let t="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((t=>t?parseInt(t,36):1));for(let e=1;e<t.length;e++)t[e]+=t[e-1];function e(e){for(let i=1;i<t.length;i+=2)if(t[i]>e)return t[i-1]<=e;return!1}function i(t){return t>=127462&&t<=127487}function n(t,e,i=!0,n=!0){return(i?s:r)(t,e,n)}function s(t,n,s){if(n==t.length)return n;n&&o(t.charCodeAt(n))&&l(t.charCodeAt(n-1))&&n--;let r=h(t,n);for(n+=c(r);n<t.length;){let o=h(t,n);if(8205==r||8205==o||s&&e(o))n+=c(o),r=o;else{if(!i(o))break;{let e=0,s=n-2;for(;s>=0&&i(h(t,s));)e++,s-=2;if(e%2==0)break;n+=2}}}return n}function r(t,e,i){for(;e>0;){let n=s(t,e-2,i);if(n<e)return n;e--}return 0}function o(t){return t>=56320&&t<57344}function l(t){return t>=55296&&t<56320}function h(t,e){let i=t.charCodeAt(e);if(!l(i)||e+1==t.length)return i;let n=t.charCodeAt(e+1);return o(n)?n-56320+(i-55296<<10)+65536:i}function a(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function c(t){return t<65536?1:2}function d(t,e,i=t.length){let s=0;for(let r=0;r<i;)9==t.charCodeAt(r)?(s+=e-s%e,r++):(s++,r=n(t,r));return s}function u(t,e,i,s){for(let s=0,r=0;;){if(r>=e)return s;if(s==t.length)break;r+=9==t.charCodeAt(s)?i-r%i:1,s=n(t,s)}return!0===s?-1:t.length}class f{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),g.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),g.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new w(this),s=new w(t);for(let t=e,r=e;;){if(n.next(t),s.next(t),t=0,n.lineBreak!=s.lineBreak||n.done!=s.done||n.value!=s.value)return!1;if(r+=n.value.length,n.done||r>=i)return!0}}iter(t=1){return new w(this,t)}iterRange(t,e=this.length){return new y(this,t,e)}iterLines(t,e){let i;if(null==t)i=this.iter();else{null==e&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new b(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new p(t):g.from(p.split(t,[])):f.empty}}class p extends f{constructor(t,e=function(t){let e=-1;for(let i of t)e+=i.length+1;return e}(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let s=0;;s++){let r=this.text[s],o=n+r.length;if((e?i:o)>=t)return new x(n,o,i,r);n=o+1,i++}}decompose(t,e,i,n){let s=t<=0&&e>=this.length?this:new p(v(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(1&n){let t=i.pop(),e=m(s.text,t.text.slice(),0,s.length);if(e.length<=32)i.push(new p(e,t.length+s.length));else{let t=e.length>>1;i.push(new p(e.slice(0,t)),new p(e.slice(t)))}}else i.push(s)}replace(t,e,i){if(!(i instanceof p))return super.replace(t,e,i);let n=m(this.text,m(i.text,v(this.text,0,t)),e),s=this.length+i.length-(e-t);return n.length<=32?new p(n,s):g.from(p.split(n,[]),s)}sliceString(t,e=this.length,i="\n"){let n="";for(let s=0,r=0;s<=e&&r<this.text.length;r++){let o=this.text[r],l=s+o.length;s>t&&r&&(n+=i),t<l&&e>s&&(n+=o.slice(Math.max(0,t-s),e-s)),s=l+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let s of t)i.push(s),n+=s.length+1,32==i.length&&(e.push(new p(i,n)),i=[],n=-1);return n>-1&&e.push(new p(i,n)),e}}class g extends f{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let e of t)this.lines+=e.lines}lineInner(t,e,i,n){for(let s=0;;s++){let r=this.children[s],o=n+r.length,l=i+r.lines-1;if((e?l:o)>=t)return r.lineInner(t,e,i,n);n=o+1,i=l+1}}decompose(t,e,i,n){for(let s=0,r=0;r<=e&&s<this.children.length;s++){let o=this.children[s],l=r+o.length;if(t<=l&&e>=r){let s=n&((r<=t?1:0)|(l>=e?2:0));r>=t&&l<=e&&!s?i.push(o):o.decompose(t-r,e-r,i,s)}r=l+1}}replace(t,e,i){if(i.lines<this.lines)for(let n=0,s=0;n<this.children.length;n++){let r=this.children[n],o=s+r.length;if(t>=s&&e<=o){let l=r.replace(t-s,e-s,i),h=this.lines-r.lines+l.lines;if(l.lines<h>>4&&l.lines>h>>6){let s=this.children.slice();return s[n]=l,new g(s,this.length-(e-t)+i.length)}return super.replace(s,o,l)}s=o+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i="\n"){let n="";for(let s=0,r=0;s<this.children.length&&r<=e;s++){let o=this.children[s],l=r+o.length;r>t&&s&&(n+=i),t<l&&e>r&&(n+=o.sliceString(t-r,e-r,i)),r=l+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof g))return 0;let i=0,[n,s,r,o]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,s+=e){if(n==r||s==o)return i;let l=this.children[n],h=t.children[s];if(l!=h)return i+l.scanIdentical(h,e);i+=l.length+1}}static from(t,e=t.reduce(((t,e)=>t+e.length+1),-1)){let i=0;for(let e of t)i+=e.lines;if(i<32){let i=[];for(let e of t)e.flatten(i);return new p(i,e)}let n=Math.max(32,i>>5),s=n<<1,r=n>>1,o=[],l=0,h=-1,a=[];function c(t){let e;if(t.lines>s&&t instanceof g)for(let e of t.children)c(e);else t.lines>r&&(l>r||!l)?(d(),o.push(t)):t instanceof p&&l&&(e=a[a.length-1])instanceof p&&t.lines+e.lines<=32?(l+=t.lines,h+=t.length+1,a[a.length-1]=new p(e.text.concat(t.text),e.length+1+t.length)):(l+t.lines>n&&d(),l+=t.lines,h+=t.length+1,a.push(t))}function d(){0!=l&&(o.push(1==a.length?a[0]:g.from(a,h)),h=-1,l=a.length=0)}for(let e of t)c(e);return d(),1==o.length?o[0]:new g(o,e)}}function m(t,e,i=0,n=1e9){for(let s=0,r=0,o=!0;r<t.length&&s<=n;r++){let l=t[r],h=s+l.length;h>=i&&(h>n&&(l=l.slice(0,n-s)),s<i&&(l=l.slice(i-s)),o?(e[e.length-1]+=l,o=!1):e.push(l)),s=h+1}return e}function v(t,e,i){return m(t,[""],e,i)}f.empty=new p([""],0);class w{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof p?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],s=this.offsets[i],r=s>>1,o=n instanceof p?n.text.length:n.children.length;if(r==(e>0?o:0)){if(0==i)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&s)==(e>0?0:1)){if(this.offsets[i]+=e,0==t)return this.lineBreak=!0,this.value="\n",this;t--}else if(n instanceof p){let s=n.text[r+(e<0?-1:0)];if(this.offsets[i]+=e,s.length>Math.max(0,t))return this.value=0==t?s:e>0?s.slice(t):s.slice(0,s.length-t),this;t-=s.length}else{let s=n.children[r+(e<0?-1:0)];t>s.length?(t-=s.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(s),this.offsets.push(e>0?1:(s instanceof p?s.text.length:s.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class y{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new w(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class b{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(f.prototype[Symbol.iterator]=function(){return this.iter()},w.prototype[Symbol.iterator]=y.prototype[Symbol.iterator]=b.prototype[Symbol.iterator]=function(){return this});class x{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}}const S=/\r\n?|\n/;var k=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(k||(k={}));class A{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let s=this.sections[e++],r=this.sections[e++];r<0?(t(i,n,s),n+=s):n+=r,i+=s}}iterChangedRanges(t,e=!1){D(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new A(t)}composeDesc(t){return this.empty?t:t.empty?this:B(this,t)}mapDesc(t,e=!1){return t.empty?this:T(this,t,e)}mapPos(t,e=-1,i=k.Simple){let n=0,s=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],l=this.sections[r++],h=n+o;if(l<0){if(h>t)return s+(t-n);s+=o}else{if(i!=k.Simple&&h>=t&&(i==k.TrackDel&&n<t&&h>t||i==k.TrackBefore&&n<t||i==k.TrackAfter&&h>t))return null;if(h>t||h==t&&e<0&&!o)return t==n||e<0?s:s+l;s+=l}n=h}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return s}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let s=n+this.sections[i++];if(this.sections[i++]>=0&&n<=e&&s>=t)return!(n<t&&s>e)||"cover";n=s}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some((t=>"number"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new A(t)}}class M extends A{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return D(this,((e,i,n,s,r)=>t=t.replace(n,n+(i-e),r)),!1),t}mapDesc(t,e=!1){return T(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,s=0;n<e.length;n+=2){let r=e[n],o=e[n+1];if(o>=0){e[n]=o,e[n+1]=r;let l=n>>1;for(;i.length<l;)i.push(f.empty);i.push(r?t.slice(s,s+r):f.empty)}s+=r}return new M(e,i)}compose(t){return this.empty?t:t.empty?this:B(this,t,!0)}map(t,e=!1){return t.empty?this:T(this,t,e,!0)}iterChanges(t,e=!1){D(this,t,e)}get desc(){return new A(this.sections)}filter(t){let e=[],i=[],n=[],s=new E(this);t:for(let r=0,o=0;;){let l=r==t.length?1e9:t[r++];for(;o<l||o==l&&0==s.len;){if(s.done)break t;let t=Math.min(s.len,l-o);C(n,t,-1);let r=-1==s.ins?-1:0==s.off?s.ins:0;C(e,t,r),r>0&&O(i,e,s.text),s.forward(t),o+=t}let h=t[r++];for(;o<h;){if(s.done)break t;let t=Math.min(s.len,h-o);C(e,t,-1),C(n,t,-1==s.ins?-1:0==s.off?s.ins:0),s.forward(t),o+=t}}return{changes:new M(e,i),filtered:new A(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):0==n?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],s=[],r=0,o=null;function l(t=!1){if(!t&&!n.length)return;r<e&&C(n,e-r,-1);let i=new M(n,s);o=o?o.compose(i.map(o)):i,n=[],s=[],r=0}return function t(h){if(Array.isArray(h))for(let e of h)t(e);else if(h instanceof M){if(h.length!=e)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${e})`);l(),o=o?o.compose(h.map(o)):h}else{let{from:t,to:o=t,insert:a}=h;if(t>o||t<0||o>e)throw new RangeError(`Invalid change range ${t} to ${o} (in doc of length ${e})`);let c=a?"string"==typeof a?f.of(a.split(i||S)):a:f.empty,d=c.length;if(t==o&&0==d)return;t<r&&l(),t>r&&C(n,t-r,-1),C(n,o-t,d),O(s,n,c),r=o}}(t),l(!o),o}static empty(t){return new M(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let s=t[n];if("number"==typeof s)e.push(s,-1);else{if(!Array.isArray(s)||"number"!=typeof s[0]||s.some(((t,e)=>e&&"string"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==s.length)e.push(s[0],0);else{for(;i.length<n;)i.push(f.empty);i[n]=f.of(s.slice(1)),e.push(s[0],i[n].length)}}}return new M(e,i)}}function C(t,e,i,n=!1){if(0==e&&i<=0)return;let s=t.length-2;s>=0&&i<=0&&i==t[s+1]?t[s]+=e:0==e&&0==t[s]?t[s+1]+=i:n?(t[s]+=e,t[s+1]+=i):t.push(e,i)}function O(t,e,i){if(0==i.length)return;let n=e.length-2>>1;if(n<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<n;)t.push(f.empty);t.push(i)}}function D(t,e,i){let n=t.inserted;for(let s=0,r=0,o=0;o<t.sections.length;){let l=t.sections[o++],h=t.sections[o++];if(h<0)s+=l,r+=l;else{let a=s,c=r,d=f.empty;for(;a+=l,c+=h,h&&n&&(d=d.append(n[o-2>>1])),!(i||o==t.sections.length||t.sections[o+1]<0);)l=t.sections[o++],h=t.sections[o++];e(s,a,r,c,d),s=a,r=c}}}function T(t,e,i,n=!1){let s=[],r=n?[]:null,o=new E(t),l=new E(e);for(let t=0,e=0;;)if(-1==o.ins)t+=o.len,o.next();else if(-1==l.ins&&e<t){let i=Math.min(l.len,t-e);l.forward(i),C(s,i,-1),e+=i}else if(l.ins>=0&&(o.done||e<t||e==t&&(l.len<o.len||l.len==o.len&&!i))){for(C(s,l.ins,-1);t>e&&!o.done&&t+o.len<e+l.len;)t+=o.len,o.next();e+=l.len,l.next()}else{if(!(o.ins>=0)){if(o.done&&l.done)return r?new M(s,r):new A(s);throw new Error("Mismatched change set lengths")}{let i=0,n=t+o.len;for(;;)if(l.ins>=0&&e>t&&e+l.len<n)i+=l.ins,e+=l.len,l.next();else{if(!(-1==l.ins&&e<n))break;{let t=Math.min(l.len,n-e);i+=t,l.forward(t),e+=t}}C(s,i,o.ins),r&&O(r,s,o.text),t=n,o.next()}}}function B(t,e,i=!1){let n=[],s=i?[]:null,r=new E(t),o=new E(e);for(let t=!1;;){if(r.done&&o.done)return s?new M(n,s):new A(n);if(0==r.ins)C(n,r.len,0,t),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(r.len2,o.len),i=n.length;if(-1==r.ins){let i=-1==o.ins?-1:o.off?0:o.ins;C(n,e,i,t),s&&i&&O(s,n,o.text)}else-1==o.ins?(C(n,r.off?0:r.len,e,t),s&&O(s,n,r.textBit(e))):(C(n,r.off?0:r.len,o.off?0:o.ins,t),s&&!o.off&&O(s,n,o.text));t=(r.ins>e||o.ins>=0&&o.len>e)&&(t||n.length>i),r.forward2(e),o.forward(e)}}else C(n,0,o.ins,t),s&&O(s,n,o.text),o.next()}}class E{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?f.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?f.empty:e[i].slice(this.off,null==t?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){-1==this.ins?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class R{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let t=3&this.flags;return 3==t?null:t}get goalColumn(){let t=this.flags>>5;return 33554431==t?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new R(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return L.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return L.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||"number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid JSON representation for SelectionRange");return L.range(t.anchor,t.head)}}class L{constructor(t,e=0){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:L.create(this.ranges.map((i=>i.map(t,e))),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new L([this.main])}addRange(t,e=!0){return L.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,L.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((t=>t.toJSON())),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new L(t.ranges.map((t=>R.fromJSON(t))),t.main)}static single(t,e=t){return new L([L.range(t,e)],0)}static create(t,e=0){if(0==t.length)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let s=t[n];if(s.empty?s.from<=i:s.from<i)return V(t.slice(),e);i=s.to}return new L(t,e)}static cursor(t,e=0,i,n){return new R(t,t,(0==e?0:e<0?4:8)|(null==i?3:Math.min(2,i))|(null!=n?n:33554431)<<5)}static range(t,e,i){let n=(null!=i?i:33554431)<<5;return e<t?new R(e,t,24|n):new R(t,e,n|(e>t?4:0))}}function V(t,e=0){let i=t[e];t.sort(((t,e)=>t.from-e.from)),e=t.indexOf(i);for(let i=1;i<t.length;i++){let n=t[i],s=t[i-1];if(n.empty?n.from<=s.to:n.from<s.to){let r=s.from,o=Math.max(n.to,s.to);i<=e&&e--,t.splice(--i,2,n.anchor>n.head?L.range(o,r):L.range(r,o))}}return new L(t,e)}function N(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}let P=0;class H{constructor(t,e,i,n,s){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.extensions=s,this.id=P++,this.default=t([])}static define(t={}){return new H(t.combine||(t=>t),t.compareInput||((t,e)=>t===e),t.compare||(t.combine?(t,e)=>t===e:W),!!t.static,t.enables)}of(t){return new I([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new I(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new I(t,this,2,e)}from(t,e){return e||(e=t=>t),this.compute([t],(i=>e(i.field(t))))}}function W(t,e){return t==e||t.length==e.length&&t.every(((t,i)=>t===e[i]))}class I{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=P++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,s=this.id,r=t[s]>>1,o=2==this.type,l=!1,h=!1,a=[];for(let i of this.dependencies)"doc"==i?l=!0:"selection"==i?h=!0:0==(1&(null!==(e=t[i.id])&&void 0!==e?e:1))&&a.push(t[i.id]);return{create:t=>(t.values[r]=i(t),1),update(t,e){if(l&&e.docChanged||h&&(e.docChanged||e.selection)||a.some((e=>(1&et(t,e))>0))){let e=i(t);if(o?!F(e,t.values[r],n):!n(e,t.values[r]))return t.values[r]=e,1}return 0},reconfigure(t,e){let l=i(t),h=e.config.address[s];if(null!=h){let i=it(e,h);if(o?F(l,i,n):n(l,i))return t.values[r]=i,0}return t.values[r]=l,1}}}}function F(t,e,i){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!i(t[n],e[n]))return!1;return!0}function z(t,e,i){let n=i.map((e=>t[e.id])),s=i.map((t=>t.type)),r=n.filter((t=>!(1&t))),o=t[e.id]>>1;function l(t){let i=[];for(let e=0;e<n.length;e++){let r=it(t,n[e]);if(2==s[e])for(let t of r)i.push(t);else i.push(r)}return e.combine(i)}return{create(t){for(let e of n)et(t,e);return t.values[o]=l(t),1},update(t,i){if(!r.some((e=>1&et(t,e))))return 0;let n=l(t);return e.compare(n,t.values[o])?0:(t.values[o]=n,1)},reconfigure(t,s){let r=n.some((e=>1&et(t,e))),h=s.config.facets[e.id],a=s.facet(e);if(h&&!r&&W(i,h))return t.values[o]=a,0;let c=l(t);return e.compare(c,a)?(t.values[o]=a,0):(t.values[o]=c,1)}}}const q=H.define({static:!0});class K{constructor(t,e,i,n,s){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=s,this.provides=void 0}static define(t){let e=new K(P++,t.create,t.update,t.compare||((t,e)=>t===e),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(q).find((t=>t.field==this));return((null==e?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:t=>(t.values[e]=this.create(t),1),update:(t,i)=>{let n=t.values[e],s=this.updateF(n,i);return this.compareF(n,s)?0:(t.values[e]=s,1)},reconfigure:(t,i)=>null!=i.config.address[this.id]?(t.values[e]=i.field(this),0):(t.values[e]=this.create(t),1)}}init(t){return[this,q.of({field:this,create:t})]}get extension(){return this}}const G=4,j=3,_=2,U=1,$=0;function Y(t){return e=>new J(e,t)}const X={lowest:Y(G),low:Y(j),default:Y(_),high:Y(U),highest:Y($),fallback:Y(G),extend:Y(U),override:Y($)};class J{constructor(t,e){this.inner=t,this.prec=e}}class Q{of(t){return new Z(this,t)}reconfigure(t){return Q.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class Z{constructor(t,e){this.compartment=t,this.inner=e}}class tt{constructor(t,e,i,n,s,r){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=s,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return null==e?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],s=Object.create(null),r=new Map;for(let i of function(t,e,i){let n=[[],[],[],[],[]],s=new Map;function r(t,o){let l=s.get(t);if(null!=l){if(l>=o)return;let e=n[l].indexOf(t);e>-1&&n[l].splice(e,1),t instanceof Z&&i.delete(t.compartment)}if(s.set(t,o),Array.isArray(t))for(let e of t)r(e,o);else if(t instanceof Z){if(i.has(t.compartment))throw new RangeError("Duplicate use of compartment in extensions");let n=e.get(t.compartment)||t.inner;i.set(t.compartment,n),r(n,o)}else if(t instanceof J)r(t.inner,t.prec);else if(t instanceof K)n[o].push(t),t.provides&&r(t.provides,o);else if(t instanceof I)n[o].push(t),t.facet.extensions&&r(t.facet.extensions,o);else{let e=t.extension;if(!e)throw new Error(`Unrecognized extension value in extension set (${t}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(e,o)}}return r(t,_),n.reduce(((t,e)=>t.concat(e)))}(t,e,r))i instanceof K?n.push(i):(s[i.facet.id]||(s[i.facet.id]=[])).push(i);let o=Object.create(null),l=[],h=[];for(let t of n)o[t.id]=h.length<<1,h.push((e=>t.slot(e)));let a=null==i?void 0:i.config.facets;for(let t in s){let e=s[t],n=e[0].facet,r=a&&a[t]||[];if(e.every((t=>0==t.type)))if(o[n.id]=l.length<<1|1,W(r,e))l.push(i.facet(n));else{let t=n.combine(e.map((t=>t.value)));l.push(i&&n.compare(t,i.facet(n))?i.facet(n):t)}else{for(let t of e)0==t.type?(o[t.id]=l.length<<1|1,l.push(t.value)):(o[t.id]=h.length<<1,h.push((e=>t.dynamicSlot(e))));o[n.id]=h.length<<1,h.push((t=>z(t,n,e)))}}let c=h.map((t=>t(o)));return new tt(t,r,c,o,l,s)}}function et(t,e){if(1&e)return 2;let i=e>>1,n=t.status[i];if(4==n)throw new Error("Cyclic dependency between fields and/or facets");if(2&n)return n;t.status[i]=4;let s=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|s}function it(t,e){return 1&e?t.config.staticValues[e>>1]:t.values[e>>1]}const nt=H.define(),st=H.define({combine:t=>t.some((t=>t)),static:!0}),rt=H.define({combine:t=>t.length?t[0]:void 0,static:!0}),ot=H.define(),lt=H.define(),ht=H.define(),at=H.define({combine:t=>!!t.length&&t[0]});class ct{constructor(t,e){this.type=t,this.value=e}static define(){return new dt}}class dt{of(t){return new ct(this,t)}}class ut{constructor(t){this.map=t}of(t){return new ft(this,t)}}class ft{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return void 0===e?void 0:e==this.value?this:new ft(this.type,e)}is(t){return this.type==t}static define(t={}){return new ut(t.map||(t=>t))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let t=n.map(e);t&&i.push(t)}return i}}ft.reconfigure=ft.define(),ft.appendConfig=ft.define();class pt{constructor(t,e,i,n,s,r){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=s,this.scrollIntoView=r,this._doc=null,this._state=null,i&&N(i,e.newLength),s.some((t=>t.type==pt.time))||(this.annotations=s.concat(pt.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(pt.userEvent);return!(!e||!(e==t||e.length>t.length&&e.slice(0,t.length)==t&&"."==e[t.length]))}}function gt(t,e){let i=[];for(let n=0,s=0;;){let r,o;if(n<t.length&&(s==e.length||e[s]>=t[n]))r=t[n++],o=t[n++];else{if(!(s<e.length))return i;r=e[s++],o=e[s++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function mt(t,e,i){var n;let s,r,o;return i?(s=e.changes,r=M.empty(e.changes.length),o=t.changes.compose(e.changes)):(s=e.changes.map(t.changes),r=t.changes.mapDesc(e.changes,!0),o=t.changes.compose(s)),{changes:o,selection:e.selection?e.selection.map(r):null===(n=t.selection)||void 0===n?void 0:n.map(s),effects:ft.mapEffects(t.effects,s).concat(ft.mapEffects(e.effects,r)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function vt(t,e,i){let n=e.selection,s=bt(e.annotations);return e.userEvent&&(s=s.concat(pt.userEvent.of(e.userEvent))),{changes:e.changes instanceof M?e.changes:M.of(e.changes||[],i,t.facet(rt)),selection:n&&(n instanceof L?n:L.single(n.anchor,n.head)),effects:bt(e.effects),annotations:s,scrollIntoView:!!e.scrollIntoView}}function wt(t,e,i){let n=vt(t,e.length?e[0]:{},t.doc.length);e.length&&!1===e[0].filter&&(i=!1);for(let s=1;s<e.length;s++){!1===e[s].filter&&(i=!1);let r=!!e[s].sequential;n=mt(n,vt(t,e[s],r?n.changes.newLength:t.doc.length),r)}let s=new pt(t,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return function(t){let e=t.startState,i=e.facet(ht),n=t;for(let s=i.length-1;s>=0;s--){let r=i[s](t);r&&Object.keys(r).length&&(n=mt(t,vt(e,r,t.changes.newLength),!0))}return n==t?t:new pt(e,t.changes,t.selection,n.effects,n.annotations,n.scrollIntoView)}(i?function(t){let e=t.startState,i=!0;for(let n of e.facet(ot)){let e=n(t);if(!1===e){i=!1;break}Array.isArray(e)&&(i=!0===i?e:gt(i,e))}if(!0!==i){let n,s;if(!1===i)s=t.changes.invertedDesc,n=M.empty(e.doc.length);else{let e=t.changes.filter(i);n=e.changes,s=e.filtered.invertedDesc}t=new pt(e,n,t.selection&&t.selection.map(s),ft.mapEffects(t.effects,s),t.annotations,t.scrollIntoView)}let n=e.facet(lt);for(let i=n.length-1;i>=0;i--){let s=n[i](t);t=s instanceof pt?s:Array.isArray(s)&&1==s.length&&s[0]instanceof pt?s[0]:wt(e,bt(s),!1)}return t}(s):s)}pt.time=ct.define(),pt.userEvent=ct.define(),pt.addToHistory=ct.define(),pt.remote=ct.define();const yt=[];function bt(t){return null==t?yt:Array.isArray(t)?t:[t]}var xt=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(xt||(xt={}));const St=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let kt;try{kt=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(t){}function At(t){return e=>{if(!/\S/.test(e))return xt.Space;if(function(t){if(kt)return kt.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||St.test(i)))return!0}return!1}(e))return xt.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return xt.Word;return xt.Other}}class Mt{constructor(t,e,i,n,s,r){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=s,r&&(r._state=this);for(let t=0;t<this.config.dynamicSlots.length;t++)et(this,t<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(null!=i)return et(this,i),it(this,i);if(e)throw new RangeError("Field is not present in this state")}update(...t){return wt(this,t,!0)}applyTransaction(t){let e,i=this.config,{base:n,compartments:s}=i;for(let e of t.effects)e.is(Q.reconfigure)?(i&&(s=new Map,i.compartments.forEach(((t,e)=>s.set(e,t))),i=null),s.set(e.value.compartment,e.value.extension)):e.is(ft.reconfigure)?(i=null,n=e.value):e.is(ft.appendConfig)&&(i=null,n=bt(n).concat(e.value));if(i)e=t.startState.values.slice();else{i=tt.resolve(n,s,this),e=new Mt(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((t,e)=>e.reconfigure(t,this)),null).values}new Mt(i,t.newDoc,t.newSelection,e,((e,i)=>i.update(e,t)),t)}replaceSelection(t){return"string"==typeof t&&(t=this.toText(t)),this.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:t},range:L.cursor(e.from+t.length)})))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),s=[i.range],r=bt(i.effects);for(let i=1;i<e.ranges.length;i++){let o=t(e.ranges[i]),l=this.changes(o.changes),h=l.map(n);for(let t=0;t<i;t++)s[t]=s[t].map(h);let a=n.mapDesc(l,!0);s.push(o.range.map(a)),n=n.compose(h),r=ft.mapEffects(r,h).concat(ft.mapEffects(bt(o.effects),a))}return{changes:n,selection:L.create(s,e.mainIndex),effects:r}}changes(t=[]){return t instanceof M?t:M.of(t,this.doc.length,this.facet(Mt.lineSeparator))}toText(t){return f.of(t.split(this.facet(Mt.lineSeparator)||S))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return null==e?t.default:(et(this,e),it(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof K&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let e in i){let s=i[e],r=t[e];n.push(s.init((t=>s.spec.fromJSON(r,t))))}return Mt.create({doc:t.doc,selection:L.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=tt.resolve(t.extensions||[],new Map),i=t.doc instanceof f?t.doc:f.of((t.doc||"").split(e.staticFacet(Mt.lineSeparator)||S)),n=t.selection?t.selection instanceof L?t.selection:L.single(t.selection.anchor,t.selection.head):L.single(0);return N(n,i.length),e.staticFacet(st)||(n=n.asSingle()),new Mt(e,i,n,e.dynamicSlots.map((()=>null)),((t,e)=>e.create(t)),null)}get tabSize(){return this.facet(Mt.tabSize)}get lineBreak(){return this.facet(Mt.lineSeparator)||"\n"}get readOnly(){return this.facet(at)}phrase(t){for(let e of this.facet(Mt.phrases))if(Object.prototype.hasOwnProperty.call(e,t))return e[t];return t}languageDataAt(t,e,i=-1){let n=[];for(let s of this.facet(nt))for(let r of s(this,e,i))Object.prototype.hasOwnProperty.call(r,t)&&n.push(r[t]);return n}charCategorizer(t){return At(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let t=n(e,o,!1);if(r(e.slice(t,o))!=xt.Word)break;o=t}for(;l<s;){let t=n(e,l);if(r(e.slice(l,t))!=xt.Word)break;l=t}return o==l?null:L.range(o+i,l+i)}}function Ct(t,e,i={}){let n={};for(let e of t)for(let t of Object.keys(e)){let s=e[t],r=n[t];if(void 0===r)n[t]=s;else if(r===s||void 0===s);else{if(!Object.hasOwnProperty.call(i,t))throw new Error("Config merge conflict for field "+t);n[t]=i[t](r,s)}}for(let t in e)void 0===n[t]&&(n[t]=e[t]);return n}Mt.allowMultipleSelections=st,Mt.tabSize=H.define({combine:t=>t.length?t[0]:4}),Mt.lineSeparator=rt,Mt.readOnly=at,Mt.phrases=H.define(),Mt.languageData=nt,Mt.changeFilter=ot,Mt.transactionFilter=lt,Mt.transactionExtender=ht,Q.reconfigure=ft.define();const Ot="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),Dt="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),Tt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class Bt{constructor(t,e){this.rules=[];let{finish:i}=e||{};function n(t){return/^@/.test(t)?[t]:t.split(/,\s*/)}function s(t,e,r,o){let l=[],h=/^@(\w+)\b/.exec(t[0]),a=h&&"keyframes"==h[1];if(h&&null==e)return r.push(t[0]+";");for(let i in e){let o=e[i];if(/&/.test(i))s(i.split(/,\s*/).map((e=>t.map((t=>e.replace(/&/,t))))).reduce(((t,e)=>t.concat(e))),o,r);else if(o&&"object"==typeof o){if(!h)throw new RangeError("The value of a property ("+i+") should be a primitive value.");s(n(i),o,l,a)}else null!=o&&l.push(i.replace(/_.*/,"").replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()))+": "+o+";")}(l.length||a)&&r.push((!i||h||o?t:t.map(i)).join(", ")+" {"+l.join(" ")+"}")}for(let e in t)s(n(e),t[e],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let t=Tt[Ot]||1;return Tt[Ot]=t+1,"ͼ"+t.toString(36)}static mount(t,e){(t[Dt]||new Rt(t)).mount(Array.isArray(e)?e:[e])}}let Et=null;class Rt{constructor(t){if(!t.head&&t.adoptedStyleSheets&&"undefined"!=typeof CSSStyleSheet){if(Et)return t.adoptedStyleSheets=[Et.sheet].concat(t.adoptedStyleSheets),t[Dt]=Et;this.sheet=new CSSStyleSheet,t.adoptedStyleSheets=[this.sheet].concat(t.adoptedStyleSheets),Et=this}else{this.styleTag=(t.ownerDocument||t).createElement("style");let e=t.head||t;e.insertBefore(this.styleTag,e.firstChild)}this.modules=[],t[Dt]=this}mount(t){let e=this.sheet,i=0,n=0;for(let s=0;s<t.length;s++){let r=t[s],o=this.modules.indexOf(r);if(o<n&&o>-1&&(this.modules.splice(o,1),n--,o=-1),-1==o){if(this.modules.splice(n++,0,r),e)for(let t=0;t<r.rules.length;t++)e.insertRule(r.rules[t],i++)}else{for(;n<o;)i+=this.modules[n++].rules.length;i+=r.rules.length,n++}}if(!e){let t="";for(let e=0;e<this.modules.length;e++)t+=this.modules[e].getRules()+"\n";this.styleTag.textContent=t}}}class Lt{eq(t){return this==t}range(t,e=t){return new Vt(t,e,this)}}Lt.prototype.startSide=Lt.prototype.endSide=0,Lt.prototype.point=!1,Lt.prototype.mapMode=k.TrackDel;class Vt{constructor(t,e,i){this.from=t,this.to=e,this.value=i}}function Nt(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class Pt{constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let s=i?this.to:this.from;for(let r=n,o=s.length;;){if(r==o)return r;let n=r+o>>1,l=s[n]-t||(i?this.value[n].endSide:this.value[n].startSide)-e;if(n==r)return l>=0?r:o;l>=0?o=n:r=n+1}}between(t,e,i,n){for(let s=this.findIndex(e,-1e9,!0),r=this.findIndex(i,1e9,!1,s);s<r;s++)if(!1===n(this.from[s]+t,this.to[s]+t,this.value[s]))return!1}map(t,e){let i=[],n=[],s=[],r=-1,o=-1;for(let l=0;l<this.value.length;l++){let h,a,c=this.value[l],d=this.from[l]+t,u=this.to[l]+t;if(d==u){let t=e.mapPos(d,c.startSide,c.mapMode);if(null==t)continue;if(h=a=t,c.startSide!=c.endSide&&(a=e.mapPos(d,c.endSide),a<h))continue}else if(h=e.mapPos(d,c.startSide),a=e.mapPos(u,c.endSide),h>a||h==a&&c.startSide>0&&c.endSide<=0)continue;(a-h||c.endSide-c.startSide)<0||(r<0&&(r=h),c.point&&(o=Math.max(o,a-h)),i.push(c),n.push(h-r),s.push(a-r))}return{mapped:i.length?new Pt(n,s,i,o):null,pos:r}}}class Ht{constructor(t,e,i=Ht.empty,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:s=this.length}=t,r=t.filter;if(0==e.length&&!r)return this;if(i&&(e=e.slice().sort(Nt)),this.isEmpty)return e.length?Ht.of(e):this;let o=new Ft(this,null,-1).goto(0),l=0,h=[],a=new Wt;for(;o.value||l<e.length;)if(l<e.length&&(o.from-e[l].from||o.startSide-e[l].value.startSide)>=0){let t=e[l++];a.addInner(t.from,t.to,t.value)||h.push(t)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(l==e.length||this.chunkEnd(o.chunkIndex)<e[l].from)&&(!r||n>this.chunkEnd(o.chunkIndex)||s<this.chunkPos[o.chunkIndex])&&a.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!r||n>o.to||s<o.from||r(o.from,o.to,o.value))&&(a.addInner(o.from,o.to,o.value)||h.push(new Vt(o.from,o.to,o.value))),o.next());return a.finishInner(this.nextLayer.isEmpty&&!h.length?Ht.empty:this.nextLayer.update({add:h,filter:r,filterFrom:n,filterTo:s}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],o=this.chunk[s],l=t.touchesRange(r,r+o.length);if(!1===l)n=Math.max(n,o.maxPoint),e.push(o),i.push(t.mapPos(r));else if(!0===l){let{mapped:s,pos:l}=o.map(r,t);s&&(n=Math.max(n,s.maxPoint),e.push(s),i.push(l))}}let s=this.nextLayer.map(t);return 0==e.length?s:new Ht(i,e,s,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let s=this.chunkPos[n],r=this.chunk[n];if(e>=s&&t<=s+r.length&&!1===r.between(s,t-s,e-s,i))return}this.nextLayer.between(t,e,i)}}iter(t=0){return zt.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return zt.from(t).goto(e)}static compare(t,e,i,n,s=-1){let r=t.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=s)),o=e.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=s)),l=It(r,o,i),h=new Kt(r,l,s),a=new Kt(o,l,s);i.iterGaps(((t,e,i)=>Gt(h,t,a,e,i,n))),i.empty&&0==i.length&&Gt(h,0,a,0,0,n)}static eq(t,e,i=0,n){null==n&&(n=1e9);let s=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0)),r=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0));if(s.length!=r.length)return!1;if(!s.length)return!0;let o=It(s,r),l=new Kt(s,o,0).goto(i),h=new Kt(r,o,0).goto(i);for(;;){if(l.to!=h.to||!jt(l.active,h.active)||l.point&&(!h.point||!l.point.eq(h.point)))return!1;if(l.to>n)return!0;l.next(),h.next()}}static spans(t,e,i,n,s=-1){var r;let o=new Kt(t,null,s,null===(r=n.filterPoint)||void 0===r?void 0:r.bind(n)).goto(e),l=e,h=o.openStart;for(;;){let t=Math.min(o.to,i);if(o.point?(n.point(l,t,o.point,o.activeForPoint(o.to),h),h=o.openEnd(t)+(o.to>t?1:0)):t>l&&(n.span(l,t,o.active,h),h=o.openEnd(t)),o.to>i)break;l=o.to,o.next()}return h}static of(t,e=!1){let i=new Wt;for(let n of t instanceof Vt?[t]:e?function(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let n=t[i];if(Nt(e,n)>0)return t.slice().sort(Nt);e=n}return t}(t):t)i.add(n.from,n.to,n.value);return i.finish()}}Ht.empty=new Ht([],[],null,-1),Ht.empty.nextLayer=Ht.empty;class Wt{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new Pt(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new Wt)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(n<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(Ht.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return t;let e=new Ht(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function It(t,e,i){let n=new Map;for(let e of t)for(let t=0;t<e.chunk.length;t++)e.chunk[t].maxPoint<=0&&n.set(e.chunk[t],e.chunkPos[t]);let s=new Set;for(let t of e)for(let e=0;e<t.chunk.length;e++){let r=n.get(t.chunk[e]);null==r||(i?i.mapPos(r):r)!=t.chunkPos[e]||(null==i?void 0:i.touchesRange(r,r+t.chunk[e].length))||s.add(t.chunk[e])}return s}class Ft{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let e=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(e)||this.layer.chunkEnd(this.chunkIndex)<t||e.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.to-t.to||this.endSide-t.endSide}}class zt{constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let s=0;s<t.length;s++)for(let r=t[s];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&n.push(new Ft(r,e,i,s));return 1==n.length?n[0]:new zt(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let t=this.heap.length>>1;t>=0;t--)qt(this.heap,t);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let t=this.heap.length>>1;t>=0;t--)qt(this.heap,t);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),qt(this.heap,0)}}}function qt(t,e){for(let i=t[e];;){let n=1+(e<<1);if(n>=t.length)break;let s=t[n];if(n+1<t.length&&s.compare(t[n+1])>=0&&(s=t[n+1],n++),i.compare(s)<0)break;t[n]=i,t[e]=s,e=n}}class Kt{constructor(t,e,i,n=(()=>!0)){this.minPoint=i,this.filterPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=zt.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){_t(this.active,t),_t(this.activeTo,t),_t(this.activeRank,t),this.minActive=$t(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:s}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=s;)e++;Ut(this.active,e,i),Ut(this.activeTo,e,n),Ut(this.activeRank,e,s),t&&Ut(t,e,this.cursor.from),this.minActive=$t(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>t){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&_t(i,s)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let s=this.cursor.value;if(s.point)if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{if(this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank)){this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.from<t&&(n=1),this.cursor.next(),this.to>t&&this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){let e=0;for(;e<i.length&&i[e]<t;)e++;this.openStart=e+n}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function Gt(t,e,i,n,s,r){t.goto(e),i.goto(n);let o=n+s,l=n,h=n-e;for(;;){let e=t.to+h-i.to||t.endSide-i.endSide,n=e<0?t.to+h:i.to,s=Math.min(n,o);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&jt(t.activeForPoint(t.to+h),i.activeForPoint(i.to))||r.comparePoint(l,s,t.point,i.point):s>l&&!jt(t.active,i.active)&&r.compareRange(l,s,t.active,i.active),n>o)break;l=n,e<=0&&t.next(),e>=0&&i.next()}}function jt(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function _t(t,e){for(let i=e,n=t.length-1;i<n;i++)t[i]=t[i+1];t.pop()}function Ut(t,e,i){for(let i=t.length-1;i>=e;i--)t[i+1]=t[i];t[e]=i}function $t(t,e){let i=-1,n=1e9;for(let s=0;s<e.length;s++)(e[s]-n||t[s].endSide-t[i].endSide)<0&&(i=s,n=e[s]);return i}for(var Yt={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},Xt={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},Jt="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),Qt="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),Zt="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),te="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ee="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),ie=Jt&&(te||+Jt[1]<57)||Zt&&te,ne=0;ne<10;ne++)Yt[48+ne]=Yt[96+ne]=String(ne);for(ne=1;ne<=24;ne++)Yt[ne+111]="F"+ne;for(ne=65;ne<=90;ne++)Yt[ne]=String.fromCharCode(ne+32),Xt[ne]=String.fromCharCode(ne);for(var se in Yt)Xt.hasOwnProperty(se)||(Xt[se]=Yt[se]);function re(t){var e=!(ie&&(t.ctrlKey||t.altKey||t.metaKey)||(Qt||ee)&&t.shiftKey&&t.key&&1==t.key.length)&&t.key||(t.shiftKey?Xt:Yt)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}function oe(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function le(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function he(t,e){if(!e.anchorNode)return!1;try{return le(t,e.anchorNode)}catch(t){return!1}}function ae(t){return 3==t.nodeType?xe(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function ce(t,e,i,n){return!!i&&(ue(t,e,i,n,-1)||ue(t,e,i,n,1))}function de(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function ue(t,e,i,n,s){for(;;){if(t==i&&e==n)return!0;if(e==(s<0?0:fe(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=de(t)+(s<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(s<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=s<0?fe(t):0}}}function fe(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const pe={left:0,right:0,top:0,bottom:0};function ge(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function me(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class ve{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let we,ye=null;function be(t){if(t.setActive)return t.setActive();if(ye)return t.focus(ye);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==ye?{get preventScroll(){return ye={preventScroll:!0},!0}}:void 0),!ye){ye=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],s=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function xe(t,e,i=e){let n=we||(we=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function Se(t,e,i){let n={key:e,code:e,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,t.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,t.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function ke(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Ae{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Ae(t.parentNode,de(t),e)}static after(t,e){return new Ae(t.parentNode,de(t)+1,e)}}const Me=[];class Ce{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e=this.dom,i=e.firstChild;for(let n of this.children){if(n.dirty){if(!n.dom&&i){let t=Ce.get(i);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(i)}n.sync(t),n.dirty=0}if(t&&!t.written&&t.node==e&&i!=n.dom&&(t.written=!0),n.dom.parentNode==e){for(;i&&i!=n.dom;)i=Oe(i);i=n.dom.nextSibling}else e.insertBefore(n.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=Oe(i)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=0==fe(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==n&&e.firstChild!=e.lastChild&&(n=t==e.firstChild?-1:1),t=e}i=n<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Ce.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let n=this.children[t];if(n.dom==i)return e;e+=n.length+n.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,r=-1,o=-1;for(let l=0,h=i,a=i;l<this.children.length;l++){let i=this.children[l],c=h+i.length;if(h<t&&c>e)return i.domBoundsAround(t,e,h);if(c>=t&&-1==n&&(n=l,s=h),h>e&&i.dom.parentNode==this.dom){r=l,o=a;break}a=c,h=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Me){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new De(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Oe(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}Ce.prototype.breakAfter=0;class De{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Te(t,e,i,n,s,r,o,l,h){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(i,s,r.length?d:null,0==i,l,h))){if(n<a.length){let t=a[n];t&&s<t.length?(e==n&&(t=t.split(s),s=0),!u&&d&&t.merge(0,s,d,!0,0,h)?r[r.length-1]=t:(s&&t.merge(0,s,null,!1,0,h),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),e++));e<n&&r.length;)if(a[n-1].become(r[r.length-1]))n--,r.pop(),h=r.length?0:l;else{if(!a[e].become(r[0]))break;e++,r.shift(),l=r.length?0:h}!r.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,l,h)&&e--,(e<n||r.length)&&t.replaceChildren(e,n,r)}}function Be(t,e,i,n,s,r){let o=t.childCursor(),{i:l,off:h}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of n)d+=t.length;t.length+=d,Te(t,a,c,l,h,n,0,s,r)}let Ee="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Re="undefined"!=typeof document?document:{documentElement:{style:{}}};const Le=/Edge\/(\d+)/.exec(Ee.userAgent),Ve=/MSIE \d/.test(Ee.userAgent),Ne=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ee.userAgent),Pe=!!(Ve||Ne||Le),He=!Pe&&/gecko\/(\d+)/i.test(Ee.userAgent),We=!Pe&&/Chrome\/(\d+)/.exec(Ee.userAgent),Ie="webkitFontSmoothing"in Re.documentElement.style,Fe=!Pe&&/Apple Computer/.test(Ee.vendor),ze=Fe&&(/Mobile\/\w+/.test(Ee.userAgent)||Ee.maxTouchPoints>2);var qe={mac:ze||/Mac/.test(Ee.platform),windows:/Win/.test(Ee.platform),linux:/Linux|X11/.test(Ee.platform),ie:Pe,ie_version:Ve?Re.documentMode||6:Ne?+Ne[1]:Le?+Le[1]:0,gecko:He,gecko_version:He?+(/Firefox\/(\d+)/.exec(Ee.userAgent)||[0,0])[1]:0,chrome:!!We,chrome_version:We?+We[1]:0,ios:ze,android:/Android\b/.test(Ee.userAgent),webkit:Ie,safari:Fe,webkit_version:Ie?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Re.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class Ke extends Ce{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof Ke&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Ke(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Ae(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return je(this.dom,t,e)}}class Ge extends Ce{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(ke(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,r){return(!i||!(!(i instanceof Ge&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&r<=0))&&(Be(this,t,e,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),n<0&&i>=t&&(n=s),i=o,s++}let r=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new Ge(this.mark,e,r)}domAtPos(t){return Je(this.dom,this.children,t)}coordsAt(t,e){return Ze(this,t,e)}}function je(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;0==e&&i<0||e==n&&i>=0?qe.chrome||qe.gecko||(e?(s--,o=1):(r++,o=-1)):i<0?s--:r++;let l=xe(t,s,r).getClientRects();if(!l.length)return pe;let h=l[(o?o<0:i>=0)?0:l.length-1];return qe.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(l,(t=>t.width))||h),o?ge(h,o<0):h||null}class _e extends Ce{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||_e)(t,e,i)}split(t){let e=_e.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof _e&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof _e&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return f.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):f.empty}domAtPos(t){return 0==t?Ae.before(this.dom):Ae.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return pe;for(let e=t>0?i.length-1:0;n=i[e],!(t>0?0==e:e==i.length-1||n.top<n.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?n:ge(n,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Ue extends _e{domAtPos(t){let{topView:e,text:i}=this.widget;return e?$e(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Ae(i,Math.min(t,i.nodeValue.length)))):new Ae(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?Ye(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?$e(t,e,i,n,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>je(n,t,e))):je(n,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function $e(t,e,i,n,s,r){if(i instanceof Ge){for(let o of i.children){let i=le(o.dom,n),l=i?n.nodeValue.length:o.length;if(t<l||t==l&&o.getSide()<=0)return i?$e(t,e,o,n,s,r):s(o,t,e);t-=l}return s(i,i.length,-1)}return i.dom==n?r(t,e):s(i,t,e)}function Ye(t,e,i,n){if(i instanceof Ge)for(let s of i.children){let i=0,r=le(s.dom,n);if(le(s.dom,t))return i+(r?Ye(t,e,s,n):s.localPosFromDOM(t,e));i+=r?n.nodeValue.length:s.length}else if(i.dom==n)return Math.min(e,n.nodeValue.length);return i.localPosFromDOM(t,e)}class Xe extends Ce{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Xe&&t.side==this.side}split(){return new Xe(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Ae.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,n=i?i.children.indexOf(t):-1;for(;i&&n>=0;)if(e<0?n>0:n<i.children.length){let t=i.children[n+e];if(t instanceof Ke){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}n+=e}else{if(!(i instanceof Ge&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}n=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return f.empty}}function Je(t,e,i){let n=0;for(let s=0;n<e.length;n++){let r=e[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return Ae.after(i)}return new Ae(t,0)}function Qe(t,e,i){let n,{children:s}=t;i>0&&e instanceof Ge&&s.length&&(n=s[s.length-1])instanceof Ge&&n.mark.eq(e.mark)?Qe(n,e.children[0],i-1):(s.push(e),e.setParent(t)),t.length+=e.length}function Ze(t,e,i){for(let n=0,s=0;s<t.children.length;s++){let r,o=t.children[s],l=n+o.length;if((i<=0||l==t.length||o.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(r=t.children[s+1]).length||r.getSide()>0)){let t=0;if(l==n){if(o.getSide()<=0)continue;t=i=-o.getSide()}let s=o.coordsAt(Math.max(0,e-n),i);return t&&s?ge(s,i<0):s}n=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let s=ae(n);return s[s.length-1]||null}function ti(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function ei(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||t[s]!==e[s])return!1;return!0}function ii(t,e,i){if(e)for(let n in e)i&&n in i||t.removeAttribute(n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(n,i[n])}Ke.prototype.children=_e.prototype.children=Xe.prototype.children=Me;class ni{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var si=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(si||(si={}));class ri extends Lt{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new oi(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?4e8:-5e8:e>0?1e8:-1e8,new hi(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,n=!!t.block;if(t.isBlockGap)e=-4e8,i=3e8;else{let{start:s,end:r}=ai(t,n);e=(s?n?-3e8:-1:5e8)-1,i=1+(r?n?2e8:1:-6e8)}return new hi(t,e,i,n,t.widget||null,!0)}static line(t){return new li(t)}static set(t,e=!1){return Ht.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}ri.none=Ht.empty;class oi extends ri{constructor(t){let{start:e,end:i}=ai(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof oi&&this.tagName==t.tagName&&this.class==t.class&&ei(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}oi.prototype.point=!1;class li extends ri{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof li&&ei(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}li.prototype.mapMode=k.TrackBefore,li.prototype.point=!0;class hi extends ri{constructor(t,e,i,n,s,r){super(e,i,s,t),this.block=n,this.isReplace=r,this.mapMode=n?e<=0?k.TrackBefore:k.TrackAfter:k.TrackDel}get type(){return this.startSide<this.endSide?si.WidgetRange:this.startSide<=0?si.WidgetBefore:si.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof hi&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function ai(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return null==i&&(i=t.inclusive),null==n&&(n=t.inclusive),{start:null!=i?i:e,end:null!=n?n:e}}function ci(t,e,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=t?i[s]=Math.max(i[s],e):i.push(t,e)}hi.prototype.point=!0;class di extends Ce{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,r){if(i){if(!(i instanceof di))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Be(this,t,e,i?i.children:[],s,r),!0}split(t){let e=new di;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){ei(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Qe(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=ti(e,this.attrs||{})),i&&(this.attrs=ti({class:i},this.attrs||{}))}domAtPos(t){return Je(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(ke(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(ii(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Ce.get(i)instanceof Ge;)i=i.lastChild;if(!i||"BR"!=i.nodeName&&0==(null===(e=Ce.get(i))||void 0===e?void 0:e.isEditable)&&(!qe.ios||!this.children.some((t=>t instanceof Ke)))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Ke))return null;let i=ae(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return Ze(this,t,e)}become(t){return!1}get type(){return si.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],r=n+s.length;if(r>=e){if(s instanceof di)return s;if(r>e)break}n=r+s.breakAfter}return null}}class ui extends Ce{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof ui&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Ae.before(this.dom):Ae.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new ui(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Me}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):f.empty}domBoundsAround(){return null}become(t){return t instanceof ui&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class fi{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof ui&&t.type==si.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new di),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(pi(new Xe(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(pi(new Ke(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s){let r=e-t;if(i instanceof hi)if(i.block){let{type:t}=i;t!=si.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new ui(i.widget||new gi("div"),r,t))}else{let o=_e.create(i.widget||new gi("span"),r,i.startSide),l=this.atCursorPos&&!o.isEditable&&s<=n.length&&(t<e||i.startSide>0),h=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(n),l&&(a.append(pi(new Xe(1),n),s),s=n.length+Math.max(0,s-n.length)),a.append(pi(o,n),s),this.atCursorPos=h,this.pendingBuffer=h?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}filterPoint(t,e,i,n){if(n<this.disallowBlockEffectsBelow&&i instanceof hi){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,n,s){let r=new fi(t,e,i,s);return r.openEnd=Ht.spans(n,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function pi(t,e){for(let i of e)t=new Ge(i,[t],t.length);return t}class gi extends ni{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const mi=[],vi=H.define(),wi=H.define(),yi=H.define(),bi=H.define(),xi=H.define(),Si=H.define(),ki=ft.define({map:(t,e)=>t.map(e)}),Ai=ft.define({map:(t,e)=>t.map(e)});class Mi{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new Mi(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const Ci=ft.define({map:(t,e)=>t.map(e)});function Oi(t,e,i){let n=t.facet(bi);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const Di=H.define({combine:t=>!t.length||t[0]});class Ti{constructor(t,e){this.field=t,this.get=e}}class Bi{from(t){return new Ti(this,t)}static define(){return new Bi}}Bi.decorations=Bi.define(),Bi.atomicRanges=Bi.define(),Bi.scrollMargins=Bi.define();let Ei=0;const Ri=H.define();class Li{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Ri.of(this)}static define(t,e){let{eventHandlers:i,provide:n,decorations:s}=e||{},r=[];if(n)for(let t of Array.isArray(n)?n:[n])r.push(t);return i&&r.push(Vi.from((t=>({plugin:t,handlers:i})))),s&&r.push(Bi.decorations.from(s)),new Li(Ei++,t,r)}static fromClass(t,e){return Li.define((e=>new t(e)),e)}}const Vi=Bi.define();class Ni{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:n}of this.spec.fields)i==t&&e.push(n(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(Oi(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Oi(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Oi(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Pi=H.define(),Hi=H.define(),Wi=H.define(),Ii=H.define();class Fi{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new Fi(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let l=n==t.length?null:t[n],h=r-o,a=l?l.fromB:1e9;for(;s<e.length&&e[s]<a;){let t=e[s],n=e[s+1],r=Math.max(o,t),l=Math.min(a,n);if(r<=l&&new Fi(r+h,l+h,r,l).addToSet(i),n>a)break;s+=2}if(!l)return i;new Fi(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class zi{constructor(t,e,i=mi){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=M.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let n=[];this.changes.iterChangedRanges(((t,e,i,s)=>n.push(new Fi(t,e,i,s)))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var qi=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(qi||(qi={}));const Ki=qi.LTR,Gi=qi.RTL;function ji(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const _i=ji("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Ui=ji("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),$i=Object.create(null),Yi=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);$i[e]=i,$i[i]=-e}const Xi=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Ji{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?Gi:Ki}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<e:o.to>e:t[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const Qi=[];function Zi(t,e){let i=t.length,n=e==Ki?1:2,s=e==Ki?2:1;if(!t||1==n&&!Xi.test(t))return tn(i);for(let e=0,s=n,o=n;e<i;e++){let i=(r=t.charCodeAt(e))<=247?_i[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Ui[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),Qi[e]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let t=0,e=n,s=n;t<i;t++){let n=Qi[t];if(128==n)t<i-1&&e==Qi[t+1]&&24&e?n=Qi[t]=e:Qi[t]=256;else if(64==n){let n=t+1;for(;n<i&&64==Qi[n];)n++;let r=t&&8==e||n<i&&8==Qi[n]?1==s?1:8:256;for(let e=t;e<n;e++)Qi[e]=r;t=n-1}else 8==n&&1==s&&(Qi[t]=1);e=n,7&n&&(s=n)}for(let e,r,o,l=0,h=0,a=0;l<i;l++)if(r=$i[e=t.charCodeAt(l)])if(r<0){for(let t=h-3;t>=0;t-=3)if(Yi[t+1]==-r){let e=Yi[t+2],i=2&e?n:4&e?1&e?s:n:0;i&&(Qi[l]=Qi[Yi[t]]=i),h=t;break}}else{if(189==Yi.length)break;Yi[h++]=l,Yi[h++]=e,Yi[h++]=a}else if(2==(o=Qi[l])||1==o){let t=o==n;a=t?0:1;for(let e=h-3;e>=0;e-=3){let i=Yi[e+2];if(2&i)break;if(t)Yi[e+2]|=2;else{if(4&i)break;Yi[e+2]|=4}}}for(let t=0;t<i;t++)if(256==Qi[t]){let e=t+1;for(;e<i&&256==Qi[e];)e++;let s=1==(t?Qi[t-1]:n),r=s==(1==(e<i?Qi[e]:n))?s?1:2:n;for(let i=t;i<e;i++)Qi[i]=r;t=e-1}let o=[];if(1==n)for(let t=0;t<i;){let e=t,n=1!=Qi[t++];for(;t<i&&n==(1!=Qi[t]);)t++;if(n)for(let i=t;i>e;){let t=i,n=2!=Qi[--i];for(;i>e&&n==(2!=Qi[i-1]);)i--;o.push(new Ji(i,t,n?2:1))}else o.push(new Ji(e,t,0))}else for(let t=0;t<i;){let e=t,n=2==Qi[t++];for(;t<i&&n==(2==Qi[t]);)t++;o.push(new Ji(e,t,n?1:2))}return o}function tn(t){return[new Ji(0,t,0)]}let en="";function nn(t,e,i,s,r){var o;let l=s.head-t.from,h=-1;if(0==l){if(!r||!t.length)return null;e[0].level!=i&&(l=e[0].side(!1,i),h=0)}else if(l==t.length){if(r)return null;let t=e[e.length-1];t.level!=i&&(l=t.side(!0,i),h=e.length-1)}h<0&&(h=Ji.find(e,l,null!==(o=s.bidiLevel)&&void 0!==o?o:-1,s.assoc));let a=e[h];l==a.side(r,i)&&(a=e[h+=r?1:-1],l=a.side(!r,i));let c=r==(a.dir==i),d=n(t.text,l,c);if(en=t.text.slice(Math.min(l,d),Math.max(l,d)),d!=a.side(r,i))return L.cursor(d+t.from,c?-1:1,a.level);let u=h==(r?e.length-1:0)?null:e[h+(r?1:-1)];return u||a.level==i?u&&u.level<a.level?L.cursor(u.side(!r,i)+t.from,r?1:-1,u.level):L.cursor(d+t.from,r?-1:1,a.level):L.cursor(r?t.to:t.from,r?-1:1,i)}class sn{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Mt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let t=n.nextSibling;if(t==e)break;let s=Ce.get(n),r=Ce.get(t);(s&&r?s.breakAfter:(s?s.breakAfter:rn(n))||rn(t)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(e))&&(r=s.index,o=s[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Ce.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function rn(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class on{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class ln extends Ce{constructor(t){super(),this.view=t,this.compositionDeco=ri.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new di],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Fi(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ri.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=an(t);if(!i)return ri.none;let{from:n,to:s,node:r,text:o}=i,l=e.mapPos(n,1),h=Math.max(l,e.mapPos(s,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new sn([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),"￿")==c)h=l+c.length;else{if(a.doc.sliceString(Math.max(0,h-c.length),h,"￿")!=c)return ri.none;l=h-c.length}else if(a.doc.sliceString(l,h,"￿")!=c)return ri.none;let d=Ce.get(r);d instanceof Ue?d=d.widget.topView:d&&(d.parent=null);return ri.set(ri.replace({widget:new cn(r,o,d)}).range(l,h))}(this.view,t.changes)),(qe.ie||qe.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let n=new un;return Ht.compare(t,e,i,n),n.changes}(this.decorations,this.updateDeco(),t.changes);return e=Fi.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=qe.chrome||qe.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof ui&&t.widget instanceof hn&&n.push(t.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let n=e>=0?t[e]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:l}=n,{content:h,breakAtStart:a,openStart:c,openEnd:d}=fi.build(this.view.state.doc,o,l,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);Te(this,p,g,u,f,h,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||qe.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if(qe.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(t,s.node.childNodes[s.offset]||null))),s=r=new Ae(t,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&ce(s.node,s.offset,l.anchorNode,l.anchorOffset)&&ce(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{qe.android&&qe.chrome&&this.dom.contains(l.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=oe(this.root);if(n.empty){if(qe.gecko){let t=(e=s.node,i=s.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=dn(s.node,s.offset,1==t?1:-1);e&&(s=new Ae(e,1==t?0:e.nodeValue.length))}}t.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(t.extend)t.collapse(s.node,s.offset),t.extend(r.node,r.offset);else{let e=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),e.setEnd(r.node,r.offset),e.setStart(s.node,s.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new Ae(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new Ae(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=oe(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=di.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Di)?this.root.activeElement==this.dom:he(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=Ce.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof di)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(t>r||t==r&&s.type!=si.WidgetBefore&&s.type!=si.WidgetAfter&&(!n||2==e||this.children[n-1].breakAfter||this.children[n-1].type==si.WidgetBefore&&e>-2))return s.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,n=this.view.contentDOM.clientWidth,s=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,l=0;l<this.children.length;l++){let h=this.children[l],a=o+h.length;if(a>i)break;if(o>=e){let e=h.dom.getBoundingClientRect();if(t.push(e.height),s){let t=h.dom.lastChild,i=t?ae(t):[];if(i.length){let t=i[i.length-1],s=this.view.textDirection==qi.LTR?t.right-e.left:e.right-t.left;s>r&&(r=s,this.minWidth=n,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+h.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof di){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=ae(i.firstChild)[0];t=i.getBoundingClientRect().height,e=n?n.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new De(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(ri.replace({widget:new hn(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!s)break;i=s.to+1}return ri.set(t)}updateDeco(){let t=this.view.pluginField(Bi.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(Wi),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)});let s=0,r=0,o=0,l=0;for(let t of this.view.pluginField(Bi.scrollMargins))if(t){let{left:e,right:i,top:n,bottom:h}=t;null!=e&&(s=Math.max(s,e)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=h&&(l=Math.max(l,h))}let h={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+l};!function(t,e,i,n,s,r,o,l){let h=t.ownerDocument,a=h.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==h.body;if(d)t=me(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==s)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let n=e.bottom-e.top,r=t.bottom-t.top;f=("center"==s&&n<=r?e.top+n/2-r/2:"start"==s||"center"==s&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==n?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==n?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==n==l?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,h,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==qi.LTR)}}class hn extends ni{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function an(t){let e=t.observer.selectionRange,i=e.focusNode&&dn(e.focusNode,e.focusOffset,0);if(!i)return null;let n=t.docView.nearest(i);if(!n)return null;if(n instanceof di){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!Ce.get(e);)e=e.previousSibling;let s=e?Ce.get(e).posAtEnd:n.posAtStart;return{from:s,to:s,node:t,text:i}}{for(;;){let{parent:t}=n;if(!t)return null;if(t instanceof di)break;n=t}let t=n.posAtStart;return{from:t,to:t+n.length,node:n.dom,text:i}}}class cn extends ni{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Ue}}function dn(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=fe(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class un{constructor(){this.changes=[]}compareRange(t,e){ci(t,e,this.changes)}comparePoint(t,e){ci(t,e,this.changes)}}function fn(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function pn(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function gn(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function mn(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function vn(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function wn(t,e,i){let n,s,r,o,l,h,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=ae(d);for(let u=0;u<t.length;u++){let f=t[u];s&&gn(s,f)&&(f=mn(vn(f,s.bottom),s.top));let p=fn(e,f),g=pn(i,f);if(0==p&&0==g)return 3==d.nodeType?yn(d,e,i):wn(d,e,i);(!n||o>g||o==g&&r>p)&&(n=d,s=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(l=d,a=f):i<f.top&&(!c||c.top>f.top)&&(h=d,c=f):a&&gn(a,f)?a=vn(a,f.bottom):c&&gn(c,f)&&(c=mn(c,f.top))}}if(a&&a.bottom>=i?(n=l,s=a):c&&c.top<=i&&(n=h,s=c),!n)return{node:t,offset:0};let d=Math.max(s.left,Math.min(s.right,e));return 3==n.nodeType?yn(n,d,i):r||"true"!=n.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,n)+(e>=(s.left+s.right)/2?1:0)}:wn(n,d,i)}function yn(t,e,i){let n=t.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<n;l++){let n=xe(t,l,l+1).getClientRects();for(let h=0;h<n.length;h++){let a=n[h];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,n=i;if(qe.chrome||qe.gecko){xe(t,l).getBoundingClientRect().left==a.right&&(n=!i)}if(c<=0)return{node:t,offset:l+(n?1:0)};s=l+(n?1:0),r=c}}}return{node:t,offset:s>-1?s:o>0?t.nodeValue.length:0}}function bn(t,{x:e,y:i},n,s=-1){var r;let o,l=t.contentDOM.getBoundingClientRect(),h=l.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-h;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=si.Text;)for(;c=s>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return n?null:0;i=!0,s=-s}i=h+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:n?null:xn(t,l,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:xn(t,l,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(l.left+1,Math.min(l.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),qe.safari&&function(t,e,i){let n;if(3!=t.nodeType||e!=(n=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return xe(t,n-1,n).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let n=di.find(t.docView,d);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=wn(n.dom,e,i))}return t.docView.posFromDOM(g,m)}function xn(t,e,i,n,s){let r=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((s-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+u(o,r,t.state.tabSize)}function Sn(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=t.bidiSpans(s);for(let o=e,l=null;;){let e=nn(s,r,t.textDirection,o,i),h=en;if(!e){if(s.number==(i?t.state.doc.lines:1))return o;h="\n",s=t.state.doc.line(s.number+(i?1:-1)),r=t.bidiSpans(s),e=L.cursor(i?s.from:s.to)}if(l){if(!l(h))return o}else{if(!n)return e;l=n(h)}o=e}}function kn(t,e,i){let n=t.pluginField(Bi.atomicRanges);for(;;){let t=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=e.from>i.from?L.cursor(n,1):L.cursor(s,-1),t=!0)}));if(!t)return i}}class An{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in Tn){let i=Tn[e];t.contentDOM.addEventListener(e,(n=>{"keydown"==e&&this.keydown(t,n)||Dn(t,n)&&!this.ignoreDuringComposition(n)&&(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),qe.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Vi);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{Dn(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Oi(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(e){Oi(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if(qe.android&&qe.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!qe.ios||!(i=Mn.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,Se(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(qe.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(t,e){let i=9==e.keyCode&&Date.now()<this.lastEscPress+2e3;return 27==e.keyCode?this.lastEscPress=Date.now():Cn.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!qe.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Mn=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Cn=[16,17,18,20,91,92,224,225];class On{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Mt.allowMultipleSelections)&&function(t,e){let i=t.state.facet(vi);return i.length?i[0](e):qe.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(wi);return i.length?i[0](e):qe.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=oe(t.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let t=0;t<s.length;t++){let i=s[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=qn(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function Dn(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=Ce.get(n))&&i.ignoreEvent(e))return!1;return!0}const Tn=Object.create(null),Bn=qe.ie&&qe.ie_version<15||qe.ios&&qe.webkit_version<604;function En(t,e){let i,{state:n}=t,s=1,r=n.toText(e),o=r.lines==n.selection.ranges.length;if(null!=Gn&&n.selection.ranges.every((t=>t.empty))&&Gn==r.toString()){let t=-1;i=n.changeByRange((i=>{let l=n.doc.lineAt(i.from);if(l.from==t)return{range:i};t=l.from;let h=n.toText((o?r.line(s++).text:e)+n.lineBreak);return{changes:{from:l.from,insert:h},range:L.cursor(i.from+h.length)}}))}else i=o?n.changeByRange((t=>{let e=r.line(s++);return{changes:{from:t.from,to:t.to,insert:e.text},range:L.cursor(t.from+e.length)}})):n.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Tn.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select")};let Rn=0;function Ln(t,e,i,s){if(1==s)return L.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),r=t.doc.lineAt(e),o=e-r.from;if(0==r.length)return L.cursor(e);0==o?i=1:o==r.length&&(i=-1);let l=o,h=o;i<0?l=n(r.text,o,!1):h=n(r.text,o);let a=s(r.text.slice(l,h));for(;l>0;){let t=n(r.text,l,!1);if(s(r.text.slice(t,l))!=a)break;l=t}for(;h<r.length;){let t=n(r.text,h);if(s(r.text.slice(h,t))!=a)break;h=t}return L.range(l+r.from,h+r.from)}(t.state,e,i);{let i=di.find(t.docView,e),n=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<t.state.doc.length&&r==n.to&&r++,L.range(s,r)}}Tn.touchstart=(t,e)=>{Rn=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},Tn.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},Tn.mousedown=(t,e)=>{if(t.observer.flush(),Rn>Date.now()-2e3&&1==qn(e))return;let i=null;for(let n of t.state.facet(yi))if(i=n(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=Hn(t,e),n=qn(e),s=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),s=s.map(t.changes),o=null)},get(e,l,h){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=Hn(t,e),o=e),!a||!i)return s;let c=Ln(t,a.pos,a.bias,n);if(i.pos!=a.pos&&!l){let e=Ln(t,i.pos,i.bias,n),s=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=s<c.from?L.range(s,r):L.range(r,s)}return l?s.replaceRange(s.main.extend(c.from,c.to)):h?s.addRange(c):L.create([c])}}}(t,e)),i){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore((()=>be(t.contentDOM))),t.inputState.startMouseSelection(new On(t,e,i,n))}};let Vn=(t,e)=>t>=e.top&&t<=e.bottom,Nn=(t,e,i)=>Vn(e,i)&&t>=i.left&&t<=i.right;function Pn(t,e,i,n){let s=di.find(t.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&Nn(i,n,o))return-1;let l=s.coordsAt(r,1);return l&&Nn(i,n,l)?1:o&&Vn(n,o)?-1:1}function Hn(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:Pn(t,i,e.clientX,e.clientY)}}const Wn=qe.ie&&qe.ie_version<=11;let In=null,Fn=0,zn=0;function qn(t){if(!Wn)return t.detail;let e=In,i=zn;return In=t,zn=Date.now(),Fn=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Fn+1)%3:1}function Kn(t,e,i,n){if(!i)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:i},h=t.state.changes(o?[o,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}Tn.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},Tn.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&Kn(t,e,n.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(n[t]=e.result),r()},e.readAsText(i[t])}}else Kn(t,e,e.dataTransfer.getData("Text"),!0)},Tn.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Bn?null:e.clipboardData;i?(En(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),En(t,i.value)}),50)}(t)};let Gn=null;function jn(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}Tn.copy=Tn.cut=(t,e)=>{let{text:i,ranges:n,linewise:s}=function(t){let e=[],i=[],n=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let s=-1;for(let{from:n}of t.selection.ranges){let r=t.doc.lineAt(n);r.number>s&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),s=r.number}n=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:n}}(t.state);if(!i&&!s)return;Gn=s?i:null;let r=Bn?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout((()=>{n.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},Tn.focus=Tn.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},Tn.beforeprint=t=>{t.viewState.printing=!0,t.requestMeasure(),setTimeout((()=>{t.viewState.printing=!1,t.requestMeasure()}),2e3)},Tn.compositionstart=Tn.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),jn(t,!0)))},Tn.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&jn(t,!1)}),50)},Tn.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},Tn.beforeinput=(t,e)=>{var i;let n;if(qe.chrome&&qe.android&&(n=Mn.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const _n=["pre-wrap","normal","pre-line","break-spaces"];class Un{constructor(){this.doc=f.empty,this.lineWrapping=!1,this.direction=qi.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return _n.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(e=!0,this.heightSamples[Math.floor(10*n)]=!0)}return e}refresh(t,e,i,n,s,r){let o=_n.indexOf(t)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=n,this.lineLength=s,l){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return l}}class $n{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Yn{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Yn(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new Yn(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var Xn=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Xn||(Xn={}));class Jn{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Jn.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:h,toB:a}=n[r],c=s.lineAt(o,Xn.ByPosNoHeight,e,0,0),d=c.to>=l?c:s.lineAt(l,Xn.ByPosNoHeight,e,0,0);for(a+=d.to-l,l=d.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,h=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,Xn.ByPosNoHeight,e,0,0));h+=c.from-o,o=c.from;let u=ns.build(i,t,h,a);s=s.replace(o,l,u)}return s.updateHeight(i,0)}static empty(){return new Zn(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>2*s){let s=t[e-1];s.break?t.splice(--e,1,s.left,null,s.right):t.splice(--e,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,s-=e.size}}else if(n<s){let i=t[e++];i&&(n+=i.size)}else{let e=t[--i];e&&(s+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new es(Jn.of(t.slice(0,e)),r,Jn.of(t.slice(i)))}}Jn.prototype.size=1;class Qn extends Jn{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new Yn(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,r){r(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Zn extends Qn{constructor(t,e){super(t,e,si.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return 1==i.length&&(n instanceof Zn||n instanceof ts&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof ts?n=new Zn(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):Jn.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ts extends Jn{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(e,n),l=Math.max(0,Math.min(r-s,Math.floor((t-i)/o))),{from:h,length:a}=e.line(s+l);return new Yn(h,a,i+o*l,o,si.Text)}lineAt(t,e,i,n,s){if(e==Xn.ByHeight)return this.blockAt(t,i,n,s);if(e==Xn.ByPosNoHeight){let{from:e,to:n}=i.lineAt(t);return new Yn(e,n-e,0,0,si.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:l,length:h,number:a}=i.lineAt(t);return new Yn(l,h,n+o*(a-r),o,si.Text)}forEachLine(t,e,i,n,s,r){let{firstLine:o,lineHeight:l}=this.lines(i,s);for(let h=Math.max(t,s),a=Math.min(s+this.length,e);h<=a;){let e=i.lineAt(h);h==t&&(n+=l*(e.number-o)),r(new Yn(e.from,e.length,n,l,si.Text)),n+=l,h=e.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let t=i[i.length-1];t instanceof ts?i[i.length-1]=new ts(t.length+n):i.push(null,new ts(n-1))}if(t>0){let e=i[0];e instanceof ts?i[0]=new ts(t+e.length):i.unshift(new ts(t-1),null)}return Jn.of(i)}decomposeLeft(t,e){e.push(new ts(t-1),null)}decomposeRight(t,e){e.push(null,new ts(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let i=[],r=Math.max(e,n.from),o=-1,l=t.heightChanged;for(n.from>e&&i.push(new ts(n.from-e-1).updateHeight(t,e));r<=s&&n.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let l=new Zn(e,s);l.outdated=!1,i.push(l),r+=e+1}r<=s&&i.push(null,new ts(s-r).updateHeight(t,r));let h=Jn.of(i);return t.heightChanged=l||o<0||Math.abs(h.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,h}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class es extends Jn{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,l=e==Xn.ByHeight?t<r:t<o,h=l?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,r,o);if(this.break||(l?h.to<o:h.from>o))return h;let a=e==Xn.ByPosNoHeight?Xn.ByPosNoHeight:Xn.ByPos;return l?h.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,n,s).join(h)}forEachLine(t,e,i,n,s,r){let o=n+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,n,s,r),e>=l&&this.right.forEachLine(t,e,i,o,l,r);else{let h=this.lineAt(l,Xn.ByPos,i,n,s);t<h.from&&this.left.forEachLine(t,h.from-1,i,n,s,r),h.to>=t&&h.from<=e&&r(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,o,l,r)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let r=s.length;for(let t of i)s.push(t);if(t>0&&is(s,r-1),e<this.length){let t=s.length;this.decomposeRight(e,s),is(s,t)}return Jn.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Jn.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:r}=this,o=e+s.length+this.break,l=null;return n&&n.from<=e+s.length&&n.more?l=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=o+r.length&&n.more?l=r=r.updateHeight(t,o,i,n):r.updateHeight(t,o,i),l?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function is(t,e){let i,n;null==t[e]&&(i=t[e-1])instanceof ts&&(n=t[e+1])instanceof ts&&t.splice(e-1,3,new ts(i.length+1+n.length))}class ns{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Zn?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new Zn(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new Qn(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Zn(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new ts(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Zn)return t;let e=new Zn(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=si.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=si.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof Zn||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new Zn(0,-1));let i=t;for(let t of this.nodes)t instanceof Zn&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,n){let s=new ns(i,t);return Ht.spans(e,i,n,s,0),s.finish(i)}}class ss{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&ci(t,e,this.changes,5)}}class rs{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return ri.replace({widget:new os(this.size,t)}).range(this.from,this.to)}}class os extends ni{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class ls{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Un,this.scaler=ps,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Jn.empty().applyChanges(t.facet(Wi),f.empty,this.heightOracle.setDoc(t.doc),[new Fi(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ri.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>n>=t&&n<=e))){let{from:e,to:i}=this.lineBlockAt(n);t.push(new hs(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?ps:new gs(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:ms(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let n=this.state.facet(Wi),s=t.changedRanges,r=Fi.extendWithRanges(s,function(t,e,i){let n=new ss;return Ht.compare(t,e,i,n,0),n.changes}(t.startState.facet(Wi),n,t?t.changes:M.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace,r="rtl"==i.direction?qi.RTL:qi.LTR,o=this.heightOracle.mustRefreshForStyle(s,r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,n=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==n||(h|=8,this.paddingTop=t,this.paddingBottom=n)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:function(t,e){let i=t.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=l;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();n=Math.max(n,e.left),s=Math.min(s,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let e=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(e)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:l}=t.docView.measureTextSize();o=n.refresh(s,r,i,l,p/l,e),o&&(t.docView.minWidth=0,h|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),n.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(n,0,o,new $n(this.viewport.from,e)),n.heightChanged&&(h|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&h||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new hs(n.lineAt(r-1e3*i,Xn.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),Xn.ByHeight,s,0,0).to);if(e){let{head:t}=e.range;if(t<l.from||t>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(t,Xn.ByPos,s,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<l.from?o.top:o.bottom-r,l=new hs(n.lineAt(i-500,Xn.ByHeight,s,0,0).from,n.lineAt(i+r+500,Xn.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new hs(this.heightMap.lineAt(i,Xn.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,Xn.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,Xn.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,Xn.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||n<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new rs(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=qi.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=as(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=cs(r,(this.visibleTop-i.top-t)/i.height),s=cs(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;n=cs(r,(this.pixelViewport.left-e)/t),s=cs(r,(this.pixelViewport.right+e)/t)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&us(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&us(o,l.to-10,l.to+10);for(let{from:n,to:s}of o)s-n>1e3&&e.push(fs(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-n)<1e3&&Math.abs(t.to-s)<1e3))||new rs(n,s,this.gapSize(i,n,s,r)))}return e}gapSize(t,e,i,n){let s=ds(n,i)-ds(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){rs.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=ri.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(Wi);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Ht.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||ms(this.heightMap.lineAt(t,Xn.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return ms(this.heightMap.lineAt(this.scaler.fromDOM(t),Xn.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return ms(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class hs{constructor(t,e){this.from=t,this.to=e}}function as(t,e,i){let n=[],s=t,r=0;return Ht.spans(i.facet(Wi),t,e,{span(){},point(t,e){t>s&&(n.push({from:s,to:t}),r+=t-s),s=e}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function cs({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:s}=e[t],r=s-i;if(n<=r)return i+n;n-=r}}function ds(t,e){let i=0;for(let{from:n,to:s}of t.ranges){if(e<=s){i+=e-n;break}i+=s-n}return i/t.total}function us(t,e,i){for(let n=0;n<t.length;n++){let s=t[n];if(s.from<i&&s.to>e){let r=[];s.from<e&&r.push({from:s.from,to:e}),s.to>i&&r.push({from:i,to:s.to}),t.splice(n,1,...r),n+=r.length-1}}}function fs(t,e){for(let i of t)if(e(i))return i}const ps={toDOM:t=>t,fromDOM:t=>t,scale:1};class gs{constructor(t,e,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=e.lineAt(i,Xn.ByPos,t,0,0).top,o=e.lineAt(s,Xn.ByPos,t,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(e.height-n);for(let t of this.viewports)t.domTop=r+(t.top-s)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),s=t.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function ms(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new Yn(t.from,t.length,i,n-i,Array.isArray(t.type)?t.type.map((t=>ms(t,e))):t.type)}const vs=H.define({combine:t=>t.join(" ")}),ws=H.define({combine:t=>t.indexOf(!0)>-1}),ys=Bt.newName(),bs=Bt.newName(),xs=Bt.newName(),Ss={"&light":"."+bs,"&dark":"."+xs};function ks(t,e,i){return new Bt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const As=ks("."+ys,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Ss),Ms={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Cs=qe.ie&&qe.ie_version<=11;class Os{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new ve,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(qe.ie&&qe.ie_version<=11||qe.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),Cs&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(Di)?e.root.activeElement!=this.dom:!he(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((qe.ie&&qe.ie_version<=11||qe.android&&qe.chrome)&&!e.state.selection.main.empty&&i.focusNode&&ce(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=oe(t),i=qe.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let n=e.startContainer,s=e.startOffset,r=e.endContainer,o=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);ce(l.node,l.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Ms),Cs&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Cs&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;Se(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let t=this.readMutation(s);t&&(t.typeOver&&(n=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&he(this.dom,this.selectionRange);if(e<0&&!s)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,n),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=Ds(e,t.previousSibling||t.target.previousSibling,-1),n=Ds(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Ds(t,e,i){for(;e;){let n=Ce.get(e);if(n&&n.parent==t)return n;let s=e.parentNode;e=s!=t.dom?s:i>0?e.nextSibling:e.previousSibling}return null}function Ts(t,e,i,n){let s,r,o=t.state.selection.main;if(e>-1){let n=t.docView.domBoundsAround(e,i,0);if(!n||t.state.readOnly)return;let{from:l,to:h}=n,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new on(i,n)),s==i&&r==n||e.push(new on(s,r)));return e}(t),c=new sn(a,t.state);c.readRange(n.startDOM,n.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||qe.android&&c.text.length<h-l)&&(d=o.to,u="end");let p=function(t,e,i,n){let s=Math.min(t.length,e.length),r=0;for(;r<s&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&t.length==e.length)return null;let o=t.length,l=e.length;for(;o>0&&l>0&&t.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(t.state.doc.sliceString(l,h,"￿"),c.text,d-l,u);p&&(qe.chrome&&13==t.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==c.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:f.of(c.text.slice(p.from,p.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,n=2==t.length?t[1].pos:i;return i>-1&&n>-1?L.single(i+e,n+e):null}(a,l)}else if(t.hasFocus||!t.state.facet(Di)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=t.docView,s=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!le(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),l=n&&n.node==e.anchorNode&&n.offset==e.anchorOffset||!le(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);s==o.head&&l==o.anchor||(r=L.single(l,s))}if(s||r)if(!s&&n&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,s.from).append(s.insert).append(t.state.doc.slice(s.to,o.to))}),s){let e=t.state;if(qe.ios&&t.inputState.flushIOSKey(t))return;if(qe.android&&(s.from==o.from&&s.to==o.to&&1==s.insert.length&&2==s.insert.lines&&Se(t.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&0==s.insert.length&&Se(t.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&0==s.insert.length&&Se(t.contentDOM,"Delete",46)))return;let i,n=s.insert.toString();if(t.state.facet(Si).some((e=>e(t,s.from,s.to,n))))return;if(t.inputState.composing>=0&&t.inputState.composing++,s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&t.inputState.composing<0){let n=o.from<s.from?e.sliceDoc(o.from,s.from):"",r=o.to>s.to?e.sliceDoc(s.to,o.to):"";i=e.replaceSelection(t.state.toText(n+s.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let n=e.changes(s),l=r&&!e.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let r=t.state.sliceDoc(s.from,s.to),h=an(t)||t.state.doc.lineAt(o.head),a=o.to-s.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:n,range:l||i.map(n)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let f=e.changes({from:u,to:d,insert:s.insert}),p=i.to-o.to;return{changes:f,range:l?L.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}}))}else i={changes:n,selection:l&&e.selection.replaceRange(l)}}let l="input.type";t.composing&&(l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:l})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class Bs{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new ls(t.state||Mt.create()),this.plugins=this.state.facet(Ri).map((t=>new Ni(t)));for(let t of this.plugins)t.update(this);this.observer=new Os(this,((t,e,i)=>{Ts(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new An(this),this.docView=new ln(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);if(n.facet(Mt.phrases)!=this.state.facet(Mt.phrases))return this.setState(n);e=new zi(this,n,t);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(s&&(s=s.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;s=new Mi(t.empty?t:L.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(ki)?s=new Mi(t.value):t.is(Ai)?s=new Mi(t.value,"center"):t.is(Ci)&&(s=t.value)}this.viewState.update(e,s),this.bidiCache=Vs.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(Ii)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(vs)!=e.state.facet(vs)&&(this.viewState.mustMeasureContent=!0),(i||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(xi))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new ls(t),this.plugins=t.facet(Ri).map((t=>new Ni(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new ln(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Ri),i=t.state.facet(Ri);if(e!=i){let n=[];for(let s of i){let i=e.indexOf(s);if(i<0)n.push(new Ni(s));else{let e=this.plugins[i];e.mustUpdate=t,n.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((t=>{try{return t.read(this)}catch(t){return Oi(this.state,t),Ls}})),o=new zi(this,this.state),l=!1,h=!1;o.flags|=n,e?e.flags|=n:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),l=this.docView.update(o));for(let t=0;t<s.length;t++)if(r[t]!=Ls)try{let e=s[t];e.write&&e.write(r[t],this)}catch(t){Oi(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),l&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(xi))t(e)}get themeClasses(){return ys+" "+(this.state.facet(ws)?xs:bs)+" "+this.state.facet(vs)}updateAttrs(){let t=Ns(this,Pi,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Di)?"true":"false",class:"cm-content",style:`${qe.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Ns(this,Hi,e),this.observer.ignore((()=>{ii(this.contentDOM,this.contentAttrs,e),ii(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(Bs.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(Ii),Bt.mount(this.root,this.styleModules.concat(As).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Rs(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Rs(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Rs(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return kn(this,t,Sn(this,t,e,i))}moveByGroup(t,e){return kn(this,t,Sn(this,t,e,(e=>function(t,e,i){let n=t.state.charCategorizer(e),s=n(i);return t=>{let e=n(t);return s==xt.Space&&(s=e),s==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=n&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),n=t.posAtCoords({x:i==(t.textDirection==qi.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=n)return L.cursor(n,i?-1:1)}let o=di.find(t.docView,e.head),l=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return L.cursor(l,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return kn(this,t,function(t,e,i,n){let s=e.head,r=i?1:-1;if(s==(i?t.state.doc.length:0))return L.cursor(s,e.assoc);let o,l=e.goalColumn,h=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(s),c=t.documentTop;if(a)null==l&&(l=a.left-h.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(s-c);null==l&&(l=Math.min(h.right-h.left,t.defaultCharacterWidth*(s-e.from))),o=(r<0?e.top:e.bottom)+c}let d=h.left+l,u=null!=n?n:t.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(u+i)*r,a=bn(t,{x:d,y:n},!1,r);if(n<h.top||n>h.bottom||(r<0?a<s:a>s))return L.cursor(a,e.assoc,void 0,l)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:ki.of(L.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),bn(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n);return ge(i,s[Ji.find(s,t-n.from,-1,e)].dir==qi.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Es)return tn(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=Zi(t.text,this.textDirection);return this.bidiCache.push(new Vs(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||qe.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{be(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Ci.of(new Mi("number"==typeof t?L.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Li.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Bt.newName(),n=[vs.of(i),Ii.of(ks(`.${i}`,t))];return e&&e.dark&&n.push(ws.of(!0)),n}static baseTheme(t){return X.lowest(Ii.of(ks("."+ys,t,Ss)))}}Bs.scrollTo=ki,Bs.centerOn=Ai,Bs.styleModule=Ii,Bs.inputHandler=Si,Bs.exceptionSink=bi,Bs.updateListener=xi,Bs.editable=Di,Bs.mouseSelectionStyle=yi,Bs.dragMovesSelection=wi,Bs.clickAddsSelectionRange=vi,Bs.decorations=Wi,Bs.darkTheme=ws,Bs.contentAttributes=Hi,Bs.editorAttributes=Pi,Bs.lineWrapping=Bs.contentAttributes.of({class:"cm-lineWrapping"}),Bs.announce=ft.define();const Es=4096;function Rs(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const Ls={};class Vs{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:qi.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let r=t[s];r.dir!=n||e.touchesRange(r.from,r.to)||i.push(new Vs(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function Ns(t,e,i){for(let n=t.state.facet(e),s=n.length-1;s>=0;s--){let e=n[s],r="function"==typeof e?e(t):e;r&&ti(r,i)}return i}const Ps=qe.mac?"mac":qe.windows?"win":qe.linux?"linux":"key";function Hs(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==i&&e.shiftKey&&(t="Shift-"+t),t}const Ws=Bs.domEventHandlers({keydown:(t,e)=>Ks(zs(e.state),t,e,"editor")}),Is=H.define({enables:Ws}),Fs=new WeakMap;function zs(t){let e=t.facet(Is),i=Fs.get(e);return i||Fs.set(e,i=function(t,e=Ps){let i=Object.create(null),n=Object.create(null),s=(t,e)=>{let i=n[t];if(null==i)n[t]=e;else if(i!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")},r=(t,n,r,o)=>{let l=i[t]||(i[t]=Object.create(null)),h=n.split(/ (?!$)/).map((t=>function(t,e){const i=t.split(/-(?!$)/);let n,s,r,o,l=i[i.length-1];"Space"==l&&(l=" ");for(let t=0;t<i.length-1;++t){const l=i[t];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))r=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);"mac"==e?o=!0:s=!0}}return n&&(l="Alt-"+l),s&&(l="Ctrl-"+l),o&&(l="Meta-"+l),r&&(l="Shift-"+l),l}(t,e)));for(let e=1;e<h.length;e++){let i=h.slice(0,e).join(" ");s(i,!0),l[i]||(l[i]={preventDefault:!0,commands:[e=>{let n=qs={view:e,prefix:i,scope:t};return setTimeout((()=>{qs==n&&(qs=null)}),4e3),!0}]})}let a=h.join(" ");s(a,!1);let c=l[a]||(l[a]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let i of t){let t=i[e]||i.key;if(t)for(let e of i.scope?i.scope.split(" "):["editor"])r(e,t,i.run,i.preventDefault),i.shift&&r(e,"Shift-"+t,i.shift,i.preventDefault)}return i}(e.reduce(((t,e)=>t.concat(e)),[]))),i}let qs=null;function Ks(t,e,i,n){let s=re(e),r=1==s.length&&" "!=s,o="",l=!1;qs&&qs.view==i&&qs.scope==n&&(o=qs.prefix+" ",(l=Cn.indexOf(e.keyCode)<0)&&(qs=null));let h,a=t=>{if(t){for(let e of t.commands)if(e(i))return!0;t.preventDefault&&(l=!0)}return!1},c=t[n];if(c){if(a(c[o+Hs(s,e,!r)]))return!0;if(r&&(e.shiftKey||e.altKey||e.metaKey)&&(h=Yt[e.keyCode])&&h!=s){if(a(c[o+Hs(h,e,!0)]))return!0}else if(r&&e.shiftKey&&a(c[o+Hs(s,e,!0)]))return!0}return l}const Gs=!qe.ios,js=H.define({combine:t=>Ct(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})});function _s(t={}){return[js.of(t),$s,Xs]}class Us{constructor(t,e,i,n,s){this.left=t,this.top=e,this.width=i,this.height=n,this.className=s}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width>=0&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}}const $s=Li.fromClass(class{constructor(t){this.view=t,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=t.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=t.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),t.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(js).cursorBlinkRate+"ms"}update(t){let e=t.startState.facet(js)!=t.state.facet(js);(e||t.selectionSet||t.geometryChanged||t.viewportChanged)&&this.view.requestMeasure(this.measureReq),t.transactions.some((t=>t.scrollIntoView))&&(this.cursorLayer.style.animationName="cm-blink"==this.cursorLayer.style.animationName?"cm-blink2":"cm-blink"),e&&this.setBlinkRate()}readPos(){let{state:t}=this.view,e=t.facet(js),i=t.selection.ranges.map((t=>t.empty?[]:function(t,e){if(e.to<=t.viewport.from||e.from>=t.viewport.to)return[];let i=Math.max(e.from,t.viewport.from),n=Math.min(e.to,t.viewport.to),s=t.textDirection==qi.LTR,r=t.contentDOM,o=r.getBoundingClientRect(),l=Js(t),h=window.getComputedStyle(r.firstChild),a=o.left+parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)),c=o.right-parseInt(h.paddingRight),d=Zs(t,i),u=Zs(t,n),f=d.type==si.Text?d:null,p=u.type==si.Text?u:null;t.lineWrapping&&(f&&(f=Qs(t,i,f)),p&&(p=Qs(t,n,p)));if(f&&p&&f.from==p.from)return m(v(e.from,e.to,f));{let i=f?v(e.from,null,f):w(d,!1),n=p?v(null,e.to,p):w(u,!0),s=[];return(f||d).to<(p||u).from-1?s.push(g(a,i.bottom,c,n.top)):i.bottom<n.top&&t.elementAtHeight((i.bottom+n.top)/2).type==si.Text&&(i.bottom=n.top=(i.bottom+n.top)/2),m(i).concat(s).concat(m(n))}function g(t,e,i,n){return new Us(t-l.left,e-l.top-.01,i-t,n-e+.01,"cm-selectionBackground")}function m({top:t,bottom:e,horizontal:i}){let n=[];for(let s=0;s<i.length;s+=2)n.push(g(i[s],t,i[s+1],e));return n}function v(e,i,n){let r=1e9,o=-1e9,l=[];function h(e,i,h,d,u){let f=t.coordsAtPos(e,e==n.to?-2:2),p=t.coordsAtPos(h,h==n.from?2:-2);r=Math.min(f.top,p.top,r),o=Math.max(f.bottom,p.bottom,o),u==qi.LTR?l.push(s&&i?a:f.left,s&&d?c:p.right):l.push(!s&&d?a:p.left,!s&&i?c:f.right)}let d=null!=e?e:n.from,u=null!=i?i:n.to;for(let n of t.visibleRanges)if(n.to>d&&n.from<u)for(let s=Math.max(n.from,d),r=Math.min(n.to,u);;){let n=t.state.doc.lineAt(s);for(let o of t.bidiSpans(n)){let t=o.from+n.from,l=o.to+n.from;if(t>=r)break;l>s&&h(Math.max(t,s),null==e&&t<=d,Math.min(l,r),null==i&&l>=u,o.dir)}if(s=n.to+1,s>=r)break}return 0==l.length&&h(d,null==e,u,null==i,t.textDirection),{top:r,bottom:o,horizontal:l}}function w(t,e){let i=o.top+(e?t.top:t.bottom);return{top:i,bottom:i,horizontal:[]}}}(this.view,t))).reduce(((t,e)=>t.concat(e))),n=[];for(let i of t.selection.ranges){let s=i==t.selection.main;if(i.empty?!s||Gs:e.drawRangeCursor){let t=tr(this.view,i,s);t&&n.push(t)}}return{rangePieces:i,cursors:n}}drawSel({rangePieces:t,cursors:e}){if(t.length!=this.rangePieces.length||t.some(((t,e)=>!t.eq(this.rangePieces[e])))){this.selectionLayer.textContent="";for(let e of t)this.selectionLayer.appendChild(e.draw());this.rangePieces=t}if(e.length!=this.cursors.length||e.some(((t,e)=>!t.eq(this.cursors[e])))){let t=this.cursorLayer.children;if(t.length!==e.length){this.cursorLayer.textContent="";for(const t of e)this.cursorLayer.appendChild(t.draw())}else e.forEach(((e,i)=>e.adjust(t[i])));this.cursors=e}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),Ys={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};Gs&&(Ys[".cm-line"].caretColor="transparent !important");const Xs=X.highest(Bs.theme(Ys));function Js(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==qi.LTR?e.left:e.right-t.scrollDOM.clientWidth)-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}}function Qs(t,e,i){let n=L.cursor(e);return{from:Math.max(i.from,t.moveToLineBoundary(n,!1,!0).from),to:Math.min(i.to,t.moveToLineBoundary(n,!0,!0).from),type:si.Text}}function Zs(t,e){let i=t.lineBlockAt(e);if(Array.isArray(i.type))for(let t of i.type)if(t.to>e||t.to==e&&(t.to==i.to||t.type==si.Text))return t;return i}function tr(t,e,i){let n=t.coordsAtPos(e.head,e.assoc||1);if(!n)return null;let s=Js(t);return new Us(n.left-s.left,n.top-s.top,-1,n.bottom-n.top,i?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const er=ft.define({map:(t,e)=>null==t?null:e.mapPos(t)}),ir=K.define({create:()=>null,update:(t,e)=>(null!=t&&(t=e.changes.mapPos(t)),e.effects.reduce(((t,e)=>e.is(er)?e.value:t),t))}),nr=Li.fromClass(class{constructor(t){this.view=t,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(t){var e;let i=t.state.field(ir);null==i?null!=this.cursor&&(null===(e=this.cursor)||void 0===e||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(t.startState.field(ir)!=i||t.docChanged||t.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let t=this.view.state.field(ir),e=null!=t&&this.view.coordsAtPos(t);if(!e)return null;let i=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-i.left+this.view.scrollDOM.scrollLeft,top:e.top-i.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(t){this.cursor&&(t?(this.cursor.style.left=t.left+"px",this.cursor.style.top=t.top+"px",this.cursor.style.height=t.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(t){this.view.state.field(ir)!=t&&this.view.dispatch({effects:er.of(t)})}},{eventHandlers:{dragover(t){this.setDropPos(this.view.posAtCoords({x:t.clientX,y:t.clientY}))},dragleave(t){t.target!=this.view.contentDOM&&this.view.contentDOM.contains(t.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function sr(){return[ir,nr]}function rr(t,e,i,n,s){e.lastIndex=0;for(let r,o=t.iterRange(i,n),l=i;!o.next().done;l+=o.value.length)if(!o.lineBreak)for(;r=e.exec(o.value);)s(l+r.index,l+r.index+r[0].length,r)}class or{constructor(t){let{regexp:e,decoration:i,boundary:n,maxLength:s=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=e,this.getDeco="function"==typeof i?i:()=>i,this.boundary=n,this.maxLength=s}createDeco(t){let e=new Wt;for(let{from:i,to:n}of function(t,e){let i=t.visibleRanges;if(1==i.length&&i[0].from==t.viewport.from&&i[0].to==t.viewport.to)return i;let n=[];for(let{from:s,to:r}of i)s=Math.max(t.state.doc.lineAt(s).from,s-e),r=Math.min(t.state.doc.lineAt(r).to,r+e),n.length&&n[n.length-1].to>=s?n[n.length-1].to=r:n.push({from:s,to:r});return n}(t,this.maxLength))rr(t.state.doc,this.regexp,i,n,((i,n,s)=>e.add(i,n,this.getDeco(s,t,i))));return e.finish()}updateDeco(t,e){let i=1e9,n=-1;return t.docChanged&&t.changes.iterChanges(((e,s,r,o)=>{o>t.view.viewport.from&&r<t.view.viewport.to&&(i=Math.min(r,i),n=Math.max(o,n))})),t.viewportChanged||n-i>1e3?this.createDeco(t.view):n>-1?this.updateRange(t.view,e.map(t.changes),i,n):e}updateRange(t,e,i,n){for(let s of t.visibleRanges){let r=Math.max(s.from,i),o=Math.min(s.to,n);if(o>r){let i=t.state.doc.lineAt(r),n=i.to<o?t.state.doc.lineAt(o):i,l=Math.max(s.from,i.from),h=Math.min(s.to,n.to);if(this.boundary){for(;r>i.from;r--)if(this.boundary.test(i.text[r-1-i.from])){l=r;break}for(;o<n.to;o++)if(this.boundary.test(n.text[o-n.from])){h=o;break}}let a,c=[];if(i==n)for(this.regexp.lastIndex=l-i.from;(a=this.regexp.exec(i.text))&&a.index<h-i.from;){let e=a.index+i.from;c.push(this.getDeco(a,t,e).range(e,e+a[0].length))}else rr(t.state.doc,this.regexp,l,h,((e,i,n)=>c.push(this.getDeco(n,t,e).range(e,i))));e=e.update({filterFrom:l,filterTo:h,filter:(t,e)=>t<l||e>h,add:c})}}return e}}const lr=null!=/x/.unicode?"gu":"g",hr=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮\ufeff￹-￼]",lr),ar={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let cr=null;const dr=H.define({combine(t){let e=Ct(t,{render:null,specialChars:hr,addSpecialChars:null});return(e.replaceTabs=!function(){var t;if(null==cr&&"undefined"!=typeof document&&document.body){let e=document.body.style;cr=null!=(null!==(t=e.tabSize)&&void 0!==t?t:e.MozTabSize)}return cr||!1}())&&(e.specialChars=new RegExp("\t|"+e.specialChars.source,lr)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,lr)),e}});function ur(t={}){return[dr.of(t),fr||(fr=Li.fromClass(class{constructor(t){this.view=t,this.decorations=ri.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(dr)),this.decorations=this.decorator.createDeco(t)}makeDecorator(t){return new or({regexp:t.specialChars,decoration:(e,i,n)=>{let{doc:s}=i.state,r=h(e[0],0);if(9==r){let t=s.lineAt(n),e=i.state.tabSize,r=d(t.text,e,n-t.from);return ri.replace({widget:new gr((e-r%e)*this.view.defaultCharacterWidth)})}return this.decorationCache[r]||(this.decorationCache[r]=ri.replace({widget:new pr(t,r)}))},boundary:t.replaceTabs?void 0:/[^]/})}update(t){let e=t.state.facet(dr);t.startState.facet(dr)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations}))]}let fr=null;class pr extends ni{constructor(t,e){super(),this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){let e=(i=this.code)>=32?"•":10==i?"␤":String.fromCharCode(9216+i);var i;let n=t.state.phrase("Control character")+" "+(ar[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,n,e);if(s)return s;let r=document.createElement("span");return r.textContent=e,r.title=n,r.setAttribute("aria-label",n),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class gr extends ni{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="\t",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}function mr(){return wr}const vr=ri.line({class:"cm-activeLine"}),wr=Li.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,i=[];for(let n of t.state.selection.ranges){if(!n.empty)return ri.none;let s=t.lineBlockAt(n.head);s.from>e&&(i.push(vr.range(s.from)),e=s.from)}return ri.set(i)}},{decorations:t=>t.decorations});function yr(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function br(t,e){return!!e&&t.contains(1!=e.nodeType?e.parentNode:e)}function xr(t,e){if(!e.anchorNode)return!1;try{return br(t,e.anchorNode)}catch(t){return!1}}function Sr(t){return 3==t.nodeType?Vr(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function kr(t,e,i,n){return!!i&&(Mr(t,e,i,n,-1)||Mr(t,e,i,n,1))}function Ar(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function Mr(t,e,i,n,s){for(;;){if(t==i&&e==n)return!0;if(e==(s<0?0:Cr(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=Ar(t)+(s<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(s<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=s<0?Cr(t):0}}}function Cr(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const Or={left:0,right:0,top:0,bottom:0};function Dr(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Tr(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Br{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let Er,Rr=null;function Lr(t){if(t.setActive)return t.setActive();if(Rr)return t.focus(Rr);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Rr?{get preventScroll(){return Rr={preventScroll:!0},!0}}:void 0),!Rr){Rr=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],s=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function Vr(t,e,i=e){let n=Er||(Er=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function Nr(t,e,i){let n={key:e,code:e,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,t.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,t.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function Pr(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Hr{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Hr(t.parentNode,Ar(t),e)}static after(t,e){return new Hr(t.parentNode,Ar(t)+1,e)}}const Wr=[];class Ir{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e=this.dom,i=e.firstChild;for(let n of this.children){if(n.dirty){if(!n.dom&&i){let t=Ir.get(i);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(i)}n.sync(t),n.dirty=0}if(t&&!t.written&&t.node==e&&i!=n.dom&&(t.written=!0),n.dom.parentNode==e){for(;i&&i!=n.dom;)i=Fr(i);i=n.dom.nextSibling}else e.insertBefore(n.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=Fr(i)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=0==Cr(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==n&&e.firstChild!=e.lastChild&&(n=t==e.firstChild?-1:1),t=e}i=n<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Ir.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let n=this.children[t];if(n.dom==i)return e;e+=n.length+n.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,r=-1,o=-1;for(let l=0,h=i,a=i;l<this.children.length;l++){let i=this.children[l],c=h+i.length;if(h<t&&c>e)return i.domBoundsAround(t,e,h);if(c>=t&&-1==n&&(n=l,s=h),h>e&&i.dom.parentNode==this.dom){r=l,o=a;break}a=c,h=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Wr){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new zr(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Fr(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}Ir.prototype.breakAfter=0;class zr{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function qr(t,e,i,n,s,r,o,l,h){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(i,s,r.length?d:null,0==i,l,h))){if(n<a.length){let t=a[n];t&&s<t.length?(e==n&&(t=t.split(s),s=0),!u&&d&&t.merge(0,s,d,!0,0,h)?r[r.length-1]=t:(s&&t.merge(0,s,null,!1,0,h),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),e++));e<n&&r.length;)if(a[n-1].become(r[r.length-1]))n--,r.pop(),h=r.length?0:l;else{if(!a[e].become(r[0]))break;e++,r.shift(),l=r.length?0:h}!r.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,l,h)&&e--,(e<n||r.length)&&t.replaceChildren(e,n,r)}}function Kr(t,e,i,n,s,r){let o=t.childCursor(),{i:l,off:h}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of n)d+=t.length;t.length+=d,qr(t,a,c,l,h,n,0,s,r)}let Gr="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},jr="undefined"!=typeof document?document:{documentElement:{style:{}}};const _r=/Edge\/(\d+)/.exec(Gr.userAgent),Ur=/MSIE \d/.test(Gr.userAgent),$r=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Gr.userAgent),Yr=!!(Ur||$r||_r),Xr=!Yr&&/gecko\/(\d+)/i.test(Gr.userAgent),Jr=!Yr&&/Chrome\/(\d+)/.exec(Gr.userAgent),Qr="webkitFontSmoothing"in jr.documentElement.style,Zr=!Yr&&/Apple Computer/.test(Gr.vendor),to=Zr&&(/Mobile\/\w+/.test(Gr.userAgent)||Gr.maxTouchPoints>2);var eo={mac:to||/Mac/.test(Gr.platform),windows:/Win/.test(Gr.platform),linux:/Linux|X11/.test(Gr.platform),ie:Yr,ie_version:Ur?jr.documentMode||6:$r?+$r[1]:_r?+_r[1]:0,gecko:Xr,gecko_version:Xr?+(/Firefox\/(\d+)/.exec(Gr.userAgent)||[0,0])[1]:0,chrome:!!Jr,chrome_version:Jr?+Jr[1]:0,ios:to,android:/Android\b/.test(Gr.userAgent),webkit:Qr,safari:Zr,webkit_version:Qr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=jr.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class io extends Ir{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof io&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new io(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Hr(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return so(this.dom,t,e)}}class no extends Ir{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(Pr(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,r){return(!i||!(!(i instanceof no&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&r<=0))&&(Kr(this,t,e,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),n<0&&i>=t&&(n=s),i=o,s++}let r=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new no(this.mark,e,r)}domAtPos(t){return ao(this.dom,this.children,t)}coordsAt(t,e){return uo(this,t,e)}}function so(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;0==e&&i<0||e==n&&i>=0?eo.chrome||eo.gecko||(e?(s--,o=1):(r++,o=-1)):i<0?s--:r++;let l=Vr(t,s,r).getClientRects();if(!l.length)return Or;let h=l[(o?o<0:i>=0)?0:l.length-1];return eo.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(l,(t=>t.width))||h),o?Dr(h,o<0):h||null}class ro extends Ir{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||ro)(t,e,i)}split(t){let e=ro.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof ro&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof ro&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return f.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):f.empty}domAtPos(t){return 0==t?Hr.before(this.dom):Hr.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return Or;for(let e=t>0?i.length-1:0;n=i[e],!(t>0?0==e:e==i.length-1||n.top<n.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?n:Dr(n,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class oo extends ro{domAtPos(t){let{topView:e}=this.widget;return e?lo(t,e,this.widget.text):new Hr(this.widget.text,Math.min(t,this.widget.text.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){return e?3==t.nodeType?Math.min(e,this.length):this.length:0}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){return so(this.widget.text,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function lo(t,e,i){if(e instanceof no){for(let n of e.children){let e=n.dom==i||n.dom.contains(i.parentNode),s=e?i.nodeValue.length:n.length;if(t<s||t==s&&n.getSide()<=0)return e?lo(t,n,i):n.domAtPos(t);t-=s}return e.domAtPos(e.length)}return e.dom==i?new Hr(i,Math.min(t,i.nodeValue.length)):e.domAtPos(t)}class ho extends Ir{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof ho&&t.side==this.side}split(){return new ho(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Hr.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){return this.dom.getBoundingClientRect()}get overrideDOMText(){return f.empty}}function ao(t,e,i){let n=0;for(let s=0;n<e.length;n++){let r=e[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return Hr.after(i)}return new Hr(t,0)}function co(t,e,i){let n,{children:s}=t;i>0&&e instanceof no&&s.length&&(n=s[s.length-1])instanceof no&&n.mark.eq(e.mark)?co(n,e.children[0],i-1):(s.push(e),e.setParent(t)),t.length+=e.length}function uo(t,e,i){for(let n=0,s=0;s<t.children.length;s++){let r,o=t.children[s],l=n+o.length;if((i<=0||l==t.length||o.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(r=t.children[s+1]).length||r.getSide()>0)){let t=0;if(l==n){if(o.getSide()<=0)continue;t=i=-o.getSide()}let s=o.coordsAt(Math.max(0,e-n),i);return t&&s?Dr(s,i<0):s}n=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let s=Sr(n);return s[s.length-1]||null}function fo(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function po(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||t[s]!==e[s])return!1;return!0}function go(t,e,i){if(e)for(let n in e)i&&n in i||t.removeAttribute(n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(n,i[n])}io.prototype.children=ro.prototype.children=ho.prototype.children=Wr;class mo{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var vo=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(vo||(vo={}));class wo extends Lt{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new yo(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new xo(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,{start:i,end:n}=So(t,e);return new xo(t,(i?e?-3e8:-1:4e8)-1,1+(n?e?2e8:1:-5e8),e,t.widget||null,!0)}static line(t){return new bo(t)}static set(t,e=!1){return Ht.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}wo.none=Ht.empty;class yo extends wo{constructor(t){let{start:e,end:i}=So(t);super(e?-1:4e8,i?1:-5e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof yo&&this.tagName==t.tagName&&this.class==t.class&&po(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}yo.prototype.point=!1;class bo extends wo{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof bo&&po(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}bo.prototype.mapMode=k.TrackBefore,bo.prototype.point=!0;class xo extends wo{constructor(t,e,i,n,s,r){super(e,i,s,t),this.block=n,this.isReplace=r,this.mapMode=n?e<=0?k.TrackBefore:k.TrackAfter:k.TrackDel}get type(){return this.startSide<this.endSide?vo.WidgetRange:this.startSide<=0?vo.WidgetBefore:vo.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof xo&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function So(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return null==i&&(i=t.inclusive),null==n&&(n=t.inclusive),{start:null!=i?i:e,end:null!=n?n:e}}function ko(t,e,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=t?i[s]=Math.max(i[s],e):i.push(t,e)}xo.prototype.point=!0;class Ao extends Ir{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,r){if(i){if(!(i instanceof Ao))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Kr(this,t,e,i?i.children:[],s,r),!0}split(t){let e=new Ao;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){po(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){co(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=fo(e,this.attrs||{})),i&&(this.attrs=fo({class:i},this.attrs||{}))}domAtPos(t){return ao(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(Pr(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(go(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Ir.get(i)instanceof no;)i=i.lastChild;if(!i||"BR"!=i.nodeName&&0==(null===(e=Ir.get(i))||void 0===e?void 0:e.isEditable)&&(!eo.ios||!this.children.some((t=>t instanceof io)))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof io))return null;let i=Sr(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return uo(this,t,e)}become(t){return!1}get type(){return vo.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],r=n+s.length;if(r>=e){if(s instanceof Ao)return s;if(r>e)break}n=r+s.breakAfter}return null}}class Mo extends Ir{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof Mo&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Hr.before(this.dom):Hr.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Mo(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Wr}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):f.empty}domBoundsAround(){return null}become(t){return t instanceof Mo&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Co{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Mo&&t.type==vo.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ao),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Oo(new ho(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Oo(new io(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s){let r=e-t;if(i instanceof xo)if(i.block){let{type:t}=i;t!=vo.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new Mo(i.widget||new Do("div"),r,t))}else{let o=ro.create(i.widget||new Do("span"),r,i.startSide),l=this.atCursorPos&&!o.isEditable&&s<=n.length&&(t<e||i.startSide>0),h=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(n),l&&(a.append(Oo(new ho(1),n),s),s=n.length+Math.max(0,s-n.length)),a.append(Oo(o,n),s),this.atCursorPos=h,this.pendingBuffer=h?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}filterPoint(t,e,i,n){if(n<this.disallowBlockEffectsBelow&&i instanceof xo){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,n,s){let r=new Co(t,e,i,s);return r.openEnd=Ht.spans(n,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function Oo(t,e){for(let i of e)t=new no(i,[t],t.length);return t}class Do extends mo{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const To=[],Bo=H.define(),Eo=H.define(),Ro=H.define(),Lo=H.define(),Vo=H.define(),No=H.define(),Po=ft.define({map:(t,e)=>t.map(e)}),Ho=ft.define({map:(t,e)=>t.map(e)});class Wo{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new Wo(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const Io=ft.define({map:(t,e)=>t.map(e)});function Fo(t,e,i){let n=t.facet(Lo);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const zo=H.define({combine:t=>!t.length||t[0]});class qo{constructor(t,e){this.field=t,this.get=e}}class Ko{from(t){return new qo(this,t)}static define(){return new Ko}}Ko.decorations=Ko.define(),Ko.atomicRanges=Ko.define(),Ko.scrollMargins=Ko.define();let Go=0;const jo=H.define();class _o{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=jo.of(this)}static define(t,e){let{eventHandlers:i,provide:n,decorations:s}=e||{},r=[];if(n)for(let t of Array.isArray(n)?n:[n])r.push(t);return i&&r.push(Uo.from((t=>({plugin:t,handlers:i})))),s&&r.push(Ko.decorations.from(s)),new _o(Go++,t,r)}static fromClass(t,e){return _o.define((e=>new t(e)),e)}}const Uo=Ko.define();class $o{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:n}of this.spec.fields)i==t&&e.push(n(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(Fo(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Fo(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Fo(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Yo=H.define(),Xo=H.define(),Jo=H.define(),Qo=H.define();class Zo{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new Zo(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let l=n==t.length?null:t[n],h=r-o,a=l?l.fromB:1e9;for(;s<e.length&&e[s]<a;){let t=e[s],n=e[s+1],r=Math.max(o,t),l=Math.min(a,n);if(r<=l&&new Zo(r+h,l+h,r,l).addToSet(i),n>a)break;s+=2}if(!l)return i;new Zo(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class tl{constructor(t,e,i=To){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=M.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let n=[];this.changes.iterChangedRanges(((t,e,i,s)=>n.push(new Zo(t,e,i,s)))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var el=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(el||(el={}));const il=el.LTR,nl=el.RTL;function sl(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const rl=sl("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ol=sl("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),ll=Object.create(null),hl=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);ll[e]=i,ll[i]=-e}const al=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class cl{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?nl:il}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<e:o.to>e:t[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const dl=[];function ul(t,e){let i=t.length,n=e==il?1:2,s=e==il?2:1;if(!t||1==n&&!al.test(t))return fl(i);for(let e=0,s=n,o=n;e<i;e++){let i=(r=t.charCodeAt(e))<=247?rl[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?ol[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),dl[e]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let t=0,e=n,s=n;t<i;t++){let n=dl[t];if(128==n)t<i-1&&e==dl[t+1]&&24&e?n=dl[t]=e:dl[t]=256;else if(64==n){let n=t+1;for(;n<i&&64==dl[n];)n++;let r=t&&8==e||n<i&&8==dl[n]?1==s?1:8:256;for(let e=t;e<n;e++)dl[e]=r;t=n-1}else 8==n&&1==s&&(dl[t]=1);e=n,7&n&&(s=n)}for(let e,r,o,l=0,h=0,a=0;l<i;l++)if(r=ll[e=t.charCodeAt(l)])if(r<0){for(let t=h-3;t>=0;t-=3)if(hl[t+1]==-r){let e=hl[t+2],i=2&e?n:4&e?1&e?s:n:0;i&&(dl[l]=dl[hl[t]]=i),h=t;break}}else{if(189==hl.length)break;hl[h++]=l,hl[h++]=e,hl[h++]=a}else if(2==(o=dl[l])||1==o){let t=o==n;a=t?0:1;for(let e=h-3;e>=0;e-=3){let i=hl[e+2];if(2&i)break;if(t)hl[e+2]|=2;else{if(4&i)break;hl[e+2]|=4}}}for(let t=0;t<i;t++)if(256==dl[t]){let e=t+1;for(;e<i&&256==dl[e];)e++;let s=1==(t?dl[t-1]:n),r=s==(1==(e<i?dl[e]:n))?s?1:2:n;for(let i=t;i<e;i++)dl[i]=r;t=e-1}let o=[];if(1==n)for(let t=0;t<i;){let e=t,n=1!=dl[t++];for(;t<i&&n==(1!=dl[t]);)t++;if(n)for(let i=t;i>e;){let t=i,n=2!=dl[--i];for(;i>e&&n==(2!=dl[i-1]);)i--;o.push(new cl(i,t,n?2:1))}else o.push(new cl(e,t,0))}else for(let t=0;t<i;){let e=t,n=2==dl[t++];for(;t<i&&n==(2==dl[t]);)t++;o.push(new cl(e,t,n?1:2))}return o}function fl(t){return[new cl(0,t,0)]}let pl="";function gl(t,e,i,s,r){var o;let l=s.head-t.from,h=-1;if(0==l){if(!r||!t.length)return null;e[0].level!=i&&(l=e[0].side(!1,i),h=0)}else if(l==t.length){if(r)return null;let t=e[e.length-1];t.level!=i&&(l=t.side(!0,i),h=e.length-1)}h<0&&(h=cl.find(e,l,null!==(o=s.bidiLevel)&&void 0!==o?o:-1,s.assoc));let a=e[h];l==a.side(r,i)&&(a=e[h+=r?1:-1],l=a.side(!r,i));let c=r==(a.dir==i),d=n(t.text,l,c);if(pl=t.text.slice(Math.min(l,d),Math.max(l,d)),d!=a.side(r,i))return L.cursor(d+t.from,c?-1:1,a.level);let u=h==(r?e.length-1:0)?null:e[h+(r?1:-1)];return u||a.level==i?u&&u.level<a.level?L.cursor(u.side(!r,i)+t.from,r?1:-1,u.level):L.cursor(d+t.from,r?-1:1,a.level):L.cursor(r?t.to:t.from,r?-1:1,i)}class ml{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Mt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let t=n.nextSibling;if(t==e)break;let s=Ir.get(n),r=Ir.get(t);(s&&r?s.breakAfter:(s?s.breakAfter:vl(n))||vl(t)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(e))&&(r=s.index,o=s[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Ir.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function vl(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class wl{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class yl extends Ir{constructor(t){super(),this.view=t,this.compositionDeco=wo.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Ao],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Zo(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=wo.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=xl(t);if(!i)return wo.none;let{from:n,to:s,node:r,text:o}=i,l=e.mapPos(n,1),h=Math.max(l,e.mapPos(s,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new ml([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),"￿")==c)h=l+c.length;else{if(a.doc.sliceString(Math.max(0,h-c.length),h,"￿")!=c)return wo.none;l=h-c.length}else if(a.doc.sliceString(l,h,"￿")!=c)return wo.none;let d=Ir.get(r);d instanceof oo?d=d.widget.topView:d&&(d.parent=null);return wo.set(wo.replace({widget:new Sl(r,o,d)}).range(l,h))}(this.view,t.changes)),(eo.ie||eo.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let n=new Al;return Ht.compare(t,e,i,n),n.changes}(this.decorations,this.updateDeco(),t.changes);return e=Zo.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=eo.chrome||eo.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof Mo&&t.widget instanceof bl&&n.push(t.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let n=e>=0?t[e]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:l}=n,{content:h,breakAtStart:a,openStart:c,openEnd:d}=Co.build(this.view.state.doc,o,l,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);qr(this,p,g,u,f,h,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||eo.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if(eo.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(t,s.node.childNodes[s.offset]||null))),s=r=new Hr(t,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&kr(s.node,s.offset,l.anchorNode,l.anchorOffset)&&kr(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{eo.android&&eo.chrome&&this.dom.contains(l.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=yr(this.root);if(n.empty){if(eo.gecko){let t=(e=s.node,i=s.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=kl(s.node,s.offset,1==t?1:-1);e&&(s=new Hr(e,1==t?0:e.nodeValue.length))}}t.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(t.extend)t.collapse(s.node,s.offset),t.extend(r.node,r.offset);else{let e=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),e.setEnd(r.node,r.offset),e.setStart(s.node,s.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new Hr(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new Hr(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=yr(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=Ao.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(zo)?this.root.activeElement==this.dom:xr(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=Ir.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof Ao)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(t>r||t==r&&s.type!=vo.WidgetBefore&&s.type!=vo.WidgetAfter&&(!n||2==e||this.children[n-1].breakAfter||this.children[n-1].type==vo.WidgetBefore&&e>-2))return s.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,n=this.view.contentDOM.clientWidth,s=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,l=0;l<this.children.length;l++){let h=this.children[l],a=o+h.length;if(a>i)break;if(o>=e){let e=h.dom.getBoundingClientRect();if(t.push(e.height),s){let t=h.dom.lastChild,i=t?Sr(t):[];if(i.length){let t=i[i.length-1],s=this.view.textDirection==el.LTR?t.right-e.left:e.right-t.left;s>r&&(r=s,this.minWidth=n,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+h.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof Ao){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=Sr(i.firstChild)[0];t=i.getBoundingClientRect().height,e=n?n.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new zr(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(wo.replace({widget:new bl(n),block:!0,inclusive:!0}).range(i,r))}if(!s)break;i=s.to+1}return wo.set(t)}updateDeco(){let t=this.view.pluginField(Ko.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(Jo),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)});let s=0,r=0,o=0,l=0;for(let t of this.view.pluginField(Ko.scrollMargins))if(t){let{left:e,right:i,top:n,bottom:h}=t;null!=e&&(s=Math.max(s,e)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=h&&(l=Math.max(l,h))}let h={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+l};!function(t,e,i,n,s,r,o,l){let h=t.ownerDocument,a=h.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==h.body;if(d)t=Tr(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==s)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let n=e.bottom-e.top,r=t.bottom-t.top;f=("center"==s&&n<=r?e.top+n/2-r/2:"start"==s||"center"==s&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==n?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==n?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==n==l?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,h,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==el.LTR)}}class bl extends mo{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function xl(t){let e=t.observer.selectionRange,i=e.focusNode&&kl(e.focusNode,e.focusOffset,0);if(!i)return null;let n=t.docView.nearest(i);if(!n)return null;if(n instanceof Ao){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!Ir.get(e);)e=e.previousSibling;let s=e?Ir.get(e).posAtEnd:n.posAtStart;return{from:s,to:s,node:t,text:i}}{for(;;){let{parent:t}=n;if(!t)return null;if(t instanceof Ao)break;n=t}let t=n.posAtStart;return{from:t,to:t+n.length,node:n.dom,text:i}}}class Sl extends mo{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return oo}}function kl(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=Cr(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class Al{constructor(){this.changes=[]}compareRange(t,e){ko(t,e,this.changes)}comparePoint(t,e){ko(t,e,this.changes)}}function Ml(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Cl(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Ol(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Dl(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Tl(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Bl(t,e,i){let n,s,r,o,l,h,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=Sr(d);for(let u=0;u<t.length;u++){let f=t[u];s&&Ol(s,f)&&(f=Dl(Tl(f,s.bottom),s.top));let p=Ml(e,f),g=Cl(i,f);if(0==p&&0==g)return 3==d.nodeType?El(d,e,i):Bl(d,e,i);(!n||o>g||o==g&&r>p)&&(n=d,s=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(l=d,a=f):i<f.top&&(!c||c.top>f.top)&&(h=d,c=f):a&&Ol(a,f)?a=Tl(a,f.bottom):c&&Ol(c,f)&&(c=Dl(c,f.top))}}if(a&&a.bottom>=i?(n=l,s=a):c&&c.top<=i&&(n=h,s=c),!n)return{node:t,offset:0};let d=Math.max(s.left,Math.min(s.right,e));return 3==n.nodeType?El(n,d,i):r||"true"!=n.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,n)+(e>=(s.left+s.right)/2?1:0)}:Bl(n,d,i)}function El(t,e,i){let n=t.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<n;l++){let n=Vr(t,l,l+1).getClientRects();for(let h=0;h<n.length;h++){let a=n[h];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,n=i;if(eo.chrome||eo.gecko){Vr(t,l).getBoundingClientRect().left==a.right&&(n=!i)}if(c<=0)return{node:t,offset:l+(n?1:0)};s=l+(n?1:0),r=c}}}return{node:t,offset:s>-1?s:o>0?t.nodeValue.length:0}}function Rl(t,{x:e,y:i},n,s=-1){var r;let o,l=t.contentDOM.getBoundingClientRect(),h=l.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-h;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=vo.Text;)for(;c=s>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return n?null:0;i=!0,s=-s}i=h+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:n?null:Ll(t,l,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:Ll(t,l,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(l.left+1,Math.min(l.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),eo.safari&&function(t,e,i){let n;if(3!=t.nodeType||e!=(n=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return Vr(t,n-1,n).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let n=Ao.find(t.docView,d);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=Bl(n.dom,e,i))}return t.docView.posFromDOM(g,m)}function Ll(t,e,i,n,s){let r=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((s-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+u(o,r,t.state.tabSize)}function Vl(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=t.bidiSpans(s);for(let o=e,l=null;;){let e=gl(s,r,t.textDirection,o,i),h=pl;if(!e){if(s.number==(i?t.state.doc.lines:1))return o;h="\n",s=t.state.doc.line(s.number+(i?1:-1)),r=t.bidiSpans(s),e=L.cursor(i?s.from:s.to)}if(l){if(!l(h))return o}else{if(!n)return e;l=n(h)}o=e}}function Nl(t,e,i){let n=t.pluginField(Ko.atomicRanges);for(;;){let t=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=e.from>i.from?L.cursor(n,1):L.cursor(s,-1),t=!0)}));if(!t)return i}}class Pl{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in zl){let i=zl[e];t.contentDOM.addEventListener(e,(n=>{"keydown"==e&&this.keydown(t,n)||Fl(t,n)&&!this.ignoreDuringComposition(n)&&(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),eo.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Uo);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{Fl(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Fo(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(e){Fo(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if(eo.android&&eo.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!eo.ios||!(i=Hl.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,Nr(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(eo.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(t,e){let i=9==e.keyCode&&Date.now()<this.lastEscPress+2e3;return 27==e.keyCode?this.lastEscPress=Date.now():Wl.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!eo.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Hl=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Wl=[16,17,18,20,91,92,224,225];class Il{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Mt.allowMultipleSelections)&&function(t,e){let i=t.state.facet(Bo);return i.length?i[0](e):eo.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Eo);return i.length?i[0](e):eo.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=yr(t.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let t=0;t<s.length;t++){let i=s[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=th(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function Fl(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=Ir.get(n))&&i.ignoreEvent(e))return!1;return!0}const zl=Object.create(null),ql=eo.ie&&eo.ie_version<15||eo.ios&&eo.webkit_version<604;function Kl(t,e){let i,{state:n}=t,s=1,r=n.toText(e),o=r.lines==n.selection.ranges.length;if(null!=ih&&n.selection.ranges.every((t=>t.empty))&&ih==r.toString()){let t=-1;i=n.changeByRange((i=>{let l=n.doc.lineAt(i.from);if(l.from==t)return{range:i};t=l.from;let h=n.toText((o?r.line(s++).text:e)+n.lineBreak);return{changes:{from:l.from,insert:h},range:L.cursor(i.from+h.length)}}))}else i=o?n.changeByRange((t=>{let e=r.line(s++);return{changes:{from:t.from,to:t.to,insert:e.text},range:L.cursor(t.from+e.length)}})):n.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}zl.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select")};let Gl=0;function jl(t,e,i,s){if(1==s)return L.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),r=t.doc.lineAt(e),o=e-r.from;if(0==r.length)return L.cursor(e);0==o?i=1:o==r.length&&(i=-1);let l=o,h=o;i<0?l=n(r.text,o,!1):h=n(r.text,o);let a=s(r.text.slice(l,h));for(;l>0;){let t=n(r.text,l,!1);if(s(r.text.slice(t,l))!=a)break;l=t}for(;h<r.length;){let t=n(r.text,h);if(s(r.text.slice(h,t))!=a)break;h=t}return L.range(l+r.from,h+r.from)}(t.state,e,i);{let i=Ao.find(t.docView,e),n=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<t.state.doc.length&&r==n.to&&r++,L.range(s,r)}}zl.touchstart=(t,e)=>{Gl=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},zl.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},zl.mousedown=(t,e)=>{if(t.observer.flush(),Gl>Date.now()-2e3&&1==th(e))return;let i=null;for(let n of t.state.facet(Ro))if(i=n(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=Yl(t,e),n=th(e),s=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),s=s.map(t.changes),o=null)},get(e,l,h){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=Yl(t,e),o=e),!a||!i)return s;let c=jl(t,a.pos,a.bias,n);if(i.pos!=a.pos&&!l){let e=jl(t,i.pos,i.bias,n),s=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=s<c.from?L.range(s,r):L.range(r,s)}return l?s.replaceRange(s.main.extend(c.from,c.to)):h?s.addRange(c):L.create([c])}}}(t,e)),i){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore((()=>Lr(t.contentDOM))),t.inputState.startMouseSelection(new Il(t,e,i,n))}};let _l=(t,e)=>t>=e.top&&t<=e.bottom,Ul=(t,e,i)=>_l(e,i)&&t>=i.left&&t<=i.right;function $l(t,e,i,n){let s=Ao.find(t.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&Ul(i,n,o))return-1;let l=s.coordsAt(r,1);return l&&Ul(i,n,l)?1:o&&_l(n,o)?-1:1}function Yl(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:$l(t,i,e.clientX,e.clientY)}}const Xl=eo.ie&&eo.ie_version<=11;let Jl=null,Ql=0,Zl=0;function th(t){if(!Xl)return t.detail;let e=Jl,i=Zl;return Jl=t,Zl=Date.now(),Ql=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Ql+1)%3:1}function eh(t,e,i,n){if(!i)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:i},h=t.state.changes(o?[o,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}zl.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},zl.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&eh(t,e,n.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(n[t]=e.result),r()},e.readAsText(i[t])}}else eh(t,e,e.dataTransfer.getData("Text"),!0)},zl.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=ql?null:e.clipboardData;i?(Kl(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),Kl(t,i.value)}),50)}(t)};let ih=null;function nh(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}zl.copy=zl.cut=(t,e)=>{let{text:i,ranges:n,linewise:s}=function(t){let e=[],i=[],n=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let s=-1;for(let{from:n}of t.selection.ranges){let r=t.doc.lineAt(n);r.number>s&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),s=r.number}n=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:n}}(t.state);if(!i&&!s)return;ih=s?i:null;let r=ql?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout((()=>{n.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},zl.focus=zl.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},zl.beforeprint=t=>{t.viewState.printing=!0,t.requestMeasure(),setTimeout((()=>{t.viewState.printing=!1,t.requestMeasure()}),2e3)},zl.compositionstart=zl.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),nh(t,!0)))},zl.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&nh(t,!1)}),50)},zl.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},zl.beforeinput=(t,e)=>{var i;let n;if(eo.chrome&&eo.android&&(n=Hl.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const sh=["pre-wrap","normal","pre-line","break-spaces"];class rh{constructor(){this.doc=f.empty,this.lineWrapping=!1,this.direction=el.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return sh.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(e=!0,this.heightSamples[Math.floor(10*n)]=!0)}return e}refresh(t,e,i,n,s,r){let o=sh.indexOf(t)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=n,this.lineLength=s,l){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return l}}class oh{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class lh{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new lh(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new lh(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var hh=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(hh||(hh={}));class ah{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return ah.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:h,toB:a}=n[r],c=s.lineAt(o,hh.ByPosNoHeight,e,0,0),d=c.to>=l?c:s.lineAt(l,hh.ByPosNoHeight,e,0,0);for(a+=d.to-l,l=d.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,h=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,hh.ByPosNoHeight,e,0,0));h+=c.from-o,o=c.from;let u=gh.build(i,t,h,a);s=s.replace(o,l,u)}return s.updateHeight(i,0)}static empty(){return new dh(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>2*s){let s=t[e-1];s.break?t.splice(--e,1,s.left,null,s.right):t.splice(--e,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,s-=e.size}}else if(n<s){let i=t[e++];i&&(n+=i.size)}else{let e=t[--i];e&&(s+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new fh(ah.of(t.slice(0,e)),r,ah.of(t.slice(i)))}}ah.prototype.size=1;class ch extends ah{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new lh(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,r){r(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class dh extends ch{constructor(t,e){super(t,e,vo.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return 1==i.length&&(n instanceof dh||n instanceof uh&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof uh?n=new dh(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):ah.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class uh extends ah{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(e,n),l=Math.max(0,Math.min(r-s,Math.floor((t-i)/o))),{from:h,length:a}=e.line(s+l);return new lh(h,a,i+o*l,o,vo.Text)}lineAt(t,e,i,n,s){if(e==hh.ByHeight)return this.blockAt(t,i,n,s);if(e==hh.ByPosNoHeight){let{from:e,to:n}=i.lineAt(t);return new lh(e,n-e,0,0,vo.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:l,length:h,number:a}=i.lineAt(t);return new lh(l,h,n+o*(a-r),o,vo.Text)}forEachLine(t,e,i,n,s,r){let{firstLine:o,lineHeight:l}=this.lines(i,s);for(let h=Math.max(t,s),a=Math.min(s+this.length,e);h<=a;){let e=i.lineAt(h);h==t&&(n+=l*(e.number-o)),r(new lh(e.from,e.length,n,l,vo.Text)),n+=l,h=e.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let t=i[i.length-1];t instanceof uh?i[i.length-1]=new uh(t.length+n):i.push(null,new uh(n-1))}if(t>0){let e=i[0];e instanceof uh?i[0]=new uh(t+e.length):i.unshift(new uh(t-1),null)}return ah.of(i)}decomposeLeft(t,e){e.push(new uh(t-1),null)}decomposeRight(t,e){e.push(null,new uh(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let i=[],r=Math.max(e,n.from),o=-1,l=t.heightChanged;for(n.from>e&&i.push(new uh(n.from-e-1).updateHeight(t,e));r<=s&&n.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let l=new dh(e,s);l.outdated=!1,i.push(l),r+=e+1}r<=s&&i.push(null,new uh(s-r).updateHeight(t,r));let h=ah.of(i);return t.heightChanged=l||o<0||Math.abs(h.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,h}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class fh extends ah{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,l=e==hh.ByHeight?t<r:t<o,h=l?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,r,o);if(this.break||(l?h.to<o:h.from>o))return h;let a=e==hh.ByPosNoHeight?hh.ByPosNoHeight:hh.ByPos;return l?h.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,n,s).join(h)}forEachLine(t,e,i,n,s,r){let o=n+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,n,s,r),e>=l&&this.right.forEachLine(t,e,i,o,l,r);else{let h=this.lineAt(l,hh.ByPos,i,n,s);t<h.from&&this.left.forEachLine(t,h.from-1,i,n,s,r),h.to>=t&&h.from<=e&&r(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,o,l,r)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let r=s.length;for(let t of i)s.push(t);if(t>0&&ph(s,r-1),e<this.length){let t=s.length;this.decomposeRight(e,s),ph(s,t)}return ah.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?ah.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:r}=this,o=e+s.length+this.break,l=null;return n&&n.from<=e+s.length&&n.more?l=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=o+r.length&&n.more?l=r=r.updateHeight(t,o,i,n):r.updateHeight(t,o,i),l?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function ph(t,e){let i,n;null==t[e]&&(i=t[e-1])instanceof uh&&(n=t[e+1])instanceof uh&&t.splice(e-1,3,new uh(i.length+1+n.length))}class gh{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof dh?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new dh(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new ch(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new dh(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new uh(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof dh)return t;let e=new dh(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=vo.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=vo.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof dh||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new dh(0,-1));let i=t;for(let t of this.nodes)t instanceof dh&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,n){let s=new gh(i,t);return Ht.spans(e,i,n,s,0),s.finish(i)}}class mh{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&ko(t,e,this.changes,5)}}class vh{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return wo.replace({widget:new wh(this.size,t)}).range(this.from,this.to)}}class wh extends mo{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class yh{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new rh,this.scaler=Ch,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=ah.empty().applyChanges(t.facet(Jo),f.empty,this.heightOracle.setDoc(t.doc),[new Zo(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=wo.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>n>=t&&n<=e))){let{from:e,to:i}=this.lineBlockAt(n);t.push(new bh(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?Ch:new Oh(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:Dh(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let n=this.state.facet(Jo),s=t.changedRanges,r=Zo.extendWithRanges(s,function(t,e,i){let n=new mh;return Ht.compare(t,e,i,n,0),n.changes}(t.startState.facet(Jo),n,t?t.changes:M.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace,r="rtl"==i.direction?el.RTL:el.LTR,o=this.heightOracle.mustRefreshForStyle(s,r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,n=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==n||(h|=8,this.paddingTop=t,this.paddingBottom=n)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:function(t,e){let i=t.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=l;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();n=Math.max(n,e.left),s=Math.min(s,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let e=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(e)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:l}=t.docView.measureTextSize();o=n.refresh(s,r,i,l,p/l,e),o&&(t.docView.minWidth=0,h|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),n.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(n,0,o,new oh(this.viewport.from,e)),n.heightChanged&&(h|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&h||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new bh(n.lineAt(r-1e3*i,hh.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),hh.ByHeight,s,0,0).to);if(e){let{head:t}=e.range;if(t<l.from||t>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(t,hh.ByPos,s,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<l.from?o.top:o.bottom-r,l=new bh(n.lineAt(i-500,hh.ByHeight,s,0,0).from,n.lineAt(i+r+500,hh.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new bh(this.heightMap.lineAt(i,hh.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,hh.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,hh.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,hh.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||n<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new vh(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=el.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=xh(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=Sh(r,(this.visibleTop-i.top-t)/i.height),s=Sh(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;n=Sh(r,(this.pixelViewport.left-e)/t),s=Sh(r,(this.pixelViewport.right+e)/t)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&Ah(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&Ah(o,l.to-10,l.to+10);for(let{from:n,to:s}of o)s-n>1e3&&e.push(Mh(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-n)<1e3&&Math.abs(t.to-s)<1e3))||new vh(n,s,this.gapSize(i,n,s,r)))}return e}gapSize(t,e,i,n){let s=kh(n,i)-kh(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){vh.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=wo.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(Jo);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Ht.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||Dh(this.heightMap.lineAt(t,hh.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Dh(this.heightMap.lineAt(this.scaler.fromDOM(t),hh.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Dh(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class bh{constructor(t,e){this.from=t,this.to=e}}function xh(t,e,i){let n=[],s=t,r=0;return Ht.spans(i.facet(Jo),t,e,{span(){},point(t,e){t>s&&(n.push({from:s,to:t}),r+=t-s),s=e}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function Sh({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:s}=e[t],r=s-i;if(n<=r)return i+n;n-=r}}function kh(t,e){let i=0;for(let{from:n,to:s}of t.ranges){if(e<=s){i+=e-n;break}i+=s-n}return i/t.total}function Ah(t,e,i){for(let n=0;n<t.length;n++){let s=t[n];if(s.from<i&&s.to>e){let r=[];s.from<e&&r.push({from:s.from,to:e}),s.to>i&&r.push({from:i,to:s.to}),t.splice(n,1,...r),n+=r.length-1}}}function Mh(t,e){for(let i of t)if(e(i))return i}const Ch={toDOM:t=>t,fromDOM:t=>t,scale:1};class Oh{constructor(t,e,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=e.lineAt(i,hh.ByPos,t,0,0).top,o=e.lineAt(s,hh.ByPos,t,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(e.height-n);for(let t of this.viewports)t.domTop=r+(t.top-s)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),s=t.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function Dh(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new lh(t.from,t.length,i,n-i,Array.isArray(t.type)?t.type.map((t=>Dh(t,e))):t.type)}const Th=H.define({combine:t=>t.join(" ")}),Bh=H.define({combine:t=>t.indexOf(!0)>-1}),Eh=Bt.newName(),Rh=Bt.newName(),Lh=Bt.newName(),Vh={"&light":"."+Rh,"&dark":"."+Lh};function Nh(t,e,i){return new Bt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const Ph=Nh("."+Eh,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Vh),Hh={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Wh=eo.ie&&eo.ie_version<=11;class Ih{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Br,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(eo.ie&&eo.ie_version<=11||eo.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),Wh&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(zo)?e.root.activeElement!=this.dom:!xr(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((eo.ie&&eo.ie_version<=11||eo.android&&eo.chrome)&&!e.state.selection.main.empty&&i.focusNode&&kr(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=yr(t),i=eo.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let n=e.startContainer,s=e.startOffset,r=e.endContainer,o=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);kr(l.node,l.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Hh),Wh&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Wh&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;Nr(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let t=this.readMutation(s);t&&(t.typeOver&&(n=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&xr(this.dom,this.selectionRange);if(e<0&&!s)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,n),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=Fh(e,t.previousSibling||t.target.previousSibling,-1),n=Fh(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Fh(t,e,i){for(;e;){let n=Ir.get(e);if(n&&n.parent==t)return n;let s=e.parentNode;e=s!=t.dom?s:i>0?e.nextSibling:e.previousSibling}return null}function zh(t,e,i,n){let s,r,o=t.state.selection.main;if(e>-1){let n=t.docView.domBoundsAround(e,i,0);if(!n||t.state.readOnly)return;let{from:l,to:h}=n,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new wl(i,n)),s==i&&r==n||e.push(new wl(s,r)));return e}(t),c=new ml(a,t.state);c.readRange(n.startDOM,n.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||eo.android&&c.text.length<h-l)&&(d=o.to,u="end");let p=function(t,e,i,n){let s=Math.min(t.length,e.length),r=0;for(;r<s&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&t.length==e.length)return null;let o=t.length,l=e.length;for(;o>0&&l>0&&t.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(t.state.doc.sliceString(l,h,"￿"),c.text,d-l,u);p&&(eo.chrome&&13==t.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==c.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:f.of(c.text.slice(p.from,p.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,n=2==t.length?t[1].pos:i;return i>-1&&n>-1?L.single(i+e,n+e):null}(a,l)}else if(t.hasFocus||!t.state.facet(zo)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=t.docView,s=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!br(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),l=n&&n.node==e.anchorNode&&n.offset==e.anchorOffset||!br(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);s==o.head&&l==o.anchor||(r=L.single(l,s))}if(s||r)if(!s&&n&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,s.from).append(s.insert).append(t.state.doc.slice(s.to,o.to))}),s){let e=t.state;if(eo.ios&&t.inputState.flushIOSKey(t))return;if(eo.android&&(s.from==o.from&&s.to==o.to&&1==s.insert.length&&2==s.insert.lines&&Nr(t.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&0==s.insert.length&&Nr(t.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&0==s.insert.length&&Nr(t.contentDOM,"Delete",46)))return;let i,n=s.insert.toString();if(t.state.facet(No).some((e=>e(t,s.from,s.to,n))))return;if(t.inputState.composing>=0&&t.inputState.composing++,s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&t.inputState.composing<0){let n=o.from<s.from?e.sliceDoc(o.from,s.from):"",r=o.to>s.to?e.sliceDoc(s.to,o.to):"";i=e.replaceSelection(t.state.toText(n+s.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let n=e.changes(s),l=r&&!e.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let r=t.state.sliceDoc(s.from,s.to),h=xl(t)||t.state.doc.lineAt(o.head),a=o.to-s.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:n,range:l||i.map(n)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let f=e.changes({from:u,to:d,insert:s.insert}),p=i.to-o.to;return{changes:f,range:l?L.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}}))}else i={changes:n,selection:l&&e.selection.replaceRange(l)}}let l="input.type";t.composing&&(l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:l})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class qh{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new yh(t.state||Mt.create()),this.plugins=this.state.facet(jo).map((t=>new $o(t)));for(let t of this.plugins)t.update(this);this.observer=new Ih(this,((t,e,i)=>{zh(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new Pl(this),this.docView=new yl(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);if(n.facet(Mt.phrases)!=this.state.facet(Mt.phrases))return this.setState(n);e=new tl(this,n,t);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(s&&(s=s.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;s=new Wo(t.empty?t:L.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(Po)?s=new Wo(t.value):t.is(Ho)?s=new Wo(t.value,"center"):t.is(Io)&&(s=t.value)}this.viewState.update(e,s),this.bidiCache=_h.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(Qo)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(Th)!=e.state.facet(Th)&&(this.viewState.mustMeasureContent=!0),(i||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(Vo))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new yh(t),this.plugins=t.facet(jo).map((t=>new $o(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new yl(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(jo),i=t.state.facet(jo);if(e!=i){let n=[];for(let s of i){let i=e.indexOf(s);if(i<0)n.push(new $o(s));else{let e=this.plugins[i];e.mustUpdate=t,n.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((t=>{try{return t.read(this)}catch(t){return Fo(this.state,t),jh}})),o=new tl(this,this.state),l=!1,h=!1;o.flags|=n,e?e.flags|=n:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),l=this.docView.update(o));for(let t=0;t<s.length;t++)if(r[t]!=jh)try{let e=s[t];e.write&&e.write(r[t],this)}catch(t){Fo(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),l&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(Vo))t(e)}get themeClasses(){return Eh+" "+(this.state.facet(Bh)?Lh:Rh)+" "+this.state.facet(Th)}updateAttrs(){let t=Uh(this,Yo,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(zo)?"true":"false",class:"cm-content",style:`${eo.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Uh(this,Xo,e),this.observer.ignore((()=>{go(this.contentDOM,this.contentAttrs,e),go(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(qh.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(Qo),Bt.mount(this.root,this.styleModules.concat(Ph).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Gh(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Gh(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Gh(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Nl(this,t,Vl(this,t,e,i))}moveByGroup(t,e){return Nl(this,t,Vl(this,t,e,(e=>function(t,e,i){let n=t.state.charCategorizer(e),s=n(i);return t=>{let e=n(t);return s==xt.Space&&(s=e),s==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=n&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),n=t.posAtCoords({x:i==(t.textDirection==el.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=n)return L.cursor(n,i?-1:1)}let o=Ao.find(t.docView,e.head),l=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return L.cursor(l,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return Nl(this,t,function(t,e,i,n){let s=e.head,r=i?1:-1;if(s==(i?t.state.doc.length:0))return L.cursor(s,e.assoc);let o,l=e.goalColumn,h=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(s),c=t.documentTop;if(a)null==l&&(l=a.left-h.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(s-c);null==l&&(l=Math.min(h.right-h.left,t.defaultCharacterWidth*(s-e.from))),o=(r<0?e.top:e.bottom)+c}let d=h.left+l,u=null!=n?n:t.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(u+i)*r,a=Rl(t,{x:d,y:n},!1,r);if(n<h.top||n>h.bottom||(r<0?a<s:a>s))return L.cursor(a,e.assoc,void 0,l)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:Po.of(L.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Rl(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n);return Dr(i,s[cl.find(s,t-n.from,-1,e)].dir==el.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Kh)return fl(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=ul(t.text,this.textDirection);return this.bidiCache.push(new _h(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||eo.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{Lr(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Io.of(new Wo("number"==typeof t?L.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return _o.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Bt.newName(),n=[Th.of(i),Qo.of(Nh(`.${i}`,t))];return e&&e.dark&&n.push(Bh.of(!0)),n}static baseTheme(t){return X.lowest(Qo.of(Nh("."+Eh,t,Vh)))}}qh.scrollTo=Po,qh.centerOn=Ho,qh.styleModule=Qo,qh.inputHandler=No,qh.exceptionSink=Lo,qh.updateListener=Vo,qh.editable=zo,qh.mouseSelectionStyle=Ro,qh.dragMovesSelection=Eo,qh.clickAddsSelectionRange=Bo,qh.decorations=Jo,qh.darkTheme=Bh,qh.contentAttributes=Xo,qh.editorAttributes=Yo,qh.lineWrapping=qh.contentAttributes.of({class:"cm-lineWrapping"}),qh.announce=ft.define();const Kh=4096;function Gh(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const jh={};class _h{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:el.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let r=t[s];r.dir!=n||e.touchesRange(r.from,r.to)||i.push(new _h(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function Uh(t,e,i){for(let n=t.state.facet(e),s=n.length-1;s>=0;s--){let e=n[s],r="function"==typeof e?e(t):e;r&&fo(r,i)}return i}const $h=eo.mac?"mac":eo.windows?"win":eo.linux?"linux":"key";function Yh(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==i&&e.shiftKey&&(t="Shift-"+t),t}const Xh=qh.domEventHandlers({keydown:(t,e)=>ea(Zh(e.state),t,e,"editor")}),Jh=H.define({enables:Xh}),Qh=new WeakMap;function Zh(t){let e=t.facet(Jh),i=Qh.get(e);return i||Qh.set(e,i=function(t,e=$h){let i=Object.create(null),n=Object.create(null),s=(t,e)=>{let i=n[t];if(null==i)n[t]=e;else if(i!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")},r=(t,n,r,o)=>{let l=i[t]||(i[t]=Object.create(null)),h=n.split(/ (?!$)/).map((t=>function(t,e){const i=t.split(/-(?!$)/);let n,s,r,o,l=i[i.length-1];"Space"==l&&(l=" ");for(let t=0;t<i.length-1;++t){const l=i[t];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))r=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);"mac"==e?o=!0:s=!0}}return n&&(l="Alt-"+l),s&&(l="Ctrl-"+l),o&&(l="Meta-"+l),r&&(l="Shift-"+l),l}(t,e)));for(let e=1;e<h.length;e++){let i=h.slice(0,e).join(" ");s(i,!0),l[i]||(l[i]={preventDefault:!0,commands:[e=>{let n=ta={view:e,prefix:i,scope:t};return setTimeout((()=>{ta==n&&(ta=null)}),4e3),!0}]})}let a=h.join(" ");s(a,!1);let c=l[a]||(l[a]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let i of t){let t=i[e]||i.key;if(t)for(let e of i.scope?i.scope.split(" "):["editor"])r(e,t,i.run,i.preventDefault),i.shift&&r(e,"Shift-"+t,i.shift,i.preventDefault)}return i}(e.reduce(((t,e)=>t.concat(e)),[]))),i}let ta=null;function ea(t,e,i,n){let s=re(e),r=1==s.length&&" "!=s,o="",l=!1;ta&&ta.view==i&&ta.scope==n&&(o=ta.prefix+" ",(l=Wl.indexOf(e.keyCode)<0)&&(ta=null));let h,a=t=>{if(t){for(let e of t.commands)if(e(i))return!0;t.preventDefault&&(l=!0)}return!1},c=t[n];if(c){if(a(c[o+Yh(s,e,!r)]))return!0;if(r&&(e.shiftKey||e.altKey||e.metaKey)&&(h=Yt[e.keyCode])&&h!=s){if(a(c[o+Yh(h,e,!0)]))return!0}else if(r&&e.shiftKey&&a(c[o+Yh(s,e,!0)]))return!0}return l}const ia=!eo.ios;const na={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};ia&&(na[".cm-line"].caretColor="transparent !important");const sa=ct.define(),ra=ct.define(),oa=H.define(),la=H.define({combine:t=>Ct(t,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})});const ha=K.define({create:()=>Aa.empty,update(t,e){let i=e.state.facet(la),n=e.annotation(sa);if(n){let s=e.docChanged?L.single(function(t){let e=0;return t.iterChangedRanges(((t,i)=>e=i)),e}(e.changes)):void 0,r=ga.fromTransaction(e,s),o=n.side,l=0==o?t.undone:t.done;return l=r?ma(l,l.length,i.minDepth,r):ya(l,e.startState.selection),new Aa(0==o?n.rest:l,0==o?l:n.rest)}let s=e.annotation(ra);if("full"!=s&&"before"!=s||(t=t.isolate()),!1===e.annotation(pt.addToHistory))return e.changes.empty?t:t.addMapping(e.changes.desc);let r=ga.fromTransaction(e),o=e.annotation(pt.time),l=e.annotation(pt.userEvent);return r?t=t.addChanges(r,o,l,i.newGroupDelay,i.minDepth):e.selection&&(t=t.addSelection(e.startState.selection,o,l,i.newGroupDelay)),"full"!=s&&"after"!=s||(t=t.isolate()),t},toJSON:t=>({done:t.done.map((t=>t.toJSON())),undone:t.undone.map((t=>t.toJSON()))}),fromJSON:t=>new Aa(t.done.map(ga.fromJSON),t.undone.map(ga.fromJSON))});function aa(t={}){return[ha,la.of(t),qh.domEventHandlers({beforeinput(t,e){let i="historyUndo"==t.inputType?da:"historyRedo"==t.inputType?ua:null;return!!i&&(t.preventDefault(),i(e))}})]}function ca(t,e){return function({state:i,dispatch:n}){if(!e&&i.readOnly)return!1;let s=i.field(ha,!1);if(!s)return!1;let r=s.pop(t,i,e);return!!r&&(n(r),!0)}}const da=ca(0,!1),ua=ca(1,!1),fa=ca(0,!0),pa=ca(1,!0);class ga{constructor(t,e,i,n,s){this.changes=t,this.effects=e,this.mapped=i,this.startSelection=n,this.selectionsAfter=s}setSelAfter(t){return new ga(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,e,i;return{changes:null===(t=this.changes)||void 0===t?void 0:t.toJSON(),mapped:null===(e=this.mapped)||void 0===e?void 0:e.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map((t=>t.toJSON()))}}static fromJSON(t){return new ga(t.changes&&M.fromJSON(t.changes),[],t.mapped&&A.fromJSON(t.mapped),t.startSelection&&L.fromJSON(t.startSelection),t.selectionsAfter.map(L.fromJSON))}static fromTransaction(t,e){let i=wa;for(let e of t.startState.facet(oa)){let n=e(t);n.length&&(i=i.concat(n))}return!i.length&&t.changes.empty?null:new ga(t.changes.invert(t.startState.doc),i,void 0,e||t.startState.selection,wa)}static selection(t){return new ga(void 0,wa,void 0,void 0,t)}}function ma(t,e,i,n){let s=e+1>i+20?e-i-1:0,r=t.slice(s,e);return r.push(n),r}function va(t,e){return t.length?e.length?t.concat(e):t:e}const wa=[];function ya(t,e){if(t.length){let i=t[t.length-1],n=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-200));return n.length&&n[n.length-1].eq(e)?t:(n.push(e),ma(t,t.length-1,1e9,i.setSelAfter(n)))}return[ga.selection([e])]}function ba(t){let e=t[t.length-1],i=t.slice();return i[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),i}function xa(t,e){if(!t.length)return t;let i=t.length,n=wa;for(;i;){let s=Sa(t[i-1],e,n);if(s.changes&&!s.changes.empty||s.effects.length){let e=t.slice(0,i);return e[i-1]=s,e}e=s.mapped,i--,n=s.selectionsAfter}return n.length?[ga.selection(n)]:wa}function Sa(t,e,i){let n=va(t.selectionsAfter.length?t.selectionsAfter.map((t=>t.map(e))):wa,i);if(!t.changes)return ga.selection(n);let s=t.changes.map(e),r=e.mapDesc(t.changes,!0),o=t.mapped?t.mapped.composeDesc(r):r;return new ga(s,ft.mapEffects(t.effects,e),o,t.startSelection.map(r),n)}const ka=/^(input\.type|delete)($|\.)/;class Aa{constructor(t,e,i=0,n){this.done=t,this.undone=e,this.prevTime=i,this.prevUserEvent=n}isolate(){return this.prevTime?new Aa(this.done,this.undone):this}addChanges(t,e,i,n,s){let r=this.done,o=r[r.length-1];return r=o&&o.changes&&!o.changes.empty&&t.changes&&(!i||ka.test(i))&&(!o.selectionsAfter.length&&e-this.prevTime<n&&function(t,e){let i=[],n=!1;return t.iterChangedRanges(((t,e)=>i.push(t,e))),e.iterChangedRanges(((t,e,s,r)=>{for(let t=0;t<i.length;){let e=i[t++],o=i[t++];r>=e&&s<=o&&(n=!0)}})),n}(o.changes,t.changes)||"input.type.compose"==i)?ma(r,r.length-1,s,new ga(t.changes.compose(o.changes),va(t.effects,o.effects),o.mapped,o.startSelection,wa)):ma(r,r.length,s,t),new Aa(r,wa,e,i)}addSelection(t,e,i,n){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:wa;return s.length>0&&e-this.prevTime<n&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&(r=s[s.length-1],o=t,r.ranges.length==o.ranges.length&&0===r.ranges.filter(((t,e)=>t.empty!=o.ranges[e].empty)).length)?this:new Aa(ya(this.done,t),this.undone,e,i);var r,o}addMapping(t){return new Aa(xa(this.done,t),xa(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,e,i){let n=0==t?this.done:this.undone;if(0==n.length)return null;let s=n[n.length-1];if(i&&s.selectionsAfter.length)return e.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:sa.of({side:t,rest:ba(n)}),userEvent:0==t?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let i=1==n.length?wa:n.slice(0,n.length-1);return s.mapped&&(i=xa(i,s.mapped)),e.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:sa.of({side:t,rest:i}),filter:!1,userEvent:0==t?"undo":"redo",scrollIntoView:!0})}return null}}Aa.empty=new Aa(wa,wa);const Ma=[{key:"Mod-z",run:da,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:ua,preventDefault:!0},{key:"Mod-u",run:fa,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:pa,preventDefault:!0}];function Ca(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function Oa(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function Da(t,e){if(!e.anchorNode)return!1;try{return Oa(t,e.anchorNode)}catch(t){return!1}}function Ta(t){return 3==t.nodeType?za(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function Ba(t,e,i,n){return!!i&&(Ra(t,e,i,n,-1)||Ra(t,e,i,n,1))}function Ea(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function Ra(t,e,i,n,s){for(;;){if(t==i&&e==n)return!0;if(e==(s<0?0:La(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=Ea(t)+(s<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(s<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=s<0?La(t):0}}}function La(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const Va={left:0,right:0,top:0,bottom:0};function Na(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Pa(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Ha{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let Wa,Ia=null;function Fa(t){if(t.setActive)return t.setActive();if(Ia)return t.focus(Ia);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Ia?{get preventScroll(){return Ia={preventScroll:!0},!0}}:void 0),!Ia){Ia=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],s=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function za(t,e,i=e){let n=Wa||(Wa=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function qa(t,e,i){let n={key:e,code:e,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,t.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,t.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function Ka(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Ga{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Ga(t.parentNode,Ea(t),e)}static after(t,e){return new Ga(t.parentNode,Ea(t)+1,e)}}const ja=[];class _a{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e=this.dom,i=e.firstChild;for(let n of this.children){if(n.dirty){if(!n.dom&&i){let t=_a.get(i);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(i)}n.sync(t),n.dirty=0}if(t&&!t.written&&t.node==e&&i!=n.dom&&(t.written=!0),n.dom.parentNode==e){for(;i&&i!=n.dom;)i=Ua(i);i=n.dom.nextSibling}else e.insertBefore(n.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=Ua(i)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=0==La(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==n&&e.firstChild!=e.lastChild&&(n=t==e.firstChild?-1:1),t=e}i=n<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!_a.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let n=this.children[t];if(n.dom==i)return e;e+=n.length+n.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,r=-1,o=-1;for(let l=0,h=i,a=i;l<this.children.length;l++){let i=this.children[l],c=h+i.length;if(h<t&&c>e)return i.domBoundsAround(t,e,h);if(c>=t&&-1==n&&(n=l,s=h),h>e&&i.dom.parentNode==this.dom){r=l,o=a;break}a=c,h=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=ja){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new $a(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Ua(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}_a.prototype.breakAfter=0;class $a{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Ya(t,e,i,n,s,r,o,l,h){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(i,s,r.length?d:null,0==i,l,h))){if(n<a.length){let t=a[n];t&&s<t.length?(e==n&&(t=t.split(s),s=0),!u&&d&&t.merge(0,s,d,!0,0,h)?r[r.length-1]=t:(s&&t.merge(0,s,null,!1,0,h),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),e++));e<n&&r.length;)if(a[n-1].become(r[r.length-1]))n--,r.pop(),h=r.length?0:l;else{if(!a[e].become(r[0]))break;e++,r.shift(),l=r.length?0:h}!r.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,l,h)&&e--,(e<n||r.length)&&t.replaceChildren(e,n,r)}}function Xa(t,e,i,n,s,r){let o=t.childCursor(),{i:l,off:h}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of n)d+=t.length;t.length+=d,Ya(t,a,c,l,h,n,0,s,r)}let Ja="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Qa="undefined"!=typeof document?document:{documentElement:{style:{}}};const Za=/Edge\/(\d+)/.exec(Ja.userAgent),tc=/MSIE \d/.test(Ja.userAgent),ec=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ja.userAgent),ic=!!(tc||ec||Za),nc=!ic&&/gecko\/(\d+)/i.test(Ja.userAgent),sc=!ic&&/Chrome\/(\d+)/.exec(Ja.userAgent),rc="webkitFontSmoothing"in Qa.documentElement.style,oc=!ic&&/Apple Computer/.test(Ja.vendor),lc=oc&&(/Mobile\/\w+/.test(Ja.userAgent)||Ja.maxTouchPoints>2);var hc={mac:lc||/Mac/.test(Ja.platform),windows:/Win/.test(Ja.platform),linux:/Linux|X11/.test(Ja.platform),ie:ic,ie_version:tc?Qa.documentMode||6:ec?+ec[1]:Za?+Za[1]:0,gecko:nc,gecko_version:nc?+(/Firefox\/(\d+)/.exec(Ja.userAgent)||[0,0])[1]:0,chrome:!!sc,chrome_version:sc?+sc[1]:0,ios:lc,android:/Android\b/.test(Ja.userAgent),webkit:rc,safari:oc,webkit_version:rc?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Qa.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class ac extends _a{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof ac&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new ac(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Ga(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return dc(this.dom,t,e)}}class cc extends _a{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(Ka(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,r){return(!i||!(!(i instanceof cc&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&r<=0))&&(Xa(this,t,e,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),n<0&&i>=t&&(n=s),i=o,s++}let r=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new cc(this.mark,e,r)}domAtPos(t){return vc(this.dom,this.children,t)}coordsAt(t,e){return yc(this,t,e)}}function dc(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;0==e&&i<0||e==n&&i>=0?hc.chrome||hc.gecko||(e?(s--,o=1):(r++,o=-1)):i<0?s--:r++;let l=za(t,s,r).getClientRects();if(!l.length)return Va;let h=l[(o?o<0:i>=0)?0:l.length-1];return hc.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(l,(t=>t.width))||h),o?Na(h,o<0):h||null}class uc extends _a{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||uc)(t,e,i)}split(t){let e=uc.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof uc&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof uc&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return f.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):f.empty}domAtPos(t){return 0==t?Ga.before(this.dom):Ga.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return Va;for(let e=t>0?i.length-1:0;n=i[e],!(t>0?0==e:e==i.length-1||n.top<n.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?n:Na(n,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class fc extends uc{domAtPos(t){let{topView:e,text:i}=this.widget;return e?pc(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Ga(i,Math.min(t,i.nodeValue.length)))):new Ga(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?gc(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?pc(t,e,i,n,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>dc(n,t,e))):dc(n,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function pc(t,e,i,n,s,r){if(i instanceof cc){for(let o of i.children){let i=Oa(o.dom,n),l=i?n.nodeValue.length:o.length;if(t<l||t==l&&o.getSide()<=0)return i?pc(t,e,o,n,s,r):s(o,t,e);t-=l}return s(i,i.length,-1)}return i.dom==n?r(t,e):s(i,t,e)}function gc(t,e,i,n){if(i instanceof cc)for(let s of i.children){let i=0,r=Oa(s.dom,n);if(Oa(s.dom,t))return i+(r?gc(t,e,s,n):s.localPosFromDOM(t,e));i+=r?n.nodeValue.length:s.length}else if(i.dom==n)return Math.min(e,n.nodeValue.length);return i.localPosFromDOM(t,e)}class mc extends _a{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof mc&&t.side==this.side}split(){return new mc(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Ga.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,n=i?i.children.indexOf(t):-1;for(;i&&n>=0;)if(e<0?n>0:n<i.children.length){let t=i.children[n+e];if(t instanceof ac){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}n+=e}else{if(!(i instanceof cc&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}n=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return f.empty}}function vc(t,e,i){let n=0;for(let s=0;n<e.length;n++){let r=e[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return Ga.after(i)}return new Ga(t,0)}function wc(t,e,i){let n,{children:s}=t;i>0&&e instanceof cc&&s.length&&(n=s[s.length-1])instanceof cc&&n.mark.eq(e.mark)?wc(n,e.children[0],i-1):(s.push(e),e.setParent(t)),t.length+=e.length}function yc(t,e,i){for(let n=0,s=0;s<t.children.length;s++){let r,o=t.children[s],l=n+o.length;if((i<=0||l==t.length||o.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(r=t.children[s+1]).length||r.getSide()>0)){let t=0;if(l==n){if(o.getSide()<=0)continue;t=i=-o.getSide()}let s=o.coordsAt(Math.max(0,e-n),i);return t&&s?Na(s,i<0):s}n=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let s=Ta(n);return s[s.length-1]||null}function bc(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function xc(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||t[s]!==e[s])return!1;return!0}function Sc(t,e,i){if(e)for(let n in e)i&&n in i||t.removeAttribute(n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(n,i[n])}ac.prototype.children=uc.prototype.children=mc.prototype.children=ja;class kc{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var Ac=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Ac||(Ac={}));class Mc extends Lt{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new Cc(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?4e8:-5e8:e>0?1e8:-1e8,new Dc(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,n=!!t.block;if(t.isBlockGap)e=-4e8,i=3e8;else{let{start:s,end:r}=Tc(t,n);e=(s?n?-3e8:-1:5e8)-1,i=1+(r?n?2e8:1:-6e8)}return new Dc(t,e,i,n,t.widget||null,!0)}static line(t){return new Oc(t)}static set(t,e=!1){return Ht.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Mc.none=Ht.empty;class Cc extends Mc{constructor(t){let{start:e,end:i}=Tc(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof Cc&&this.tagName==t.tagName&&this.class==t.class&&xc(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}Cc.prototype.point=!1;class Oc extends Mc{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Oc&&xc(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Oc.prototype.mapMode=k.TrackBefore,Oc.prototype.point=!0;class Dc extends Mc{constructor(t,e,i,n,s,r){super(e,i,s,t),this.block=n,this.isReplace=r,this.mapMode=n?e<=0?k.TrackBefore:k.TrackAfter:k.TrackDel}get type(){return this.startSide<this.endSide?Ac.WidgetRange:this.startSide<=0?Ac.WidgetBefore:Ac.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof Dc&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function Tc(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return null==i&&(i=t.inclusive),null==n&&(n=t.inclusive),{start:null!=i?i:e,end:null!=n?n:e}}function Bc(t,e,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=t?i[s]=Math.max(i[s],e):i.push(t,e)}Dc.prototype.point=!0;class Ec extends _a{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,r){if(i){if(!(i instanceof Ec))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Xa(this,t,e,i?i.children:[],s,r),!0}split(t){let e=new Ec;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){xc(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){wc(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=bc(e,this.attrs||{})),i&&(this.attrs=bc({class:i},this.attrs||{}))}domAtPos(t){return vc(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(Ka(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(Sc(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&_a.get(i)instanceof cc;)i=i.lastChild;if(!i||"BR"!=i.nodeName&&0==(null===(e=_a.get(i))||void 0===e?void 0:e.isEditable)&&(!hc.ios||!this.children.some((t=>t instanceof ac)))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof ac))return null;let i=Ta(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return yc(this,t,e)}become(t){return!1}get type(){return Ac.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],r=n+s.length;if(r>=e){if(s instanceof Ec)return s;if(r>e)break}n=r+s.breakAfter}return null}}class Rc extends _a{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof Rc&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Ga.before(this.dom):Ga.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Rc(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return ja}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):f.empty}domBoundsAround(){return null}become(t){return t instanceof Rc&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Lc{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Rc&&t.type==Ac.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ec),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Vc(new mc(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Vc(new ac(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s){let r=e-t;if(i instanceof Dc)if(i.block){let{type:t}=i;t!=Ac.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new Rc(i.widget||new Nc("div"),r,t))}else{let o=uc.create(i.widget||new Nc("span"),r,i.startSide),l=this.atCursorPos&&!o.isEditable&&s<=n.length&&(t<e||i.startSide>0),h=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(n),l&&(a.append(Vc(new mc(1),n),s),s=n.length+Math.max(0,s-n.length)),a.append(Vc(o,n),s),this.atCursorPos=h,this.pendingBuffer=h?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}filterPoint(t,e,i,n){if(n<this.disallowBlockEffectsBelow&&i instanceof Dc){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,n,s){let r=new Lc(t,e,i,s);return r.openEnd=Ht.spans(n,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function Vc(t,e){for(let i of e)t=new cc(i,[t],t.length);return t}class Nc extends kc{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const Pc=[],Hc=H.define(),Wc=H.define(),Ic=H.define(),Fc=H.define(),zc=H.define(),qc=H.define(),Kc=ft.define({map:(t,e)=>t.map(e)}),Gc=ft.define({map:(t,e)=>t.map(e)});class jc{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new jc(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const _c=ft.define({map:(t,e)=>t.map(e)});function Uc(t,e,i){let n=t.facet(Fc);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const $c=H.define({combine:t=>!t.length||t[0]});class Yc{constructor(t,e){this.field=t,this.get=e}}class Xc{from(t){return new Yc(this,t)}static define(){return new Xc}}Xc.decorations=Xc.define(),Xc.atomicRanges=Xc.define(),Xc.scrollMargins=Xc.define();let Jc=0;const Qc=H.define();class Zc{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Qc.of(this)}static define(t,e){let{eventHandlers:i,provide:n,decorations:s}=e||{},r=[];if(n)for(let t of Array.isArray(n)?n:[n])r.push(t);return i&&r.push(td.from((t=>({plugin:t,handlers:i})))),s&&r.push(Xc.decorations.from(s)),new Zc(Jc++,t,r)}static fromClass(t,e){return Zc.define((e=>new t(e)),e)}}const td=Xc.define();class ed{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:n}of this.spec.fields)i==t&&e.push(n(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(Uc(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Uc(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Uc(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const id=H.define(),nd=H.define(),sd=H.define(),rd=H.define();class od{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new od(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let l=n==t.length?null:t[n],h=r-o,a=l?l.fromB:1e9;for(;s<e.length&&e[s]<a;){let t=e[s],n=e[s+1],r=Math.max(o,t),l=Math.min(a,n);if(r<=l&&new od(r+h,l+h,r,l).addToSet(i),n>a)break;s+=2}if(!l)return i;new od(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class ld{constructor(t,e,i=Pc){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=M.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let n=[];this.changes.iterChangedRanges(((t,e,i,s)=>n.push(new od(t,e,i,s)))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var hd=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(hd||(hd={}));const ad=hd.LTR,cd=hd.RTL;function dd(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const ud=dd("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),fd=dd("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),pd=Object.create(null),gd=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);pd[e]=i,pd[i]=-e}const md=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class vd{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?cd:ad}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<e:o.to>e:t[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const wd=[];function yd(t,e){let i=t.length,n=e==ad?1:2,s=e==ad?2:1;if(!t||1==n&&!md.test(t))return bd(i);for(let e=0,s=n,o=n;e<i;e++){let i=(r=t.charCodeAt(e))<=247?ud[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?fd[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),wd[e]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let t=0,e=n,s=n;t<i;t++){let n=wd[t];if(128==n)t<i-1&&e==wd[t+1]&&24&e?n=wd[t]=e:wd[t]=256;else if(64==n){let n=t+1;for(;n<i&&64==wd[n];)n++;let r=t&&8==e||n<i&&8==wd[n]?1==s?1:8:256;for(let e=t;e<n;e++)wd[e]=r;t=n-1}else 8==n&&1==s&&(wd[t]=1);e=n,7&n&&(s=n)}for(let e,r,o,l=0,h=0,a=0;l<i;l++)if(r=pd[e=t.charCodeAt(l)])if(r<0){for(let t=h-3;t>=0;t-=3)if(gd[t+1]==-r){let e=gd[t+2],i=2&e?n:4&e?1&e?s:n:0;i&&(wd[l]=wd[gd[t]]=i),h=t;break}}else{if(189==gd.length)break;gd[h++]=l,gd[h++]=e,gd[h++]=a}else if(2==(o=wd[l])||1==o){let t=o==n;a=t?0:1;for(let e=h-3;e>=0;e-=3){let i=gd[e+2];if(2&i)break;if(t)gd[e+2]|=2;else{if(4&i)break;gd[e+2]|=4}}}for(let t=0;t<i;t++)if(256==wd[t]){let e=t+1;for(;e<i&&256==wd[e];)e++;let s=1==(t?wd[t-1]:n),r=s==(1==(e<i?wd[e]:n))?s?1:2:n;for(let i=t;i<e;i++)wd[i]=r;t=e-1}let o=[];if(1==n)for(let t=0;t<i;){let e=t,n=1!=wd[t++];for(;t<i&&n==(1!=wd[t]);)t++;if(n)for(let i=t;i>e;){let t=i,n=2!=wd[--i];for(;i>e&&n==(2!=wd[i-1]);)i--;o.push(new vd(i,t,n?2:1))}else o.push(new vd(e,t,0))}else for(let t=0;t<i;){let e=t,n=2==wd[t++];for(;t<i&&n==(2==wd[t]);)t++;o.push(new vd(e,t,n?1:2))}return o}function bd(t){return[new vd(0,t,0)]}let xd="";function Sd(t,e,i,s,r){var o;let l=s.head-t.from,h=-1;if(0==l){if(!r||!t.length)return null;e[0].level!=i&&(l=e[0].side(!1,i),h=0)}else if(l==t.length){if(r)return null;let t=e[e.length-1];t.level!=i&&(l=t.side(!0,i),h=e.length-1)}h<0&&(h=vd.find(e,l,null!==(o=s.bidiLevel)&&void 0!==o?o:-1,s.assoc));let a=e[h];l==a.side(r,i)&&(a=e[h+=r?1:-1],l=a.side(!r,i));let c=r==(a.dir==i),d=n(t.text,l,c);if(xd=t.text.slice(Math.min(l,d),Math.max(l,d)),d!=a.side(r,i))return L.cursor(d+t.from,c?-1:1,a.level);let u=h==(r?e.length-1:0)?null:e[h+(r?1:-1)];return u||a.level==i?u&&u.level<a.level?L.cursor(u.side(!r,i)+t.from,r?1:-1,u.level):L.cursor(d+t.from,r?-1:1,a.level):L.cursor(r?t.to:t.from,r?-1:1,i)}class kd{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Mt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let t=n.nextSibling;if(t==e)break;let s=_a.get(n),r=_a.get(t);(s&&r?s.breakAfter:(s?s.breakAfter:Ad(n))||Ad(t)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(e))&&(r=s.index,o=s[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=_a.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function Ad(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Md{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class Cd extends _a{constructor(t){super(),this.view=t,this.compositionDeco=Mc.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Ec],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new od(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Mc.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=Dd(t);if(!i)return Mc.none;let{from:n,to:s,node:r,text:o}=i,l=e.mapPos(n,1),h=Math.max(l,e.mapPos(s,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new kd([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),"￿")==c)h=l+c.length;else{if(a.doc.sliceString(Math.max(0,h-c.length),h,"￿")!=c)return Mc.none;l=h-c.length}else if(a.doc.sliceString(l,h,"￿")!=c)return Mc.none;let d=_a.get(r);d instanceof fc?d=d.widget.topView:d&&(d.parent=null);return Mc.set(Mc.replace({widget:new Td(r,o,d)}).range(l,h))}(this.view,t.changes)),(hc.ie||hc.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let n=new Ed;return Ht.compare(t,e,i,n),n.changes}(this.decorations,this.updateDeco(),t.changes);return e=od.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=hc.chrome||hc.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof Rc&&t.widget instanceof Od&&n.push(t.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let n=e>=0?t[e]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:l}=n,{content:h,breakAtStart:a,openStart:c,openEnd:d}=Lc.build(this.view.state.doc,o,l,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);Ya(this,p,g,u,f,h,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||hc.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if(hc.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(t,s.node.childNodes[s.offset]||null))),s=r=new Ga(t,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&Ba(s.node,s.offset,l.anchorNode,l.anchorOffset)&&Ba(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{hc.android&&hc.chrome&&this.dom.contains(l.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=Ca(this.root);if(n.empty){if(hc.gecko){let t=(e=s.node,i=s.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=Bd(s.node,s.offset,1==t?1:-1);e&&(s=new Ga(e,1==t?0:e.nodeValue.length))}}t.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(t.extend)t.collapse(s.node,s.offset),t.extend(r.node,r.offset);else{let e=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),e.setEnd(r.node,r.offset),e.setStart(s.node,s.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new Ga(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new Ga(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=Ca(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=Ec.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet($c)?this.root.activeElement==this.dom:Da(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=_a.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof Ec)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(t>r||t==r&&s.type!=Ac.WidgetBefore&&s.type!=Ac.WidgetAfter&&(!n||2==e||this.children[n-1].breakAfter||this.children[n-1].type==Ac.WidgetBefore&&e>-2))return s.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,n=this.view.contentDOM.clientWidth,s=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,l=0;l<this.children.length;l++){let h=this.children[l],a=o+h.length;if(a>i)break;if(o>=e){let e=h.dom.getBoundingClientRect();if(t.push(e.height),s){let t=h.dom.lastChild,i=t?Ta(t):[];if(i.length){let t=i[i.length-1],s=this.view.textDirection==hd.LTR?t.right-e.left:e.right-t.left;s>r&&(r=s,this.minWidth=n,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+h.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof Ec){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=Ta(i.firstChild)[0];t=i.getBoundingClientRect().height,e=n?n.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new $a(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(Mc.replace({widget:new Od(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!s)break;i=s.to+1}return Mc.set(t)}updateDeco(){let t=this.view.pluginField(Xc.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(sd),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)});let s=0,r=0,o=0,l=0;for(let t of this.view.pluginField(Xc.scrollMargins))if(t){let{left:e,right:i,top:n,bottom:h}=t;null!=e&&(s=Math.max(s,e)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=h&&(l=Math.max(l,h))}let h={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+l};!function(t,e,i,n,s,r,o,l){let h=t.ownerDocument,a=h.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==h.body;if(d)t=Pa(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==s)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let n=e.bottom-e.top,r=t.bottom-t.top;f=("center"==s&&n<=r?e.top+n/2-r/2:"start"==s||"center"==s&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==n?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==n?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==n==l?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,h,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==hd.LTR)}}class Od extends kc{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Dd(t){let e=t.observer.selectionRange,i=e.focusNode&&Bd(e.focusNode,e.focusOffset,0);if(!i)return null;let n=t.docView.nearest(i);if(!n)return null;if(n instanceof Ec){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!_a.get(e);)e=e.previousSibling;let s=e?_a.get(e).posAtEnd:n.posAtStart;return{from:s,to:s,node:t,text:i}}{for(;;){let{parent:t}=n;if(!t)return null;if(t instanceof Ec)break;n=t}let t=n.posAtStart;return{from:t,to:t+n.length,node:n.dom,text:i}}}class Td extends kc{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return fc}}function Bd(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=La(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class Ed{constructor(){this.changes=[]}compareRange(t,e){Bc(t,e,this.changes)}comparePoint(t,e){Bc(t,e,this.changes)}}function Rd(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Ld(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Vd(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Nd(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Pd(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Hd(t,e,i){let n,s,r,o,l,h,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=Ta(d);for(let u=0;u<t.length;u++){let f=t[u];s&&Vd(s,f)&&(f=Nd(Pd(f,s.bottom),s.top));let p=Rd(e,f),g=Ld(i,f);if(0==p&&0==g)return 3==d.nodeType?Wd(d,e,i):Hd(d,e,i);(!n||o>g||o==g&&r>p)&&(n=d,s=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(l=d,a=f):i<f.top&&(!c||c.top>f.top)&&(h=d,c=f):a&&Vd(a,f)?a=Pd(a,f.bottom):c&&Vd(c,f)&&(c=Nd(c,f.top))}}if(a&&a.bottom>=i?(n=l,s=a):c&&c.top<=i&&(n=h,s=c),!n)return{node:t,offset:0};let d=Math.max(s.left,Math.min(s.right,e));return 3==n.nodeType?Wd(n,d,i):r||"true"!=n.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,n)+(e>=(s.left+s.right)/2?1:0)}:Hd(n,d,i)}function Wd(t,e,i){let n=t.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<n;l++){let n=za(t,l,l+1).getClientRects();for(let h=0;h<n.length;h++){let a=n[h];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,n=i;if(hc.chrome||hc.gecko){za(t,l).getBoundingClientRect().left==a.right&&(n=!i)}if(c<=0)return{node:t,offset:l+(n?1:0)};s=l+(n?1:0),r=c}}}return{node:t,offset:s>-1?s:o>0?t.nodeValue.length:0}}function Id(t,{x:e,y:i},n,s=-1){var r;let o,l=t.contentDOM.getBoundingClientRect(),h=l.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-h;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=Ac.Text;)for(;c=s>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return n?null:0;i=!0,s=-s}i=h+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:n?null:Fd(t,l,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:Fd(t,l,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(l.left+1,Math.min(l.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),hc.safari&&function(t,e,i){let n;if(3!=t.nodeType||e!=(n=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return za(t,n-1,n).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let n=Ec.find(t.docView,d);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=Hd(n.dom,e,i))}return t.docView.posFromDOM(g,m)}function Fd(t,e,i,n,s){let r=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((s-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+u(o,r,t.state.tabSize)}function zd(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=t.bidiSpans(s);for(let o=e,l=null;;){let e=Sd(s,r,t.textDirection,o,i),h=xd;if(!e){if(s.number==(i?t.state.doc.lines:1))return o;h="\n",s=t.state.doc.line(s.number+(i?1:-1)),r=t.bidiSpans(s),e=L.cursor(i?s.from:s.to)}if(l){if(!l(h))return o}else{if(!n)return e;l=n(h)}o=e}}function qd(t,e,i){let n=t.pluginField(Xc.atomicRanges);for(;;){let t=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=e.from>i.from?L.cursor(n,1):L.cursor(s,-1),t=!0)}));if(!t)return i}}class Kd{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in $d){let i=$d[e];t.contentDOM.addEventListener(e,(n=>{"keydown"==e&&this.keydown(t,n)||Ud(t,n)&&!this.ignoreDuringComposition(n)&&(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),hc.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(td);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{Ud(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Uc(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(e){Uc(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if(hc.android&&hc.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!hc.ios||!(i=Gd.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,qa(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(hc.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(t,e){let i=9==e.keyCode&&Date.now()<this.lastEscPress+2e3;return 27==e.keyCode?this.lastEscPress=Date.now():jd.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!hc.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Gd=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],jd=[16,17,18,20,91,92,224,225];class _d{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Mt.allowMultipleSelections)&&function(t,e){let i=t.state.facet(Hc);return i.length?i[0](e):hc.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Wc);return i.length?i[0](e):hc.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=Ca(t.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let t=0;t<s.length;t++){let i=s[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=lu(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function Ud(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=_a.get(n))&&i.ignoreEvent(e))return!1;return!0}const $d=Object.create(null),Yd=hc.ie&&hc.ie_version<15||hc.ios&&hc.webkit_version<604;function Xd(t,e){let i,{state:n}=t,s=1,r=n.toText(e),o=r.lines==n.selection.ranges.length;if(null!=au&&n.selection.ranges.every((t=>t.empty))&&au==r.toString()){let t=-1;i=n.changeByRange((i=>{let l=n.doc.lineAt(i.from);if(l.from==t)return{range:i};t=l.from;let h=n.toText((o?r.line(s++).text:e)+n.lineBreak);return{changes:{from:l.from,insert:h},range:L.cursor(i.from+h.length)}}))}else i=o?n.changeByRange((t=>{let e=r.line(s++);return{changes:{from:t.from,to:t.to,insert:e.text},range:L.cursor(t.from+e.length)}})):n.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}$d.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select")};let Jd=0;function Qd(t,e,i,s){if(1==s)return L.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),r=t.doc.lineAt(e),o=e-r.from;if(0==r.length)return L.cursor(e);0==o?i=1:o==r.length&&(i=-1);let l=o,h=o;i<0?l=n(r.text,o,!1):h=n(r.text,o);let a=s(r.text.slice(l,h));for(;l>0;){let t=n(r.text,l,!1);if(s(r.text.slice(t,l))!=a)break;l=t}for(;h<r.length;){let t=n(r.text,h);if(s(r.text.slice(h,t))!=a)break;h=t}return L.range(l+r.from,h+r.from)}(t.state,e,i);{let i=Ec.find(t.docView,e),n=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<t.state.doc.length&&r==n.to&&r++,L.range(s,r)}}$d.touchstart=(t,e)=>{Jd=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},$d.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},$d.mousedown=(t,e)=>{if(t.observer.flush(),Jd>Date.now()-2e3&&1==lu(e))return;let i=null;for(let n of t.state.facet(Ic))if(i=n(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=iu(t,e),n=lu(e),s=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),s=s.map(t.changes),o=null)},get(e,l,h){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=iu(t,e),o=e),!a||!i)return s;let c=Qd(t,a.pos,a.bias,n);if(i.pos!=a.pos&&!l){let e=Qd(t,i.pos,i.bias,n),s=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=s<c.from?L.range(s,r):L.range(r,s)}return l?s.replaceRange(s.main.extend(c.from,c.to)):h?s.addRange(c):L.create([c])}}}(t,e)),i){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore((()=>Fa(t.contentDOM))),t.inputState.startMouseSelection(new _d(t,e,i,n))}};let Zd=(t,e)=>t>=e.top&&t<=e.bottom,tu=(t,e,i)=>Zd(e,i)&&t>=i.left&&t<=i.right;function eu(t,e,i,n){let s=Ec.find(t.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&tu(i,n,o))return-1;let l=s.coordsAt(r,1);return l&&tu(i,n,l)?1:o&&Zd(n,o)?-1:1}function iu(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:eu(t,i,e.clientX,e.clientY)}}const nu=hc.ie&&hc.ie_version<=11;let su=null,ru=0,ou=0;function lu(t){if(!nu)return t.detail;let e=su,i=ou;return su=t,ou=Date.now(),ru=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(ru+1)%3:1}function hu(t,e,i,n){if(!i)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:i},h=t.state.changes(o?[o,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}$d.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},$d.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&hu(t,e,n.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(n[t]=e.result),r()},e.readAsText(i[t])}}else hu(t,e,e.dataTransfer.getData("Text"),!0)},$d.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Yd?null:e.clipboardData;i?(Xd(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),Xd(t,i.value)}),50)}(t)};let au=null;function cu(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}$d.copy=$d.cut=(t,e)=>{let{text:i,ranges:n,linewise:s}=function(t){let e=[],i=[],n=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let s=-1;for(let{from:n}of t.selection.ranges){let r=t.doc.lineAt(n);r.number>s&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),s=r.number}n=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:n}}(t.state);if(!i&&!s)return;au=s?i:null;let r=Yd?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout((()=>{n.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},$d.focus=$d.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},$d.beforeprint=t=>{t.viewState.printing=!0,t.requestMeasure(),setTimeout((()=>{t.viewState.printing=!1,t.requestMeasure()}),2e3)},$d.compositionstart=$d.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),cu(t,!0)))},$d.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&cu(t,!1)}),50)},$d.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},$d.beforeinput=(t,e)=>{var i;let n;if(hc.chrome&&hc.android&&(n=Gd.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const du=["pre-wrap","normal","pre-line","break-spaces"];class uu{constructor(){this.doc=f.empty,this.lineWrapping=!1,this.direction=hd.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return du.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(e=!0,this.heightSamples[Math.floor(10*n)]=!0)}return e}refresh(t,e,i,n,s,r){let o=du.indexOf(t)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=n,this.lineLength=s,l){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return l}}class fu{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class pu{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new pu(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new pu(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var gu=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(gu||(gu={}));class mu{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return mu.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:h,toB:a}=n[r],c=s.lineAt(o,gu.ByPosNoHeight,e,0,0),d=c.to>=l?c:s.lineAt(l,gu.ByPosNoHeight,e,0,0);for(a+=d.to-l,l=d.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,h=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,gu.ByPosNoHeight,e,0,0));h+=c.from-o,o=c.from;let u=Su.build(i,t,h,a);s=s.replace(o,l,u)}return s.updateHeight(i,0)}static empty(){return new wu(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>2*s){let s=t[e-1];s.break?t.splice(--e,1,s.left,null,s.right):t.splice(--e,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,s-=e.size}}else if(n<s){let i=t[e++];i&&(n+=i.size)}else{let e=t[--i];e&&(s+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new bu(mu.of(t.slice(0,e)),r,mu.of(t.slice(i)))}}mu.prototype.size=1;class vu extends mu{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new pu(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,r){r(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class wu extends vu{constructor(t,e){super(t,e,Ac.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return 1==i.length&&(n instanceof wu||n instanceof yu&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof yu?n=new wu(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):mu.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class yu extends mu{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(e,n),l=Math.max(0,Math.min(r-s,Math.floor((t-i)/o))),{from:h,length:a}=e.line(s+l);return new pu(h,a,i+o*l,o,Ac.Text)}lineAt(t,e,i,n,s){if(e==gu.ByHeight)return this.blockAt(t,i,n,s);if(e==gu.ByPosNoHeight){let{from:e,to:n}=i.lineAt(t);return new pu(e,n-e,0,0,Ac.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:l,length:h,number:a}=i.lineAt(t);return new pu(l,h,n+o*(a-r),o,Ac.Text)}forEachLine(t,e,i,n,s,r){let{firstLine:o,lineHeight:l}=this.lines(i,s);for(let h=Math.max(t,s),a=Math.min(s+this.length,e);h<=a;){let e=i.lineAt(h);h==t&&(n+=l*(e.number-o)),r(new pu(e.from,e.length,n,l,Ac.Text)),n+=l,h=e.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let t=i[i.length-1];t instanceof yu?i[i.length-1]=new yu(t.length+n):i.push(null,new yu(n-1))}if(t>0){let e=i[0];e instanceof yu?i[0]=new yu(t+e.length):i.unshift(new yu(t-1),null)}return mu.of(i)}decomposeLeft(t,e){e.push(new yu(t-1),null)}decomposeRight(t,e){e.push(null,new yu(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let i=[],r=Math.max(e,n.from),o=-1,l=t.heightChanged;for(n.from>e&&i.push(new yu(n.from-e-1).updateHeight(t,e));r<=s&&n.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let l=new wu(e,s);l.outdated=!1,i.push(l),r+=e+1}r<=s&&i.push(null,new yu(s-r).updateHeight(t,r));let h=mu.of(i);return t.heightChanged=l||o<0||Math.abs(h.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,h}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class bu extends mu{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,l=e==gu.ByHeight?t<r:t<o,h=l?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,r,o);if(this.break||(l?h.to<o:h.from>o))return h;let a=e==gu.ByPosNoHeight?gu.ByPosNoHeight:gu.ByPos;return l?h.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,n,s).join(h)}forEachLine(t,e,i,n,s,r){let o=n+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,n,s,r),e>=l&&this.right.forEachLine(t,e,i,o,l,r);else{let h=this.lineAt(l,gu.ByPos,i,n,s);t<h.from&&this.left.forEachLine(t,h.from-1,i,n,s,r),h.to>=t&&h.from<=e&&r(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,o,l,r)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let r=s.length;for(let t of i)s.push(t);if(t>0&&xu(s,r-1),e<this.length){let t=s.length;this.decomposeRight(e,s),xu(s,t)}return mu.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?mu.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:r}=this,o=e+s.length+this.break,l=null;return n&&n.from<=e+s.length&&n.more?l=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=o+r.length&&n.more?l=r=r.updateHeight(t,o,i,n):r.updateHeight(t,o,i),l?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function xu(t,e){let i,n;null==t[e]&&(i=t[e-1])instanceof yu&&(n=t[e+1])instanceof yu&&t.splice(e-1,3,new yu(i.length+1+n.length))}class Su{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof wu?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new wu(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new vu(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new wu(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new yu(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof wu)return t;let e=new wu(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=Ac.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Ac.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof wu||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new wu(0,-1));let i=t;for(let t of this.nodes)t instanceof wu&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,n){let s=new Su(i,t);return Ht.spans(e,i,n,s,0),s.finish(i)}}class ku{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&Bc(t,e,this.changes,5)}}class Au{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return Mc.replace({widget:new Mu(this.size,t)}).range(this.from,this.to)}}class Mu extends kc{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class Cu{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new uu,this.scaler=Lu,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=mu.empty().applyChanges(t.facet(sd),f.empty,this.heightOracle.setDoc(t.doc),[new od(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Mc.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>n>=t&&n<=e))){let{from:e,to:i}=this.lineBlockAt(n);t.push(new Ou(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?Lu:new Vu(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:Nu(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let n=this.state.facet(sd),s=t.changedRanges,r=od.extendWithRanges(s,function(t,e,i){let n=new ku;return Ht.compare(t,e,i,n,0),n.changes}(t.startState.facet(sd),n,t?t.changes:M.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace,r="rtl"==i.direction?hd.RTL:hd.LTR,o=this.heightOracle.mustRefreshForStyle(s,r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,n=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==n||(h|=8,this.paddingTop=t,this.paddingBottom=n)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:function(t,e){let i=t.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=l;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();n=Math.max(n,e.left),s=Math.min(s,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let e=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(e)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:l}=t.docView.measureTextSize();o=n.refresh(s,r,i,l,p/l,e),o&&(t.docView.minWidth=0,h|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),n.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(n,0,o,new fu(this.viewport.from,e)),n.heightChanged&&(h|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&h||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new Ou(n.lineAt(r-1e3*i,gu.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),gu.ByHeight,s,0,0).to);if(e){let{head:t}=e.range;if(t<l.from||t>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(t,gu.ByPos,s,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<l.from?o.top:o.bottom-r,l=new Ou(n.lineAt(i-500,gu.ByHeight,s,0,0).from,n.lineAt(i+r+500,gu.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new Ou(this.heightMap.lineAt(i,gu.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,gu.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,gu.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,gu.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||n<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new Au(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=hd.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=Du(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=Tu(r,(this.visibleTop-i.top-t)/i.height),s=Tu(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;n=Tu(r,(this.pixelViewport.left-e)/t),s=Tu(r,(this.pixelViewport.right+e)/t)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&Eu(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&Eu(o,l.to-10,l.to+10);for(let{from:n,to:s}of o)s-n>1e3&&e.push(Ru(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-n)<1e3&&Math.abs(t.to-s)<1e3))||new Au(n,s,this.gapSize(i,n,s,r)))}return e}gapSize(t,e,i,n){let s=Bu(n,i)-Bu(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){Au.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Mc.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(sd);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Ht.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||Nu(this.heightMap.lineAt(t,gu.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Nu(this.heightMap.lineAt(this.scaler.fromDOM(t),gu.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Nu(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Ou{constructor(t,e){this.from=t,this.to=e}}function Du(t,e,i){let n=[],s=t,r=0;return Ht.spans(i.facet(sd),t,e,{span(){},point(t,e){t>s&&(n.push({from:s,to:t}),r+=t-s),s=e}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function Tu({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:s}=e[t],r=s-i;if(n<=r)return i+n;n-=r}}function Bu(t,e){let i=0;for(let{from:n,to:s}of t.ranges){if(e<=s){i+=e-n;break}i+=s-n}return i/t.total}function Eu(t,e,i){for(let n=0;n<t.length;n++){let s=t[n];if(s.from<i&&s.to>e){let r=[];s.from<e&&r.push({from:s.from,to:e}),s.to>i&&r.push({from:i,to:s.to}),t.splice(n,1,...r),n+=r.length-1}}}function Ru(t,e){for(let i of t)if(e(i))return i}const Lu={toDOM:t=>t,fromDOM:t=>t,scale:1};class Vu{constructor(t,e,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=e.lineAt(i,gu.ByPos,t,0,0).top,o=e.lineAt(s,gu.ByPos,t,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(e.height-n);for(let t of this.viewports)t.domTop=r+(t.top-s)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),s=t.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function Nu(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new pu(t.from,t.length,i,n-i,Array.isArray(t.type)?t.type.map((t=>Nu(t,e))):t.type)}const Pu=H.define({combine:t=>t.join(" ")}),Hu=H.define({combine:t=>t.indexOf(!0)>-1}),Wu=Bt.newName(),Iu=Bt.newName(),Fu=Bt.newName(),zu={"&light":"."+Iu,"&dark":"."+Fu};function qu(t,e,i){return new Bt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const Ku=qu("."+Wu,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},zu),Gu={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},ju=hc.ie&&hc.ie_version<=11;class _u{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Ha,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(hc.ie&&hc.ie_version<=11||hc.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),ju&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet($c)?e.root.activeElement!=this.dom:!Da(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((hc.ie&&hc.ie_version<=11||hc.android&&hc.chrome)&&!e.state.selection.main.empty&&i.focusNode&&Ba(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=Ca(t),i=hc.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let n=e.startContainer,s=e.startOffset,r=e.endContainer,o=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);Ba(l.node,l.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Gu),ju&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),ju&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;qa(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let t=this.readMutation(s);t&&(t.typeOver&&(n=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&Da(this.dom,this.selectionRange);if(e<0&&!s)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,n),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=Uu(e,t.previousSibling||t.target.previousSibling,-1),n=Uu(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Uu(t,e,i){for(;e;){let n=_a.get(e);if(n&&n.parent==t)return n;let s=e.parentNode;e=s!=t.dom?s:i>0?e.nextSibling:e.previousSibling}return null}function $u(t,e,i,n){let s,r,o=t.state.selection.main;if(e>-1){let n=t.docView.domBoundsAround(e,i,0);if(!n||t.state.readOnly)return;let{from:l,to:h}=n,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new Md(i,n)),s==i&&r==n||e.push(new Md(s,r)));return e}(t),c=new kd(a,t.state);c.readRange(n.startDOM,n.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||hc.android&&c.text.length<h-l)&&(d=o.to,u="end");let p=function(t,e,i,n){let s=Math.min(t.length,e.length),r=0;for(;r<s&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&t.length==e.length)return null;let o=t.length,l=e.length;for(;o>0&&l>0&&t.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(t.state.doc.sliceString(l,h,"￿"),c.text,d-l,u);p&&(hc.chrome&&13==t.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==c.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:f.of(c.text.slice(p.from,p.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,n=2==t.length?t[1].pos:i;return i>-1&&n>-1?L.single(i+e,n+e):null}(a,l)}else if(t.hasFocus||!t.state.facet($c)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=t.docView,s=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!Oa(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),l=n&&n.node==e.anchorNode&&n.offset==e.anchorOffset||!Oa(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);s==o.head&&l==o.anchor||(r=L.single(l,s))}if(s||r)if(!s&&n&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,s.from).append(s.insert).append(t.state.doc.slice(s.to,o.to))}),s){let e=t.state;if(hc.ios&&t.inputState.flushIOSKey(t))return;if(hc.android&&(s.from==o.from&&s.to==o.to&&1==s.insert.length&&2==s.insert.lines&&qa(t.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&0==s.insert.length&&qa(t.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&0==s.insert.length&&qa(t.contentDOM,"Delete",46)))return;let i,n=s.insert.toString();if(t.state.facet(qc).some((e=>e(t,s.from,s.to,n))))return;if(t.inputState.composing>=0&&t.inputState.composing++,s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&t.inputState.composing<0){let n=o.from<s.from?e.sliceDoc(o.from,s.from):"",r=o.to>s.to?e.sliceDoc(s.to,o.to):"";i=e.replaceSelection(t.state.toText(n+s.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let n=e.changes(s),l=r&&!e.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let r=t.state.sliceDoc(s.from,s.to),h=Dd(t)||t.state.doc.lineAt(o.head),a=o.to-s.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:n,range:l||i.map(n)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let f=e.changes({from:u,to:d,insert:s.insert}),p=i.to-o.to;return{changes:f,range:l?L.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}}))}else i={changes:n,selection:l&&e.selection.replaceRange(l)}}let l="input.type";t.composing&&(l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:l})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class Yu{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new Cu(t.state||Mt.create()),this.plugins=this.state.facet(Qc).map((t=>new ed(t)));for(let t of this.plugins)t.update(this);this.observer=new _u(this,((t,e,i)=>{$u(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new Kd(this),this.docView=new Cd(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);if(n.facet(Mt.phrases)!=this.state.facet(Mt.phrases))return this.setState(n);e=new ld(this,n,t);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(s&&(s=s.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;s=new jc(t.empty?t:L.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(Kc)?s=new jc(t.value):t.is(Gc)?s=new jc(t.value,"center"):t.is(_c)&&(s=t.value)}this.viewState.update(e,s),this.bidiCache=Zu.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(rd)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(Pu)!=e.state.facet(Pu)&&(this.viewState.mustMeasureContent=!0),(i||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(zc))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new Cu(t),this.plugins=t.facet(Qc).map((t=>new ed(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new Cd(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Qc),i=t.state.facet(Qc);if(e!=i){let n=[];for(let s of i){let i=e.indexOf(s);if(i<0)n.push(new ed(s));else{let e=this.plugins[i];e.mustUpdate=t,n.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((t=>{try{return t.read(this)}catch(t){return Uc(this.state,t),Qu}})),o=new ld(this,this.state),l=!1,h=!1;o.flags|=n,e?e.flags|=n:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),l=this.docView.update(o));for(let t=0;t<s.length;t++)if(r[t]!=Qu)try{let e=s[t];e.write&&e.write(r[t],this)}catch(t){Uc(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),l&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(zc))t(e)}get themeClasses(){return Wu+" "+(this.state.facet(Hu)?Fu:Iu)+" "+this.state.facet(Pu)}updateAttrs(){let t=tf(this,id,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet($c)?"true":"false",class:"cm-content",style:`${hc.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),tf(this,nd,e),this.observer.ignore((()=>{Sc(this.contentDOM,this.contentAttrs,e),Sc(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(Yu.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(rd),Bt.mount(this.root,this.styleModules.concat(Ku).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Ju(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Ju(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Ju(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return qd(this,t,zd(this,t,e,i))}moveByGroup(t,e){return qd(this,t,zd(this,t,e,(e=>function(t,e,i){let n=t.state.charCategorizer(e),s=n(i);return t=>{let e=n(t);return s==xt.Space&&(s=e),s==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=n&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),n=t.posAtCoords({x:i==(t.textDirection==hd.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=n)return L.cursor(n,i?-1:1)}let o=Ec.find(t.docView,e.head),l=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return L.cursor(l,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return qd(this,t,function(t,e,i,n){let s=e.head,r=i?1:-1;if(s==(i?t.state.doc.length:0))return L.cursor(s,e.assoc);let o,l=e.goalColumn,h=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(s),c=t.documentTop;if(a)null==l&&(l=a.left-h.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(s-c);null==l&&(l=Math.min(h.right-h.left,t.defaultCharacterWidth*(s-e.from))),o=(r<0?e.top:e.bottom)+c}let d=h.left+l,u=null!=n?n:t.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(u+i)*r,a=Id(t,{x:d,y:n},!1,r);if(n<h.top||n>h.bottom||(r<0?a<s:a>s))return L.cursor(a,e.assoc,void 0,l)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:Kc.of(L.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Id(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n);return Na(i,s[vd.find(s,t-n.from,-1,e)].dir==hd.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Xu)return bd(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=yd(t.text,this.textDirection);return this.bidiCache.push(new Zu(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||hc.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{Fa(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return _c.of(new jc("number"==typeof t?L.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Zc.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Bt.newName(),n=[Pu.of(i),rd.of(qu(`.${i}`,t))];return e&&e.dark&&n.push(Hu.of(!0)),n}static baseTheme(t){return X.lowest(rd.of(qu("."+Wu,t,zu)))}}Yu.scrollTo=Kc,Yu.centerOn=Gc,Yu.styleModule=rd,Yu.inputHandler=qc,Yu.exceptionSink=Fc,Yu.updateListener=zc,Yu.editable=$c,Yu.mouseSelectionStyle=Ic,Yu.dragMovesSelection=Wc,Yu.clickAddsSelectionRange=Hc,Yu.decorations=sd,Yu.darkTheme=Hu,Yu.contentAttributes=nd,Yu.editorAttributes=id,Yu.lineWrapping=Yu.contentAttributes.of({class:"cm-lineWrapping"}),Yu.announce=ft.define();const Xu=4096;function Ju(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const Qu={};class Zu{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:hd.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let r=t[s];r.dir!=n||e.touchesRange(r.from,r.to)||i.push(new Zu(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function tf(t,e,i){for(let n=t.state.facet(e),s=n.length-1;s>=0;s--){let e=n[s],r="function"==typeof e?e(t):e;r&&bc(r,i)}return i}const ef=!hc.ios;const nf={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};ef&&(nf[".cm-line"].caretColor="transparent !important");const sf=1024;let rf=0;class of{constructor(t,e){this.from=t,this.to=e}}class lf{constructor(t={}){this.id=rf++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof t&&(t=af.match(t)),e=>{let i=t(e);return void 0===i?null:[this,i]}}}lf.closedBy=new lf({deserialize:t=>t.split(" ")}),lf.openedBy=new lf({deserialize:t=>t.split(" ")}),lf.group=new lf({deserialize:t=>t.split(" ")}),lf.contextHash=new lf({perNode:!0}),lf.lookAhead=new lf({perNode:!0}),lf.mounted=new lf({perNode:!0});const hf=Object.create(null);class af{constructor(t,e,i,n=0){this.name=t,this.props=e,this.id=i,this.flags=n}static define(t){let e=t.props&&t.props.length?Object.create(null):hf,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),n=new af(t.name||"",e,t.id,i);if(t.props)for(let i of t.props)if(Array.isArray(i)||(i=i(n)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[i[0].id]=i[1]}return n}prop(t){return this.props[t.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(t){if("string"==typeof t){if(this.name==t)return!0;let e=this.prop(lf.group);return!!e&&e.indexOf(t)>-1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let n of i.split(" "))e[n]=t[i];return t=>{for(let i=t.prop(lf.group),n=-1;n<(i?i.length:0);n++){let s=e[n<0?t.name:i[n]];if(s)return s}}}}af.none=new af("",Object.create(null),0,8);const cf=new WeakMap,df=new WeakMap;class uf{constructor(t,e,i,n,s){if(this.type=t,this.children=e,this.positions=i,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[t,e]of s)this.props["number"==typeof t?t:t.id]=e}}toString(){let t=this.prop(lf.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let t of this.children){let i=t.toString();i&&(e&&(e+=","),e+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t,e=0){let i=null!=t&&cf.get(this)||this.topNode,n=new Sf(i);return null!=t&&(n.moveTo(t,e),cf.set(this,n._tree)),n}fullCursor(){return new Sf(this.topNode,1)}get topNode(){return new wf(this,0,0,null)}resolve(t,e=0){let i=vf(cf.get(this)||this.topNode,t,e,!1);return cf.set(this,i),i}resolveInner(t,e=0){let i=vf(df.get(this)||this.topNode,t,e,!0);return df.set(this,i),i}iterate(t){let{enter:e,leave:i,from:n=0,to:s=this.length}=t;for(let t=this.cursor(),r=()=>t.node;;){let o=!1;if(t.from<=s&&t.to>=n&&(t.type.isAnonymous||!1!==e(t.type,t.from,t.to,r))){if(t.firstChild())continue;t.type.isAnonymous||(o=!0)}for(;o&&i&&i(t.type,t.from,t.to,r),o=t.type.isAnonymous,!t.nextSibling();){if(!t.parent())return;o=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Cf(af.none,this.children,this.positions,0,this.children.length,0,this.length,((t,e,i)=>new uf(this.type,t,e,i,this.propValues)),t.makeTree||((t,e,i)=>new uf(af.none,t,e,i)))}static build(t){return function(t){var e;let{buffer:i,nodeSet:n,maxBufferLength:s=sf,reused:r=[],minRepeatType:o=n.types.length}=t,l=Array.isArray(i)?new ff(i,i.length):i,h=n.types,a=0,c=0;function d(t,e,i,v,w){let{id:y,start:b,end:x,size:S}=l,k=c;for(;S<0;){if(l.next(),-1==S){let e=r[y];return i.push(e),void v.push(b-t)}if(-3==S)return void(a=y);if(-4==S)return void(c=y);throw new RangeError(`Unrecognized record size: ${S}`)}let A,M,C=h[y],O=b-t;if(x-b<=s&&(M=g(l.pos-e,w))){let e=new Uint16Array(M.size-M.skip),i=l.pos-M.size,s=e.length;for(;l.pos>i;)s=m(M.start,e,s);A=new pf(e,x-M.start,n),O=M.start-t}else{let t=l.pos-S;l.next();let e=[],i=[],n=y>=o?y:-1,r=0,h=x;for(;l.pos>t;)n>=0&&l.id==n&&l.size>=0?(l.end<=h-s&&(f(e,i,b,r,l.end,h,n,k),r=e.length,h=l.end),l.next()):d(b,t,e,i,n);if(n>=0&&r>0&&r<e.length&&f(e,i,b,r,b,h,n,k),e.reverse(),i.reverse(),n>-1&&r>0){let t=u(C);A=Cf(C,e,i,0,e.length,0,x-b,t,t)}else A=p(C,e,i,x-b,k-x)}i.push(A),v.push(O)}function u(t){return(e,i,n)=>{let s,r,o=0,l=e.length-1;if(l>=0&&(s=e[l])instanceof uf){if(!l&&s.type==t&&s.length==n)return s;(r=s.prop(lf.lookAhead))&&(o=i[l]+s.length+r)}return p(t,e,i,n,o)}}function f(t,e,i,s,r,o,l,h){let a=[],c=[];for(;t.length>s;)a.push(t.pop()),c.push(e.pop()+i-r);t.push(p(n.types[l],a,c,o-r,h-o)),e.push(r-i)}function p(t,e,i,n,s=0,r){if(a){let t=[lf.contextHash,a];r=r?[t].concat(r):[t]}if(s>25){let t=[lf.lookAhead,s];r=r?[t].concat(r):[t]}return new uf(t,e,i,n,r)}function g(t,e){let i=l.fork(),n=0,r=0,h=0,a=i.end-s,c={size:0,start:0,skip:0};t:for(let s=i.pos-t;i.pos>s;){let t=i.size;if(i.id==e&&t>=0){c.size=n,c.start=r,c.skip=h,h+=4,n+=4,i.next();continue}let l=i.pos-t;if(t<0||l<s||i.start<a)break;let d=i.id>=o?4:0,u=i.start;for(i.next();i.pos>l;){if(i.size<0){if(-3!=i.size)break t;d+=4}else i.id>=o&&(d+=4);i.next()}r=u,n+=t,h+=d}return(e<0||n==t)&&(c.size=n,c.start=r,c.skip=h),c.size>4?c:void 0}function m(t,e,i){let{id:n,start:s,end:r,size:h}=l;if(l.next(),h>=0&&n<o){let o=i;if(h>4){let n=l.pos-(h-4);for(;l.pos>n;)i=m(t,e,i)}e[--i]=o,e[--i]=r-t,e[--i]=s-t,e[--i]=n}else-3==h?a=n:-4==h&&(c=n);return i}let v=[],w=[];for(;l.pos>0;)d(t.start||0,t.bufferStart||0,v,w,-1);let y=null!==(e=t.length)&&void 0!==e?e:v.length?w[0]+v[0].length:0;return new uf(h[t.topID],v.reverse(),w.reverse(),y)}(t)}}uf.empty=new uf(af.none,[],[],0);class ff{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ff(this.buffer,this.index)}}class pf{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return af.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],n=this.set.types[e],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),i==(t+=4))return s;let r=[];for(;t<i;)r.push(this.childString(t)),t=this.buffer[t+3];return s+"("+r.join(",")+")"}findChild(t,e,i,n,s){let{buffer:r}=this,o=-1;for(let l=t;l!=e&&!(gf(s,n,r[l+1],r[l+2])&&(o=l,i>0));l=r[l+3]);return o}slice(t,e,i,n){let s=this.buffer,r=new Uint16Array(e-t);for(let n=t,o=0;n<e;)r[o++]=s[n++],r[o++]=s[n++]-i,r[o++]=s[n++]-i,r[o++]=s[n++]-t;return new pf(r,n-i,this.set)}}function gf(t,e,i,n){switch(t){case-2:return i<e;case-1:return n>=e&&i<e;case 0:return i<e&&n>e;case 1:return i<=e&&n>e;case 2:return n>e;case 4:return!0}}function mf(t,e){let i=t.childBefore(e);for(;i;){let e=i.lastChild;if(!e||e.to!=i.to)break;e.type.isError&&e.from==e.to?(t=i,i=e.prevSibling):i=e}return t}function vf(t,e,i,n){for(var s;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let e=!n&&t instanceof wf&&t.index<0?null:t.parent;if(!e)return t;t=e}if(n)for(let n=t,r=n.parent;r;n=r,r=n.parent)n instanceof wf&&n.index<0&&(null===(s=r.enter(e,i,!0))||void 0===s?void 0:s.from)!=n.from&&(t=r);for(;;){let s=t.enter(e,i,n);if(!s)return t;t=s}}class wf{constructor(t,e,i,n){this.node=t,this._from=e,this.index=i,this._parent=n}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(t,e,i,n,s=0){for(let r=this;;){for(let{children:o,positions:l}=r.node,h=e>0?o.length:-1;t!=h;t+=e){let h=o[t],a=l[t]+r._from;if(gf(n,i,a,a+h.length))if(h instanceof pf){if(2&s)continue;let o=h.findChild(0,h.buffer.length,e,i-a,n);if(o>-1)return new xf(new bf(r,h,t,a),null,o)}else if(1&s||!h.type.isAnonymous||kf(h)){let o;if(!(1&s)&&h.props&&(o=h.prop(lf.mounted))&&!o.overlay)return new wf(o.tree,a,t,r);let l=new wf(h,a,t,r);return 1&s||!l.type.isAnonymous?l:l.nextChild(e<0?h.children.length-1:0,e,i,n)}}if(1&s||!r.type.isAnonymous)return null;if(t=r.index>=0?r.index+e:e<0?-1:r._parent.node.children.length,r=r._parent,!r)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this.node.children.length-1,-1,t,-2)}enter(t,e,i=!0,n=!0){let s;if(i&&(s=this.node.prop(lf.mounted))&&s.overlay){let i=t-this.from;for(let{from:t,to:n}of s.overlay)if((e>0?t<=i:t<i)&&(e<0?n>=i:n>i))return new wf(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,n?0:2)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new Sf(this)}get tree(){return this.node}toTree(){return this.node}resolve(t,e=0){return vf(this,t,e,!1)}resolveInner(t,e=0){return vf(this,t,e,!0)}enterUnfinishedNodesBefore(t){return mf(this,t)}getChild(t,e=null,i=null){let n=yf(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return yf(this,t,e,i)}toString(){return this.node.toString()}}function yf(t,e,i,n){let s=t.cursor,r=[];if(!s.firstChild())return r;if(null!=i)for(;!s.type.is(i);)if(!s.nextSibling())return r;for(;;){if(null!=n&&s.type.is(n))return r;if(s.type.is(e)&&r.push(s.node),!s.nextSibling())return null==n?r:[]}}class bf{constructor(t,e,i,n){this.parent=t,this.buffer=e,this.index=i,this.start=n}}class xf{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.context.start,i);return s<0?null:new xf(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i,n=!0){if(!n)return null;let{buffer:s}=this.context,r=s.findChild(this.index+4,s.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return r<0?null:new xf(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new xf(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new xf(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}get cursor(){return new Sf(this)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,n=this.index+4,s=i.buffer[this.index+3];if(s>n){let r=i.buffer[this.index+1],o=i.buffer[this.index+2];t.push(i.slice(n,s,r,o)),e.push(0)}return new uf(this.type,t,e,this.to-this.from)}resolve(t,e=0){return vf(this,t,e,!1)}resolveInner(t,e=0){return vf(this,t,e,!0)}enterUnfinishedNodesBefore(t){return mf(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let n=yf(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return yf(this,t,e,i)}}class Sf{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof wf)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let e=t._parent;e;e=e._parent)this.stack.unshift(e.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;let{start:i,buffer:n}=this.buffer;return this.type=e||n.set.types[n.buffer[t]],this.from=i+n.buffer[t+1],this.to=i+n.buffer[t+2],!0}yield(t){return!!t&&(t instanceof wf?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree.node.children.length-1:0,t,e,i,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.buffer.start,i);return!(s<0)&&(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=!0,n=!0){return this.buffer?!!n&&this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i&&!(1&this.mode),n))}parent(){if(!this.buffer)return this.yieldNode(1&this.mode?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=1&this.mode?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode));let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let t=i<0?0:this.stack[i]+4;if(this.index!=t)return this.yieldBuf(e.findChild(t,this.index,-1,0,4))}else{let t=e.buffer[this.index+3];if(t<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(t)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:n}=this;if(n){if(t>0){if(this.index<n.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(n.buffer.buffer[t+3]<this.index)return!1;({index:e,parent:i}=n)}else({index:e,_parent:i}=this._tree);for(;i;({index:e,_parent:i}=i))if(e>-1)for(let n=e+t,s=t<0?-1:i.node.children.length;n!=s;n+=t){let t=i.node.children[n];if(1&this.mode||t instanceof pf||!t.type.isAnonymous||kf(t))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let n=this.index,s=this.stack.length;s>=0;){for(let r=t;r;r=r._parent)if(r.index==n){if(n==this.index)return r;e=r,i=s+1;break t}n=this.stack[--s]}for(let t=i;t<this.stack.length;t++)e=new xf(this.buffer,e,this.stack[t]);return this.bufferNode=new xf(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree.node}}function kf(t){return t.children.some((t=>t instanceof pf||!t.type.isAnonymous||kf(t)))}const Af=new WeakMap;function Mf(t,e){if(!t.isAnonymous||e instanceof pf||e.type!=t)return 1;let i=Af.get(e);if(null==i){i=1;for(let n of e.children){if(n.type!=t||!(n instanceof uf)){i=1;break}i+=Mf(t,n)}Af.set(e,i)}return i}function Cf(t,e,i,n,s,r,o,l,h){let a=0;for(let i=n;i<s;i++)a+=Mf(t,e[i]);let c=Math.ceil(1.5*a/8),d=[],u=[];return function e(i,n,s,o,l){for(let a=s;a<o;){let s=a,f=n[a],p=Mf(t,i[a]);for(a++;a<o;a++){let e=Mf(t,i[a]);if(p+e>=c)break;p+=e}if(a==s+1){if(p>c){let t=i[s];e(t.children,t.positions,0,t.children.length,n[s]+l);continue}d.push(i[s])}else{let e=n[a-1]+i[a-1].length-f;d.push(Cf(t,i,n,s,a,f,e,null,h))}u.push(f+l-r)}}(e,i,n,s,0),(l||h)(d,u,o)}class Of{constructor(t,e,i,n,s=!1,r=!1){this.from=t,this.to=e,this.tree=i,this.offset=n,this.open=(s?1:0)|(r?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(t,e=[],i=!1){let n=[new Of(0,t.length,t,0,!1,i)];for(let i of e)i.to>t.length&&n.push(i);return n}static applyChanges(t,e,i=128){if(!e.length)return t;let n=[],s=1,r=t.length?t[0]:null;for(let o=0,l=0,h=0;;o++){let a=o<e.length?e[o]:null,c=a?a.fromA:1e9;if(c-l>=i)for(;r&&r.from<c;){let e=r;if(l>=e.from||c<=e.to||h){let t=Math.max(e.from,l)-h,i=Math.min(e.to,c)-h;e=t>=i?null:new Of(t,i,e.tree,e.offset+h,o>0,!!a)}if(e&&n.push(e),r.to>c)break;r=s<t.length?t[s++]:null}if(!a)break;l=a.toA,h=a.toA-a.toB}return n}}class Df{startParse(t,e,i){return"string"==typeof t&&(t=new Tf(t)),i=i?i.length?i.map((t=>new of(t.from,t.to))):[new of(0,0)]:[new of(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let n=this.startParse(t,e,i);for(;;){let t=n.advance();if(t)return t}}}class Tf{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new lf({perNode:!0});const Bf=new lf;class Ef{constructor(t,e,i,n=[]){this.data=t,this.topNode=i,Mt.prototype.hasOwnProperty("tree")||Object.defineProperty(Mt.prototype,"tree",{get(){return Lf(this)}}),this.parser=e,this.extension=[zf.of(this),Mt.languageData.of(((t,e,i)=>t.facet(Rf(t,e,i))))].concat(n)}isActiveAt(t,e,i=-1){return Rf(t,e,i)==this.data}findRegions(t){let e=t.facet(zf);if((null==e?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],n=(t,e)=>{if(t.prop(Bf)==this.data)return void i.push({from:e,to:e+t.length});let s=t.prop(lf.mounted);if(s){if(s.tree.prop(Bf)==this.data){if(s.overlay)for(let t of s.overlay)i.push({from:t.from+e,to:t.to+e});else i.push({from:e,to:e+t.length});return}if(s.overlay){let t=i.length;if(n(s.tree,s.overlay[0].from+e),i.length>t)return}}for(let i=0;i<t.children.length;i++){let s=t.children[i];s instanceof uf&&n(s,t.positions[i]+e)}};return n(Lf(t),0),i}get allowsNesting(){return!0}}function Rf(t,e,i){let n=t.facet(zf);if(!n)return null;let s=n.data;if(n.allowsNesting)for(let n=Lf(t).topNode;n;n=n.enter(e,i,!0,!1))s=n.type.prop(Bf)||s;return s}Ef.setState=ft.define();function Lf(t){let e=t.field(Ef.state,!1);return e?e.tree:uf.empty}class Vf{constructor(t,e=t.length){this.doc=t,this.length=e,this.cursorPos=0,this.string="",this.cursor=t.iter()}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let Nf=null;class Pf{constructor(t,e,i=[],n,s,r,o,l){this.parser=t,this.state=e,this.fragments=i,this.tree=n,this.treeLen=s,this.viewport=r,this.skipped=o,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}startParse(){return this.parser.startParse(new Vf(this.state.doc),this.fragments)}work(t,e){return null!=e&&e>=this.state.doc.length&&(e=void 0),this.tree!=uf.empty&&this.isDone(null!=e?e:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;let n=Date.now()+t;for(this.parse||(this.parse=this.startParse()),null!=e&&(null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let t=this.parse.advance();if(t){if(this.fragments=this.withoutTempSkipped(Of.addTree(t,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=t,this.parse=null,!(this.treeLen<(null!=e?e:this.state.doc.length)))return!0;this.parse=this.startParse()}if(Date.now()>n)return!1}}))}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext((()=>{for(;!(e=this.parse.advance()););})),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(Of.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=Nf;Nf=this;try{return t()}finally{Nf=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=Hf(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:n,treeLen:s,viewport:r,skipped:o}=this;if(this.takeTree(),!t.empty){let e=[];if(t.iterChangedRanges(((t,i,n,s)=>e.push({fromA:t,toA:i,fromB:n,toB:s}))),i=Of.applyChanges(i,e),n=uf.empty,s=0,r={from:t.mapPos(r.from,-1),to:t.mapPos(r.to,1)},this.skipped.length){o=[];for(let e of this.skipped){let i=t.mapPos(e.from,1),n=t.mapPos(e.to,-1);i<n&&o.push({from:i,to:n})}}}return new Pf(this.parser,e,i,n,s,r,o,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let e=0;e<this.skipped.length;e++){let{from:i,to:n}=this.skipped[e];i<t.to&&n>t.from&&(this.fragments=Hf(this.fragments,i,n),this.skipped.splice(e--,1))}return!(this.skipped.length>=e)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends Df{createParse(e,i,n){let s=n[0].from,r=n[n.length-1].to;return{parsedPos:s,advance(){let e=Nf;if(e){for(let t of n)e.tempSkipped.push(t);t&&(e.scheduleOn=e.scheduleOn?Promise.all([e.scheduleOn,t]):t)}return this.parsedPos=r,new uf(af.none,[],[],r-s)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&0==e[0].from&&e[0].to>=t}static get(){return Nf}}function Hf(t,e,i){return Of.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}class Wf{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new Wf(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=new Pf(t.facet(zf).parser,t,[],uf.empty,0,{from:0,to:e},[],null);return i.work(20,e)||i.takeTree(),new Wf(i)}}Ef.state=K.define({create:Wf.init,update(t,e){for(let t of e.effects)if(t.is(Ef.setState))return t.value;return e.startState.facet(zf)!=e.state.facet(zf)?Wf.init(e.state):t.apply(e)}});let If=t=>{let e=setTimeout((()=>t()),500);return()=>clearTimeout(e)};"undefined"!=typeof requestIdleCallback&&(If=t=>{let e=-1,i=setTimeout((()=>{e=requestIdleCallback(t,{timeout:400})}),100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});const Ff=_o.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(Ef.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),t.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(Ef.state);e.tree==e.context.tree&&e.context.isDone(t.doc.length)||(this.working=If(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:n}}=this.view,s=i.field(Ef.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let r=Math.min(this.chunkBudget,100,t?Math.max(25,t.timeRemaining()-5):1e9),o=s.context.treeLen<n&&i.doc.length>n+1e3,l=s.context.work(r,n+(o?0:1e5));this.chunkBudget-=Date.now()-e,(l||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Ef.setState.of(new Wf(s.context))})),this.chunkBudget>0&&(!l||o)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then((()=>this.scheduleWork())).catch((t=>Fo(this.view.state,t))).then((()=>this.workScheduled--)),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return this.working||this.workScheduled>0}},{eventHandlers:{focus(){this.scheduleWork()}}}),zf=H.define({combine:t=>t.length?t[0]:null,enables:[Ef.state,Ff]});const qf=H.define(),Kf=H.define({combine:t=>{if(!t.length)return"  ";if(!/^(?: +|\t+)$/.test(t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return t[0]}});function Gf(t){let e=t.facet(Kf);return 9==e.charCodeAt(0)?t.tabSize*e.length:e.length}function jf(t,e){let i="",n=t.tabSize;if(9==t.facet(Kf).charCodeAt(0))for(;e>=n;)i+="\t",e-=n;for(let t=0;t<e;t++)i+=" ";return i}function _f(t,e){t instanceof Mt&&(t=new Uf(t));for(let i of t.state.facet(qf)){let n=i(t,e);if(null!=n)return n}let i=Lf(t.state);return i?function(t,e,i){return Xf(e.resolveInner(i).enterUnfinishedNodesBefore(i),i,t)}(t,i,e):null}class Uf{constructor(t,e={}){this.state=t,this.options=e,this.unit=Gf(t)}lineAt(t,e=1){let i=this.state.doc.lineAt(t),{simulateBreak:n}=this.options;return null!=n&&n>=i.from&&n<=i.to?(e<0?n<t:n<=t)?{text:i.text.slice(n-i.from),from:n}:{text:i.text.slice(0,n-i.from),from:i.from}:i}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:i,from:n}=this.lineAt(t,e);return i.slice(t-n,Math.min(i.length,t+100-n))}column(t,e=1){let{text:i,from:n}=this.lineAt(t,e),s=this.countColumn(i,t-n),r=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return r>-1&&(s+=r-this.countColumn(i,i.search(/\S|$/))),s}countColumn(t,e=t.length){return d(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:i,from:n}=this.lineAt(t,e),s=this.options.overrideIndentation;if(s){let t=s(n);if(t>-1)return t}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const $f=new lf;function Yf(t){let e=t.type.prop($f);if(e)return e;let i,n=t.firstChild;if(n&&(i=n.type.prop(lf.closedBy))){let e=t.lastChild,n=e&&i.indexOf(e.name)>-1;return t=>tp(t,!0,1,void 0,n&&!function(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}(t)?e.from:void 0)}return null==t.parent?Jf:null}function Xf(t,e,i){for(;t;t=t.parent){let n=Yf(t);if(n)return n(new Qf(i,e,t))}return null}function Jf(){return 0}class Qf extends Uf{constructor(t,e,i){super(t.state,t.options),this.base=t,this.pos=e,this.node=i}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let t=this.state.doc.lineAt(this.node.from);for(;;){let e=this.node.resolve(t.from);for(;e.parent&&e.parent.from==e.from;)e=e.parent;if(Zf(e,this.node))break;t=this.state.doc.lineAt(e.from)}return this.lineIndent(t.from)}continue(){let t=this.node.parent;return t?Xf(t,this.pos,this.base):0}}function Zf(t,e){for(let i=e;i;i=i.parent)if(t==i)return!0;return!1}function tp(t,e,i,n,s){let r=t.textAfter,o=r.match(/^\s*/)[0].length,l=n&&r.slice(o,o+n.length)==n||s==t.pos+o,h=e?function(t){let e=t.node,i=e.childAfter(e.from),n=e.lastChild;if(!i)return null;let s=t.options.simulateBreak,r=t.state.doc.lineAt(i.from),o=null==s||s<=r.from?r.to:Math.min(r.to,s);for(let t=i.to;;){let s=e.childAfter(t);if(!s||s==n)return null;if(!s.type.isSkipped)return s.from<o?i:null;t=s.to}}(t):null;return h?l?t.column(h.from):t.column(h.to):t.baseIndent+(l?0:t.unit*i)}function ep(){return Mt.transactionFilter.of((t=>{if(!t.docChanged||!t.isUserEvent("input.type"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let i=t.newDoc,{head:n}=t.newSelection.main,s=i.lineAt(n);if(n>s.from+200)return t;let r=i.sliceString(s.from,n);if(!e.some((t=>t.test(r))))return t;let{state:o}=t,l=-1,h=[];for(let{head:t}of o.selection.ranges){let e=o.doc.lineAt(t);if(e.from==l)continue;l=e.from;let i=_f(o,e.from);if(null==i)continue;let n=/^\s*/.exec(e.text)[0],s=jf(o,i);n!=s&&h.push({from:e.from,to:e.from+n.length,insert:s})}return h.length?[t,{changes:h,sequential:!0}]:t}))}const ip=H.define(),np=new lf;function sp(t,e,i){for(let n of t.facet(ip)){let s=n(t,e,i);if(s)return s}return function(t,e,i){let n=Lf(t);if(0==n.length)return null;let s=null;for(let r=n.resolveInner(i);r;r=r.parent){if(r.to<=i||r.from>i)continue;if(s&&r.from<e)break;let n=r.type.prop(np);if(n){let o=n(r,t);o&&o.from<=i&&o.from>=e&&o.to>i&&(s=o)}}return s}(t,e,i)}function rp(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function op(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function lp(t,e){if(!e.anchorNode)return!1;try{return op(t,e.anchorNode)}catch(t){return!1}}function hp(t){return 3==t.nodeType?bp(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function ap(t,e,i,n){return!!i&&(dp(t,e,i,n,-1)||dp(t,e,i,n,1))}function cp(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function dp(t,e,i,n,s){for(;;){if(t==i&&e==n)return!0;if(e==(s<0?0:up(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=cp(t)+(s<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(s<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=s<0?up(t):0}}}function up(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const fp={left:0,right:0,top:0,bottom:0};function pp(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function gp(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class mp{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let vp,wp=null;function yp(t){if(t.setActive)return t.setActive();if(wp)return t.focus(wp);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==wp?{get preventScroll(){return wp={preventScroll:!0},!0}}:void 0),!wp){wp=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],s=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function bp(t,e,i=e){let n=vp||(vp=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function xp(t,e,i){let n={key:e,code:e,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,t.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,t.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function Sp(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class kp{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new kp(t.parentNode,cp(t),e)}static after(t,e){return new kp(t.parentNode,cp(t)+1,e)}}const Ap=[];class Mp{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e=this.dom,i=e.firstChild;for(let n of this.children){if(n.dirty){if(!n.dom&&i){let t=Mp.get(i);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(i)}n.sync(t),n.dirty=0}if(t&&!t.written&&t.node==e&&i!=n.dom&&(t.written=!0),n.dom.parentNode==e){for(;i&&i!=n.dom;)i=Cp(i);i=n.dom.nextSibling}else e.insertBefore(n.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=Cp(i)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=0==up(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==n&&e.firstChild!=e.lastChild&&(n=t==e.firstChild?-1:1),t=e}i=n<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Mp.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let n=this.children[t];if(n.dom==i)return e;e+=n.length+n.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,r=-1,o=-1;for(let l=0,h=i,a=i;l<this.children.length;l++){let i=this.children[l],c=h+i.length;if(h<t&&c>e)return i.domBoundsAround(t,e,h);if(c>=t&&-1==n&&(n=l,s=h),h>e&&i.dom.parentNode==this.dom){r=l,o=a;break}a=c,h=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Ap){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Op(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Cp(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}Mp.prototype.breakAfter=0;class Op{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Dp(t,e,i,n,s,r,o,l,h){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(i,s,r.length?d:null,0==i,l,h))){if(n<a.length){let t=a[n];t&&s<t.length?(e==n&&(t=t.split(s),s=0),!u&&d&&t.merge(0,s,d,!0,0,h)?r[r.length-1]=t:(s&&t.merge(0,s,null,!1,0,h),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),e++));e<n&&r.length;)if(a[n-1].become(r[r.length-1]))n--,r.pop(),h=r.length?0:l;else{if(!a[e].become(r[0]))break;e++,r.shift(),l=r.length?0:h}!r.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,l,h)&&e--,(e<n||r.length)&&t.replaceChildren(e,n,r)}}function Tp(t,e,i,n,s,r){let o=t.childCursor(),{i:l,off:h}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of n)d+=t.length;t.length+=d,Dp(t,a,c,l,h,n,0,s,r)}let Bp="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Ep="undefined"!=typeof document?document:{documentElement:{style:{}}};const Rp=/Edge\/(\d+)/.exec(Bp.userAgent),Lp=/MSIE \d/.test(Bp.userAgent),Vp=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Bp.userAgent),Np=!!(Lp||Vp||Rp),Pp=!Np&&/gecko\/(\d+)/i.test(Bp.userAgent),Hp=!Np&&/Chrome\/(\d+)/.exec(Bp.userAgent),Wp="webkitFontSmoothing"in Ep.documentElement.style,Ip=!Np&&/Apple Computer/.test(Bp.vendor),Fp=Ip&&(/Mobile\/\w+/.test(Bp.userAgent)||Bp.maxTouchPoints>2);var zp={mac:Fp||/Mac/.test(Bp.platform),windows:/Win/.test(Bp.platform),linux:/Linux|X11/.test(Bp.platform),ie:Np,ie_version:Lp?Ep.documentMode||6:Vp?+Vp[1]:Rp?+Rp[1]:0,gecko:Pp,gecko_version:Pp?+(/Firefox\/(\d+)/.exec(Bp.userAgent)||[0,0])[1]:0,chrome:!!Hp,chrome_version:Hp?+Hp[1]:0,ios:Fp,android:/Android\b/.test(Bp.userAgent),webkit:Wp,safari:Ip,webkit_version:Wp?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Ep.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class qp extends Mp{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof qp&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new qp(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new kp(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Gp(this.dom,t,e)}}class Kp extends Mp{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(Sp(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,r){return(!i||!(!(i instanceof Kp&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&r<=0))&&(Tp(this,t,e,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),n<0&&i>=t&&(n=s),i=o,s++}let r=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new Kp(this.mark,e,r)}domAtPos(t){return Xp(this.dom,this.children,t)}coordsAt(t,e){return Qp(this,t,e)}}function Gp(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;0==e&&i<0||e==n&&i>=0?zp.chrome||zp.gecko||(e?(s--,o=1):(r++,o=-1)):i<0?s--:r++;let l=bp(t,s,r).getClientRects();if(!l.length)return fp;let h=l[(o?o<0:i>=0)?0:l.length-1];return zp.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(l,(t=>t.width))||h),o?pp(h,o<0):h||null}class jp extends Mp{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||jp)(t,e,i)}split(t){let e=jp.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof jp&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof jp&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return f.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):f.empty}domAtPos(t){return 0==t?kp.before(this.dom):kp.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return fp;for(let e=t>0?i.length-1:0;n=i[e],!(t>0?0==e:e==i.length-1||n.top<n.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?n:pp(n,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class _p extends jp{domAtPos(t){let{topView:e,text:i}=this.widget;return e?Up(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new kp(i,Math.min(t,i.nodeValue.length)))):new kp(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?$p(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?Up(t,e,i,n,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Gp(n,t,e))):Gp(n,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function Up(t,e,i,n,s,r){if(i instanceof Kp){for(let o of i.children){let i=op(o.dom,n),l=i?n.nodeValue.length:o.length;if(t<l||t==l&&o.getSide()<=0)return i?Up(t,e,o,n,s,r):s(o,t,e);t-=l}return s(i,i.length,-1)}return i.dom==n?r(t,e):s(i,t,e)}function $p(t,e,i,n){if(i instanceof Kp)for(let s of i.children){let i=0,r=op(s.dom,n);if(op(s.dom,t))return i+(r?$p(t,e,s,n):s.localPosFromDOM(t,e));i+=r?n.nodeValue.length:s.length}else if(i.dom==n)return Math.min(e,n.nodeValue.length);return i.localPosFromDOM(t,e)}class Yp extends Mp{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Yp&&t.side==this.side}split(){return new Yp(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return kp.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,n=i?i.children.indexOf(t):-1;for(;i&&n>=0;)if(e<0?n>0:n<i.children.length){let t=i.children[n+e];if(t instanceof qp){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}n+=e}else{if(!(i instanceof Kp&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}n=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return f.empty}}function Xp(t,e,i){let n=0;for(let s=0;n<e.length;n++){let r=e[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return kp.after(i)}return new kp(t,0)}function Jp(t,e,i){let n,{children:s}=t;i>0&&e instanceof Kp&&s.length&&(n=s[s.length-1])instanceof Kp&&n.mark.eq(e.mark)?Jp(n,e.children[0],i-1):(s.push(e),e.setParent(t)),t.length+=e.length}function Qp(t,e,i){for(let n=0,s=0;s<t.children.length;s++){let r,o=t.children[s],l=n+o.length;if((i<=0||l==t.length||o.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(r=t.children[s+1]).length||r.getSide()>0)){let t=0;if(l==n){if(o.getSide()<=0)continue;t=i=-o.getSide()}let s=o.coordsAt(Math.max(0,e-n),i);return t&&s?pp(s,i<0):s}n=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let s=hp(n);return s[s.length-1]||null}function Zp(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function tg(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||t[s]!==e[s])return!1;return!0}function eg(t,e,i){if(e)for(let n in e)i&&n in i||t.removeAttribute(n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(n,i[n])}qp.prototype.children=jp.prototype.children=Yp.prototype.children=Ap;class ig{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var ng=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(ng||(ng={}));class sg extends Lt{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new rg(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?4e8:-5e8:e>0?1e8:-1e8,new lg(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,n=!!t.block;if(t.isBlockGap)e=-4e8,i=3e8;else{let{start:s,end:r}=hg(t,n);e=(s?n?-3e8:-1:5e8)-1,i=1+(r?n?2e8:1:-6e8)}return new lg(t,e,i,n,t.widget||null,!0)}static line(t){return new og(t)}static set(t,e=!1){return Ht.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}sg.none=Ht.empty;class rg extends sg{constructor(t){let{start:e,end:i}=hg(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof rg&&this.tagName==t.tagName&&this.class==t.class&&tg(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}rg.prototype.point=!1;class og extends sg{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof og&&tg(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}og.prototype.mapMode=k.TrackBefore,og.prototype.point=!0;class lg extends sg{constructor(t,e,i,n,s,r){super(e,i,s,t),this.block=n,this.isReplace=r,this.mapMode=n?e<=0?k.TrackBefore:k.TrackAfter:k.TrackDel}get type(){return this.startSide<this.endSide?ng.WidgetRange:this.startSide<=0?ng.WidgetBefore:ng.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof lg&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function hg(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return null==i&&(i=t.inclusive),null==n&&(n=t.inclusive),{start:null!=i?i:e,end:null!=n?n:e}}function ag(t,e,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=t?i[s]=Math.max(i[s],e):i.push(t,e)}lg.prototype.point=!0;class cg extends Mp{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,r){if(i){if(!(i instanceof cg))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Tp(this,t,e,i?i.children:[],s,r),!0}split(t){let e=new cg;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){tg(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Jp(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Zp(e,this.attrs||{})),i&&(this.attrs=Zp({class:i},this.attrs||{}))}domAtPos(t){return Xp(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(Sp(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(eg(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Mp.get(i)instanceof Kp;)i=i.lastChild;if(!i||"BR"!=i.nodeName&&0==(null===(e=Mp.get(i))||void 0===e?void 0:e.isEditable)&&(!zp.ios||!this.children.some((t=>t instanceof qp)))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof qp))return null;let i=hp(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return Qp(this,t,e)}become(t){return!1}get type(){return ng.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],r=n+s.length;if(r>=e){if(s instanceof cg)return s;if(r>e)break}n=r+s.breakAfter}return null}}class dg extends Mp{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof dg&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?kp.before(this.dom):kp.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new dg(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Ap}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):f.empty}domBoundsAround(){return null}become(t){return t instanceof dg&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class ug{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof dg&&t.type==ng.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new cg),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(fg(new Yp(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(fg(new qp(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s){let r=e-t;if(i instanceof lg)if(i.block){let{type:t}=i;t!=ng.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new dg(i.widget||new pg("div"),r,t))}else{let o=jp.create(i.widget||new pg("span"),r,i.startSide),l=this.atCursorPos&&!o.isEditable&&s<=n.length&&(t<e||i.startSide>0),h=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(n),l&&(a.append(fg(new Yp(1),n),s),s=n.length+Math.max(0,s-n.length)),a.append(fg(o,n),s),this.atCursorPos=h,this.pendingBuffer=h?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}filterPoint(t,e,i,n){if(n<this.disallowBlockEffectsBelow&&i instanceof lg){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,n,s){let r=new ug(t,e,i,s);return r.openEnd=Ht.spans(n,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function fg(t,e){for(let i of e)t=new Kp(i,[t],t.length);return t}class pg extends ig{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const gg=[],mg=H.define(),vg=H.define(),wg=H.define(),yg=H.define(),bg=H.define(),xg=H.define(),Sg=ft.define({map:(t,e)=>t.map(e)}),kg=ft.define({map:(t,e)=>t.map(e)});class Ag{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new Ag(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const Mg=ft.define({map:(t,e)=>t.map(e)});function Cg(t,e,i){let n=t.facet(yg);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const Og=H.define({combine:t=>!t.length||t[0]});class Dg{constructor(t,e){this.field=t,this.get=e}}class Tg{from(t){return new Dg(this,t)}static define(){return new Tg}}Tg.decorations=Tg.define(),Tg.atomicRanges=Tg.define(),Tg.scrollMargins=Tg.define();let Bg=0;const Eg=H.define();class Rg{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Eg.of(this)}static define(t,e){let{eventHandlers:i,provide:n,decorations:s}=e||{},r=[];if(n)for(let t of Array.isArray(n)?n:[n])r.push(t);return i&&r.push(Lg.from((t=>({plugin:t,handlers:i})))),s&&r.push(Tg.decorations.from(s)),new Rg(Bg++,t,r)}static fromClass(t,e){return Rg.define((e=>new t(e)),e)}}const Lg=Tg.define();class Vg{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:n}of this.spec.fields)i==t&&e.push(n(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(Cg(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Cg(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Cg(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Ng=H.define(),Pg=H.define(),Hg=H.define(),Wg=H.define();class Ig{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new Ig(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let l=n==t.length?null:t[n],h=r-o,a=l?l.fromB:1e9;for(;s<e.length&&e[s]<a;){let t=e[s],n=e[s+1],r=Math.max(o,t),l=Math.min(a,n);if(r<=l&&new Ig(r+h,l+h,r,l).addToSet(i),n>a)break;s+=2}if(!l)return i;new Ig(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class Fg{constructor(t,e,i=gg){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=M.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let n=[];this.changes.iterChangedRanges(((t,e,i,s)=>n.push(new Ig(t,e,i,s)))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var zg=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(zg||(zg={}));const qg=zg.LTR,Kg=zg.RTL;function Gg(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const jg=Gg("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),_g=Gg("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Ug=Object.create(null),$g=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Ug[e]=i,Ug[i]=-e}const Yg=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Xg{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?Kg:qg}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<e:o.to>e:t[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const Jg=[];function Qg(t,e){let i=t.length,n=e==qg?1:2,s=e==qg?2:1;if(!t||1==n&&!Yg.test(t))return Zg(i);for(let e=0,s=n,o=n;e<i;e++){let i=(r=t.charCodeAt(e))<=247?jg[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?_g[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),Jg[e]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let t=0,e=n,s=n;t<i;t++){let n=Jg[t];if(128==n)t<i-1&&e==Jg[t+1]&&24&e?n=Jg[t]=e:Jg[t]=256;else if(64==n){let n=t+1;for(;n<i&&64==Jg[n];)n++;let r=t&&8==e||n<i&&8==Jg[n]?1==s?1:8:256;for(let e=t;e<n;e++)Jg[e]=r;t=n-1}else 8==n&&1==s&&(Jg[t]=1);e=n,7&n&&(s=n)}for(let e,r,o,l=0,h=0,a=0;l<i;l++)if(r=Ug[e=t.charCodeAt(l)])if(r<0){for(let t=h-3;t>=0;t-=3)if($g[t+1]==-r){let e=$g[t+2],i=2&e?n:4&e?1&e?s:n:0;i&&(Jg[l]=Jg[$g[t]]=i),h=t;break}}else{if(189==$g.length)break;$g[h++]=l,$g[h++]=e,$g[h++]=a}else if(2==(o=Jg[l])||1==o){let t=o==n;a=t?0:1;for(let e=h-3;e>=0;e-=3){let i=$g[e+2];if(2&i)break;if(t)$g[e+2]|=2;else{if(4&i)break;$g[e+2]|=4}}}for(let t=0;t<i;t++)if(256==Jg[t]){let e=t+1;for(;e<i&&256==Jg[e];)e++;let s=1==(t?Jg[t-1]:n),r=s==(1==(e<i?Jg[e]:n))?s?1:2:n;for(let i=t;i<e;i++)Jg[i]=r;t=e-1}let o=[];if(1==n)for(let t=0;t<i;){let e=t,n=1!=Jg[t++];for(;t<i&&n==(1!=Jg[t]);)t++;if(n)for(let i=t;i>e;){let t=i,n=2!=Jg[--i];for(;i>e&&n==(2!=Jg[i-1]);)i--;o.push(new Xg(i,t,n?2:1))}else o.push(new Xg(e,t,0))}else for(let t=0;t<i;){let e=t,n=2==Jg[t++];for(;t<i&&n==(2==Jg[t]);)t++;o.push(new Xg(e,t,n?1:2))}return o}function Zg(t){return[new Xg(0,t,0)]}let tm="";function em(t,e,i,s,r){var o;let l=s.head-t.from,h=-1;if(0==l){if(!r||!t.length)return null;e[0].level!=i&&(l=e[0].side(!1,i),h=0)}else if(l==t.length){if(r)return null;let t=e[e.length-1];t.level!=i&&(l=t.side(!0,i),h=e.length-1)}h<0&&(h=Xg.find(e,l,null!==(o=s.bidiLevel)&&void 0!==o?o:-1,s.assoc));let a=e[h];l==a.side(r,i)&&(a=e[h+=r?1:-1],l=a.side(!r,i));let c=r==(a.dir==i),d=n(t.text,l,c);if(tm=t.text.slice(Math.min(l,d),Math.max(l,d)),d!=a.side(r,i))return L.cursor(d+t.from,c?-1:1,a.level);let u=h==(r?e.length-1:0)?null:e[h+(r?1:-1)];return u||a.level==i?u&&u.level<a.level?L.cursor(u.side(!r,i)+t.from,r?1:-1,u.level):L.cursor(d+t.from,r?-1:1,a.level):L.cursor(r?t.to:t.from,r?-1:1,i)}class im{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Mt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let t=n.nextSibling;if(t==e)break;let s=Mp.get(n),r=Mp.get(t);(s&&r?s.breakAfter:(s?s.breakAfter:nm(n))||nm(t)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(e))&&(r=s.index,o=s[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Mp.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function nm(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class sm{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class rm extends Mp{constructor(t){super(),this.view=t,this.compositionDeco=sg.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new cg],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Ig(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=sg.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=lm(t);if(!i)return sg.none;let{from:n,to:s,node:r,text:o}=i,l=e.mapPos(n,1),h=Math.max(l,e.mapPos(s,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new im([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),"￿")==c)h=l+c.length;else{if(a.doc.sliceString(Math.max(0,h-c.length),h,"￿")!=c)return sg.none;l=h-c.length}else if(a.doc.sliceString(l,h,"￿")!=c)return sg.none;let d=Mp.get(r);d instanceof _p?d=d.widget.topView:d&&(d.parent=null);return sg.set(sg.replace({widget:new hm(r,o,d)}).range(l,h))}(this.view,t.changes)),(zp.ie||zp.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let n=new cm;return Ht.compare(t,e,i,n),n.changes}(this.decorations,this.updateDeco(),t.changes);return e=Ig.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=zp.chrome||zp.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof dg&&t.widget instanceof om&&n.push(t.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let n=e>=0?t[e]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:l}=n,{content:h,breakAtStart:a,openStart:c,openEnd:d}=ug.build(this.view.state.doc,o,l,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);Dp(this,p,g,u,f,h,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||zp.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if(zp.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(t,s.node.childNodes[s.offset]||null))),s=r=new kp(t,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&ap(s.node,s.offset,l.anchorNode,l.anchorOffset)&&ap(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{zp.android&&zp.chrome&&this.dom.contains(l.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=rp(this.root);if(n.empty){if(zp.gecko){let t=(e=s.node,i=s.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=am(s.node,s.offset,1==t?1:-1);e&&(s=new kp(e,1==t?0:e.nodeValue.length))}}t.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(t.extend)t.collapse(s.node,s.offset),t.extend(r.node,r.offset);else{let e=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),e.setEnd(r.node,r.offset),e.setStart(s.node,s.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new kp(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new kp(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=rp(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=cg.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Og)?this.root.activeElement==this.dom:lp(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=Mp.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof cg)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(t>r||t==r&&s.type!=ng.WidgetBefore&&s.type!=ng.WidgetAfter&&(!n||2==e||this.children[n-1].breakAfter||this.children[n-1].type==ng.WidgetBefore&&e>-2))return s.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,n=this.view.contentDOM.clientWidth,s=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,l=0;l<this.children.length;l++){let h=this.children[l],a=o+h.length;if(a>i)break;if(o>=e){let e=h.dom.getBoundingClientRect();if(t.push(e.height),s){let t=h.dom.lastChild,i=t?hp(t):[];if(i.length){let t=i[i.length-1],s=this.view.textDirection==zg.LTR?t.right-e.left:e.right-t.left;s>r&&(r=s,this.minWidth=n,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+h.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof cg){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=hp(i.firstChild)[0];t=i.getBoundingClientRect().height,e=n?n.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Op(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(sg.replace({widget:new om(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!s)break;i=s.to+1}return sg.set(t)}updateDeco(){let t=this.view.pluginField(Tg.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(Hg),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)});let s=0,r=0,o=0,l=0;for(let t of this.view.pluginField(Tg.scrollMargins))if(t){let{left:e,right:i,top:n,bottom:h}=t;null!=e&&(s=Math.max(s,e)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=h&&(l=Math.max(l,h))}let h={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+l};!function(t,e,i,n,s,r,o,l){let h=t.ownerDocument,a=h.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==h.body;if(d)t=gp(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==s)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let n=e.bottom-e.top,r=t.bottom-t.top;f=("center"==s&&n<=r?e.top+n/2-r/2:"start"==s||"center"==s&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==n?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==n?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==n==l?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,h,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==zg.LTR)}}class om extends ig{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function lm(t){let e=t.observer.selectionRange,i=e.focusNode&&am(e.focusNode,e.focusOffset,0);if(!i)return null;let n=t.docView.nearest(i);if(!n)return null;if(n instanceof cg){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!Mp.get(e);)e=e.previousSibling;let s=e?Mp.get(e).posAtEnd:n.posAtStart;return{from:s,to:s,node:t,text:i}}{for(;;){let{parent:t}=n;if(!t)return null;if(t instanceof cg)break;n=t}let t=n.posAtStart;return{from:t,to:t+n.length,node:n.dom,text:i}}}class hm extends ig{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return _p}}function am(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=up(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class cm{constructor(){this.changes=[]}compareRange(t,e){ag(t,e,this.changes)}comparePoint(t,e){ag(t,e,this.changes)}}function dm(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function um(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function fm(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function pm(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function gm(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function mm(t,e,i){let n,s,r,o,l,h,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=hp(d);for(let u=0;u<t.length;u++){let f=t[u];s&&fm(s,f)&&(f=pm(gm(f,s.bottom),s.top));let p=dm(e,f),g=um(i,f);if(0==p&&0==g)return 3==d.nodeType?vm(d,e,i):mm(d,e,i);(!n||o>g||o==g&&r>p)&&(n=d,s=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(l=d,a=f):i<f.top&&(!c||c.top>f.top)&&(h=d,c=f):a&&fm(a,f)?a=gm(a,f.bottom):c&&fm(c,f)&&(c=pm(c,f.top))}}if(a&&a.bottom>=i?(n=l,s=a):c&&c.top<=i&&(n=h,s=c),!n)return{node:t,offset:0};let d=Math.max(s.left,Math.min(s.right,e));return 3==n.nodeType?vm(n,d,i):r||"true"!=n.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,n)+(e>=(s.left+s.right)/2?1:0)}:mm(n,d,i)}function vm(t,e,i){let n=t.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<n;l++){let n=bp(t,l,l+1).getClientRects();for(let h=0;h<n.length;h++){let a=n[h];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,n=i;if(zp.chrome||zp.gecko){bp(t,l).getBoundingClientRect().left==a.right&&(n=!i)}if(c<=0)return{node:t,offset:l+(n?1:0)};s=l+(n?1:0),r=c}}}return{node:t,offset:s>-1?s:o>0?t.nodeValue.length:0}}function wm(t,{x:e,y:i},n,s=-1){var r;let o,l=t.contentDOM.getBoundingClientRect(),h=l.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-h;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=ng.Text;)for(;c=s>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return n?null:0;i=!0,s=-s}i=h+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:n?null:ym(t,l,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:ym(t,l,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(l.left+1,Math.min(l.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),zp.safari&&function(t,e,i){let n;if(3!=t.nodeType||e!=(n=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return bp(t,n-1,n).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let n=cg.find(t.docView,d);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=mm(n.dom,e,i))}return t.docView.posFromDOM(g,m)}function ym(t,e,i,n,s){let r=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((s-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+u(o,r,t.state.tabSize)}function bm(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=t.bidiSpans(s);for(let o=e,l=null;;){let e=em(s,r,t.textDirection,o,i),h=tm;if(!e){if(s.number==(i?t.state.doc.lines:1))return o;h="\n",s=t.state.doc.line(s.number+(i?1:-1)),r=t.bidiSpans(s),e=L.cursor(i?s.from:s.to)}if(l){if(!l(h))return o}else{if(!n)return e;l=n(h)}o=e}}function xm(t,e,i){let n=t.pluginField(Tg.atomicRanges);for(;;){let t=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=e.from>i.from?L.cursor(n,1):L.cursor(s,-1),t=!0)}));if(!t)return i}}class Sm{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in Om){let i=Om[e];t.contentDOM.addEventListener(e,(n=>{"keydown"==e&&this.keydown(t,n)||Cm(t,n)&&!this.ignoreDuringComposition(n)&&(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),zp.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Lg);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{Cm(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Cg(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(e){Cg(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if(zp.android&&zp.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!zp.ios||!(i=km.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,xp(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(zp.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(t,e){let i=9==e.keyCode&&Date.now()<this.lastEscPress+2e3;return 27==e.keyCode?this.lastEscPress=Date.now():Am.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!zp.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const km=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Am=[16,17,18,20,91,92,224,225];class Mm{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Mt.allowMultipleSelections)&&function(t,e){let i=t.state.facet(mg);return i.length?i[0](e):zp.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(vg);return i.length?i[0](e):zp.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=rp(t.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let t=0;t<s.length;t++){let i=s[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=Fm(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function Cm(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=Mp.get(n))&&i.ignoreEvent(e))return!1;return!0}const Om=Object.create(null),Dm=zp.ie&&zp.ie_version<15||zp.ios&&zp.webkit_version<604;function Tm(t,e){let i,{state:n}=t,s=1,r=n.toText(e),o=r.lines==n.selection.ranges.length;if(null!=qm&&n.selection.ranges.every((t=>t.empty))&&qm==r.toString()){let t=-1;i=n.changeByRange((i=>{let l=n.doc.lineAt(i.from);if(l.from==t)return{range:i};t=l.from;let h=n.toText((o?r.line(s++).text:e)+n.lineBreak);return{changes:{from:l.from,insert:h},range:L.cursor(i.from+h.length)}}))}else i=o?n.changeByRange((t=>{let e=r.line(s++);return{changes:{from:t.from,to:t.to,insert:e.text},range:L.cursor(t.from+e.length)}})):n.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Om.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select")};let Bm=0;function Em(t,e,i,s){if(1==s)return L.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),r=t.doc.lineAt(e),o=e-r.from;if(0==r.length)return L.cursor(e);0==o?i=1:o==r.length&&(i=-1);let l=o,h=o;i<0?l=n(r.text,o,!1):h=n(r.text,o);let a=s(r.text.slice(l,h));for(;l>0;){let t=n(r.text,l,!1);if(s(r.text.slice(t,l))!=a)break;l=t}for(;h<r.length;){let t=n(r.text,h);if(s(r.text.slice(h,t))!=a)break;h=t}return L.range(l+r.from,h+r.from)}(t.state,e,i);{let i=cg.find(t.docView,e),n=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<t.state.doc.length&&r==n.to&&r++,L.range(s,r)}}Om.touchstart=(t,e)=>{Bm=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},Om.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},Om.mousedown=(t,e)=>{if(t.observer.flush(),Bm>Date.now()-2e3&&1==Fm(e))return;let i=null;for(let n of t.state.facet(wg))if(i=n(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=Nm(t,e),n=Fm(e),s=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),s=s.map(t.changes),o=null)},get(e,l,h){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=Nm(t,e),o=e),!a||!i)return s;let c=Em(t,a.pos,a.bias,n);if(i.pos!=a.pos&&!l){let e=Em(t,i.pos,i.bias,n),s=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=s<c.from?L.range(s,r):L.range(r,s)}return l?s.replaceRange(s.main.extend(c.from,c.to)):h?s.addRange(c):L.create([c])}}}(t,e)),i){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore((()=>yp(t.contentDOM))),t.inputState.startMouseSelection(new Mm(t,e,i,n))}};let Rm=(t,e)=>t>=e.top&&t<=e.bottom,Lm=(t,e,i)=>Rm(e,i)&&t>=i.left&&t<=i.right;function Vm(t,e,i,n){let s=cg.find(t.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&Lm(i,n,o))return-1;let l=s.coordsAt(r,1);return l&&Lm(i,n,l)?1:o&&Rm(n,o)?-1:1}function Nm(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:Vm(t,i,e.clientX,e.clientY)}}const Pm=zp.ie&&zp.ie_version<=11;let Hm=null,Wm=0,Im=0;function Fm(t){if(!Pm)return t.detail;let e=Hm,i=Im;return Hm=t,Im=Date.now(),Wm=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Wm+1)%3:1}function zm(t,e,i,n){if(!i)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:i},h=t.state.changes(o?[o,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}Om.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},Om.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&zm(t,e,n.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(n[t]=e.result),r()},e.readAsText(i[t])}}else zm(t,e,e.dataTransfer.getData("Text"),!0)},Om.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Dm?null:e.clipboardData;i?(Tm(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),Tm(t,i.value)}),50)}(t)};let qm=null;function Km(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}Om.copy=Om.cut=(t,e)=>{let{text:i,ranges:n,linewise:s}=function(t){let e=[],i=[],n=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let s=-1;for(let{from:n}of t.selection.ranges){let r=t.doc.lineAt(n);r.number>s&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),s=r.number}n=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:n}}(t.state);if(!i&&!s)return;qm=s?i:null;let r=Dm?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout((()=>{n.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},Om.focus=Om.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},Om.beforeprint=t=>{t.viewState.printing=!0,t.requestMeasure(),setTimeout((()=>{t.viewState.printing=!1,t.requestMeasure()}),2e3)},Om.compositionstart=Om.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),Km(t,!0)))},Om.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&Km(t,!1)}),50)},Om.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},Om.beforeinput=(t,e)=>{var i;let n;if(zp.chrome&&zp.android&&(n=km.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const Gm=["pre-wrap","normal","pre-line","break-spaces"];class jm{constructor(){this.doc=f.empty,this.lineWrapping=!1,this.direction=zg.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return Gm.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(e=!0,this.heightSamples[Math.floor(10*n)]=!0)}return e}refresh(t,e,i,n,s,r){let o=Gm.indexOf(t)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=n,this.lineLength=s,l){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return l}}class _m{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Um{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Um(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new Um(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var $m=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}($m||($m={}));class Ym{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Ym.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:h,toB:a}=n[r],c=s.lineAt(o,$m.ByPosNoHeight,e,0,0),d=c.to>=l?c:s.lineAt(l,$m.ByPosNoHeight,e,0,0);for(a+=d.to-l,l=d.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,h=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,$m.ByPosNoHeight,e,0,0));h+=c.from-o,o=c.from;let u=ev.build(i,t,h,a);s=s.replace(o,l,u)}return s.updateHeight(i,0)}static empty(){return new Jm(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>2*s){let s=t[e-1];s.break?t.splice(--e,1,s.left,null,s.right):t.splice(--e,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,s-=e.size}}else if(n<s){let i=t[e++];i&&(n+=i.size)}else{let e=t[--i];e&&(s+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new Zm(Ym.of(t.slice(0,e)),r,Ym.of(t.slice(i)))}}Ym.prototype.size=1;class Xm extends Ym{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new Um(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,r){r(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Jm extends Xm{constructor(t,e){super(t,e,ng.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return 1==i.length&&(n instanceof Jm||n instanceof Qm&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof Qm?n=new Jm(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):Ym.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Qm extends Ym{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(e,n),l=Math.max(0,Math.min(r-s,Math.floor((t-i)/o))),{from:h,length:a}=e.line(s+l);return new Um(h,a,i+o*l,o,ng.Text)}lineAt(t,e,i,n,s){if(e==$m.ByHeight)return this.blockAt(t,i,n,s);if(e==$m.ByPosNoHeight){let{from:e,to:n}=i.lineAt(t);return new Um(e,n-e,0,0,ng.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:l,length:h,number:a}=i.lineAt(t);return new Um(l,h,n+o*(a-r),o,ng.Text)}forEachLine(t,e,i,n,s,r){let{firstLine:o,lineHeight:l}=this.lines(i,s);for(let h=Math.max(t,s),a=Math.min(s+this.length,e);h<=a;){let e=i.lineAt(h);h==t&&(n+=l*(e.number-o)),r(new Um(e.from,e.length,n,l,ng.Text)),n+=l,h=e.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let t=i[i.length-1];t instanceof Qm?i[i.length-1]=new Qm(t.length+n):i.push(null,new Qm(n-1))}if(t>0){let e=i[0];e instanceof Qm?i[0]=new Qm(t+e.length):i.unshift(new Qm(t-1),null)}return Ym.of(i)}decomposeLeft(t,e){e.push(new Qm(t-1),null)}decomposeRight(t,e){e.push(null,new Qm(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let i=[],r=Math.max(e,n.from),o=-1,l=t.heightChanged;for(n.from>e&&i.push(new Qm(n.from-e-1).updateHeight(t,e));r<=s&&n.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let l=new Jm(e,s);l.outdated=!1,i.push(l),r+=e+1}r<=s&&i.push(null,new Qm(s-r).updateHeight(t,r));let h=Ym.of(i);return t.heightChanged=l||o<0||Math.abs(h.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,h}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class Zm extends Ym{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,l=e==$m.ByHeight?t<r:t<o,h=l?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,r,o);if(this.break||(l?h.to<o:h.from>o))return h;let a=e==$m.ByPosNoHeight?$m.ByPosNoHeight:$m.ByPos;return l?h.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,n,s).join(h)}forEachLine(t,e,i,n,s,r){let o=n+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,n,s,r),e>=l&&this.right.forEachLine(t,e,i,o,l,r);else{let h=this.lineAt(l,$m.ByPos,i,n,s);t<h.from&&this.left.forEachLine(t,h.from-1,i,n,s,r),h.to>=t&&h.from<=e&&r(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,o,l,r)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let r=s.length;for(let t of i)s.push(t);if(t>0&&tv(s,r-1),e<this.length){let t=s.length;this.decomposeRight(e,s),tv(s,t)}return Ym.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Ym.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:r}=this,o=e+s.length+this.break,l=null;return n&&n.from<=e+s.length&&n.more?l=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=o+r.length&&n.more?l=r=r.updateHeight(t,o,i,n):r.updateHeight(t,o,i),l?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function tv(t,e){let i,n;null==t[e]&&(i=t[e-1])instanceof Qm&&(n=t[e+1])instanceof Qm&&t.splice(e-1,3,new Qm(i.length+1+n.length))}class ev{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Jm?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new Jm(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new Xm(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Jm(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Qm(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Jm)return t;let e=new Jm(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=ng.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=ng.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof Jm||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new Jm(0,-1));let i=t;for(let t of this.nodes)t instanceof Jm&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,n){let s=new ev(i,t);return Ht.spans(e,i,n,s,0),s.finish(i)}}class iv{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&ag(t,e,this.changes,5)}}class nv{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return sg.replace({widget:new sv(this.size,t)}).range(this.from,this.to)}}class sv extends ig{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class rv{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new jm,this.scaler=uv,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Ym.empty().applyChanges(t.facet(Hg),f.empty,this.heightOracle.setDoc(t.doc),[new Ig(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=sg.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>n>=t&&n<=e))){let{from:e,to:i}=this.lineBlockAt(n);t.push(new ov(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?uv:new fv(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:pv(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let n=this.state.facet(Hg),s=t.changedRanges,r=Ig.extendWithRanges(s,function(t,e,i){let n=new iv;return Ht.compare(t,e,i,n,0),n.changes}(t.startState.facet(Hg),n,t?t.changes:M.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace,r="rtl"==i.direction?zg.RTL:zg.LTR,o=this.heightOracle.mustRefreshForStyle(s,r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,n=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==n||(h|=8,this.paddingTop=t,this.paddingBottom=n)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:function(t,e){let i=t.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=l;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();n=Math.max(n,e.left),s=Math.min(s,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let e=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(e)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:l}=t.docView.measureTextSize();o=n.refresh(s,r,i,l,p/l,e),o&&(t.docView.minWidth=0,h|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),n.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(n,0,o,new _m(this.viewport.from,e)),n.heightChanged&&(h|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&h||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new ov(n.lineAt(r-1e3*i,$m.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),$m.ByHeight,s,0,0).to);if(e){let{head:t}=e.range;if(t<l.from||t>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(t,$m.ByPos,s,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<l.from?o.top:o.bottom-r,l=new ov(n.lineAt(i-500,$m.ByHeight,s,0,0).from,n.lineAt(i+r+500,$m.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new ov(this.heightMap.lineAt(i,$m.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,$m.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,$m.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,$m.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||n<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new nv(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=zg.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=lv(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=hv(r,(this.visibleTop-i.top-t)/i.height),s=hv(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;n=hv(r,(this.pixelViewport.left-e)/t),s=hv(r,(this.pixelViewport.right+e)/t)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&cv(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&cv(o,l.to-10,l.to+10);for(let{from:n,to:s}of o)s-n>1e3&&e.push(dv(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-n)<1e3&&Math.abs(t.to-s)<1e3))||new nv(n,s,this.gapSize(i,n,s,r)))}return e}gapSize(t,e,i,n){let s=av(n,i)-av(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){nv.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=sg.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(Hg);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Ht.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||pv(this.heightMap.lineAt(t,$m.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return pv(this.heightMap.lineAt(this.scaler.fromDOM(t),$m.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return pv(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class ov{constructor(t,e){this.from=t,this.to=e}}function lv(t,e,i){let n=[],s=t,r=0;return Ht.spans(i.facet(Hg),t,e,{span(){},point(t,e){t>s&&(n.push({from:s,to:t}),r+=t-s),s=e}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function hv({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:s}=e[t],r=s-i;if(n<=r)return i+n;n-=r}}function av(t,e){let i=0;for(let{from:n,to:s}of t.ranges){if(e<=s){i+=e-n;break}i+=s-n}return i/t.total}function cv(t,e,i){for(let n=0;n<t.length;n++){let s=t[n];if(s.from<i&&s.to>e){let r=[];s.from<e&&r.push({from:s.from,to:e}),s.to>i&&r.push({from:i,to:s.to}),t.splice(n,1,...r),n+=r.length-1}}}function dv(t,e){for(let i of t)if(e(i))return i}const uv={toDOM:t=>t,fromDOM:t=>t,scale:1};class fv{constructor(t,e,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=e.lineAt(i,$m.ByPos,t,0,0).top,o=e.lineAt(s,$m.ByPos,t,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(e.height-n);for(let t of this.viewports)t.domTop=r+(t.top-s)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),s=t.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function pv(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new Um(t.from,t.length,i,n-i,Array.isArray(t.type)?t.type.map((t=>pv(t,e))):t.type)}const gv=H.define({combine:t=>t.join(" ")}),mv=H.define({combine:t=>t.indexOf(!0)>-1}),vv=Bt.newName(),wv=Bt.newName(),yv=Bt.newName(),bv={"&light":"."+wv,"&dark":"."+yv};function xv(t,e,i){return new Bt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const Sv=xv("."+vv,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},bv),kv={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Av=zp.ie&&zp.ie_version<=11;class Mv{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new mp,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(zp.ie&&zp.ie_version<=11||zp.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),Av&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(Og)?e.root.activeElement!=this.dom:!lp(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((zp.ie&&zp.ie_version<=11||zp.android&&zp.chrome)&&!e.state.selection.main.empty&&i.focusNode&&ap(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=rp(t),i=zp.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let n=e.startContainer,s=e.startOffset,r=e.endContainer,o=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);ap(l.node,l.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,kv),Av&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Av&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;xp(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let t=this.readMutation(s);t&&(t.typeOver&&(n=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&lp(this.dom,this.selectionRange);if(e<0&&!s)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,n),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=Cv(e,t.previousSibling||t.target.previousSibling,-1),n=Cv(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Cv(t,e,i){for(;e;){let n=Mp.get(e);if(n&&n.parent==t)return n;let s=e.parentNode;e=s!=t.dom?s:i>0?e.nextSibling:e.previousSibling}return null}function Ov(t,e,i,n){let s,r,o=t.state.selection.main;if(e>-1){let n=t.docView.domBoundsAround(e,i,0);if(!n||t.state.readOnly)return;let{from:l,to:h}=n,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new sm(i,n)),s==i&&r==n||e.push(new sm(s,r)));return e}(t),c=new im(a,t.state);c.readRange(n.startDOM,n.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||zp.android&&c.text.length<h-l)&&(d=o.to,u="end");let p=function(t,e,i,n){let s=Math.min(t.length,e.length),r=0;for(;r<s&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&t.length==e.length)return null;let o=t.length,l=e.length;for(;o>0&&l>0&&t.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(t.state.doc.sliceString(l,h,"￿"),c.text,d-l,u);p&&(zp.chrome&&13==t.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==c.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:f.of(c.text.slice(p.from,p.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,n=2==t.length?t[1].pos:i;return i>-1&&n>-1?L.single(i+e,n+e):null}(a,l)}else if(t.hasFocus||!t.state.facet(Og)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=t.docView,s=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!op(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),l=n&&n.node==e.anchorNode&&n.offset==e.anchorOffset||!op(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);s==o.head&&l==o.anchor||(r=L.single(l,s))}if(s||r)if(!s&&n&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,s.from).append(s.insert).append(t.state.doc.slice(s.to,o.to))}),s){let e=t.state;if(zp.ios&&t.inputState.flushIOSKey(t))return;if(zp.android&&(s.from==o.from&&s.to==o.to&&1==s.insert.length&&2==s.insert.lines&&xp(t.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&0==s.insert.length&&xp(t.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&0==s.insert.length&&xp(t.contentDOM,"Delete",46)))return;let i,n=s.insert.toString();if(t.state.facet(xg).some((e=>e(t,s.from,s.to,n))))return;if(t.inputState.composing>=0&&t.inputState.composing++,s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&t.inputState.composing<0){let n=o.from<s.from?e.sliceDoc(o.from,s.from):"",r=o.to>s.to?e.sliceDoc(s.to,o.to):"";i=e.replaceSelection(t.state.toText(n+s.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let n=e.changes(s),l=r&&!e.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let r=t.state.sliceDoc(s.from,s.to),h=lm(t)||t.state.doc.lineAt(o.head),a=o.to-s.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:n,range:l||i.map(n)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let f=e.changes({from:u,to:d,insert:s.insert}),p=i.to-o.to;return{changes:f,range:l?L.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}}))}else i={changes:n,selection:l&&e.selection.replaceRange(l)}}let l="input.type";t.composing&&(l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:l})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class Dv{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new rv(t.state||Mt.create()),this.plugins=this.state.facet(Eg).map((t=>new Vg(t)));for(let t of this.plugins)t.update(this);this.observer=new Mv(this,((t,e,i)=>{Ov(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new Sm(this),this.docView=new rm(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);if(n.facet(Mt.phrases)!=this.state.facet(Mt.phrases))return this.setState(n);e=new Fg(this,n,t);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(s&&(s=s.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;s=new Ag(t.empty?t:L.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(Sg)?s=new Ag(t.value):t.is(kg)?s=new Ag(t.value,"center"):t.is(Mg)&&(s=t.value)}this.viewState.update(e,s),this.bidiCache=Rv.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(Wg)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(gv)!=e.state.facet(gv)&&(this.viewState.mustMeasureContent=!0),(i||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(bg))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new rv(t),this.plugins=t.facet(Eg).map((t=>new Vg(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new rm(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Eg),i=t.state.facet(Eg);if(e!=i){let n=[];for(let s of i){let i=e.indexOf(s);if(i<0)n.push(new Vg(s));else{let e=this.plugins[i];e.mustUpdate=t,n.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((t=>{try{return t.read(this)}catch(t){return Cg(this.state,t),Ev}})),o=new Fg(this,this.state),l=!1,h=!1;o.flags|=n,e?e.flags|=n:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),l=this.docView.update(o));for(let t=0;t<s.length;t++)if(r[t]!=Ev)try{let e=s[t];e.write&&e.write(r[t],this)}catch(t){Cg(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),l&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(bg))t(e)}get themeClasses(){return vv+" "+(this.state.facet(mv)?yv:wv)+" "+this.state.facet(gv)}updateAttrs(){let t=Lv(this,Ng,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Og)?"true":"false",class:"cm-content",style:`${zp.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Lv(this,Pg,e),this.observer.ignore((()=>{eg(this.contentDOM,this.contentAttrs,e),eg(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(Dv.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(Wg),Bt.mount(this.root,this.styleModules.concat(Sv).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Bv(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Bv(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Bv(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return xm(this,t,bm(this,t,e,i))}moveByGroup(t,e){return xm(this,t,bm(this,t,e,(e=>function(t,e,i){let n=t.state.charCategorizer(e),s=n(i);return t=>{let e=n(t);return s==xt.Space&&(s=e),s==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=n&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),n=t.posAtCoords({x:i==(t.textDirection==zg.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=n)return L.cursor(n,i?-1:1)}let o=cg.find(t.docView,e.head),l=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return L.cursor(l,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return xm(this,t,function(t,e,i,n){let s=e.head,r=i?1:-1;if(s==(i?t.state.doc.length:0))return L.cursor(s,e.assoc);let o,l=e.goalColumn,h=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(s),c=t.documentTop;if(a)null==l&&(l=a.left-h.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(s-c);null==l&&(l=Math.min(h.right-h.left,t.defaultCharacterWidth*(s-e.from))),o=(r<0?e.top:e.bottom)+c}let d=h.left+l,u=null!=n?n:t.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(u+i)*r,a=wm(t,{x:d,y:n},!1,r);if(n<h.top||n>h.bottom||(r<0?a<s:a>s))return L.cursor(a,e.assoc,void 0,l)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:Sg.of(L.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),wm(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n);return pp(i,s[Xg.find(s,t-n.from,-1,e)].dir==zg.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Tv)return Zg(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=Qg(t.text,this.textDirection);return this.bidiCache.push(new Rv(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||zp.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{yp(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Mg.of(new Ag("number"==typeof t?L.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Rg.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Bt.newName(),n=[gv.of(i),Wg.of(xv(`.${i}`,t))];return e&&e.dark&&n.push(mv.of(!0)),n}static baseTheme(t){return X.lowest(Wg.of(xv("."+vv,t,bv)))}}Dv.scrollTo=Sg,Dv.centerOn=kg,Dv.styleModule=Wg,Dv.inputHandler=xg,Dv.exceptionSink=yg,Dv.updateListener=bg,Dv.editable=Og,Dv.mouseSelectionStyle=wg,Dv.dragMovesSelection=vg,Dv.clickAddsSelectionRange=mg,Dv.decorations=Hg,Dv.darkTheme=mv,Dv.contentAttributes=Pg,Dv.editorAttributes=Ng,Dv.lineWrapping=Dv.contentAttributes.of({class:"cm-lineWrapping"}),Dv.announce=ft.define();const Tv=4096;function Bv(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const Ev={};class Rv{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:zg.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let r=t[s];r.dir!=n||e.touchesRange(r.from,r.to)||i.push(new Rv(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function Lv(t,e,i){for(let n=t.state.facet(e),s=n.length-1;s>=0;s--){let e=n[s],r="function"==typeof e?e(t):e;r&&Zp(r,i)}return i}const Vv=!zp.ios;const Nv={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};Vv&&(Nv[".cm-line"].caretColor="transparent !important");class Pv extends Lt{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}Pv.prototype.elementClass="",Pv.prototype.toDOM=void 0,Pv.prototype.mapMode=k.TrackBefore,Pv.prototype.startSide=Pv.prototype.endSide=-1,Pv.prototype.point=!0;const Hv=H.define(),Wv={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>Ht.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Iv=H.define();function Fv(t){return[Kv(),Iv.of(Object.assign(Object.assign({},Wv),t))]}const zv=Dv.baseTheme({".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#999",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"}}),qv=H.define({combine:t=>t.some((t=>t))});function Kv(t){let e=[Gv,zv];return t&&!1===t.fixed&&e.push(qv.of(!0)),e}const Gv=Rg.fromClass(class{constructor(t){this.view=t,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=t.state.facet(Iv).map((e=>new $v(t,e)));for(let t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!t.state.facet(qv),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}update(t){if(this.updateGutters(t)){let e=this.prevViewport,i=t.view.viewport,n=Math.min(e.to,i.to)-Math.max(e.from,i.from);this.syncGutters(n<.8*(i.to-i.from))}t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(qv)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&this.dom.remove();let i=Ht.iter(this.view.state.facet(Hv),this.view.viewport.from),n=[],s=this.gutters.map((t=>new Uv(t,this.view.viewport,-this.view.documentPadding.top)));for(let t of this.view.viewportLineBlocks){let e;if(Array.isArray(t.type)){for(let i of t.type)if(i.type==ng.Text){e=i;break}}else e=t.type==ng.Text?t:void 0;if(e){n.length&&(n=[]),_v(i,n,t.from);for(let t of s)t.line(this.view,e,n)}}for(let t of s)t.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){let e=t.startState.facet(Iv),i=t.state.facet(Iv),n=t.docChanged||t.heightChanged||t.viewportChanged||!Ht.eq(t.startState.facet(Hv),t.state.facet(Hv),t.view.viewport.from,t.view.viewport.to);if(e==i)for(let e of this.gutters)e.update(t)&&(n=!0);else{n=!0;let s=[];for(let n of i){let i=e.indexOf(n);i<0?s.push(new $v(this.view,n)):(this.gutters[i].update(t),s.push(this.gutters[i]))}for(let t of this.gutters)t.dom.remove(),s.indexOf(t)<0&&t.destroy();for(let t of s)this.dom.appendChild(t.dom);this.gutters=s}return n}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove()}},{provide:Tg.scrollMargins.from((t=>0!=t.gutters.length&&t.fixed?t.view.textDirection==zg.LTR?{left:t.dom.offsetWidth}:{right:t.dom.offsetWidth}:null))});function jv(t){return Array.isArray(t)?t:[t]}function _v(t,e,i){for(;t.value&&t.from<=i;)t.from==i&&e.push(t.value),t.next()}class Uv{constructor(t,e,i){this.gutter=t,this.height=i,this.localMarkers=[],this.i=0,this.cursor=Ht.iter(t.markers,e.from)}line(t,e,i){this.localMarkers.length&&(this.localMarkers=[]),_v(this.cursor,this.localMarkers,e.from);let n=i.length?this.localMarkers.concat(i):this.localMarkers,s=this.gutter.config.lineMarker(t,e,n);s&&n.unshift(s);let r=this.gutter;if(0==n.length&&!r.config.renderEmptyElements)return;let o=e.top-this.height;if(this.i==r.elements.length){let i=new Yv(t,e.height,o,n);r.elements.push(i),r.dom.appendChild(i.dom)}else r.elements[this.i].update(t,e.height,o,n);this.height=e.bottom,this.i++}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class $v{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in e.domEventHandlers)this.dom.addEventListener(i,(n=>{let s=t.lineBlockAtHeight(n.clientY-t.documentTop);e.domEventHandlers[i](t,s,n)&&n.preventDefault()}));this.markers=jv(e.markers(t)),e.initialSpacer&&(this.spacer=new Yv(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=jv(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let e=this.config.updateSpacer(this.spacer.markers[0],t);e!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[e])}let i=t.view.viewport;return!Ht.eq(this.markers,e,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(t)}destroy(){for(let t of this.elements)t.destroy()}}class Yv{constructor(t,e,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.update(t,e,i,n)}update(t,e,i,n){this.height!=e&&(this.dom.style.height=(this.height=e)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),function(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].compare(e[i]))return!1;return!0}(this.markers,n)||this.setMarkers(t,n)}setMarkers(t,e){let i="cm-gutterElement",n=this.dom.firstChild;for(let s=0,r=0;;){let o=r,l=s<e.length?e[s++]:null,h=!1;if(l){let t=l.elementClass;t&&(i+=" "+t);for(let t=r;t<this.markers.length;t++)if(this.markers[t].compare(l)){o=t,h=!0;break}}else o=this.markers.length;for(;r<o;){let t=this.markers[r++];if(t.toDOM){t.destroy(n);let e=n.nextSibling;n.remove(),n=e}}if(!l)break;l.toDOM&&(h?n=n.nextSibling:this.dom.insertBefore(l.toDOM(t),n)),h&&r++}this.dom.className=i,this.markers=e}destroy(){this.setMarkers(null,[])}}const Xv=H.define(),Jv=H.define({combine:t=>Ct(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){let i=Object.assign({},t);for(let t in e){let n=i[t],s=e[t];i[t]=n?(t,e,i)=>n(t,e,i)||s(t,e,i):s}return i}})});class Qv extends Pv{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function Zv(t,e){return t.state.facet(Jv).formatNumber(e,t.state)}const tw=Iv.compute([Jv],(t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:t=>t.state.facet(Xv),lineMarker:(t,e,i)=>i.some((t=>t.toDOM))?null:new Qv(Zv(t,t.state.doc.lineAt(e.from).number)),lineMarkerChange:t=>t.startState.facet(Jv)!=t.state.facet(Jv),initialSpacer:t=>new Qv(Zv(t,iw(t.state.doc.lines))),updateSpacer(t,e){let i=Zv(e.view,iw(e.view.state.doc.lines));return i==t.number?t:new Qv(i)},domEventHandlers:t.facet(Jv).domEventHandlers})));function ew(t={}){return[Jv.of(t),Kv(),tw]}function iw(t){let e=9;for(;e<t;)e=10*e+9;return e}const nw=new class extends Pv{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},sw=Hv.compute(["selection"],(t=>{let e=[],i=-1;for(let n of t.selection.ranges)if(n.empty){let s=t.doc.lineAt(n.head).from;s>i&&(i=s,e.push(nw.range(s)))}return Ht.of(e)}));function rw(){return sw}function ow(t,e){let i=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);return i>=n?void 0:{from:i,to:n}}const lw=ft.define({map:ow}),hw=ft.define({map:ow});function aw(t){let e=[];for(let{head:i}of t.state.selection.ranges)e.some((t=>t.from<=i&&t.to>=i))||e.push(t.lineBlockAt(i));return e}const cw=K.define({create:()=>Mc.none,update(t,e){t=t.map(e.changes);for(let i of e.effects)i.is(lw)&&!uw(t,i.value.from,i.value.to)?t=t.update({add:[bw.range(i.value.from,i.value.to)]}):i.is(hw)&&(t=t.update({filter:(t,e)=>i.value.from!=t||i.value.to!=e,filterFrom:i.value.from,filterTo:i.value.to}));if(e.selection){let i=!1,{head:n}=e.selection.main;t.between(n,n,((t,e)=>{t<n&&e>n&&(i=!0)})),i&&(t=t.update({filterFrom:n,filterTo:n,filter:(t,e)=>e<=n||t>=n}))}return t},provide:t=>Yu.decorations.from(t)});function dw(t,e,i){var n;let s=null;return null===(n=t.field(cw,!1))||void 0===n||n.between(e,i,((t,e)=>{(!s||s.from>t)&&(s={from:t,to:e})})),s}function uw(t,e,i){let n=!1;return t.between(e,e,((t,s)=>{t==e&&s==i&&(n=!0)})),n}function fw(t,e){return t.field(cw,!1)?e:e.concat(ft.appendConfig.of(yw()))}const pw=t=>{for(let e of aw(t)){let i=sp(t.state,e.from,e.to);if(i)return t.dispatch({effects:fw(t.state,[lw.of(i),gw(t,i)])}),!0}return!1};function gw(t,e,i=!0){let n=t.state.doc.lineAt(e.from).number,s=t.state.doc.lineAt(e.to).number;return Yu.announce.of(`${t.state.phrase(i?"Folded lines":"Unfolded lines")} ${n} ${t.state.phrase("to")} ${s}.`)}const mw=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:pw},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:t=>{if(!t.state.field(cw,!1))return!1;let e=[];for(let i of aw(t)){let n=dw(t.state,i.from,i.to);n&&e.push(hw.of(n),gw(t,n,!1))}return e.length&&t.dispatch({effects:e}),e.length>0}},{key:"Ctrl-Alt-[",run:t=>{let{state:e}=t,i=[];for(let n=0;n<e.doc.length;){let s=t.lineBlockAt(n),r=sp(e,s.from,s.to);r&&i.push(lw.of(r)),n=(r?t.lineBlockAt(r.to):s).to+1}return i.length&&t.dispatch({effects:fw(t.state,i)}),!!i.length}},{key:"Ctrl-Alt-]",run:t=>{let e=t.state.field(cw,!1);if(!e||!e.size)return!1;let i=[];return e.between(0,t.state.doc.length,((t,e)=>{i.push(hw.of({from:t,to:e}))})),t.dispatch({effects:i}),!0}}],vw={placeholderDOM:null,placeholderText:"…"},ww=H.define({combine:t=>Ct(t,vw)});function yw(t){let e=[cw,Aw];return t&&e.push(ww.of(t)),e}const bw=Mc.replace({widget:new class extends kc{toDOM(t){let{state:e}=t,i=e.facet(ww),n=e=>{let i=t.lineBlockAt(t.posAtDOM(e.target)),n=dw(t.state,i.from,i.to);n&&t.dispatch({effects:hw.of(n)}),e.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(t,n);let s=document.createElement("span");return s.textContent=i.placeholderText,s.setAttribute("aria-label",e.phrase("folded code")),s.title=e.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=n,s}}}),xw={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{}};class Sw extends Pv{constructor(t,e){super(),this.config=t,this.open=e}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);let e=document.createElement("span");return e.textContent=this.open?this.config.openText:this.config.closedText,e.title=t.state.phrase(this.open?"Fold line":"Unfold line"),e}}function kw(t={}){let e=Object.assign(Object.assign({},xw),t),i=new Sw(e,!0),n=new Sw(e,!1),s=Zc.fromClass(class{constructor(t){this.from=t.viewport.from,this.markers=this.buildMarkers(t)}update(t){(t.docChanged||t.viewportChanged||t.startState.facet(zf)!=t.state.facet(zf)||t.startState.field(cw,!1)!=t.state.field(cw,!1))&&(this.markers=this.buildMarkers(t.view))}buildMarkers(t){let e=new Wt;for(let s of t.viewportLineBlocks){let r=dw(t.state,s.from,s.to)?n:sp(t.state,s.from,s.to)?i:null;r&&e.add(s.from,s.from,r)}return e.finish()}}),{domEventHandlers:r}=e;return[s,Fv({class:"cm-foldGutter",markers(t){var e;return(null===(e=t.plugin(s))||void 0===e?void 0:e.markers)||Ht.empty},initialSpacer:()=>new Sw(e,!1),domEventHandlers:Object.assign(Object.assign({},r),{click:(t,e,i)=>{if(r.click&&r.click(t,e,i))return!0;let n=dw(t.state,e.from,e.to);if(n)return t.dispatch({effects:hw.of(n)}),!0;let s=sp(t.state,e.from,e.to);return!!s&&(t.dispatch({effects:lw.of(s)}),!0)}})}),yw()]}const Aw=Yu.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});function Mw(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function Cw(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function Ow(t,e){if(!e.anchorNode)return!1;try{return Cw(t,e.anchorNode)}catch(t){return!1}}function Dw(t){return 3==t.nodeType?Fw(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function Tw(t,e,i,n){return!!i&&(Ew(t,e,i,n,-1)||Ew(t,e,i,n,1))}function Bw(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function Ew(t,e,i,n,s){for(;;){if(t==i&&e==n)return!0;if(e==(s<0?0:Rw(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=Bw(t)+(s<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(s<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=s<0?Rw(t):0}}}function Rw(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const Lw={left:0,right:0,top:0,bottom:0};function Vw(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Nw(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class Pw{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let Hw,Ww=null;function Iw(t){if(t.setActive)return t.setActive();if(Ww)return t.focus(Ww);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Ww?{get preventScroll(){return Ww={preventScroll:!0},!0}}:void 0),!Ww){Ww=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],s=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function Fw(t,e,i=e){let n=Hw||(Hw=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function zw(t,e,i){let n={key:e,code:e,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,t.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,t.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function qw(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Kw{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Kw(t.parentNode,Bw(t),e)}static after(t,e){return new Kw(t.parentNode,Bw(t)+1,e)}}const Gw=[];class jw{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e=this.dom,i=e.firstChild;for(let n of this.children){if(n.dirty){if(!n.dom&&i){let t=jw.get(i);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(i)}n.sync(t),n.dirty=0}if(t&&!t.written&&t.node==e&&i!=n.dom&&(t.written=!0),n.dom.parentNode==e){for(;i&&i!=n.dom;)i=_w(i);i=n.dom.nextSibling}else e.insertBefore(n.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=_w(i)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=0==Rw(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==n&&e.firstChild!=e.lastChild&&(n=t==e.firstChild?-1:1),t=e}i=n<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!jw.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let n=this.children[t];if(n.dom==i)return e;e+=n.length+n.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,r=-1,o=-1;for(let l=0,h=i,a=i;l<this.children.length;l++){let i=this.children[l],c=h+i.length;if(h<t&&c>e)return i.domBoundsAround(t,e,h);if(c>=t&&-1==n&&(n=l,s=h),h>e&&i.dom.parentNode==this.dom){r=l,o=a;break}a=c,h=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Gw){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Uw(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function _w(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}jw.prototype.breakAfter=0;class Uw{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function $w(t,e,i,n,s,r,o,l,h){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(i,s,r.length?d:null,0==i,l,h))){if(n<a.length){let t=a[n];t&&s<t.length?(e==n&&(t=t.split(s),s=0),!u&&d&&t.merge(0,s,d,!0,0,h)?r[r.length-1]=t:(s&&t.merge(0,s,null,!1,0,h),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),e++));e<n&&r.length;)if(a[n-1].become(r[r.length-1]))n--,r.pop(),h=r.length?0:l;else{if(!a[e].become(r[0]))break;e++,r.shift(),l=r.length?0:h}!r.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,l,h)&&e--,(e<n||r.length)&&t.replaceChildren(e,n,r)}}function Yw(t,e,i,n,s,r){let o=t.childCursor(),{i:l,off:h}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of n)d+=t.length;t.length+=d,$w(t,a,c,l,h,n,0,s,r)}let Xw="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Jw="undefined"!=typeof document?document:{documentElement:{style:{}}};const Qw=/Edge\/(\d+)/.exec(Xw.userAgent),Zw=/MSIE \d/.test(Xw.userAgent),ty=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Xw.userAgent),ey=!!(Zw||ty||Qw),iy=!ey&&/gecko\/(\d+)/i.test(Xw.userAgent),ny=!ey&&/Chrome\/(\d+)/.exec(Xw.userAgent),sy="webkitFontSmoothing"in Jw.documentElement.style,ry=!ey&&/Apple Computer/.test(Xw.vendor),oy=ry&&(/Mobile\/\w+/.test(Xw.userAgent)||Xw.maxTouchPoints>2);var ly={mac:oy||/Mac/.test(Xw.platform),windows:/Win/.test(Xw.platform),linux:/Linux|X11/.test(Xw.platform),ie:ey,ie_version:Zw?Jw.documentMode||6:ty?+ty[1]:Qw?+Qw[1]:0,gecko:iy,gecko_version:iy?+(/Firefox\/(\d+)/.exec(Xw.userAgent)||[0,0])[1]:0,chrome:!!ny,chrome_version:ny?+ny[1]:0,ios:oy,android:/Android\b/.test(Xw.userAgent),webkit:sy,safari:ry,webkit_version:sy?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Jw.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class hy extends jw{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof hy&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new hy(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Kw(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return cy(this.dom,t,e)}}class ay extends jw{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(qw(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,r){return(!i||!(!(i instanceof ay&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&r<=0))&&(Yw(this,t,e,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),n<0&&i>=t&&(n=s),i=o,s++}let r=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new ay(this.mark,e,r)}domAtPos(t){return my(this.dom,this.children,t)}coordsAt(t,e){return wy(this,t,e)}}function cy(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;0==e&&i<0||e==n&&i>=0?ly.chrome||ly.gecko||(e?(s--,o=1):(r++,o=-1)):i<0?s--:r++;let l=Fw(t,s,r).getClientRects();if(!l.length)return Lw;let h=l[(o?o<0:i>=0)?0:l.length-1];return ly.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(l,(t=>t.width))||h),o?Vw(h,o<0):h||null}class dy extends jw{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||dy)(t,e,i)}split(t){let e=dy.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof dy&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof dy&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return f.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):f.empty}domAtPos(t){return 0==t?Kw.before(this.dom):Kw.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return Lw;for(let e=t>0?i.length-1:0;n=i[e],!(t>0?0==e:e==i.length-1||n.top<n.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?n:Vw(n,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class uy extends dy{domAtPos(t){let{topView:e,text:i}=this.widget;return e?fy(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Kw(i,Math.min(t,i.nodeValue.length)))):new Kw(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?py(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?fy(t,e,i,n,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>cy(n,t,e))):cy(n,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function fy(t,e,i,n,s,r){if(i instanceof ay){for(let o of i.children){let i=Cw(o.dom,n),l=i?n.nodeValue.length:o.length;if(t<l||t==l&&o.getSide()<=0)return i?fy(t,e,o,n,s,r):s(o,t,e);t-=l}return s(i,i.length,-1)}return i.dom==n?r(t,e):s(i,t,e)}function py(t,e,i,n){if(i instanceof ay)for(let s of i.children){let i=0,r=Cw(s.dom,n);if(Cw(s.dom,t))return i+(r?py(t,e,s,n):s.localPosFromDOM(t,e));i+=r?n.nodeValue.length:s.length}else if(i.dom==n)return Math.min(e,n.nodeValue.length);return i.localPosFromDOM(t,e)}class gy extends jw{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof gy&&t.side==this.side}split(){return new gy(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Kw.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,n=i?i.children.indexOf(t):-1;for(;i&&n>=0;)if(e<0?n>0:n<i.children.length){let t=i.children[n+e];if(t instanceof hy){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}n+=e}else{if(!(i instanceof ay&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}n=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return f.empty}}function my(t,e,i){let n=0;for(let s=0;n<e.length;n++){let r=e[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return Kw.after(i)}return new Kw(t,0)}function vy(t,e,i){let n,{children:s}=t;i>0&&e instanceof ay&&s.length&&(n=s[s.length-1])instanceof ay&&n.mark.eq(e.mark)?vy(n,e.children[0],i-1):(s.push(e),e.setParent(t)),t.length+=e.length}function wy(t,e,i){for(let n=0,s=0;s<t.children.length;s++){let r,o=t.children[s],l=n+o.length;if((i<=0||l==t.length||o.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(r=t.children[s+1]).length||r.getSide()>0)){let t=0;if(l==n){if(o.getSide()<=0)continue;t=i=-o.getSide()}let s=o.coordsAt(Math.max(0,e-n),i);return t&&s?Vw(s,i<0):s}n=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let s=Dw(n);return s[s.length-1]||null}function yy(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function by(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||t[s]!==e[s])return!1;return!0}function xy(t,e,i){if(e)for(let n in e)i&&n in i||t.removeAttribute(n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(n,i[n])}hy.prototype.children=dy.prototype.children=gy.prototype.children=Gw;class Sy{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var ky=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(ky||(ky={}));class Ay extends Lt{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new My(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?4e8:-5e8:e>0?1e8:-1e8,new Oy(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,n=!!t.block;if(t.isBlockGap)e=-4e8,i=3e8;else{let{start:s,end:r}=Dy(t,n);e=(s?n?-3e8:-1:5e8)-1,i=1+(r?n?2e8:1:-6e8)}return new Oy(t,e,i,n,t.widget||null,!0)}static line(t){return new Cy(t)}static set(t,e=!1){return Ht.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Ay.none=Ht.empty;class My extends Ay{constructor(t){let{start:e,end:i}=Dy(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof My&&this.tagName==t.tagName&&this.class==t.class&&by(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}My.prototype.point=!1;class Cy extends Ay{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Cy&&by(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Cy.prototype.mapMode=k.TrackBefore,Cy.prototype.point=!0;class Oy extends Ay{constructor(t,e,i,n,s,r){super(e,i,s,t),this.block=n,this.isReplace=r,this.mapMode=n?e<=0?k.TrackBefore:k.TrackAfter:k.TrackDel}get type(){return this.startSide<this.endSide?ky.WidgetRange:this.startSide<=0?ky.WidgetBefore:ky.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof Oy&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function Dy(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return null==i&&(i=t.inclusive),null==n&&(n=t.inclusive),{start:null!=i?i:e,end:null!=n?n:e}}function Ty(t,e,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=t?i[s]=Math.max(i[s],e):i.push(t,e)}Oy.prototype.point=!0;class By extends jw{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,r){if(i){if(!(i instanceof By))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Yw(this,t,e,i?i.children:[],s,r),!0}split(t){let e=new By;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){by(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){vy(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=yy(e,this.attrs||{})),i&&(this.attrs=yy({class:i},this.attrs||{}))}domAtPos(t){return my(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(qw(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(xy(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&jw.get(i)instanceof ay;)i=i.lastChild;if(!i||"BR"!=i.nodeName&&0==(null===(e=jw.get(i))||void 0===e?void 0:e.isEditable)&&(!ly.ios||!this.children.some((t=>t instanceof hy)))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof hy))return null;let i=Dw(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return wy(this,t,e)}become(t){return!1}get type(){return ky.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],r=n+s.length;if(r>=e){if(s instanceof By)return s;if(r>e)break}n=r+s.breakAfter}return null}}class Ey extends jw{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof Ey&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Kw.before(this.dom):Kw.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Ey(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Gw}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):f.empty}domBoundsAround(){return null}become(t){return t instanceof Ey&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Ry{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Ey&&t.type==ky.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new By),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Ly(new gy(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Ly(new hy(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s){let r=e-t;if(i instanceof Oy)if(i.block){let{type:t}=i;t!=ky.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new Ey(i.widget||new Vy("div"),r,t))}else{let o=dy.create(i.widget||new Vy("span"),r,i.startSide),l=this.atCursorPos&&!o.isEditable&&s<=n.length&&(t<e||i.startSide>0),h=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(n),l&&(a.append(Ly(new gy(1),n),s),s=n.length+Math.max(0,s-n.length)),a.append(Ly(o,n),s),this.atCursorPos=h,this.pendingBuffer=h?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}filterPoint(t,e,i,n){if(n<this.disallowBlockEffectsBelow&&i instanceof Oy){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,n,s){let r=new Ry(t,e,i,s);return r.openEnd=Ht.spans(n,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function Ly(t,e){for(let i of e)t=new ay(i,[t],t.length);return t}class Vy extends Sy{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const Ny=[],Py=H.define(),Hy=H.define(),Wy=H.define(),Iy=H.define(),Fy=H.define(),zy=H.define(),qy=ft.define({map:(t,e)=>t.map(e)}),Ky=ft.define({map:(t,e)=>t.map(e)});class Gy{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new Gy(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const jy=ft.define({map:(t,e)=>t.map(e)});function _y(t,e,i){let n=t.facet(Iy);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const Uy=H.define({combine:t=>!t.length||t[0]});class $y{constructor(t,e){this.field=t,this.get=e}}class Yy{from(t){return new $y(this,t)}static define(){return new Yy}}Yy.decorations=Yy.define(),Yy.atomicRanges=Yy.define(),Yy.scrollMargins=Yy.define();let Xy=0;const Jy=H.define();class Qy{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Jy.of(this)}static define(t,e){let{eventHandlers:i,provide:n,decorations:s}=e||{},r=[];if(n)for(let t of Array.isArray(n)?n:[n])r.push(t);return i&&r.push(Zy.from((t=>({plugin:t,handlers:i})))),s&&r.push(Yy.decorations.from(s)),new Qy(Xy++,t,r)}static fromClass(t,e){return Qy.define((e=>new t(e)),e)}}const Zy=Yy.define();class tb{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:n}of this.spec.fields)i==t&&e.push(n(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(_y(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){_y(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){_y(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const eb=H.define(),ib=H.define(),nb=H.define(),sb=H.define();class rb{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new rb(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let l=n==t.length?null:t[n],h=r-o,a=l?l.fromB:1e9;for(;s<e.length&&e[s]<a;){let t=e[s],n=e[s+1],r=Math.max(o,t),l=Math.min(a,n);if(r<=l&&new rb(r+h,l+h,r,l).addToSet(i),n>a)break;s+=2}if(!l)return i;new rb(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class ob{constructor(t,e,i=Ny){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=M.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let n=[];this.changes.iterChangedRanges(((t,e,i,s)=>n.push(new rb(t,e,i,s)))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var lb=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(lb||(lb={}));const hb=lb.LTR,ab=lb.RTL;function cb(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const db=cb("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ub=cb("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),fb=Object.create(null),pb=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);fb[e]=i,fb[i]=-e}const gb=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class mb{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?ab:hb}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<e:o.to>e:t[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const vb=[];function wb(t,e){let i=t.length,n=e==hb?1:2,s=e==hb?2:1;if(!t||1==n&&!gb.test(t))return yb(i);for(let e=0,s=n,o=n;e<i;e++){let i=(r=t.charCodeAt(e))<=247?db[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?ub[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),vb[e]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let t=0,e=n,s=n;t<i;t++){let n=vb[t];if(128==n)t<i-1&&e==vb[t+1]&&24&e?n=vb[t]=e:vb[t]=256;else if(64==n){let n=t+1;for(;n<i&&64==vb[n];)n++;let r=t&&8==e||n<i&&8==vb[n]?1==s?1:8:256;for(let e=t;e<n;e++)vb[e]=r;t=n-1}else 8==n&&1==s&&(vb[t]=1);e=n,7&n&&(s=n)}for(let e,r,o,l=0,h=0,a=0;l<i;l++)if(r=fb[e=t.charCodeAt(l)])if(r<0){for(let t=h-3;t>=0;t-=3)if(pb[t+1]==-r){let e=pb[t+2],i=2&e?n:4&e?1&e?s:n:0;i&&(vb[l]=vb[pb[t]]=i),h=t;break}}else{if(189==pb.length)break;pb[h++]=l,pb[h++]=e,pb[h++]=a}else if(2==(o=vb[l])||1==o){let t=o==n;a=t?0:1;for(let e=h-3;e>=0;e-=3){let i=pb[e+2];if(2&i)break;if(t)pb[e+2]|=2;else{if(4&i)break;pb[e+2]|=4}}}for(let t=0;t<i;t++)if(256==vb[t]){let e=t+1;for(;e<i&&256==vb[e];)e++;let s=1==(t?vb[t-1]:n),r=s==(1==(e<i?vb[e]:n))?s?1:2:n;for(let i=t;i<e;i++)vb[i]=r;t=e-1}let o=[];if(1==n)for(let t=0;t<i;){let e=t,n=1!=vb[t++];for(;t<i&&n==(1!=vb[t]);)t++;if(n)for(let i=t;i>e;){let t=i,n=2!=vb[--i];for(;i>e&&n==(2!=vb[i-1]);)i--;o.push(new mb(i,t,n?2:1))}else o.push(new mb(e,t,0))}else for(let t=0;t<i;){let e=t,n=2==vb[t++];for(;t<i&&n==(2==vb[t]);)t++;o.push(new mb(e,t,n?1:2))}return o}function yb(t){return[new mb(0,t,0)]}let bb="";function xb(t,e,i,s,r){var o;let l=s.head-t.from,h=-1;if(0==l){if(!r||!t.length)return null;e[0].level!=i&&(l=e[0].side(!1,i),h=0)}else if(l==t.length){if(r)return null;let t=e[e.length-1];t.level!=i&&(l=t.side(!0,i),h=e.length-1)}h<0&&(h=mb.find(e,l,null!==(o=s.bidiLevel)&&void 0!==o?o:-1,s.assoc));let a=e[h];l==a.side(r,i)&&(a=e[h+=r?1:-1],l=a.side(!r,i));let c=r==(a.dir==i),d=n(t.text,l,c);if(bb=t.text.slice(Math.min(l,d),Math.max(l,d)),d!=a.side(r,i))return L.cursor(d+t.from,c?-1:1,a.level);let u=h==(r?e.length-1:0)?null:e[h+(r?1:-1)];return u||a.level==i?u&&u.level<a.level?L.cursor(u.side(!r,i)+t.from,r?1:-1,u.level):L.cursor(d+t.from,r?-1:1,a.level):L.cursor(r?t.to:t.from,r?-1:1,i)}class Sb{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Mt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let t=n.nextSibling;if(t==e)break;let s=jw.get(n),r=jw.get(t);(s&&r?s.breakAfter:(s?s.breakAfter:kb(n))||kb(t)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(e))&&(r=s.index,o=s[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=jw.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function kb(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Ab{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class Mb extends jw{constructor(t){super(),this.view=t,this.compositionDeco=Ay.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new By],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new rb(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Ay.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=Ob(t);if(!i)return Ay.none;let{from:n,to:s,node:r,text:o}=i,l=e.mapPos(n,1),h=Math.max(l,e.mapPos(s,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new Sb([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),"￿")==c)h=l+c.length;else{if(a.doc.sliceString(Math.max(0,h-c.length),h,"￿")!=c)return Ay.none;l=h-c.length}else if(a.doc.sliceString(l,h,"￿")!=c)return Ay.none;let d=jw.get(r);d instanceof uy?d=d.widget.topView:d&&(d.parent=null);return Ay.set(Ay.replace({widget:new Db(r,o,d)}).range(l,h))}(this.view,t.changes)),(ly.ie||ly.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let n=new Bb;return Ht.compare(t,e,i,n),n.changes}(this.decorations,this.updateDeco(),t.changes);return e=rb.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=ly.chrome||ly.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof Ey&&t.widget instanceof Cb&&n.push(t.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let n=e>=0?t[e]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:l}=n,{content:h,breakAtStart:a,openStart:c,openEnd:d}=Ry.build(this.view.state.doc,o,l,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);$w(this,p,g,u,f,h,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||ly.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if(ly.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(t,s.node.childNodes[s.offset]||null))),s=r=new Kw(t,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&Tw(s.node,s.offset,l.anchorNode,l.anchorOffset)&&Tw(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{ly.android&&ly.chrome&&this.dom.contains(l.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=Mw(this.root);if(n.empty){if(ly.gecko){let t=(e=s.node,i=s.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=Tb(s.node,s.offset,1==t?1:-1);e&&(s=new Kw(e,1==t?0:e.nodeValue.length))}}t.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(t.extend)t.collapse(s.node,s.offset),t.extend(r.node,r.offset);else{let e=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),e.setEnd(r.node,r.offset),e.setStart(s.node,s.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new Kw(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new Kw(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=Mw(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=By.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Uy)?this.root.activeElement==this.dom:Ow(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=jw.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof By)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(t>r||t==r&&s.type!=ky.WidgetBefore&&s.type!=ky.WidgetAfter&&(!n||2==e||this.children[n-1].breakAfter||this.children[n-1].type==ky.WidgetBefore&&e>-2))return s.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,n=this.view.contentDOM.clientWidth,s=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,l=0;l<this.children.length;l++){let h=this.children[l],a=o+h.length;if(a>i)break;if(o>=e){let e=h.dom.getBoundingClientRect();if(t.push(e.height),s){let t=h.dom.lastChild,i=t?Dw(t):[];if(i.length){let t=i[i.length-1],s=this.view.textDirection==lb.LTR?t.right-e.left:e.right-t.left;s>r&&(r=s,this.minWidth=n,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+h.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof By){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=Dw(i.firstChild)[0];t=i.getBoundingClientRect().height,e=n?n.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Uw(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(Ay.replace({widget:new Cb(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!s)break;i=s.to+1}return Ay.set(t)}updateDeco(){let t=this.view.pluginField(Yy.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(nb),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)});let s=0,r=0,o=0,l=0;for(let t of this.view.pluginField(Yy.scrollMargins))if(t){let{left:e,right:i,top:n,bottom:h}=t;null!=e&&(s=Math.max(s,e)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=h&&(l=Math.max(l,h))}let h={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+l};!function(t,e,i,n,s,r,o,l){let h=t.ownerDocument,a=h.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==h.body;if(d)t=Nw(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==s)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let n=e.bottom-e.top,r=t.bottom-t.top;f=("center"==s&&n<=r?e.top+n/2-r/2:"start"==s||"center"==s&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==n?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==n?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==n==l?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,h,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==lb.LTR)}}class Cb extends Sy{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Ob(t){let e=t.observer.selectionRange,i=e.focusNode&&Tb(e.focusNode,e.focusOffset,0);if(!i)return null;let n=t.docView.nearest(i);if(!n)return null;if(n instanceof By){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!jw.get(e);)e=e.previousSibling;let s=e?jw.get(e).posAtEnd:n.posAtStart;return{from:s,to:s,node:t,text:i}}{for(;;){let{parent:t}=n;if(!t)return null;if(t instanceof By)break;n=t}let t=n.posAtStart;return{from:t,to:t+n.length,node:n.dom,text:i}}}class Db extends Sy{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return uy}}function Tb(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=Rw(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class Bb{constructor(){this.changes=[]}compareRange(t,e){Ty(t,e,this.changes)}comparePoint(t,e){Ty(t,e,this.changes)}}function Eb(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Rb(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Lb(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Vb(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Nb(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Pb(t,e,i){let n,s,r,o,l,h,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=Dw(d);for(let u=0;u<t.length;u++){let f=t[u];s&&Lb(s,f)&&(f=Vb(Nb(f,s.bottom),s.top));let p=Eb(e,f),g=Rb(i,f);if(0==p&&0==g)return 3==d.nodeType?Hb(d,e,i):Pb(d,e,i);(!n||o>g||o==g&&r>p)&&(n=d,s=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(l=d,a=f):i<f.top&&(!c||c.top>f.top)&&(h=d,c=f):a&&Lb(a,f)?a=Nb(a,f.bottom):c&&Lb(c,f)&&(c=Vb(c,f.top))}}if(a&&a.bottom>=i?(n=l,s=a):c&&c.top<=i&&(n=h,s=c),!n)return{node:t,offset:0};let d=Math.max(s.left,Math.min(s.right,e));return 3==n.nodeType?Hb(n,d,i):r||"true"!=n.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,n)+(e>=(s.left+s.right)/2?1:0)}:Pb(n,d,i)}function Hb(t,e,i){let n=t.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<n;l++){let n=Fw(t,l,l+1).getClientRects();for(let h=0;h<n.length;h++){let a=n[h];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,n=i;if(ly.chrome||ly.gecko){Fw(t,l).getBoundingClientRect().left==a.right&&(n=!i)}if(c<=0)return{node:t,offset:l+(n?1:0)};s=l+(n?1:0),r=c}}}return{node:t,offset:s>-1?s:o>0?t.nodeValue.length:0}}function Wb(t,{x:e,y:i},n,s=-1){var r;let o,l=t.contentDOM.getBoundingClientRect(),h=l.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-h;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=ky.Text;)for(;c=s>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return n?null:0;i=!0,s=-s}i=h+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:n?null:Ib(t,l,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:Ib(t,l,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(l.left+1,Math.min(l.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),ly.safari&&function(t,e,i){let n;if(3!=t.nodeType||e!=(n=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return Fw(t,n-1,n).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let n=By.find(t.docView,d);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=Pb(n.dom,e,i))}return t.docView.posFromDOM(g,m)}function Ib(t,e,i,n,s){let r=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((s-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+u(o,r,t.state.tabSize)}function Fb(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=t.bidiSpans(s);for(let o=e,l=null;;){let e=xb(s,r,t.textDirection,o,i),h=bb;if(!e){if(s.number==(i?t.state.doc.lines:1))return o;h="\n",s=t.state.doc.line(s.number+(i?1:-1)),r=t.bidiSpans(s),e=L.cursor(i?s.from:s.to)}if(l){if(!l(h))return o}else{if(!n)return e;l=n(h)}o=e}}function zb(t,e,i){let n=t.pluginField(Yy.atomicRanges);for(;;){let t=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=e.from>i.from?L.cursor(n,1):L.cursor(s,-1),t=!0)}));if(!t)return i}}class qb{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in Ub){let i=Ub[e];t.contentDOM.addEventListener(e,(n=>{"keydown"==e&&this.keydown(t,n)||_b(t,n)&&!this.ignoreDuringComposition(n)&&(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),ly.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Zy);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{_b(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(t){_y(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(e){_y(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if(ly.android&&ly.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!ly.ios||!(i=Kb.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,zw(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(ly.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(t,e){let i=9==e.keyCode&&Date.now()<this.lastEscPress+2e3;return 27==e.keyCode?this.lastEscPress=Date.now():Gb.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!ly.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Kb=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Gb=[16,17,18,20,91,92,224,225];class jb{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Mt.allowMultipleSelections)&&function(t,e){let i=t.state.facet(Py);return i.length?i[0](e):ly.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(Hy);return i.length?i[0](e):ly.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=Mw(t.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let t=0;t<s.length;t++){let i=s[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=ox(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function _b(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=jw.get(n))&&i.ignoreEvent(e))return!1;return!0}const Ub=Object.create(null),$b=ly.ie&&ly.ie_version<15||ly.ios&&ly.webkit_version<604;function Yb(t,e){let i,{state:n}=t,s=1,r=n.toText(e),o=r.lines==n.selection.ranges.length;if(null!=hx&&n.selection.ranges.every((t=>t.empty))&&hx==r.toString()){let t=-1;i=n.changeByRange((i=>{let l=n.doc.lineAt(i.from);if(l.from==t)return{range:i};t=l.from;let h=n.toText((o?r.line(s++).text:e)+n.lineBreak);return{changes:{from:l.from,insert:h},range:L.cursor(i.from+h.length)}}))}else i=o?n.changeByRange((t=>{let e=r.line(s++);return{changes:{from:t.from,to:t.to,insert:e.text},range:L.cursor(t.from+e.length)}})):n.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Ub.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select")};let Xb=0;function Jb(t,e,i,s){if(1==s)return L.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),r=t.doc.lineAt(e),o=e-r.from;if(0==r.length)return L.cursor(e);0==o?i=1:o==r.length&&(i=-1);let l=o,h=o;i<0?l=n(r.text,o,!1):h=n(r.text,o);let a=s(r.text.slice(l,h));for(;l>0;){let t=n(r.text,l,!1);if(s(r.text.slice(t,l))!=a)break;l=t}for(;h<r.length;){let t=n(r.text,h);if(s(r.text.slice(h,t))!=a)break;h=t}return L.range(l+r.from,h+r.from)}(t.state,e,i);{let i=By.find(t.docView,e),n=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<t.state.doc.length&&r==n.to&&r++,L.range(s,r)}}Ub.touchstart=(t,e)=>{Xb=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},Ub.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},Ub.mousedown=(t,e)=>{if(t.observer.flush(),Xb>Date.now()-2e3&&1==ox(e))return;let i=null;for(let n of t.state.facet(Wy))if(i=n(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=ex(t,e),n=ox(e),s=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),s=s.map(t.changes),o=null)},get(e,l,h){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=ex(t,e),o=e),!a||!i)return s;let c=Jb(t,a.pos,a.bias,n);if(i.pos!=a.pos&&!l){let e=Jb(t,i.pos,i.bias,n),s=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=s<c.from?L.range(s,r):L.range(r,s)}return l?s.replaceRange(s.main.extend(c.from,c.to)):h?s.addRange(c):L.create([c])}}}(t,e)),i){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore((()=>Iw(t.contentDOM))),t.inputState.startMouseSelection(new jb(t,e,i,n))}};let Qb=(t,e)=>t>=e.top&&t<=e.bottom,Zb=(t,e,i)=>Qb(e,i)&&t>=i.left&&t<=i.right;function tx(t,e,i,n){let s=By.find(t.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&Zb(i,n,o))return-1;let l=s.coordsAt(r,1);return l&&Zb(i,n,l)?1:o&&Qb(n,o)?-1:1}function ex(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:tx(t,i,e.clientX,e.clientY)}}const ix=ly.ie&&ly.ie_version<=11;let nx=null,sx=0,rx=0;function ox(t){if(!ix)return t.detail;let e=nx,i=rx;return nx=t,rx=Date.now(),sx=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(sx+1)%3:1}function lx(t,e,i,n){if(!i)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:i},h=t.state.changes(o?[o,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}Ub.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},Ub.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&lx(t,e,n.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(n[t]=e.result),r()},e.readAsText(i[t])}}else lx(t,e,e.dataTransfer.getData("Text"),!0)},Ub.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=$b?null:e.clipboardData;i?(Yb(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),Yb(t,i.value)}),50)}(t)};let hx=null;function ax(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}Ub.copy=Ub.cut=(t,e)=>{let{text:i,ranges:n,linewise:s}=function(t){let e=[],i=[],n=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let s=-1;for(let{from:n}of t.selection.ranges){let r=t.doc.lineAt(n);r.number>s&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),s=r.number}n=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:n}}(t.state);if(!i&&!s)return;hx=s?i:null;let r=$b?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout((()=>{n.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},Ub.focus=Ub.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},Ub.beforeprint=t=>{t.viewState.printing=!0,t.requestMeasure(),setTimeout((()=>{t.viewState.printing=!1,t.requestMeasure()}),2e3)},Ub.compositionstart=Ub.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),ax(t,!0)))},Ub.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&ax(t,!1)}),50)},Ub.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},Ub.beforeinput=(t,e)=>{var i;let n;if(ly.chrome&&ly.android&&(n=Kb.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const cx=["pre-wrap","normal","pre-line","break-spaces"];class dx{constructor(){this.doc=f.empty,this.lineWrapping=!1,this.direction=lb.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return cx.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(e=!0,this.heightSamples[Math.floor(10*n)]=!0)}return e}refresh(t,e,i,n,s,r){let o=cx.indexOf(t)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=n,this.lineLength=s,l){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return l}}class ux{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class fx{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new fx(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new fx(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var px=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(px||(px={}));class gx{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return gx.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:h,toB:a}=n[r],c=s.lineAt(o,px.ByPosNoHeight,e,0,0),d=c.to>=l?c:s.lineAt(l,px.ByPosNoHeight,e,0,0);for(a+=d.to-l,l=d.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,h=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,px.ByPosNoHeight,e,0,0));h+=c.from-o,o=c.from;let u=xx.build(i,t,h,a);s=s.replace(o,l,u)}return s.updateHeight(i,0)}static empty(){return new vx(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>2*s){let s=t[e-1];s.break?t.splice(--e,1,s.left,null,s.right):t.splice(--e,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,s-=e.size}}else if(n<s){let i=t[e++];i&&(n+=i.size)}else{let e=t[--i];e&&(s+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new yx(gx.of(t.slice(0,e)),r,gx.of(t.slice(i)))}}gx.prototype.size=1;class mx extends gx{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new fx(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,r){r(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class vx extends mx{constructor(t,e){super(t,e,ky.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return 1==i.length&&(n instanceof vx||n instanceof wx&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof wx?n=new vx(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):gx.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class wx extends gx{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(e,n),l=Math.max(0,Math.min(r-s,Math.floor((t-i)/o))),{from:h,length:a}=e.line(s+l);return new fx(h,a,i+o*l,o,ky.Text)}lineAt(t,e,i,n,s){if(e==px.ByHeight)return this.blockAt(t,i,n,s);if(e==px.ByPosNoHeight){let{from:e,to:n}=i.lineAt(t);return new fx(e,n-e,0,0,ky.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:l,length:h,number:a}=i.lineAt(t);return new fx(l,h,n+o*(a-r),o,ky.Text)}forEachLine(t,e,i,n,s,r){let{firstLine:o,lineHeight:l}=this.lines(i,s);for(let h=Math.max(t,s),a=Math.min(s+this.length,e);h<=a;){let e=i.lineAt(h);h==t&&(n+=l*(e.number-o)),r(new fx(e.from,e.length,n,l,ky.Text)),n+=l,h=e.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let t=i[i.length-1];t instanceof wx?i[i.length-1]=new wx(t.length+n):i.push(null,new wx(n-1))}if(t>0){let e=i[0];e instanceof wx?i[0]=new wx(t+e.length):i.unshift(new wx(t-1),null)}return gx.of(i)}decomposeLeft(t,e){e.push(new wx(t-1),null)}decomposeRight(t,e){e.push(null,new wx(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let i=[],r=Math.max(e,n.from),o=-1,l=t.heightChanged;for(n.from>e&&i.push(new wx(n.from-e-1).updateHeight(t,e));r<=s&&n.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let l=new vx(e,s);l.outdated=!1,i.push(l),r+=e+1}r<=s&&i.push(null,new wx(s-r).updateHeight(t,r));let h=gx.of(i);return t.heightChanged=l||o<0||Math.abs(h.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,h}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class yx extends gx{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,l=e==px.ByHeight?t<r:t<o,h=l?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,r,o);if(this.break||(l?h.to<o:h.from>o))return h;let a=e==px.ByPosNoHeight?px.ByPosNoHeight:px.ByPos;return l?h.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,n,s).join(h)}forEachLine(t,e,i,n,s,r){let o=n+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,n,s,r),e>=l&&this.right.forEachLine(t,e,i,o,l,r);else{let h=this.lineAt(l,px.ByPos,i,n,s);t<h.from&&this.left.forEachLine(t,h.from-1,i,n,s,r),h.to>=t&&h.from<=e&&r(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,o,l,r)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let r=s.length;for(let t of i)s.push(t);if(t>0&&bx(s,r-1),e<this.length){let t=s.length;this.decomposeRight(e,s),bx(s,t)}return gx.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?gx.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:r}=this,o=e+s.length+this.break,l=null;return n&&n.from<=e+s.length&&n.more?l=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=o+r.length&&n.more?l=r=r.updateHeight(t,o,i,n):r.updateHeight(t,o,i),l?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function bx(t,e){let i,n;null==t[e]&&(i=t[e-1])instanceof wx&&(n=t[e+1])instanceof wx&&t.splice(e-1,3,new wx(i.length+1+n.length))}class xx{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof vx?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new vx(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new mx(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new vx(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new wx(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof vx)return t;let e=new vx(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=ky.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=ky.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof vx||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new vx(0,-1));let i=t;for(let t of this.nodes)t instanceof vx&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,n){let s=new xx(i,t);return Ht.spans(e,i,n,s,0),s.finish(i)}}class Sx{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&Ty(t,e,this.changes,5)}}class kx{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return Ay.replace({widget:new Ax(this.size,t)}).range(this.from,this.to)}}class Ax extends Sy{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class Mx{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new dx,this.scaler=Rx,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=gx.empty().applyChanges(t.facet(nb),f.empty,this.heightOracle.setDoc(t.doc),[new rb(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Ay.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>n>=t&&n<=e))){let{from:e,to:i}=this.lineBlockAt(n);t.push(new Cx(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?Rx:new Lx(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:Vx(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let n=this.state.facet(nb),s=t.changedRanges,r=rb.extendWithRanges(s,function(t,e,i){let n=new Sx;return Ht.compare(t,e,i,n,0),n.changes}(t.startState.facet(nb),n,t?t.changes:M.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace,r="rtl"==i.direction?lb.RTL:lb.LTR,o=this.heightOracle.mustRefreshForStyle(s,r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,n=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==n||(h|=8,this.paddingTop=t,this.paddingBottom=n)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:function(t,e){let i=t.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=l;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();n=Math.max(n,e.left),s=Math.min(s,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let e=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(e)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:l}=t.docView.measureTextSize();o=n.refresh(s,r,i,l,p/l,e),o&&(t.docView.minWidth=0,h|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),n.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(n,0,o,new ux(this.viewport.from,e)),n.heightChanged&&(h|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&h||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new Cx(n.lineAt(r-1e3*i,px.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),px.ByHeight,s,0,0).to);if(e){let{head:t}=e.range;if(t<l.from||t>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(t,px.ByPos,s,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<l.from?o.top:o.bottom-r,l=new Cx(n.lineAt(i-500,px.ByHeight,s,0,0).from,n.lineAt(i+r+500,px.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new Cx(this.heightMap.lineAt(i,px.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,px.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,px.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,px.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||n<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new kx(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=lb.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=Ox(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=Dx(r,(this.visibleTop-i.top-t)/i.height),s=Dx(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;n=Dx(r,(this.pixelViewport.left-e)/t),s=Dx(r,(this.pixelViewport.right+e)/t)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&Bx(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&Bx(o,l.to-10,l.to+10);for(let{from:n,to:s}of o)s-n>1e3&&e.push(Ex(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-n)<1e3&&Math.abs(t.to-s)<1e3))||new kx(n,s,this.gapSize(i,n,s,r)))}return e}gapSize(t,e,i,n){let s=Tx(n,i)-Tx(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){kx.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Ay.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(nb);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Ht.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||Vx(this.heightMap.lineAt(t,px.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Vx(this.heightMap.lineAt(this.scaler.fromDOM(t),px.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Vx(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Cx{constructor(t,e){this.from=t,this.to=e}}function Ox(t,e,i){let n=[],s=t,r=0;return Ht.spans(i.facet(nb),t,e,{span(){},point(t,e){t>s&&(n.push({from:s,to:t}),r+=t-s),s=e}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function Dx({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:s}=e[t],r=s-i;if(n<=r)return i+n;n-=r}}function Tx(t,e){let i=0;for(let{from:n,to:s}of t.ranges){if(e<=s){i+=e-n;break}i+=s-n}return i/t.total}function Bx(t,e,i){for(let n=0;n<t.length;n++){let s=t[n];if(s.from<i&&s.to>e){let r=[];s.from<e&&r.push({from:s.from,to:e}),s.to>i&&r.push({from:i,to:s.to}),t.splice(n,1,...r),n+=r.length-1}}}function Ex(t,e){for(let i of t)if(e(i))return i}const Rx={toDOM:t=>t,fromDOM:t=>t,scale:1};class Lx{constructor(t,e,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=e.lineAt(i,px.ByPos,t,0,0).top,o=e.lineAt(s,px.ByPos,t,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(e.height-n);for(let t of this.viewports)t.domTop=r+(t.top-s)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),s=t.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function Vx(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new fx(t.from,t.length,i,n-i,Array.isArray(t.type)?t.type.map((t=>Vx(t,e))):t.type)}const Nx=H.define({combine:t=>t.join(" ")}),Px=H.define({combine:t=>t.indexOf(!0)>-1}),Hx=Bt.newName(),Wx=Bt.newName(),Ix=Bt.newName(),Fx={"&light":"."+Wx,"&dark":"."+Ix};function zx(t,e,i){return new Bt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const qx=zx("."+Hx,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Fx),Kx={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Gx=ly.ie&&ly.ie_version<=11;class jx{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Pw,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(ly.ie&&ly.ie_version<=11||ly.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),Gx&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(Uy)?e.root.activeElement!=this.dom:!Ow(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((ly.ie&&ly.ie_version<=11||ly.android&&ly.chrome)&&!e.state.selection.main.empty&&i.focusNode&&Tw(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=Mw(t),i=ly.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let n=e.startContainer,s=e.startOffset,r=e.endContainer,o=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);Tw(l.node,l.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Kx),Gx&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Gx&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;zw(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let t=this.readMutation(s);t&&(t.typeOver&&(n=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&Ow(this.dom,this.selectionRange);if(e<0&&!s)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,n),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=_x(e,t.previousSibling||t.target.previousSibling,-1),n=_x(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function _x(t,e,i){for(;e;){let n=jw.get(e);if(n&&n.parent==t)return n;let s=e.parentNode;e=s!=t.dom?s:i>0?e.nextSibling:e.previousSibling}return null}function Ux(t,e,i,n){let s,r,o=t.state.selection.main;if(e>-1){let n=t.docView.domBoundsAround(e,i,0);if(!n||t.state.readOnly)return;let{from:l,to:h}=n,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new Ab(i,n)),s==i&&r==n||e.push(new Ab(s,r)));return e}(t),c=new Sb(a,t.state);c.readRange(n.startDOM,n.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||ly.android&&c.text.length<h-l)&&(d=o.to,u="end");let p=function(t,e,i,n){let s=Math.min(t.length,e.length),r=0;for(;r<s&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&t.length==e.length)return null;let o=t.length,l=e.length;for(;o>0&&l>0&&t.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(t.state.doc.sliceString(l,h,"￿"),c.text,d-l,u);p&&(ly.chrome&&13==t.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==c.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:f.of(c.text.slice(p.from,p.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,n=2==t.length?t[1].pos:i;return i>-1&&n>-1?L.single(i+e,n+e):null}(a,l)}else if(t.hasFocus||!t.state.facet(Uy)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=t.docView,s=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!Cw(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),l=n&&n.node==e.anchorNode&&n.offset==e.anchorOffset||!Cw(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);s==o.head&&l==o.anchor||(r=L.single(l,s))}if(s||r)if(!s&&n&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,s.from).append(s.insert).append(t.state.doc.slice(s.to,o.to))}),s){let e=t.state;if(ly.ios&&t.inputState.flushIOSKey(t))return;if(ly.android&&(s.from==o.from&&s.to==o.to&&1==s.insert.length&&2==s.insert.lines&&zw(t.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&0==s.insert.length&&zw(t.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&0==s.insert.length&&zw(t.contentDOM,"Delete",46)))return;let i,n=s.insert.toString();if(t.state.facet(zy).some((e=>e(t,s.from,s.to,n))))return;if(t.inputState.composing>=0&&t.inputState.composing++,s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&t.inputState.composing<0){let n=o.from<s.from?e.sliceDoc(o.from,s.from):"",r=o.to>s.to?e.sliceDoc(s.to,o.to):"";i=e.replaceSelection(t.state.toText(n+s.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let n=e.changes(s),l=r&&!e.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let r=t.state.sliceDoc(s.from,s.to),h=Ob(t)||t.state.doc.lineAt(o.head),a=o.to-s.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:n,range:l||i.map(n)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let f=e.changes({from:u,to:d,insert:s.insert}),p=i.to-o.to;return{changes:f,range:l?L.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}}))}else i={changes:n,selection:l&&e.selection.replaceRange(l)}}let l="input.type";t.composing&&(l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:l})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class $x{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new Mx(t.state||Mt.create()),this.plugins=this.state.facet(Jy).map((t=>new tb(t)));for(let t of this.plugins)t.update(this);this.observer=new jx(this,((t,e,i)=>{Ux(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new qb(this),this.docView=new Mb(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);if(n.facet(Mt.phrases)!=this.state.facet(Mt.phrases))return this.setState(n);e=new ob(this,n,t);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(s&&(s=s.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;s=new Gy(t.empty?t:L.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(qy)?s=new Gy(t.value):t.is(Ky)?s=new Gy(t.value,"center"):t.is(jy)&&(s=t.value)}this.viewState.update(e,s),this.bidiCache=Qx.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(sb)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(Nx)!=e.state.facet(Nx)&&(this.viewState.mustMeasureContent=!0),(i||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(Fy))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new Mx(t),this.plugins=t.facet(Jy).map((t=>new tb(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new Mb(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Jy),i=t.state.facet(Jy);if(e!=i){let n=[];for(let s of i){let i=e.indexOf(s);if(i<0)n.push(new tb(s));else{let e=this.plugins[i];e.mustUpdate=t,n.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((t=>{try{return t.read(this)}catch(t){return _y(this.state,t),Jx}})),o=new ob(this,this.state),l=!1,h=!1;o.flags|=n,e?e.flags|=n:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),l=this.docView.update(o));for(let t=0;t<s.length;t++)if(r[t]!=Jx)try{let e=s[t];e.write&&e.write(r[t],this)}catch(t){_y(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),l&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(Fy))t(e)}get themeClasses(){return Hx+" "+(this.state.facet(Px)?Ix:Wx)+" "+this.state.facet(Nx)}updateAttrs(){let t=Zx(this,eb,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Uy)?"true":"false",class:"cm-content",style:`${ly.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Zx(this,ib,e),this.observer.ignore((()=>{xy(this.contentDOM,this.contentAttrs,e),xy(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is($x.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(sb),Bt.mount(this.root,this.styleModules.concat(qx).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=Xx(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=Xx(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=Xx(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return zb(this,t,Fb(this,t,e,i))}moveByGroup(t,e){return zb(this,t,Fb(this,t,e,(e=>function(t,e,i){let n=t.state.charCategorizer(e),s=n(i);return t=>{let e=n(t);return s==xt.Space&&(s=e),s==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=n&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),n=t.posAtCoords({x:i==(t.textDirection==lb.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=n)return L.cursor(n,i?-1:1)}let o=By.find(t.docView,e.head),l=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return L.cursor(l,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return zb(this,t,function(t,e,i,n){let s=e.head,r=i?1:-1;if(s==(i?t.state.doc.length:0))return L.cursor(s,e.assoc);let o,l=e.goalColumn,h=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(s),c=t.documentTop;if(a)null==l&&(l=a.left-h.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(s-c);null==l&&(l=Math.min(h.right-h.left,t.defaultCharacterWidth*(s-e.from))),o=(r<0?e.top:e.bottom)+c}let d=h.left+l,u=null!=n?n:t.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(u+i)*r,a=Wb(t,{x:d,y:n},!1,r);if(n<h.top||n>h.bottom||(r<0?a<s:a>s))return L.cursor(a,e.assoc,void 0,l)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:qy.of(L.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Wb(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n);return Vw(i,s[mb.find(s,t-n.from,-1,e)].dir==lb.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Yx)return yb(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=wb(t.text,this.textDirection);return this.bidiCache.push(new Qx(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||ly.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{Iw(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return jy.of(new Gy("number"==typeof t?L.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Qy.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Bt.newName(),n=[Nx.of(i),sb.of(zx(`.${i}`,t))];return e&&e.dark&&n.push(Px.of(!0)),n}static baseTheme(t){return X.lowest(sb.of(zx("."+Hx,t,Fx)))}}$x.scrollTo=qy,$x.centerOn=Ky,$x.styleModule=sb,$x.inputHandler=zy,$x.exceptionSink=Iy,$x.updateListener=Fy,$x.editable=Uy,$x.mouseSelectionStyle=Wy,$x.dragMovesSelection=Hy,$x.clickAddsSelectionRange=Py,$x.decorations=nb,$x.darkTheme=Px,$x.contentAttributes=ib,$x.editorAttributes=eb,$x.lineWrapping=$x.contentAttributes.of({class:"cm-lineWrapping"}),$x.announce=ft.define();const Yx=4096;function Xx(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const Jx={};class Qx{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:lb.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let r=t[s];r.dir!=n||e.touchesRange(r.from,r.to)||i.push(new Qx(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function Zx(t,e,i){for(let n=t.state.facet(e),s=n.length-1;s>=0;s--){let e=n[s],r="function"==typeof e?e(t):e;r&&yy(r,i)}return i}const tS=!ly.ios;const eS={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};tS&&(eS[".cm-line"].caretColor="transparent !important");const iS=qh.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),nS=H.define({combine:t=>Ct(t,{afterCursor:!0,brackets:"()[]{}",maxScanDistance:1e4})}),sS=wo.mark({class:"cm-matchingBracket"}),rS=wo.mark({class:"cm-nonmatchingBracket"}),oS=[K.define({create:()=>wo.none,update(t,e){if(!e.docChanged&&!e.selection)return t;let i=[],n=e.state.facet(nS);for(let t of e.state.selection.ranges){if(!t.empty)continue;let s=aS(e.state,t.head,-1,n)||t.head>0&&aS(e.state,t.head-1,1,n)||n.afterCursor&&(aS(e.state,t.head,1,n)||t.head<e.state.doc.length&&aS(e.state,t.head+1,-1,n));if(!s)continue;let r=s.matched?sS:rS;i.push(r.range(s.start.from,s.start.to)),s.end&&i.push(r.range(s.end.from,s.end.to))}return wo.set(i,!0)},provide:t=>qh.decorations.from(t)}),iS];function lS(t={}){return[nS.of(t),oS]}function hS(t,e,i){let n=t.prop(e<0?lf.openedBy:lf.closedBy);if(n)return n;if(1==t.name.length){let n=i.indexOf(t.name);if(n>-1&&n%2==(e<0?1:0))return[i[n+e]]}return null}function aS(t,e,i,n={}){let s=n.maxScanDistance||1e4,r=n.brackets||"()[]{}",o=Lf(t),l=o.resolveInner(e,i);for(let n=l;n;n=n.parent){let s=hS(n.type,i,r);if(s&&n.from<n.to)return cS(t,e,i,n,s,r)}return function(t,e,i,n,s,r,o){let l=i<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),h=o.indexOf(l);if(h<0||h%2==0!=i>0)return null;let a={from:i<0?e-1:e,to:i>0?e+1:e},c=t.doc.iterRange(e,i>0?t.doc.length:0),d=0;for(let t=0;!c.next().done&&t<=r;){let r=c.value;i<0&&(t+=r.length);let l=e+t*i;for(let t=i>0?0:r.length-1,e=i>0?r.length:-1;t!=e;t+=i){let e=o.indexOf(r[t]);if(!(e<0||n.resolve(l+t,1).type!=s))if(e%2==0==i>0)d++;else{if(1==d)return{start:a,end:{from:l+t,to:l+t+1},matched:e>>1==h>>1};d--}}i>0&&(t+=r.length)}return c.done?{start:a,matched:!1}:null}(t,e,i,o,l.type,s,r)}function cS(t,e,i,n,s,r){let o=n.parent,l={from:n.from,to:n.to},h=0,a=null==o?void 0:o.cursor;if(a&&(i<0?a.childBefore(n.from):a.childAfter(n.to)))do{if(i<0?a.to<=n.from:a.from>=n.to){if(0==h&&s.indexOf(a.type.name)>-1&&a.from<a.to)return{start:l,end:{from:a.from,to:a.to},matched:!0};if(hS(a.type,i,r))h++;else if(hS(a.type,-i,r)&&(h--,0==h))return{start:l,end:a.from==a.to?void 0:{from:a.from,to:a.to},matched:!1}}}while(i<0?a.prevSibling():a.nextSibling());return{start:l,matched:!1}}function dS(t,e){return L.create(t.ranges.map(e),t.mainIndex)}function uS(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function fS({state:t,dispatch:e},i){let n=dS(t.selection,i);return!n.eq(t.selection)&&(e(uS(t,n)),!0)}function pS(t,e){return L.cursor(e?t.to:t.from)}function gS(t,e){return fS(t,(i=>i.empty?t.moveByChar(i,e):pS(i,e)))}const mS=t=>gS(t,t.textDirection!=lb.LTR),vS=t=>gS(t,t.textDirection==lb.LTR);function wS(t,e){return fS(t,(i=>i.empty?t.moveByGroup(i,e):pS(i,e)))}function yS(t,e,i){if(e.type.prop(i))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function bS(t,e,i){let n,s,r=Lf(t).resolveInner(e.head),o=i?lf.closedBy:lf.openedBy;for(let n=e.head;;){let e=i?r.childAfter(n):r.childBefore(n);if(!e)break;yS(t,e,o)?r=e:n=i?e.to:e.from}return s=r.type.prop(o)&&(n=i?aS(t,r.from,1):aS(t,r.to,-1))&&n.matched?i?n.end.to:n.end.from:i?r.to:r.from,L.cursor(s,i?-1:1)}function xS(t,e){return fS(t,(i=>{if(!i.empty)return pS(i,e);let n=t.moveVertically(i,e);return n.head!=i.head?n:t.moveToLineBoundary(i,e)}))}const SS=t=>xS(t,!1),kS=t=>xS(t,!0);function AS(t,e){let{state:i}=t,n=dS(i.selection,(i=>i.empty?t.moveVertically(i,e,t.dom.clientHeight):pS(i,e)));if(n.eq(i.selection))return!1;let s=t.coordsAtPos(i.selection.main.head),r=t.scrollDOM.getBoundingClientRect();return t.dispatch(uS(i,n),{effects:s&&s.top>r.top&&s.bottom<r.bottom?$x.scrollIntoView(n.main.head,{y:"start",yMargin:s.top-r.top}):void 0}),!0}const MS=t=>AS(t,!1),CS=t=>AS(t,!0);function OS(t,e,i){let n=t.lineBlockAt(e.head),s=t.moveToLineBoundary(e,i);if(s.head==e.head&&s.head!=(i?n.to:n.from)&&(s=t.moveToLineBoundary(e,i,!1)),!i&&s.head==n.from&&n.length){let i=/^\s*/.exec(t.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;i&&e.head!=n.from+i&&(s=L.cursor(n.from+i))}return s}const DS=t=>fS(t,(e=>OS(t,e,!0))),TS=t=>fS(t,(e=>OS(t,e,!1)));function BS(t,e,i){let n=!1,s=dS(t.selection,(e=>{let s=aS(t,e.head,-1)||aS(t,e.head,1)||e.head>0&&aS(t,e.head-1,1)||e.head<t.doc.length&&aS(t,e.head+1,-1);if(!s||!s.end)return e;n=!0;let r=s.start.from==e.head?s.end.to:s.end.from;return i?L.range(e.anchor,r):L.cursor(r)}));return!!n&&(e(uS(t,s)),!0)}function ES(t,e){let i=dS(t.state.selection,(t=>{let i=e(t);return L.range(t.anchor,i.head,i.goalColumn)}));return!i.eq(t.state.selection)&&(t.dispatch(uS(t.state,i)),!0)}function RS(t,e){return ES(t,(i=>t.moveByChar(i,e)))}const LS=t=>RS(t,t.textDirection!=lb.LTR),VS=t=>RS(t,t.textDirection==lb.LTR);function NS(t,e){return ES(t,(i=>t.moveByGroup(i,e)))}function PS(t,e){return ES(t,(i=>t.moveVertically(i,e)))}const HS=t=>PS(t,!1),WS=t=>PS(t,!0);function IS(t,e){return ES(t,(i=>t.moveVertically(i,e,t.dom.clientHeight)))}const FS=t=>IS(t,!1),zS=t=>IS(t,!0),qS=t=>ES(t,(e=>OS(t,e,!0))),KS=t=>ES(t,(e=>OS(t,e,!1))),GS=({state:t,dispatch:e})=>(e(uS(t,{anchor:0})),!0),jS=({state:t,dispatch:e})=>(e(uS(t,{anchor:t.doc.length})),!0),_S=({state:t,dispatch:e})=>(e(uS(t,{anchor:t.selection.main.anchor,head:0})),!0),US=({state:t,dispatch:e})=>(e(uS(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0);function $S({state:t,dispatch:e},i){if(t.readOnly)return!1;let n="delete.selection",s=t.changeByRange((t=>{let{from:e,to:s}=t;if(e==s){let t=i(e);t<e?n="delete.backward":t>e&&(n="delete.forward"),e=Math.min(e,t),s=Math.max(s,t)}return e==s?{range:t}:{changes:{from:e,to:s},range:L.cursor(e)}}));return!s.changes.empty&&(e(t.update(s,{scrollIntoView:!0,userEvent:n})),!0)}function YS(t,e,i){if(t instanceof $x)for(let n of t.pluginField(Yy.atomicRanges))n.between(e,e,((t,n)=>{t<e&&n>e&&(e=i?n:t)}));return e}const XS=(t,e)=>$S(t,(i=>{let s,r,{state:o}=t,l=o.doc.lineAt(i);if(!e&&i>l.from&&i<l.from+200&&!/[^ \t]/.test(s=l.text.slice(0,i-l.from))){if("\t"==s[s.length-1])return i-1;let t=d(s,o.tabSize)%Gf(o)||Gf(o);for(let e=0;e<t&&" "==s[s.length-1-e];e++)i--;r=i}else r=n(l.text,i-l.from,e,e)+l.from,r==i&&l.number!=(e?o.doc.lines:1)&&(r+=e?1:-1);return YS(t,r,e)})),JS=t=>XS(t,!1),QS=t=>XS(t,!0),ZS=(t,e)=>$S(t,(i=>{let s=i,{state:r}=t,o=r.doc.lineAt(s),l=r.charCategorizer(s);for(let t=null;;){if(s==(e?o.to:o.from)){s==i&&o.number!=(e?r.doc.lines:1)&&(s+=e?1:-1);break}let h=n(o.text,s-o.from,e)+o.from,a=o.text.slice(Math.min(s,h)-o.from,Math.max(s,h)-o.from),c=l(a);if(null!=t&&c!=t)break;" "==a&&s==i||(t=c),s=h}return YS(t,s,e)})),tk=t=>ZS(t,!1),ek=t=>$S(t,(e=>{let i=t.lineBlockAt(e).to;return YS(t,e<i?i:Math.min(t.state.doc.length,e+1),!0)}));function ik(t){let e=[],i=-1;for(let n of t.selection.ranges){let s=t.doc.lineAt(n.from),r=t.doc.lineAt(n.to);if(n.empty||n.to!=r.from||(r=t.doc.lineAt(n.to-1)),i>=s.number){let t=e[e.length-1];t.to=r.to,t.ranges.push(n)}else e.push({from:s.from,to:r.to,ranges:[n]});i=r.number+1}return e}function nk(t,e,i){if(t.readOnly)return!1;let n=[],s=[];for(let e of ik(t)){if(i?e.to==t.doc.length:0==e.from)continue;let r=t.doc.lineAt(i?e.to+1:e.from-1),o=r.length+1;if(i){n.push({from:e.to,to:r.to},{from:e.from,insert:r.text+t.lineBreak});for(let i of e.ranges)s.push(L.range(Math.min(t.doc.length,i.anchor+o),Math.min(t.doc.length,i.head+o)))}else{n.push({from:r.from,to:e.from},{from:e.to,insert:t.lineBreak+r.text});for(let t of e.ranges)s.push(L.range(t.anchor-o,t.head-o))}}return!!n.length&&(e(t.update({changes:n,scrollIntoView:!0,selection:L.create(s,t.selection.mainIndex),userEvent:"move.line"})),!0)}function sk(t,e,i){if(t.readOnly)return!1;let n=[];for(let e of ik(t))i?n.push({from:e.from,insert:t.doc.slice(e.from,e.to)+t.lineBreak}):n.push({from:e.to,insert:t.lineBreak+t.doc.slice(e.from,e.to)});return e(t.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const rk=ok(!1);function ok(t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let n=e.changeByRange((i=>{let{from:n,to:s}=i,r=e.doc.lineAt(n),o=!t&&n==s&&function(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let i,n=Lf(t).resolveInner(e),s=n.childBefore(e),r=n.childAfter(e);return s&&r&&s.to<=e&&r.from>=e&&(i=s.type.prop(lf.closedBy))&&i.indexOf(r.name)>-1&&t.doc.lineAt(s.to).from==t.doc.lineAt(r.from).from?{from:s.to,to:r.from}:null}(e,n);t&&(n=s=(s<=r.to?r:e.doc.lineAt(s)).to);let l=new Uf(e,{simulateBreak:n,simulateDoubleBreak:!!o}),h=_f(l,n);for(null==h&&(h=/^\s*/.exec(e.doc.lineAt(n).text)[0].length);s<r.to&&/\s/.test(r.text[s-r.from]);)s++;o?({from:n,to:s}=o):n>r.from&&n<r.from+100&&!/\S/.test(r.text.slice(0,n))&&(n=r.from);let a=["",jf(e,h)];return o&&a.push(jf(e,l.lineIndent(r.from,-1))),{changes:{from:n,to:s,insert:f.of(a)},range:L.cursor(n+1+a[1].length)}}));return i(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function lk(t,e){let i=-1;return t.changeByRange((n=>{let s=[];for(let r=n.from;r<=n.to;){let o=t.doc.lineAt(r);o.number>i&&(n.empty||n.to>o.from)&&(e(o,s,n),i=o.number),r=o.to+1}let r=t.changes(s);return{changes:s,range:L.range(r.mapPos(n.anchor,1),r.mapPos(n.head,1))}}))}const hk=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=Object.create(null),n=new Uf(t,{overrideIndentation:t=>{let e=i[t];return null==e?-1:e}}),s=lk(t,((e,s,r)=>{let o=_f(n,e.from);if(null==o)return;/\S/.test(e.text)||(o=0);let l=/^\s*/.exec(e.text)[0],h=jf(t,o);(l!=h||r.from<e.from+l.length)&&(i[e.from]=o,s.push({from:e.from,to:e.from+l.length,insert:h}))}));return s.changes.empty||e(t.update(s,{userEvent:"indent"})),!0},ak=({state:t,dispatch:e})=>!t.readOnly&&(e(t.update(lk(t,((e,i)=>{i.push({from:e.from,insert:t.facet(Kf)})})),{userEvent:"input.indent"})),!0),ck=({state:t,dispatch:e})=>!t.readOnly&&(e(t.update(lk(t,((e,i)=>{let n=/^\s*/.exec(e.text)[0];if(!n)return;let s=d(n,t.tabSize),r=0,o=jf(t,Math.max(0,s-Gf(t)));for(;r<n.length&&r<o.length&&n.charCodeAt(r)==o.charCodeAt(r);)r++;i.push({from:e.from+r,to:e.from+n.length,insert:o.slice(r)})})),{userEvent:"delete.dedent"})),!0),dk=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:t=>fS(t,(e=>bS(t.state,e,t.textDirection!=lb.LTR))),shift:t=>ES(t,(e=>bS(t.state,e,t.textDirection!=lb.LTR)))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:t=>fS(t,(e=>bS(t.state,e,t.textDirection==lb.LTR))),shift:t=>ES(t,(e=>bS(t.state,e,t.textDirection==lb.LTR)))},{key:"Alt-ArrowUp",run:({state:t,dispatch:e})=>nk(t,e,!1)},{key:"Shift-Alt-ArrowUp",run:({state:t,dispatch:e})=>sk(t,e,!1)},{key:"Alt-ArrowDown",run:({state:t,dispatch:e})=>nk(t,e,!0)},{key:"Shift-Alt-ArrowDown",run:({state:t,dispatch:e})=>sk(t,e,!0)},{key:"Escape",run:({state:t,dispatch:e})=>{let i=t.selection,n=null;return i.ranges.length>1?n=L.create([i.main]):i.main.empty||(n=L.create([L.cursor(i.main.head)])),!!n&&(e(uS(t,n)),!0)}},{key:"Mod-Enter",run:ok(!0)},{key:"Alt-l",mac:"Ctrl-l",run:({state:t,dispatch:e})=>{let i=ik(t).map((({from:e,to:i})=>L.range(e,Math.min(i+1,t.doc.length))));return e(t.update({selection:L.create(i),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:t,dispatch:e})=>{let i=dS(t.selection,(e=>{var i;let n=Lf(t).resolveInner(e.head,1);for(;!(n.from<e.from&&n.to>=e.to||n.to>e.to&&n.from<=e.from)&&(null===(i=n.parent)||void 0===i?void 0:i.parent);)n=n.parent;return L.range(n.to,n.from)}));return e(uS(t,i)),!0},preventDefault:!0},{key:"Mod-[",run:ck},{key:"Mod-]",run:ak},{key:"Mod-Alt-\\",run:hk},{key:"Shift-Mod-k",run:t=>{if(t.state.readOnly)return!1;let{state:e}=t,i=e.changes(ik(e).map((({from:t,to:i})=>(t>0?t--:i<e.doc.length&&i++,{from:t,to:i})))),n=dS(e.selection,(e=>t.moveVertically(e,!0))).map(i);return t.dispatch({changes:i,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:t,dispatch:e})=>BS(t,e,!1)}].concat([{key:"ArrowLeft",run:mS,shift:LS,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:t=>wS(t,t.textDirection!=lb.LTR),shift:t=>NS(t,t.textDirection!=lb.LTR)},{mac:"Cmd-ArrowLeft",run:TS,shift:KS},{key:"ArrowRight",run:vS,shift:VS,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:t=>wS(t,t.textDirection==lb.LTR),shift:t=>NS(t,t.textDirection==lb.LTR)},{mac:"Cmd-ArrowRight",run:DS,shift:qS},{key:"ArrowUp",run:SS,shift:HS,preventDefault:!0},{mac:"Cmd-ArrowUp",run:GS,shift:_S},{mac:"Ctrl-ArrowUp",run:MS,shift:FS},{key:"ArrowDown",run:kS,shift:WS,preventDefault:!0},{mac:"Cmd-ArrowDown",run:jS,shift:US},{mac:"Ctrl-ArrowDown",run:CS,shift:zS},{key:"PageUp",run:MS,shift:FS},{key:"PageDown",run:CS,shift:zS},{key:"Home",run:TS,shift:KS},{key:"Mod-Home",run:GS,shift:_S},{key:"End",run:DS,shift:qS},{key:"Mod-End",run:jS,shift:US},{key:"Enter",run:rk},{key:"Mod-a",run:({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:JS,shift:JS},{key:"Delete",run:QS},{key:"Mod-Backspace",mac:"Alt-Backspace",run:tk},{key:"Mod-Delete",mac:"Alt-Delete",run:t=>ZS(t,!0)},{mac:"Mod-Backspace",run:t=>$S(t,(e=>{let i=t.lineBlockAt(e).from;return YS(t,e>i?i:Math.max(0,e-1),!1)}))},{mac:"Mod-Delete",run:ek}].concat([{key:"Ctrl-b",run:mS,shift:LS,preventDefault:!0},{key:"Ctrl-f",run:vS,shift:VS},{key:"Ctrl-p",run:SS,shift:HS},{key:"Ctrl-n",run:kS,shift:WS},{key:"Ctrl-a",run:t=>fS(t,(e=>L.cursor(t.lineBlockAt(e.head).from,1))),shift:t=>ES(t,(e=>L.cursor(t.lineBlockAt(e.head).from)))},{key:"Ctrl-e",run:t=>fS(t,(e=>L.cursor(t.lineBlockAt(e.head).to,-1))),shift:t=>ES(t,(e=>L.cursor(t.lineBlockAt(e.head).to)))},{key:"Ctrl-d",run:QS},{key:"Ctrl-h",run:JS},{key:"Ctrl-k",run:ek},{key:"Ctrl-Alt-h",run:tk},{key:"Ctrl-o",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange((t=>({changes:{from:t.from,to:t.to,insert:f.of(["",""])},range:L.cursor(t.from)})));return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange((e=>{if(!e.empty||0==e.from||e.from==t.doc.length)return{range:e};let i=e.from,s=t.doc.lineAt(i),r=i==s.from?i-1:n(s.text,i-s.from,!1)+s.from,o=i==s.to?i+1:n(s.text,i-s.from,!0)+s.from;return{changes:{from:r,to:o,insert:t.doc.slice(i,o).append(t.doc.slice(r,i))},range:L.cursor(o)}}));return!i.changes.empty&&(e(t.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:CS}].map((t=>({mac:t.key,run:t.run,shift:t.shift})))));function uk(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function fk(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function pk(t,e){if(!e.anchorNode)return!1;try{return fk(t,e.anchorNode)}catch(t){return!1}}function gk(t){return 3==t.nodeType?Ok(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function mk(t,e,i,n){return!!i&&(wk(t,e,i,n,-1)||wk(t,e,i,n,1))}function vk(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function wk(t,e,i,n,s){for(;;){if(t==i&&e==n)return!0;if(e==(s<0?0:yk(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=vk(t)+(s<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(s<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=s<0?yk(t):0}}}function yk(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const bk={left:0,right:0,top:0,bottom:0};function xk(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function Sk(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class kk{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let Ak,Mk=null;function Ck(t){if(t.setActive)return t.setActive();if(Mk)return t.focus(Mk);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==Mk?{get preventScroll(){return Mk={preventScroll:!0},!0}}:void 0),!Mk){Mk=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],s=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function Ok(t,e,i=e){let n=Ak||(Ak=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function Dk(t,e,i){let n={key:e,code:e,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,t.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,t.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function Tk(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Bk{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Bk(t.parentNode,vk(t),e)}static after(t,e){return new Bk(t.parentNode,vk(t)+1,e)}}const Ek=[];class Rk{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e=this.dom,i=e.firstChild;for(let n of this.children){if(n.dirty){if(!n.dom&&i){let t=Rk.get(i);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(i)}n.sync(t),n.dirty=0}if(t&&!t.written&&t.node==e&&i!=n.dom&&(t.written=!0),n.dom.parentNode==e){for(;i&&i!=n.dom;)i=Lk(i);i=n.dom.nextSibling}else e.insertBefore(n.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=Lk(i)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=0==yk(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==n&&e.firstChild!=e.lastChild&&(n=t==e.firstChild?-1:1),t=e}i=n<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Rk.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let n=this.children[t];if(n.dom==i)return e;e+=n.length+n.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,r=-1,o=-1;for(let l=0,h=i,a=i;l<this.children.length;l++){let i=this.children[l],c=h+i.length;if(h<t&&c>e)return i.domBoundsAround(t,e,h);if(c>=t&&-1==n&&(n=l,s=h),h>e&&i.dom.parentNode==this.dom){r=l,o=a;break}a=c,h=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Ek){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Vk(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function Lk(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}Rk.prototype.breakAfter=0;class Vk{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Nk(t,e,i,n,s,r,o,l,h){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(i,s,r.length?d:null,0==i,l,h))){if(n<a.length){let t=a[n];t&&s<t.length?(e==n&&(t=t.split(s),s=0),!u&&d&&t.merge(0,s,d,!0,0,h)?r[r.length-1]=t:(s&&t.merge(0,s,null,!1,0,h),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),e++));e<n&&r.length;)if(a[n-1].become(r[r.length-1]))n--,r.pop(),h=r.length?0:l;else{if(!a[e].become(r[0]))break;e++,r.shift(),l=r.length?0:h}!r.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,l,h)&&e--,(e<n||r.length)&&t.replaceChildren(e,n,r)}}function Pk(t,e,i,n,s,r){let o=t.childCursor(),{i:l,off:h}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of n)d+=t.length;t.length+=d,Nk(t,a,c,l,h,n,0,s,r)}let Hk="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Wk="undefined"!=typeof document?document:{documentElement:{style:{}}};const Ik=/Edge\/(\d+)/.exec(Hk.userAgent),Fk=/MSIE \d/.test(Hk.userAgent),zk=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Hk.userAgent),qk=!!(Fk||zk||Ik),Kk=!qk&&/gecko\/(\d+)/i.test(Hk.userAgent),Gk=!qk&&/Chrome\/(\d+)/.exec(Hk.userAgent),jk="webkitFontSmoothing"in Wk.documentElement.style,_k=!qk&&/Apple Computer/.test(Hk.vendor),Uk=_k&&(/Mobile\/\w+/.test(Hk.userAgent)||Hk.maxTouchPoints>2);var $k={mac:Uk||/Mac/.test(Hk.platform),windows:/Win/.test(Hk.platform),linux:/Linux|X11/.test(Hk.platform),ie:qk,ie_version:Fk?Wk.documentMode||6:zk?+zk[1]:Ik?+Ik[1]:0,gecko:Kk,gecko_version:Kk?+(/Firefox\/(\d+)/.exec(Hk.userAgent)||[0,0])[1]:0,chrome:!!Gk,chrome_version:Gk?+Gk[1]:0,ios:Uk,android:/Android\b/.test(Hk.userAgent),webkit:jk,safari:_k,webkit_version:jk?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Wk.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class Yk extends Rk{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof Yk&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Yk(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Bk(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Jk(this.dom,t,e)}}class Xk extends Rk{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(Tk(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,r){return(!i||!(!(i instanceof Xk&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&r<=0))&&(Pk(this,t,e,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),n<0&&i>=t&&(n=s),i=o,s++}let r=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new Xk(this.mark,e,r)}domAtPos(t){return nA(this.dom,this.children,t)}coordsAt(t,e){return rA(this,t,e)}}function Jk(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;0==e&&i<0||e==n&&i>=0?$k.chrome||$k.gecko||(e?(s--,o=1):(r++,o=-1)):i<0?s--:r++;let l=Ok(t,s,r).getClientRects();if(!l.length)return bk;let h=l[(o?o<0:i>=0)?0:l.length-1];return $k.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(l,(t=>t.width))||h),o?xk(h,o<0):h||null}class Qk extends Rk{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Qk)(t,e,i)}split(t){let e=Qk.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof Qk&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Qk&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return f.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):f.empty}domAtPos(t){return 0==t?Bk.before(this.dom):Bk.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return bk;for(let e=t>0?i.length-1:0;n=i[e],!(t>0?0==e:e==i.length-1||n.top<n.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?n:xk(n,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Zk extends Qk{domAtPos(t){let{topView:e,text:i}=this.widget;return e?tA(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Bk(i,Math.min(t,i.nodeValue.length)))):new Bk(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?eA(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?tA(t,e,i,n,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Jk(n,t,e))):Jk(n,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function tA(t,e,i,n,s,r){if(i instanceof Xk){for(let o of i.children){let i=fk(o.dom,n),l=i?n.nodeValue.length:o.length;if(t<l||t==l&&o.getSide()<=0)return i?tA(t,e,o,n,s,r):s(o,t,e);t-=l}return s(i,i.length,-1)}return i.dom==n?r(t,e):s(i,t,e)}function eA(t,e,i,n){if(i instanceof Xk)for(let s of i.children){let i=0,r=fk(s.dom,n);if(fk(s.dom,t))return i+(r?eA(t,e,s,n):s.localPosFromDOM(t,e));i+=r?n.nodeValue.length:s.length}else if(i.dom==n)return Math.min(e,n.nodeValue.length);return i.localPosFromDOM(t,e)}class iA extends Rk{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof iA&&t.side==this.side}split(){return new iA(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Bk.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,n=i?i.children.indexOf(t):-1;for(;i&&n>=0;)if(e<0?n>0:n<i.children.length){let t=i.children[n+e];if(t instanceof Yk){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}n+=e}else{if(!(i instanceof Xk&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}n=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return f.empty}}function nA(t,e,i){let n=0;for(let s=0;n<e.length;n++){let r=e[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return Bk.after(i)}return new Bk(t,0)}function sA(t,e,i){let n,{children:s}=t;i>0&&e instanceof Xk&&s.length&&(n=s[s.length-1])instanceof Xk&&n.mark.eq(e.mark)?sA(n,e.children[0],i-1):(s.push(e),e.setParent(t)),t.length+=e.length}function rA(t,e,i){for(let n=0,s=0;s<t.children.length;s++){let r,o=t.children[s],l=n+o.length;if((i<=0||l==t.length||o.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(r=t.children[s+1]).length||r.getSide()>0)){let t=0;if(l==n){if(o.getSide()<=0)continue;t=i=-o.getSide()}let s=o.coordsAt(Math.max(0,e-n),i);return t&&s?xk(s,i<0):s}n=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let s=gk(n);return s[s.length-1]||null}function oA(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function lA(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||t[s]!==e[s])return!1;return!0}function hA(t,e,i){if(e)for(let n in e)i&&n in i||t.removeAttribute(n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(n,i[n])}Yk.prototype.children=Qk.prototype.children=iA.prototype.children=Ek;class aA{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var cA=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(cA||(cA={}));class dA extends Lt{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new uA(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?4e8:-5e8:e>0?1e8:-1e8,new pA(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,n=!!t.block;if(t.isBlockGap)e=-4e8,i=3e8;else{let{start:s,end:r}=gA(t,n);e=(s?n?-3e8:-1:5e8)-1,i=1+(r?n?2e8:1:-6e8)}return new pA(t,e,i,n,t.widget||null,!0)}static line(t){return new fA(t)}static set(t,e=!1){return Ht.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}dA.none=Ht.empty;class uA extends dA{constructor(t){let{start:e,end:i}=gA(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof uA&&this.tagName==t.tagName&&this.class==t.class&&lA(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}uA.prototype.point=!1;class fA extends dA{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof fA&&lA(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}fA.prototype.mapMode=k.TrackBefore,fA.prototype.point=!0;class pA extends dA{constructor(t,e,i,n,s,r){super(e,i,s,t),this.block=n,this.isReplace=r,this.mapMode=n?e<=0?k.TrackBefore:k.TrackAfter:k.TrackDel}get type(){return this.startSide<this.endSide?cA.WidgetRange:this.startSide<=0?cA.WidgetBefore:cA.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof pA&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function gA(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return null==i&&(i=t.inclusive),null==n&&(n=t.inclusive),{start:null!=i?i:e,end:null!=n?n:e}}function mA(t,e,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=t?i[s]=Math.max(i[s],e):i.push(t,e)}pA.prototype.point=!0;class vA extends Rk{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,r){if(i){if(!(i instanceof vA))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Pk(this,t,e,i?i.children:[],s,r),!0}split(t){let e=new vA;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){lA(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){sA(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=oA(e,this.attrs||{})),i&&(this.attrs=oA({class:i},this.attrs||{}))}domAtPos(t){return nA(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(Tk(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(hA(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Rk.get(i)instanceof Xk;)i=i.lastChild;if(!i||"BR"!=i.nodeName&&0==(null===(e=Rk.get(i))||void 0===e?void 0:e.isEditable)&&(!$k.ios||!this.children.some((t=>t instanceof Yk)))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Yk))return null;let i=gk(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return rA(this,t,e)}become(t){return!1}get type(){return cA.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],r=n+s.length;if(r>=e){if(s instanceof vA)return s;if(r>e)break}n=r+s.breakAfter}return null}}class wA extends Rk{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof wA&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?Bk.before(this.dom):Bk.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new wA(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Ek}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):f.empty}domBoundsAround(){return null}become(t){return t instanceof wA&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class yA{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof wA&&t.type==cA.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new vA),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(bA(new iA(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(bA(new Yk(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s){let r=e-t;if(i instanceof pA)if(i.block){let{type:t}=i;t!=cA.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new wA(i.widget||new xA("div"),r,t))}else{let o=Qk.create(i.widget||new xA("span"),r,i.startSide),l=this.atCursorPos&&!o.isEditable&&s<=n.length&&(t<e||i.startSide>0),h=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(n),l&&(a.append(bA(new iA(1),n),s),s=n.length+Math.max(0,s-n.length)),a.append(bA(o,n),s),this.atCursorPos=h,this.pendingBuffer=h?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}filterPoint(t,e,i,n){if(n<this.disallowBlockEffectsBelow&&i instanceof pA){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,n,s){let r=new yA(t,e,i,s);return r.openEnd=Ht.spans(n,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function bA(t,e){for(let i of e)t=new Xk(i,[t],t.length);return t}class xA extends aA{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const SA=[],kA=H.define(),AA=H.define(),MA=H.define(),CA=H.define(),OA=H.define(),DA=H.define(),TA=ft.define({map:(t,e)=>t.map(e)}),BA=ft.define({map:(t,e)=>t.map(e)});class EA{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new EA(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const RA=ft.define({map:(t,e)=>t.map(e)});function LA(t,e,i){let n=t.facet(CA);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const VA=H.define({combine:t=>!t.length||t[0]});class NA{constructor(t,e){this.field=t,this.get=e}}class PA{from(t){return new NA(this,t)}static define(){return new PA}}PA.decorations=PA.define(),PA.atomicRanges=PA.define(),PA.scrollMargins=PA.define();let HA=0;const WA=H.define();class IA{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=WA.of(this)}static define(t,e){let{eventHandlers:i,provide:n,decorations:s}=e||{},r=[];if(n)for(let t of Array.isArray(n)?n:[n])r.push(t);return i&&r.push(FA.from((t=>({plugin:t,handlers:i})))),s&&r.push(PA.decorations.from(s)),new IA(HA++,t,r)}static fromClass(t,e){return IA.define((e=>new t(e)),e)}}const FA=PA.define();class zA{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:n}of this.spec.fields)i==t&&e.push(n(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(LA(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){LA(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){LA(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const qA=H.define(),KA=H.define(),GA=H.define(),jA=H.define();class _A{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new _A(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let l=n==t.length?null:t[n],h=r-o,a=l?l.fromB:1e9;for(;s<e.length&&e[s]<a;){let t=e[s],n=e[s+1],r=Math.max(o,t),l=Math.min(a,n);if(r<=l&&new _A(r+h,l+h,r,l).addToSet(i),n>a)break;s+=2}if(!l)return i;new _A(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class UA{constructor(t,e,i=SA){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=M.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let n=[];this.changes.iterChangedRanges(((t,e,i,s)=>n.push(new _A(t,e,i,s)))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var $A=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}($A||($A={}));const YA=$A.LTR,XA=$A.RTL;function JA(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const QA=JA("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ZA=JA("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),tM=Object.create(null),eM=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);tM[e]=i,tM[i]=-e}const iM=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class nM{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?XA:YA}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<e:o.to>e:t[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const sM=[];function rM(t,e){let i=t.length,n=e==YA?1:2,s=e==YA?2:1;if(!t||1==n&&!iM.test(t))return oM(i);for(let e=0,s=n,o=n;e<i;e++){let i=(r=t.charCodeAt(e))<=247?QA[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?ZA[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),sM[e]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let t=0,e=n,s=n;t<i;t++){let n=sM[t];if(128==n)t<i-1&&e==sM[t+1]&&24&e?n=sM[t]=e:sM[t]=256;else if(64==n){let n=t+1;for(;n<i&&64==sM[n];)n++;let r=t&&8==e||n<i&&8==sM[n]?1==s?1:8:256;for(let e=t;e<n;e++)sM[e]=r;t=n-1}else 8==n&&1==s&&(sM[t]=1);e=n,7&n&&(s=n)}for(let e,r,o,l=0,h=0,a=0;l<i;l++)if(r=tM[e=t.charCodeAt(l)])if(r<0){for(let t=h-3;t>=0;t-=3)if(eM[t+1]==-r){let e=eM[t+2],i=2&e?n:4&e?1&e?s:n:0;i&&(sM[l]=sM[eM[t]]=i),h=t;break}}else{if(189==eM.length)break;eM[h++]=l,eM[h++]=e,eM[h++]=a}else if(2==(o=sM[l])||1==o){let t=o==n;a=t?0:1;for(let e=h-3;e>=0;e-=3){let i=eM[e+2];if(2&i)break;if(t)eM[e+2]|=2;else{if(4&i)break;eM[e+2]|=4}}}for(let t=0;t<i;t++)if(256==sM[t]){let e=t+1;for(;e<i&&256==sM[e];)e++;let s=1==(t?sM[t-1]:n),r=s==(1==(e<i?sM[e]:n))?s?1:2:n;for(let i=t;i<e;i++)sM[i]=r;t=e-1}let o=[];if(1==n)for(let t=0;t<i;){let e=t,n=1!=sM[t++];for(;t<i&&n==(1!=sM[t]);)t++;if(n)for(let i=t;i>e;){let t=i,n=2!=sM[--i];for(;i>e&&n==(2!=sM[i-1]);)i--;o.push(new nM(i,t,n?2:1))}else o.push(new nM(e,t,0))}else for(let t=0;t<i;){let e=t,n=2==sM[t++];for(;t<i&&n==(2==sM[t]);)t++;o.push(new nM(e,t,n?1:2))}return o}function oM(t){return[new nM(0,t,0)]}let lM="";function hM(t,e,i,s,r){var o;let l=s.head-t.from,h=-1;if(0==l){if(!r||!t.length)return null;e[0].level!=i&&(l=e[0].side(!1,i),h=0)}else if(l==t.length){if(r)return null;let t=e[e.length-1];t.level!=i&&(l=t.side(!0,i),h=e.length-1)}h<0&&(h=nM.find(e,l,null!==(o=s.bidiLevel)&&void 0!==o?o:-1,s.assoc));let a=e[h];l==a.side(r,i)&&(a=e[h+=r?1:-1],l=a.side(!r,i));let c=r==(a.dir==i),d=n(t.text,l,c);if(lM=t.text.slice(Math.min(l,d),Math.max(l,d)),d!=a.side(r,i))return L.cursor(d+t.from,c?-1:1,a.level);let u=h==(r?e.length-1:0)?null:e[h+(r?1:-1)];return u||a.level==i?u&&u.level<a.level?L.cursor(u.side(!r,i)+t.from,r?1:-1,u.level):L.cursor(d+t.from,r?-1:1,a.level):L.cursor(r?t.to:t.from,r?-1:1,i)}class aM{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Mt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let t=n.nextSibling;if(t==e)break;let s=Rk.get(n),r=Rk.get(t);(s&&r?s.breakAfter:(s?s.breakAfter:cM(n))||cM(t)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(e))&&(r=s.index,o=s[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Rk.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function cM(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class dM{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class uM extends Rk{constructor(t){super(),this.view=t,this.compositionDeco=dA.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new vA],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new _A(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=dA.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=pM(t);if(!i)return dA.none;let{from:n,to:s,node:r,text:o}=i,l=e.mapPos(n,1),h=Math.max(l,e.mapPos(s,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new aM([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),"￿")==c)h=l+c.length;else{if(a.doc.sliceString(Math.max(0,h-c.length),h,"￿")!=c)return dA.none;l=h-c.length}else if(a.doc.sliceString(l,h,"￿")!=c)return dA.none;let d=Rk.get(r);d instanceof Zk?d=d.widget.topView:d&&(d.parent=null);return dA.set(dA.replace({widget:new gM(r,o,d)}).range(l,h))}(this.view,t.changes)),($k.ie||$k.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let n=new vM;return Ht.compare(t,e,i,n),n.changes}(this.decorations,this.updateDeco(),t.changes);return e=_A.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=$k.chrome||$k.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof wA&&t.widget instanceof fM&&n.push(t.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let n=e>=0?t[e]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:l}=n,{content:h,breakAtStart:a,openStart:c,openEnd:d}=yA.build(this.view.state.doc,o,l,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);Nk(this,p,g,u,f,h,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||$k.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if($k.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(t,s.node.childNodes[s.offset]||null))),s=r=new Bk(t,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&mk(s.node,s.offset,l.anchorNode,l.anchorOffset)&&mk(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{$k.android&&$k.chrome&&this.dom.contains(l.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=uk(this.root);if(n.empty){if($k.gecko){let t=(e=s.node,i=s.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=mM(s.node,s.offset,1==t?1:-1);e&&(s=new Bk(e,1==t?0:e.nodeValue.length))}}t.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(t.extend)t.collapse(s.node,s.offset),t.extend(r.node,r.offset);else{let e=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),e.setEnd(r.node,r.offset),e.setStart(s.node,s.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new Bk(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new Bk(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=uk(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=vA.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(VA)?this.root.activeElement==this.dom:pk(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=Rk.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof vA)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(t>r||t==r&&s.type!=cA.WidgetBefore&&s.type!=cA.WidgetAfter&&(!n||2==e||this.children[n-1].breakAfter||this.children[n-1].type==cA.WidgetBefore&&e>-2))return s.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,n=this.view.contentDOM.clientWidth,s=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,l=0;l<this.children.length;l++){let h=this.children[l],a=o+h.length;if(a>i)break;if(o>=e){let e=h.dom.getBoundingClientRect();if(t.push(e.height),s){let t=h.dom.lastChild,i=t?gk(t):[];if(i.length){let t=i[i.length-1],s=this.view.textDirection==$A.LTR?t.right-e.left:e.right-t.left;s>r&&(r=s,this.minWidth=n,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+h.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof vA){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=gk(i.firstChild)[0];t=i.getBoundingClientRect().height,e=n?n.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Vk(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(dA.replace({widget:new fM(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!s)break;i=s.to+1}return dA.set(t)}updateDeco(){let t=this.view.pluginField(PA.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(GA),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)});let s=0,r=0,o=0,l=0;for(let t of this.view.pluginField(PA.scrollMargins))if(t){let{left:e,right:i,top:n,bottom:h}=t;null!=e&&(s=Math.max(s,e)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=h&&(l=Math.max(l,h))}let h={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+l};!function(t,e,i,n,s,r,o,l){let h=t.ownerDocument,a=h.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==h.body;if(d)t=Sk(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==s)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let n=e.bottom-e.top,r=t.bottom-t.top;f=("center"==s&&n<=r?e.top+n/2-r/2:"start"==s||"center"==s&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==n?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==n?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==n==l?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,h,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==$A.LTR)}}class fM extends aA{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function pM(t){let e=t.observer.selectionRange,i=e.focusNode&&mM(e.focusNode,e.focusOffset,0);if(!i)return null;let n=t.docView.nearest(i);if(!n)return null;if(n instanceof vA){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!Rk.get(e);)e=e.previousSibling;let s=e?Rk.get(e).posAtEnd:n.posAtStart;return{from:s,to:s,node:t,text:i}}{for(;;){let{parent:t}=n;if(!t)return null;if(t instanceof vA)break;n=t}let t=n.posAtStart;return{from:t,to:t+n.length,node:n.dom,text:i}}}class gM extends aA{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Zk}}function mM(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=yk(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class vM{constructor(){this.changes=[]}compareRange(t,e){mA(t,e,this.changes)}comparePoint(t,e){mA(t,e,this.changes)}}function wM(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function yM(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function bM(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function xM(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function SM(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function kM(t,e,i){let n,s,r,o,l,h,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=gk(d);for(let u=0;u<t.length;u++){let f=t[u];s&&bM(s,f)&&(f=xM(SM(f,s.bottom),s.top));let p=wM(e,f),g=yM(i,f);if(0==p&&0==g)return 3==d.nodeType?AM(d,e,i):kM(d,e,i);(!n||o>g||o==g&&r>p)&&(n=d,s=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(l=d,a=f):i<f.top&&(!c||c.top>f.top)&&(h=d,c=f):a&&bM(a,f)?a=SM(a,f.bottom):c&&bM(c,f)&&(c=xM(c,f.top))}}if(a&&a.bottom>=i?(n=l,s=a):c&&c.top<=i&&(n=h,s=c),!n)return{node:t,offset:0};let d=Math.max(s.left,Math.min(s.right,e));return 3==n.nodeType?AM(n,d,i):r||"true"!=n.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,n)+(e>=(s.left+s.right)/2?1:0)}:kM(n,d,i)}function AM(t,e,i){let n=t.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<n;l++){let n=Ok(t,l,l+1).getClientRects();for(let h=0;h<n.length;h++){let a=n[h];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,n=i;if($k.chrome||$k.gecko){Ok(t,l).getBoundingClientRect().left==a.right&&(n=!i)}if(c<=0)return{node:t,offset:l+(n?1:0)};s=l+(n?1:0),r=c}}}return{node:t,offset:s>-1?s:o>0?t.nodeValue.length:0}}function MM(t,{x:e,y:i},n,s=-1){var r;let o,l=t.contentDOM.getBoundingClientRect(),h=l.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-h;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=cA.Text;)for(;c=s>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return n?null:0;i=!0,s=-s}i=h+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:n?null:CM(t,l,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:CM(t,l,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(l.left+1,Math.min(l.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),$k.safari&&function(t,e,i){let n;if(3!=t.nodeType||e!=(n=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return Ok(t,n-1,n).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let n=vA.find(t.docView,d);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=kM(n.dom,e,i))}return t.docView.posFromDOM(g,m)}function CM(t,e,i,n,s){let r=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((s-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+u(o,r,t.state.tabSize)}function OM(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=t.bidiSpans(s);for(let o=e,l=null;;){let e=hM(s,r,t.textDirection,o,i),h=lM;if(!e){if(s.number==(i?t.state.doc.lines:1))return o;h="\n",s=t.state.doc.line(s.number+(i?1:-1)),r=t.bidiSpans(s),e=L.cursor(i?s.from:s.to)}if(l){if(!l(h))return o}else{if(!n)return e;l=n(h)}o=e}}function DM(t,e,i){let n=t.pluginField(PA.atomicRanges);for(;;){let t=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=e.from>i.from?L.cursor(n,1):L.cursor(s,-1),t=!0)}));if(!t)return i}}class TM{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in VM){let i=VM[e];t.contentDOM.addEventListener(e,(n=>{"keydown"==e&&this.keydown(t,n)||LM(t,n)&&!this.ignoreDuringComposition(n)&&(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),$k.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(FA);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{LM(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(t){LA(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(e){LA(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if($k.android&&$k.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!$k.ios||!(i=BM.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,Dk(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!($k.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(t,e){let i=9==e.keyCode&&Date.now()<this.lastEscPress+2e3;return 27==e.keyCode?this.lastEscPress=Date.now():EM.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!$k.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const BM=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EM=[16,17,18,20,91,92,224,225];class RM{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Mt.allowMultipleSelections)&&function(t,e){let i=t.state.facet(kA);return i.length?i[0](e):$k.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(AA);return i.length?i[0](e):$k.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=uk(t.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let t=0;t<s.length;t++){let i=s[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=UM(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function LM(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=Rk.get(n))&&i.ignoreEvent(e))return!1;return!0}const VM=Object.create(null),NM=$k.ie&&$k.ie_version<15||$k.ios&&$k.webkit_version<604;function PM(t,e){let i,{state:n}=t,s=1,r=n.toText(e),o=r.lines==n.selection.ranges.length;if(null!=YM&&n.selection.ranges.every((t=>t.empty))&&YM==r.toString()){let t=-1;i=n.changeByRange((i=>{let l=n.doc.lineAt(i.from);if(l.from==t)return{range:i};t=l.from;let h=n.toText((o?r.line(s++).text:e)+n.lineBreak);return{changes:{from:l.from,insert:h},range:L.cursor(i.from+h.length)}}))}else i=o?n.changeByRange((t=>{let e=r.line(s++);return{changes:{from:t.from,to:t.to,insert:e.text},range:L.cursor(t.from+e.length)}})):n.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}VM.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select")};let HM=0;function WM(t,e,i,s){if(1==s)return L.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),r=t.doc.lineAt(e),o=e-r.from;if(0==r.length)return L.cursor(e);0==o?i=1:o==r.length&&(i=-1);let l=o,h=o;i<0?l=n(r.text,o,!1):h=n(r.text,o);let a=s(r.text.slice(l,h));for(;l>0;){let t=n(r.text,l,!1);if(s(r.text.slice(t,l))!=a)break;l=t}for(;h<r.length;){let t=n(r.text,h);if(s(r.text.slice(h,t))!=a)break;h=t}return L.range(l+r.from,h+r.from)}(t.state,e,i);{let i=vA.find(t.docView,e),n=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<t.state.doc.length&&r==n.to&&r++,L.range(s,r)}}VM.touchstart=(t,e)=>{HM=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},VM.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},VM.mousedown=(t,e)=>{if(t.observer.flush(),HM>Date.now()-2e3&&1==UM(e))return;let i=null;for(let n of t.state.facet(MA))if(i=n(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=qM(t,e),n=UM(e),s=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),s=s.map(t.changes),o=null)},get(e,l,h){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=qM(t,e),o=e),!a||!i)return s;let c=WM(t,a.pos,a.bias,n);if(i.pos!=a.pos&&!l){let e=WM(t,i.pos,i.bias,n),s=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=s<c.from?L.range(s,r):L.range(r,s)}return l?s.replaceRange(s.main.extend(c.from,c.to)):h?s.addRange(c):L.create([c])}}}(t,e)),i){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore((()=>Ck(t.contentDOM))),t.inputState.startMouseSelection(new RM(t,e,i,n))}};let IM=(t,e)=>t>=e.top&&t<=e.bottom,FM=(t,e,i)=>IM(e,i)&&t>=i.left&&t<=i.right;function zM(t,e,i,n){let s=vA.find(t.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&FM(i,n,o))return-1;let l=s.coordsAt(r,1);return l&&FM(i,n,l)?1:o&&IM(n,o)?-1:1}function qM(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:zM(t,i,e.clientX,e.clientY)}}const KM=$k.ie&&$k.ie_version<=11;let GM=null,jM=0,_M=0;function UM(t){if(!KM)return t.detail;let e=GM,i=_M;return GM=t,_M=Date.now(),jM=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(jM+1)%3:1}function $M(t,e,i,n){if(!i)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:i},h=t.state.changes(o?[o,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}VM.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},VM.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&$M(t,e,n.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(n[t]=e.result),r()},e.readAsText(i[t])}}else $M(t,e,e.dataTransfer.getData("Text"),!0)},VM.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=NM?null:e.clipboardData;i?(PM(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),PM(t,i.value)}),50)}(t)};let YM=null;function XM(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}VM.copy=VM.cut=(t,e)=>{let{text:i,ranges:n,linewise:s}=function(t){let e=[],i=[],n=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let s=-1;for(let{from:n}of t.selection.ranges){let r=t.doc.lineAt(n);r.number>s&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),s=r.number}n=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:n}}(t.state);if(!i&&!s)return;YM=s?i:null;let r=NM?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout((()=>{n.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},VM.focus=VM.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},VM.beforeprint=t=>{t.viewState.printing=!0,t.requestMeasure(),setTimeout((()=>{t.viewState.printing=!1,t.requestMeasure()}),2e3)},VM.compositionstart=VM.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),XM(t,!0)))},VM.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&XM(t,!1)}),50)},VM.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},VM.beforeinput=(t,e)=>{var i;let n;if($k.chrome&&$k.android&&(n=BM.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const JM=["pre-wrap","normal","pre-line","break-spaces"];class QM{constructor(){this.doc=f.empty,this.lineWrapping=!1,this.direction=$A.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return JM.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(e=!0,this.heightSamples[Math.floor(10*n)]=!0)}return e}refresh(t,e,i,n,s,r){let o=JM.indexOf(t)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=n,this.lineLength=s,l){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return l}}class ZM{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class tC{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new tC(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new tC(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var eC=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(eC||(eC={}));class iC{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return iC.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:h,toB:a}=n[r],c=s.lineAt(o,eC.ByPosNoHeight,e,0,0),d=c.to>=l?c:s.lineAt(l,eC.ByPosNoHeight,e,0,0);for(a+=d.to-l,l=d.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,h=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,eC.ByPosNoHeight,e,0,0));h+=c.from-o,o=c.from;let u=hC.build(i,t,h,a);s=s.replace(o,l,u)}return s.updateHeight(i,0)}static empty(){return new sC(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>2*s){let s=t[e-1];s.break?t.splice(--e,1,s.left,null,s.right):t.splice(--e,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,s-=e.size}}else if(n<s){let i=t[e++];i&&(n+=i.size)}else{let e=t[--i];e&&(s+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new oC(iC.of(t.slice(0,e)),r,iC.of(t.slice(i)))}}iC.prototype.size=1;class nC extends iC{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new tC(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,r){r(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class sC extends nC{constructor(t,e){super(t,e,cA.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return 1==i.length&&(n instanceof sC||n instanceof rC&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof rC?n=new sC(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):iC.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class rC extends iC{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(e,n),l=Math.max(0,Math.min(r-s,Math.floor((t-i)/o))),{from:h,length:a}=e.line(s+l);return new tC(h,a,i+o*l,o,cA.Text)}lineAt(t,e,i,n,s){if(e==eC.ByHeight)return this.blockAt(t,i,n,s);if(e==eC.ByPosNoHeight){let{from:e,to:n}=i.lineAt(t);return new tC(e,n-e,0,0,cA.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:l,length:h,number:a}=i.lineAt(t);return new tC(l,h,n+o*(a-r),o,cA.Text)}forEachLine(t,e,i,n,s,r){let{firstLine:o,lineHeight:l}=this.lines(i,s);for(let h=Math.max(t,s),a=Math.min(s+this.length,e);h<=a;){let e=i.lineAt(h);h==t&&(n+=l*(e.number-o)),r(new tC(e.from,e.length,n,l,cA.Text)),n+=l,h=e.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let t=i[i.length-1];t instanceof rC?i[i.length-1]=new rC(t.length+n):i.push(null,new rC(n-1))}if(t>0){let e=i[0];e instanceof rC?i[0]=new rC(t+e.length):i.unshift(new rC(t-1),null)}return iC.of(i)}decomposeLeft(t,e){e.push(new rC(t-1),null)}decomposeRight(t,e){e.push(null,new rC(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let i=[],r=Math.max(e,n.from),o=-1,l=t.heightChanged;for(n.from>e&&i.push(new rC(n.from-e-1).updateHeight(t,e));r<=s&&n.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let l=new sC(e,s);l.outdated=!1,i.push(l),r+=e+1}r<=s&&i.push(null,new rC(s-r).updateHeight(t,r));let h=iC.of(i);return t.heightChanged=l||o<0||Math.abs(h.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,h}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class oC extends iC{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,l=e==eC.ByHeight?t<r:t<o,h=l?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,r,o);if(this.break||(l?h.to<o:h.from>o))return h;let a=e==eC.ByPosNoHeight?eC.ByPosNoHeight:eC.ByPos;return l?h.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,n,s).join(h)}forEachLine(t,e,i,n,s,r){let o=n+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,n,s,r),e>=l&&this.right.forEachLine(t,e,i,o,l,r);else{let h=this.lineAt(l,eC.ByPos,i,n,s);t<h.from&&this.left.forEachLine(t,h.from-1,i,n,s,r),h.to>=t&&h.from<=e&&r(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,o,l,r)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let r=s.length;for(let t of i)s.push(t);if(t>0&&lC(s,r-1),e<this.length){let t=s.length;this.decomposeRight(e,s),lC(s,t)}return iC.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?iC.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:r}=this,o=e+s.length+this.break,l=null;return n&&n.from<=e+s.length&&n.more?l=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=o+r.length&&n.more?l=r=r.updateHeight(t,o,i,n):r.updateHeight(t,o,i),l?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function lC(t,e){let i,n;null==t[e]&&(i=t[e-1])instanceof rC&&(n=t[e+1])instanceof rC&&t.splice(e-1,3,new rC(i.length+1+n.length))}class hC{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof sC?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new sC(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new nC(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new sC(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new rC(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof sC)return t;let e=new sC(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=cA.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=cA.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof sC||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new sC(0,-1));let i=t;for(let t of this.nodes)t instanceof sC&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,n){let s=new hC(i,t);return Ht.spans(e,i,n,s,0),s.finish(i)}}class aC{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&mA(t,e,this.changes,5)}}class cC{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return dA.replace({widget:new dC(this.size,t)}).range(this.from,this.to)}}class dC extends aA{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class uC{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new QM,this.scaler=yC,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=iC.empty().applyChanges(t.facet(GA),f.empty,this.heightOracle.setDoc(t.doc),[new _A(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=dA.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>n>=t&&n<=e))){let{from:e,to:i}=this.lineBlockAt(n);t.push(new fC(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?yC:new bC(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:xC(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let n=this.state.facet(GA),s=t.changedRanges,r=_A.extendWithRanges(s,function(t,e,i){let n=new aC;return Ht.compare(t,e,i,n,0),n.changes}(t.startState.facet(GA),n,t?t.changes:M.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace,r="rtl"==i.direction?$A.RTL:$A.LTR,o=this.heightOracle.mustRefreshForStyle(s,r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,n=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==n||(h|=8,this.paddingTop=t,this.paddingBottom=n)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:function(t,e){let i=t.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=l;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();n=Math.max(n,e.left),s=Math.min(s,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let e=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(e)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:l}=t.docView.measureTextSize();o=n.refresh(s,r,i,l,p/l,e),o&&(t.docView.minWidth=0,h|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),n.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(n,0,o,new ZM(this.viewport.from,e)),n.heightChanged&&(h|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&h||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new fC(n.lineAt(r-1e3*i,eC.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),eC.ByHeight,s,0,0).to);if(e){let{head:t}=e.range;if(t<l.from||t>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(t,eC.ByPos,s,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<l.from?o.top:o.bottom-r,l=new fC(n.lineAt(i-500,eC.ByHeight,s,0,0).from,n.lineAt(i+r+500,eC.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new fC(this.heightMap.lineAt(i,eC.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,eC.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,eC.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,eC.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||n<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new cC(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=$A.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=pC(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=gC(r,(this.visibleTop-i.top-t)/i.height),s=gC(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;n=gC(r,(this.pixelViewport.left-e)/t),s=gC(r,(this.pixelViewport.right+e)/t)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&vC(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&vC(o,l.to-10,l.to+10);for(let{from:n,to:s}of o)s-n>1e3&&e.push(wC(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-n)<1e3&&Math.abs(t.to-s)<1e3))||new cC(n,s,this.gapSize(i,n,s,r)))}return e}gapSize(t,e,i,n){let s=mC(n,i)-mC(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){cC.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=dA.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(GA);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Ht.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||xC(this.heightMap.lineAt(t,eC.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return xC(this.heightMap.lineAt(this.scaler.fromDOM(t),eC.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return xC(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class fC{constructor(t,e){this.from=t,this.to=e}}function pC(t,e,i){let n=[],s=t,r=0;return Ht.spans(i.facet(GA),t,e,{span(){},point(t,e){t>s&&(n.push({from:s,to:t}),r+=t-s),s=e}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function gC({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:s}=e[t],r=s-i;if(n<=r)return i+n;n-=r}}function mC(t,e){let i=0;for(let{from:n,to:s}of t.ranges){if(e<=s){i+=e-n;break}i+=s-n}return i/t.total}function vC(t,e,i){for(let n=0;n<t.length;n++){let s=t[n];if(s.from<i&&s.to>e){let r=[];s.from<e&&r.push({from:s.from,to:e}),s.to>i&&r.push({from:i,to:s.to}),t.splice(n,1,...r),n+=r.length-1}}}function wC(t,e){for(let i of t)if(e(i))return i}const yC={toDOM:t=>t,fromDOM:t=>t,scale:1};class bC{constructor(t,e,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=e.lineAt(i,eC.ByPos,t,0,0).top,o=e.lineAt(s,eC.ByPos,t,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(e.height-n);for(let t of this.viewports)t.domTop=r+(t.top-s)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),s=t.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function xC(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new tC(t.from,t.length,i,n-i,Array.isArray(t.type)?t.type.map((t=>xC(t,e))):t.type)}const SC=H.define({combine:t=>t.join(" ")}),kC=H.define({combine:t=>t.indexOf(!0)>-1}),AC=Bt.newName(),MC=Bt.newName(),CC=Bt.newName(),OC={"&light":"."+MC,"&dark":"."+CC};function DC(t,e,i){return new Bt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const TC=DC("."+AC,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},OC),BC={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},EC=$k.ie&&$k.ie_version<=11;class RC{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new kk,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);($k.ie&&$k.ie_version<=11||$k.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),EC&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(VA)?e.root.activeElement!=this.dom:!pk(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||(($k.ie&&$k.ie_version<=11||$k.android&&$k.chrome)&&!e.state.selection.main.empty&&i.focusNode&&mk(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=uk(t),i=$k.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let n=e.startContainer,s=e.startOffset,r=e.endContainer,o=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);mk(l.node,l.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,BC),EC&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),EC&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;Dk(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let t=this.readMutation(s);t&&(t.typeOver&&(n=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&pk(this.dom,this.selectionRange);if(e<0&&!s)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,n),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=LC(e,t.previousSibling||t.target.previousSibling,-1),n=LC(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function LC(t,e,i){for(;e;){let n=Rk.get(e);if(n&&n.parent==t)return n;let s=e.parentNode;e=s!=t.dom?s:i>0?e.nextSibling:e.previousSibling}return null}function VC(t,e,i,n){let s,r,o=t.state.selection.main;if(e>-1){let n=t.docView.domBoundsAround(e,i,0);if(!n||t.state.readOnly)return;let{from:l,to:h}=n,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new dM(i,n)),s==i&&r==n||e.push(new dM(s,r)));return e}(t),c=new aM(a,t.state);c.readRange(n.startDOM,n.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||$k.android&&c.text.length<h-l)&&(d=o.to,u="end");let p=function(t,e,i,n){let s=Math.min(t.length,e.length),r=0;for(;r<s&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&t.length==e.length)return null;let o=t.length,l=e.length;for(;o>0&&l>0&&t.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(t.state.doc.sliceString(l,h,"￿"),c.text,d-l,u);p&&($k.chrome&&13==t.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==c.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:f.of(c.text.slice(p.from,p.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,n=2==t.length?t[1].pos:i;return i>-1&&n>-1?L.single(i+e,n+e):null}(a,l)}else if(t.hasFocus||!t.state.facet(VA)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=t.docView,s=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!fk(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),l=n&&n.node==e.anchorNode&&n.offset==e.anchorOffset||!fk(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);s==o.head&&l==o.anchor||(r=L.single(l,s))}if(s||r)if(!s&&n&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,s.from).append(s.insert).append(t.state.doc.slice(s.to,o.to))}),s){let e=t.state;if($k.ios&&t.inputState.flushIOSKey(t))return;if($k.android&&(s.from==o.from&&s.to==o.to&&1==s.insert.length&&2==s.insert.lines&&Dk(t.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&0==s.insert.length&&Dk(t.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&0==s.insert.length&&Dk(t.contentDOM,"Delete",46)))return;let i,n=s.insert.toString();if(t.state.facet(DA).some((e=>e(t,s.from,s.to,n))))return;if(t.inputState.composing>=0&&t.inputState.composing++,s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&t.inputState.composing<0){let n=o.from<s.from?e.sliceDoc(o.from,s.from):"",r=o.to>s.to?e.sliceDoc(s.to,o.to):"";i=e.replaceSelection(t.state.toText(n+s.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let n=e.changes(s),l=r&&!e.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let r=t.state.sliceDoc(s.from,s.to),h=pM(t)||t.state.doc.lineAt(o.head),a=o.to-s.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:n,range:l||i.map(n)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let f=e.changes({from:u,to:d,insert:s.insert}),p=i.to-o.to;return{changes:f,range:l?L.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}}))}else i={changes:n,selection:l&&e.selection.replaceRange(l)}}let l="input.type";t.composing&&(l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:l})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class NC{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new uC(t.state||Mt.create()),this.plugins=this.state.facet(WA).map((t=>new zA(t)));for(let t of this.plugins)t.update(this);this.observer=new RC(this,((t,e,i)=>{VC(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new TM(this),this.docView=new uM(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);if(n.facet(Mt.phrases)!=this.state.facet(Mt.phrases))return this.setState(n);e=new UA(this,n,t);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(s&&(s=s.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;s=new EA(t.empty?t:L.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(TA)?s=new EA(t.value):t.is(BA)?s=new EA(t.value,"center"):t.is(RA)&&(s=t.value)}this.viewState.update(e,s),this.bidiCache=IC.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(jA)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(SC)!=e.state.facet(SC)&&(this.viewState.mustMeasureContent=!0),(i||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(OA))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new uC(t),this.plugins=t.facet(WA).map((t=>new zA(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new uM(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(WA),i=t.state.facet(WA);if(e!=i){let n=[];for(let s of i){let i=e.indexOf(s);if(i<0)n.push(new zA(s));else{let e=this.plugins[i];e.mustUpdate=t,n.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((t=>{try{return t.read(this)}catch(t){return LA(this.state,t),WC}})),o=new UA(this,this.state),l=!1,h=!1;o.flags|=n,e?e.flags|=n:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),l=this.docView.update(o));for(let t=0;t<s.length;t++)if(r[t]!=WC)try{let e=s[t];e.write&&e.write(r[t],this)}catch(t){LA(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),l&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(OA))t(e)}get themeClasses(){return AC+" "+(this.state.facet(kC)?CC:MC)+" "+this.state.facet(SC)}updateAttrs(){let t=FC(this,qA,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(VA)?"true":"false",class:"cm-content",style:`${$k.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),FC(this,KA,e),this.observer.ignore((()=>{hA(this.contentDOM,this.contentAttrs,e),hA(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(NC.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(jA),Bt.mount(this.root,this.styleModules.concat(TC).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=HC(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=HC(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=HC(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return DM(this,t,OM(this,t,e,i))}moveByGroup(t,e){return DM(this,t,OM(this,t,e,(e=>function(t,e,i){let n=t.state.charCategorizer(e),s=n(i);return t=>{let e=n(t);return s==xt.Space&&(s=e),s==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=n&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),n=t.posAtCoords({x:i==(t.textDirection==$A.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=n)return L.cursor(n,i?-1:1)}let o=vA.find(t.docView,e.head),l=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return L.cursor(l,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return DM(this,t,function(t,e,i,n){let s=e.head,r=i?1:-1;if(s==(i?t.state.doc.length:0))return L.cursor(s,e.assoc);let o,l=e.goalColumn,h=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(s),c=t.documentTop;if(a)null==l&&(l=a.left-h.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(s-c);null==l&&(l=Math.min(h.right-h.left,t.defaultCharacterWidth*(s-e.from))),o=(r<0?e.top:e.bottom)+c}let d=h.left+l,u=null!=n?n:t.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(u+i)*r,a=MM(t,{x:d,y:n},!1,r);if(n<h.top||n>h.bottom||(r<0?a<s:a>s))return L.cursor(a,e.assoc,void 0,l)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:TA.of(L.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),MM(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n);return xk(i,s[nM.find(s,t-n.from,-1,e)].dir==$A.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>PC)return oM(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=rM(t.text,this.textDirection);return this.bidiCache.push(new IC(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||$k.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{Ck(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return RA.of(new EA("number"==typeof t?L.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return IA.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Bt.newName(),n=[SC.of(i),jA.of(DC(`.${i}`,t))];return e&&e.dark&&n.push(kC.of(!0)),n}static baseTheme(t){return X.lowest(jA.of(DC("."+AC,t,OC)))}}NC.scrollTo=TA,NC.centerOn=BA,NC.styleModule=jA,NC.inputHandler=DA,NC.exceptionSink=CA,NC.updateListener=OA,NC.editable=VA,NC.mouseSelectionStyle=MA,NC.dragMovesSelection=AA,NC.clickAddsSelectionRange=kA,NC.decorations=GA,NC.darkTheme=kC,NC.contentAttributes=KA,NC.editorAttributes=qA,NC.lineWrapping=NC.contentAttributes.of({class:"cm-lineWrapping"}),NC.announce=ft.define();const PC=4096;function HC(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const WC={};class IC{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:$A.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let r=t[s];r.dir!=n||e.touchesRange(r.from,r.to)||i.push(new IC(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function FC(t,e,i){for(let n=t.state.facet(e),s=n.length-1;s>=0;s--){let e=n[s],r="function"==typeof e?e(t):e;r&&oA(r,i)}return i}const zC=!$k.ios;const qC={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};zC&&(qC[".cm-line"].caretColor="transparent !important");const KC={brackets:["(","[","{","'",'"'],before:")]}'\":;>"},GC=ft.define({map(t,e){let i=e.mapPos(t,-1,k.TrackAfter);return null==i?void 0:i}}),jC=ft.define({map:(t,e)=>e.mapPos(t)}),_C=new class extends Lt{};_C.startSide=1,_C.endSide=-1;const UC=K.define({create:()=>Ht.empty,update(t,e){if(e.selection){let i=e.state.doc.lineAt(e.selection.main.head).from,n=e.startState.doc.lineAt(e.startState.selection.main.head).from;i!=e.changes.mapPos(n,-1)&&(t=Ht.empty)}t=t.map(e.changes);for(let i of e.effects)i.is(GC)?t=t.update({add:[_C.range(i.value,i.value+1)]}):i.is(jC)&&(t=t.update({filter:t=>t!=i.value}));return t}});function $C(){return[QC,UC]}function YC(t){for(let e=0;e<"()[]{}<>".length;e+=2)if("()[]{}<>".charCodeAt(e)==t)return"()[]{}<>".charAt(e+1);return a(t<128?t:t+1)}function XC(t,e){return t.languageDataAt("closeBrackets",e)[0]||KC}const JC="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),QC=NC.inputHandler.of(((t,e,i,n)=>{if((JC?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let s=t.state.selection.main;if(n.length>2||2==n.length&&1==c(h(n,0))||e!=s.from||i!=s.to)return!1;let r=function(t,e){let i=XC(t,t.selection.main.head),n=i.brackets||KC.brackets;for(let s of n){let r=YC(h(s,0));if(e==s)return r==s?sO(t,s,n.indexOf(s+s+s)>-1):iO(t,s,r,i.before||KC.before);if(e==r&&tO(t,t.selection.main.from))return nO(t,s,r)}return null}(t.state,n);return!!r&&(t.dispatch(r),!0)})),ZC=[{key:"Backspace",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=XC(t,t.selection.main.head).brackets||KC.brackets,n=null,s=t.changeByRange((e=>{if(e.empty){let n=function(t,e){let i=t.sliceString(e-2,e);return c(h(i,0))==i.length?i:i.slice(1)}(t.doc,e.head);for(let s of i)if(s==n&&eO(t.doc,e.head)==YC(h(s,0)))return{changes:{from:e.head-s.length,to:e.head+s.length},range:L.cursor(e.head-s.length),userEvent:"delete.backward"}}return{range:n=e}}));return n||e(t.update(s,{scrollIntoView:!0})),!n}}];function tO(t,e){let i=!1;return t.field(UC).between(0,t.doc.length,(t=>{t==e&&(i=!0)})),i}function eO(t,e){let i=t.sliceString(e,e+2);return i.slice(0,c(h(i,0)))}function iO(t,e,i,n){let s=null,r=t.changeByRange((r=>{if(!r.empty)return{changes:[{insert:e,from:r.from},{insert:i,from:r.to}],effects:GC.of(r.to+e.length),range:L.range(r.anchor+e.length,r.head+e.length)};let o=eO(t.doc,r.head);return!o||/\s/.test(o)||n.indexOf(o)>-1?{changes:{insert:e+i,from:r.head},effects:GC.of(r.head+e.length),range:L.cursor(r.head+e.length)}:{range:s=r}}));return s?null:t.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function nO(t,e,i){let n=null,s=t.selection.ranges.map((e=>e.empty&&eO(t.doc,e.head)==i?L.cursor(e.head+i.length):n=e));return n?null:t.update({selection:L.create(s,t.selection.mainIndex),scrollIntoView:!0,effects:t.selection.ranges.map((({from:t})=>jC.of(t)))})}function sO(t,e,i){let n=null,s=t.changeByRange((s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:e,from:s.to}],effects:GC.of(s.to+e.length),range:L.range(s.anchor+e.length,s.head+e.length)};let r=s.head,o=eO(t.doc,r);if(o==e){if(rO(t,r))return{changes:{insert:e+e,from:r},effects:GC.of(r+e.length),range:L.cursor(r+e.length)};if(tO(t,r)){let n=i&&t.sliceDoc(r,r+3*e.length)==e+e+e;return{range:L.cursor(r+e.length*(n?3:1)),effects:jC.of(r)}}}else{if(i&&t.sliceDoc(r-2*e.length,r)==e+e&&rO(t,r-2*e.length))return{changes:{insert:e+e+e+e,from:r},effects:GC.of(r+e.length),range:L.cursor(r+e.length)};if(t.charCategorizer(r)(o)!=xt.Word){let i=t.sliceDoc(r-1,r);if(i!=e&&t.charCategorizer(r)(i)!=xt.Word&&!function(t,e,i){let n=Lf(t).resolveInner(e,-1);for(let s=0;s<5;s++){if(t.sliceDoc(n.from,n.from+i.length)==i)return!0;let s=n.to==e&&n.parent;if(!s)break;n=s}return!1}(t,r,e))return{changes:{insert:e+e,from:r},effects:GC.of(r+e.length),range:L.cursor(r+e.length)}}}return{range:n=s}}));return n?null:t.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function rO(t,e){let i=Lf(t).resolveInner(e+1);return i.parent&&i.from==e}function oO(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function lO(t,e){return!!e&&t.contains(1!=e.nodeType?e.parentNode:e)}function hO(t,e){if(!e.anchorNode)return!1;try{return lO(t,e.anchorNode)}catch(t){return!1}}function aO(t){return 3==t.nodeType?xO(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function cO(t,e,i,n){return!!i&&(uO(t,e,i,n,-1)||uO(t,e,i,n,1))}function dO(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function uO(t,e,i,n,s){for(;;){if(t==i&&e==n)return!0;if(e==(s<0?0:fO(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=dO(t)+(s<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(s<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=s<0?fO(t):0}}}function fO(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const pO={left:0,right:0,top:0,bottom:0};function gO(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function mO(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class vO{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let wO,yO=null;function bO(t){if(t.setActive)return t.setActive();if(yO)return t.focus(yO);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==yO?{get preventScroll(){return yO={preventScroll:!0},!0}}:void 0),!yO){yO=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],s=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function xO(t,e,i=e){let n=wO||(wO=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function SO(t,e,i){let n={key:e,code:e,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,t.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,t.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function kO(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class AO{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new AO(t.parentNode,dO(t),e)}static after(t,e){return new AO(t.parentNode,dO(t)+1,e)}}const MO=[];class CO{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e=this.dom,i=e.firstChild;for(let n of this.children){if(n.dirty){if(!n.dom&&i){let t=CO.get(i);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(i)}n.sync(t),n.dirty=0}if(t&&!t.written&&t.node==e&&i!=n.dom&&(t.written=!0),n.dom.parentNode==e){for(;i&&i!=n.dom;)i=OO(i);i=n.dom.nextSibling}else e.insertBefore(n.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=OO(i)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=0==fO(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==n&&e.firstChild!=e.lastChild&&(n=t==e.firstChild?-1:1),t=e}i=n<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!CO.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let n=this.children[t];if(n.dom==i)return e;e+=n.length+n.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,r=-1,o=-1;for(let l=0,h=i,a=i;l<this.children.length;l++){let i=this.children[l],c=h+i.length;if(h<t&&c>e)return i.domBoundsAround(t,e,h);if(c>=t&&-1==n&&(n=l,s=h),h>e&&i.dom.parentNode==this.dom){r=l,o=a;break}a=c,h=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=MO){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new DO(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function OO(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}CO.prototype.breakAfter=0;class DO{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function TO(t,e,i,n,s,r,o,l,h){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(i,s,r.length?d:null,0==i,l,h))){if(n<a.length){let t=a[n];t&&s<t.length?(e==n&&(t=t.split(s),s=0),!u&&d&&t.merge(0,s,d,!0,0,h)?r[r.length-1]=t:(s&&t.merge(0,s,null,!1,0,h),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),e++));e<n&&r.length;)if(a[n-1].become(r[r.length-1]))n--,r.pop(),h=r.length?0:l;else{if(!a[e].become(r[0]))break;e++,r.shift(),l=r.length?0:h}!r.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,l,h)&&e--,(e<n||r.length)&&t.replaceChildren(e,n,r)}}function BO(t,e,i,n,s,r){let o=t.childCursor(),{i:l,off:h}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of n)d+=t.length;t.length+=d,TO(t,a,c,l,h,n,0,s,r)}let EO="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},RO="undefined"!=typeof document?document:{documentElement:{style:{}}};const LO=/Edge\/(\d+)/.exec(EO.userAgent),VO=/MSIE \d/.test(EO.userAgent),NO=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(EO.userAgent),PO=!!(VO||NO||LO),HO=!PO&&/gecko\/(\d+)/i.test(EO.userAgent),WO=!PO&&/Chrome\/(\d+)/.exec(EO.userAgent),IO="webkitFontSmoothing"in RO.documentElement.style,FO=!PO&&/Apple Computer/.test(EO.vendor),zO=FO&&(/Mobile\/\w+/.test(EO.userAgent)||EO.maxTouchPoints>2);var qO={mac:zO||/Mac/.test(EO.platform),windows:/Win/.test(EO.platform),linux:/Linux|X11/.test(EO.platform),ie:PO,ie_version:VO?RO.documentMode||6:NO?+NO[1]:LO?+LO[1]:0,gecko:HO,gecko_version:HO?+(/Firefox\/(\d+)/.exec(EO.userAgent)||[0,0])[1]:0,chrome:!!WO,chrome_version:WO?+WO[1]:0,ios:zO,android:/Android\b/.test(EO.userAgent),webkit:IO,safari:FO,webkit_version:IO?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=RO.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class KO extends CO{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof KO&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new KO(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new AO(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return jO(this.dom,t,e)}}class GO extends CO{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(kO(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,r){return(!i||!(!(i instanceof GO&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&r<=0))&&(BO(this,t,e,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),n<0&&i>=t&&(n=s),i=o,s++}let r=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new GO(this.mark,e,r)}domAtPos(t){return XO(this.dom,this.children,t)}coordsAt(t,e){return QO(this,t,e)}}function jO(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;0==e&&i<0||e==n&&i>=0?qO.chrome||qO.gecko||(e?(s--,o=1):(r++,o=-1)):i<0?s--:r++;let l=xO(t,s,r).getClientRects();if(!l.length)return pO;let h=l[(o?o<0:i>=0)?0:l.length-1];return qO.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(l,(t=>t.width))||h),o?gO(h,o<0):h||null}class _O extends CO{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||_O)(t,e,i)}split(t){let e=_O.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof _O&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof _O&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return f.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):f.empty}domAtPos(t){return 0==t?AO.before(this.dom):AO.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return pO;for(let e=t>0?i.length-1:0;n=i[e],!(t>0?0==e:e==i.length-1||n.top<n.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?n:gO(n,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class UO extends _O{domAtPos(t){let{topView:e}=this.widget;return e?$O(t,e,this.widget.text):new AO(this.widget.text,Math.min(t,this.widget.text.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){return e?3==t.nodeType?Math.min(e,this.length):this.length:0}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){return jO(this.widget.text,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function $O(t,e,i){if(e instanceof GO){for(let n of e.children){let e=n.dom==i||n.dom.contains(i.parentNode),s=e?i.nodeValue.length:n.length;if(t<s||t==s&&n.getSide()<=0)return e?$O(t,n,i):n.domAtPos(t);t-=s}return e.domAtPos(e.length)}return e.dom==i?new AO(i,Math.min(t,i.nodeValue.length)):e.domAtPos(t)}class YO extends CO{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof YO&&t.side==this.side}split(){return new YO(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return AO.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){return this.dom.getBoundingClientRect()}get overrideDOMText(){return f.empty}}function XO(t,e,i){let n=0;for(let s=0;n<e.length;n++){let r=e[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return AO.after(i)}return new AO(t,0)}function JO(t,e,i){let n,{children:s}=t;i>0&&e instanceof GO&&s.length&&(n=s[s.length-1])instanceof GO&&n.mark.eq(e.mark)?JO(n,e.children[0],i-1):(s.push(e),e.setParent(t)),t.length+=e.length}function QO(t,e,i){for(let n=0,s=0;s<t.children.length;s++){let r,o=t.children[s],l=n+o.length;if((i<=0||l==t.length||o.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(r=t.children[s+1]).length||r.getSide()>0)){let t=0;if(l==n){if(o.getSide()<=0)continue;t=i=-o.getSide()}let s=o.coordsAt(Math.max(0,e-n),i);return t&&s?gO(s,i<0):s}n=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let s=aO(n);return s[s.length-1]||null}function ZO(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function tD(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||t[s]!==e[s])return!1;return!0}function eD(t,e,i){if(e)for(let n in e)i&&n in i||t.removeAttribute(n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(n,i[n])}KO.prototype.children=_O.prototype.children=YO.prototype.children=MO;class iD{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var nD=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(nD||(nD={}));class sD extends Lt{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new rD(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new lD(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,{start:i,end:n}=hD(t,e);return new lD(t,(i?e?-3e8:-1:4e8)-1,1+(n?e?2e8:1:-5e8),e,t.widget||null,!0)}static line(t){return new oD(t)}static set(t,e=!1){return Ht.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}sD.none=Ht.empty;class rD extends sD{constructor(t){let{start:e,end:i}=hD(t);super(e?-1:4e8,i?1:-5e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof rD&&this.tagName==t.tagName&&this.class==t.class&&tD(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}rD.prototype.point=!1;class oD extends sD{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof oD&&tD(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}oD.prototype.mapMode=k.TrackBefore,oD.prototype.point=!0;class lD extends sD{constructor(t,e,i,n,s,r){super(e,i,s,t),this.block=n,this.isReplace=r,this.mapMode=n?e<=0?k.TrackBefore:k.TrackAfter:k.TrackDel}get type(){return this.startSide<this.endSide?nD.WidgetRange:this.startSide<=0?nD.WidgetBefore:nD.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof lD&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function hD(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return null==i&&(i=t.inclusive),null==n&&(n=t.inclusive),{start:null!=i?i:e,end:null!=n?n:e}}function aD(t,e,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=t?i[s]=Math.max(i[s],e):i.push(t,e)}lD.prototype.point=!0;class cD extends CO{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,r){if(i){if(!(i instanceof cD))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),BO(this,t,e,i?i.children:[],s,r),!0}split(t){let e=new cD;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){tD(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){JO(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=ZO(e,this.attrs||{})),i&&(this.attrs=ZO({class:i},this.attrs||{}))}domAtPos(t){return XO(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(kO(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(eD(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&CO.get(i)instanceof GO;)i=i.lastChild;if(!i||"BR"!=i.nodeName&&0==(null===(e=CO.get(i))||void 0===e?void 0:e.isEditable)&&(!qO.ios||!this.children.some((t=>t instanceof KO)))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof KO))return null;let i=aO(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return QO(this,t,e)}become(t){return!1}get type(){return nD.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],r=n+s.length;if(r>=e){if(s instanceof cD)return s;if(r>e)break}n=r+s.breakAfter}return null}}class dD extends CO{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof dD&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?AO.before(this.dom):AO.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new dD(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return MO}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):f.empty}domBoundsAround(){return null}become(t){return t instanceof dD&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class uD{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof dD&&t.type==nD.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new cD),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(fD(new YO(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(fD(new KO(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s){let r=e-t;if(i instanceof lD)if(i.block){let{type:t}=i;t!=nD.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new dD(i.widget||new pD("div"),r,t))}else{let o=_O.create(i.widget||new pD("span"),r,i.startSide),l=this.atCursorPos&&!o.isEditable&&s<=n.length&&(t<e||i.startSide>0),h=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(n),l&&(a.append(fD(new YO(1),n),s),s=n.length+Math.max(0,s-n.length)),a.append(fD(o,n),s),this.atCursorPos=h,this.pendingBuffer=h?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}filterPoint(t,e,i,n){if(n<this.disallowBlockEffectsBelow&&i instanceof lD){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,n,s){let r=new uD(t,e,i,s);return r.openEnd=Ht.spans(n,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function fD(t,e){for(let i of e)t=new GO(i,[t],t.length);return t}class pD extends iD{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const gD=[],mD=H.define(),vD=H.define(),wD=H.define(),yD=H.define(),bD=H.define(),xD=H.define(),SD=ft.define({map:(t,e)=>t.map(e)}),kD=ft.define({map:(t,e)=>t.map(e)});class AD{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new AD(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const MD=ft.define({map:(t,e)=>t.map(e)});function CD(t,e,i){let n=t.facet(yD);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const OD=H.define({combine:t=>!t.length||t[0]});class DD{constructor(t,e){this.field=t,this.get=e}}class TD{from(t){return new DD(this,t)}static define(){return new TD}}TD.decorations=TD.define(),TD.atomicRanges=TD.define(),TD.scrollMargins=TD.define();let BD=0;const ED=H.define();class RD{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=ED.of(this)}static define(t,e){let{eventHandlers:i,provide:n,decorations:s}=e||{},r=[];if(n)for(let t of Array.isArray(n)?n:[n])r.push(t);return i&&r.push(LD.from((t=>({plugin:t,handlers:i})))),s&&r.push(TD.decorations.from(s)),new RD(BD++,t,r)}static fromClass(t,e){return RD.define((e=>new t(e)),e)}}const LD=TD.define();class VD{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:n}of this.spec.fields)i==t&&e.push(n(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(CD(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){CD(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){CD(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const ND=H.define(),PD=H.define(),HD=H.define(),WD=H.define();class ID{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new ID(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let l=n==t.length?null:t[n],h=r-o,a=l?l.fromB:1e9;for(;s<e.length&&e[s]<a;){let t=e[s],n=e[s+1],r=Math.max(o,t),l=Math.min(a,n);if(r<=l&&new ID(r+h,l+h,r,l).addToSet(i),n>a)break;s+=2}if(!l)return i;new ID(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class FD{constructor(t,e,i=gD){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=M.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let n=[];this.changes.iterChangedRanges(((t,e,i,s)=>n.push(new ID(t,e,i,s)))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var zD=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(zD||(zD={}));const qD=zD.LTR,KD=zD.RTL;function GD(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const jD=GD("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),_D=GD("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),UD=Object.create(null),$D=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);UD[e]=i,UD[i]=-e}const YD=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class XD{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?KD:qD}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<e:o.to>e:t[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const JD=[];function QD(t,e){let i=t.length,n=e==qD?1:2,s=e==qD?2:1;if(!t||1==n&&!YD.test(t))return ZD(i);for(let e=0,s=n,o=n;e<i;e++){let i=(r=t.charCodeAt(e))<=247?jD[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?_D[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),JD[e]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let t=0,e=n,s=n;t<i;t++){let n=JD[t];if(128==n)t<i-1&&e==JD[t+1]&&24&e?n=JD[t]=e:JD[t]=256;else if(64==n){let n=t+1;for(;n<i&&64==JD[n];)n++;let r=t&&8==e||n<i&&8==JD[n]?1==s?1:8:256;for(let e=t;e<n;e++)JD[e]=r;t=n-1}else 8==n&&1==s&&(JD[t]=1);e=n,7&n&&(s=n)}for(let e,r,o,l=0,h=0,a=0;l<i;l++)if(r=UD[e=t.charCodeAt(l)])if(r<0){for(let t=h-3;t>=0;t-=3)if($D[t+1]==-r){let e=$D[t+2],i=2&e?n:4&e?1&e?s:n:0;i&&(JD[l]=JD[$D[t]]=i),h=t;break}}else{if(189==$D.length)break;$D[h++]=l,$D[h++]=e,$D[h++]=a}else if(2==(o=JD[l])||1==o){let t=o==n;a=t?0:1;for(let e=h-3;e>=0;e-=3){let i=$D[e+2];if(2&i)break;if(t)$D[e+2]|=2;else{if(4&i)break;$D[e+2]|=4}}}for(let t=0;t<i;t++)if(256==JD[t]){let e=t+1;for(;e<i&&256==JD[e];)e++;let s=1==(t?JD[t-1]:n),r=s==(1==(e<i?JD[e]:n))?s?1:2:n;for(let i=t;i<e;i++)JD[i]=r;t=e-1}let o=[];if(1==n)for(let t=0;t<i;){let e=t,n=1!=JD[t++];for(;t<i&&n==(1!=JD[t]);)t++;if(n)for(let i=t;i>e;){let t=i,n=2!=JD[--i];for(;i>e&&n==(2!=JD[i-1]);)i--;o.push(new XD(i,t,n?2:1))}else o.push(new XD(e,t,0))}else for(let t=0;t<i;){let e=t,n=2==JD[t++];for(;t<i&&n==(2==JD[t]);)t++;o.push(new XD(e,t,n?1:2))}return o}function ZD(t){return[new XD(0,t,0)]}let tT="";function eT(t,e,i,s,r){var o;let l=s.head-t.from,h=-1;if(0==l){if(!r||!t.length)return null;e[0].level!=i&&(l=e[0].side(!1,i),h=0)}else if(l==t.length){if(r)return null;let t=e[e.length-1];t.level!=i&&(l=t.side(!0,i),h=e.length-1)}h<0&&(h=XD.find(e,l,null!==(o=s.bidiLevel)&&void 0!==o?o:-1,s.assoc));let a=e[h];l==a.side(r,i)&&(a=e[h+=r?1:-1],l=a.side(!r,i));let c=r==(a.dir==i),d=n(t.text,l,c);if(tT=t.text.slice(Math.min(l,d),Math.max(l,d)),d!=a.side(r,i))return L.cursor(d+t.from,c?-1:1,a.level);let u=h==(r?e.length-1:0)?null:e[h+(r?1:-1)];return u||a.level==i?u&&u.level<a.level?L.cursor(u.side(!r,i)+t.from,r?1:-1,u.level):L.cursor(d+t.from,r?-1:1,a.level):L.cursor(r?t.to:t.from,r?-1:1,i)}class iT{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Mt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let t=n.nextSibling;if(t==e)break;let s=CO.get(n),r=CO.get(t);(s&&r?s.breakAfter:(s?s.breakAfter:nT(n))||nT(t)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(e))&&(r=s.index,o=s[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=CO.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function nT(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class sT{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class rT extends CO{constructor(t){super(),this.view=t,this.compositionDeco=sD.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new cD],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ID(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=sD.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=lT(t);if(!i)return sD.none;let{from:n,to:s,node:r,text:o}=i,l=e.mapPos(n,1),h=Math.max(l,e.mapPos(s,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new iT([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),"￿")==c)h=l+c.length;else{if(a.doc.sliceString(Math.max(0,h-c.length),h,"￿")!=c)return sD.none;l=h-c.length}else if(a.doc.sliceString(l,h,"￿")!=c)return sD.none;let d=CO.get(r);d instanceof UO?d=d.widget.topView:d&&(d.parent=null);return sD.set(sD.replace({widget:new hT(r,o,d)}).range(l,h))}(this.view,t.changes)),(qO.ie||qO.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let n=new cT;return Ht.compare(t,e,i,n),n.changes}(this.decorations,this.updateDeco(),t.changes);return e=ID.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=qO.chrome||qO.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof dD&&t.widget instanceof oT&&n.push(t.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let n=e>=0?t[e]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:l}=n,{content:h,breakAtStart:a,openStart:c,openEnd:d}=uD.build(this.view.state.doc,o,l,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);TO(this,p,g,u,f,h,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||qO.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if(qO.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(t,s.node.childNodes[s.offset]||null))),s=r=new AO(t,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&cO(s.node,s.offset,l.anchorNode,l.anchorOffset)&&cO(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{qO.android&&qO.chrome&&this.dom.contains(l.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=oO(this.root);if(n.empty){if(qO.gecko){let t=(e=s.node,i=s.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=aT(s.node,s.offset,1==t?1:-1);e&&(s=new AO(e,1==t?0:e.nodeValue.length))}}t.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(t.extend)t.collapse(s.node,s.offset),t.extend(r.node,r.offset);else{let e=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),e.setEnd(r.node,r.offset),e.setStart(s.node,s.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new AO(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new AO(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=oO(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=cD.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(OD)?this.root.activeElement==this.dom:hO(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=CO.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof cD)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(t>r||t==r&&s.type!=nD.WidgetBefore&&s.type!=nD.WidgetAfter&&(!n||2==e||this.children[n-1].breakAfter||this.children[n-1].type==nD.WidgetBefore&&e>-2))return s.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,n=this.view.contentDOM.clientWidth,s=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,l=0;l<this.children.length;l++){let h=this.children[l],a=o+h.length;if(a>i)break;if(o>=e){let e=h.dom.getBoundingClientRect();if(t.push(e.height),s){let t=h.dom.lastChild,i=t?aO(t):[];if(i.length){let t=i[i.length-1],s=this.view.textDirection==zD.LTR?t.right-e.left:e.right-t.left;s>r&&(r=s,this.minWidth=n,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+h.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof cD){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=aO(i.firstChild)[0];t=i.getBoundingClientRect().height,e=n?n.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new DO(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(sD.replace({widget:new oT(n),block:!0,inclusive:!0}).range(i,r))}if(!s)break;i=s.to+1}return sD.set(t)}updateDeco(){let t=this.view.pluginField(TD.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(HD),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)});let s=0,r=0,o=0,l=0;for(let t of this.view.pluginField(TD.scrollMargins))if(t){let{left:e,right:i,top:n,bottom:h}=t;null!=e&&(s=Math.max(s,e)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=h&&(l=Math.max(l,h))}let h={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+l};!function(t,e,i,n,s,r,o,l){let h=t.ownerDocument,a=h.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==h.body;if(d)t=mO(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==s)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let n=e.bottom-e.top,r=t.bottom-t.top;f=("center"==s&&n<=r?e.top+n/2-r/2:"start"==s||"center"==s&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==n?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==n?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==n==l?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,h,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==zD.LTR)}}class oT extends iD{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function lT(t){let e=t.observer.selectionRange,i=e.focusNode&&aT(e.focusNode,e.focusOffset,0);if(!i)return null;let n=t.docView.nearest(i);if(!n)return null;if(n instanceof cD){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!CO.get(e);)e=e.previousSibling;let s=e?CO.get(e).posAtEnd:n.posAtStart;return{from:s,to:s,node:t,text:i}}{for(;;){let{parent:t}=n;if(!t)return null;if(t instanceof cD)break;n=t}let t=n.posAtStart;return{from:t,to:t+n.length,node:n.dom,text:i}}}class hT extends iD{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return UO}}function aT(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=fO(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class cT{constructor(){this.changes=[]}compareRange(t,e){aD(t,e,this.changes)}comparePoint(t,e){aD(t,e,this.changes)}}function dT(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function uT(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function fT(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function pT(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function gT(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function mT(t,e,i){let n,s,r,o,l,h,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=aO(d);for(let u=0;u<t.length;u++){let f=t[u];s&&fT(s,f)&&(f=pT(gT(f,s.bottom),s.top));let p=dT(e,f),g=uT(i,f);if(0==p&&0==g)return 3==d.nodeType?vT(d,e,i):mT(d,e,i);(!n||o>g||o==g&&r>p)&&(n=d,s=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(l=d,a=f):i<f.top&&(!c||c.top>f.top)&&(h=d,c=f):a&&fT(a,f)?a=gT(a,f.bottom):c&&fT(c,f)&&(c=pT(c,f.top))}}if(a&&a.bottom>=i?(n=l,s=a):c&&c.top<=i&&(n=h,s=c),!n)return{node:t,offset:0};let d=Math.max(s.left,Math.min(s.right,e));return 3==n.nodeType?vT(n,d,i):r||"true"!=n.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,n)+(e>=(s.left+s.right)/2?1:0)}:mT(n,d,i)}function vT(t,e,i){let n=t.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<n;l++){let n=xO(t,l,l+1).getClientRects();for(let h=0;h<n.length;h++){let a=n[h];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,n=i;if(qO.chrome||qO.gecko){xO(t,l).getBoundingClientRect().left==a.right&&(n=!i)}if(c<=0)return{node:t,offset:l+(n?1:0)};s=l+(n?1:0),r=c}}}return{node:t,offset:s>-1?s:o>0?t.nodeValue.length:0}}function wT(t,{x:e,y:i},n,s=-1){var r;let o,l=t.contentDOM.getBoundingClientRect(),h=l.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-h;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=nD.Text;)for(;c=s>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return n?null:0;i=!0,s=-s}i=h+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:n?null:yT(t,l,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:yT(t,l,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(l.left+1,Math.min(l.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),qO.safari&&function(t,e,i){let n;if(3!=t.nodeType||e!=(n=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return xO(t,n-1,n).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let n=cD.find(t.docView,d);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=mT(n.dom,e,i))}return t.docView.posFromDOM(g,m)}function yT(t,e,i,n,s){let r=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((s-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+u(o,r,t.state.tabSize)}function bT(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=t.bidiSpans(s);for(let o=e,l=null;;){let e=eT(s,r,t.textDirection,o,i),h=tT;if(!e){if(s.number==(i?t.state.doc.lines:1))return o;h="\n",s=t.state.doc.line(s.number+(i?1:-1)),r=t.bidiSpans(s),e=L.cursor(i?s.from:s.to)}if(l){if(!l(h))return o}else{if(!n)return e;l=n(h)}o=e}}function xT(t,e,i){let n=t.pluginField(TD.atomicRanges);for(;;){let t=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=e.from>i.from?L.cursor(n,1):L.cursor(s,-1),t=!0)}));if(!t)return i}}class ST{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in OT){let i=OT[e];t.contentDOM.addEventListener(e,(n=>{"keydown"==e&&this.keydown(t,n)||CT(t,n)&&!this.ignoreDuringComposition(n)&&(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),qO.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(LD);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{CT(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(t){CD(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(e){CD(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if(qO.android&&qO.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!qO.ios||!(i=kT.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,SO(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(qO.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(t,e){let i=9==e.keyCode&&Date.now()<this.lastEscPress+2e3;return 27==e.keyCode?this.lastEscPress=Date.now():AT.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!qO.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const kT=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],AT=[16,17,18,20,91,92,224,225];class MT{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Mt.allowMultipleSelections)&&function(t,e){let i=t.state.facet(mD);return i.length?i[0](e):qO.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(vD);return i.length?i[0](e):qO.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=oO(t.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let t=0;t<s.length;t++){let i=s[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=FT(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function CT(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=CO.get(n))&&i.ignoreEvent(e))return!1;return!0}const OT=Object.create(null),DT=qO.ie&&qO.ie_version<15||qO.ios&&qO.webkit_version<604;function TT(t,e){let i,{state:n}=t,s=1,r=n.toText(e),o=r.lines==n.selection.ranges.length;if(null!=qT&&n.selection.ranges.every((t=>t.empty))&&qT==r.toString()){let t=-1;i=n.changeByRange((i=>{let l=n.doc.lineAt(i.from);if(l.from==t)return{range:i};t=l.from;let h=n.toText((o?r.line(s++).text:e)+n.lineBreak);return{changes:{from:l.from,insert:h},range:L.cursor(i.from+h.length)}}))}else i=o?n.changeByRange((t=>{let e=r.line(s++);return{changes:{from:t.from,to:t.to,insert:e.text},range:L.cursor(t.from+e.length)}})):n.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}OT.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select")};let BT=0;function ET(t,e,i,s){if(1==s)return L.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),r=t.doc.lineAt(e),o=e-r.from;if(0==r.length)return L.cursor(e);0==o?i=1:o==r.length&&(i=-1);let l=o,h=o;i<0?l=n(r.text,o,!1):h=n(r.text,o);let a=s(r.text.slice(l,h));for(;l>0;){let t=n(r.text,l,!1);if(s(r.text.slice(t,l))!=a)break;l=t}for(;h<r.length;){let t=n(r.text,h);if(s(r.text.slice(h,t))!=a)break;h=t}return L.range(l+r.from,h+r.from)}(t.state,e,i);{let i=cD.find(t.docView,e),n=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<t.state.doc.length&&r==n.to&&r++,L.range(s,r)}}OT.touchstart=(t,e)=>{BT=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},OT.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},OT.mousedown=(t,e)=>{if(t.observer.flush(),BT>Date.now()-2e3&&1==FT(e))return;let i=null;for(let n of t.state.facet(wD))if(i=n(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=NT(t,e),n=FT(e),s=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),s=s.map(t.changes),o=null)},get(e,l,h){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=NT(t,e),o=e),!a||!i)return s;let c=ET(t,a.pos,a.bias,n);if(i.pos!=a.pos&&!l){let e=ET(t,i.pos,i.bias,n),s=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=s<c.from?L.range(s,r):L.range(r,s)}return l?s.replaceRange(s.main.extend(c.from,c.to)):h?s.addRange(c):L.create([c])}}}(t,e)),i){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore((()=>bO(t.contentDOM))),t.inputState.startMouseSelection(new MT(t,e,i,n))}};let RT=(t,e)=>t>=e.top&&t<=e.bottom,LT=(t,e,i)=>RT(e,i)&&t>=i.left&&t<=i.right;function VT(t,e,i,n){let s=cD.find(t.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&LT(i,n,o))return-1;let l=s.coordsAt(r,1);return l&&LT(i,n,l)?1:o&&RT(n,o)?-1:1}function NT(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:VT(t,i,e.clientX,e.clientY)}}const PT=qO.ie&&qO.ie_version<=11;let HT=null,WT=0,IT=0;function FT(t){if(!PT)return t.detail;let e=HT,i=IT;return HT=t,IT=Date.now(),WT=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(WT+1)%3:1}function zT(t,e,i,n){if(!i)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:i},h=t.state.changes(o?[o,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}OT.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},OT.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&zT(t,e,n.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(n[t]=e.result),r()},e.readAsText(i[t])}}else zT(t,e,e.dataTransfer.getData("Text"),!0)},OT.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=DT?null:e.clipboardData;i?(TT(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),TT(t,i.value)}),50)}(t)};let qT=null;function KT(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}OT.copy=OT.cut=(t,e)=>{let{text:i,ranges:n,linewise:s}=function(t){let e=[],i=[],n=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let s=-1;for(let{from:n}of t.selection.ranges){let r=t.doc.lineAt(n);r.number>s&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),s=r.number}n=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:n}}(t.state);if(!i&&!s)return;qT=s?i:null;let r=DT?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout((()=>{n.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},OT.focus=OT.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},OT.beforeprint=t=>{t.viewState.printing=!0,t.requestMeasure(),setTimeout((()=>{t.viewState.printing=!1,t.requestMeasure()}),2e3)},OT.compositionstart=OT.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),KT(t,!0)))},OT.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&KT(t,!1)}),50)},OT.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},OT.beforeinput=(t,e)=>{var i;let n;if(qO.chrome&&qO.android&&(n=kT.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const GT=["pre-wrap","normal","pre-line","break-spaces"];class jT{constructor(){this.doc=f.empty,this.lineWrapping=!1,this.direction=zD.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return GT.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(e=!0,this.heightSamples[Math.floor(10*n)]=!0)}return e}refresh(t,e,i,n,s,r){let o=GT.indexOf(t)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=n,this.lineLength=s,l){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return l}}class _T{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class UT{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new UT(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new UT(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var $T=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}($T||($T={}));class YT{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return YT.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:h,toB:a}=n[r],c=s.lineAt(o,$T.ByPosNoHeight,e,0,0),d=c.to>=l?c:s.lineAt(l,$T.ByPosNoHeight,e,0,0);for(a+=d.to-l,l=d.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,h=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,$T.ByPosNoHeight,e,0,0));h+=c.from-o,o=c.from;let u=eB.build(i,t,h,a);s=s.replace(o,l,u)}return s.updateHeight(i,0)}static empty(){return new JT(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>2*s){let s=t[e-1];s.break?t.splice(--e,1,s.left,null,s.right):t.splice(--e,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,s-=e.size}}else if(n<s){let i=t[e++];i&&(n+=i.size)}else{let e=t[--i];e&&(s+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new ZT(YT.of(t.slice(0,e)),r,YT.of(t.slice(i)))}}YT.prototype.size=1;class XT extends YT{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new UT(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,r){r(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class JT extends XT{constructor(t,e){super(t,e,nD.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return 1==i.length&&(n instanceof JT||n instanceof QT&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof QT?n=new JT(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):YT.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class QT extends YT{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(e,n),l=Math.max(0,Math.min(r-s,Math.floor((t-i)/o))),{from:h,length:a}=e.line(s+l);return new UT(h,a,i+o*l,o,nD.Text)}lineAt(t,e,i,n,s){if(e==$T.ByHeight)return this.blockAt(t,i,n,s);if(e==$T.ByPosNoHeight){let{from:e,to:n}=i.lineAt(t);return new UT(e,n-e,0,0,nD.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:l,length:h,number:a}=i.lineAt(t);return new UT(l,h,n+o*(a-r),o,nD.Text)}forEachLine(t,e,i,n,s,r){let{firstLine:o,lineHeight:l}=this.lines(i,s);for(let h=Math.max(t,s),a=Math.min(s+this.length,e);h<=a;){let e=i.lineAt(h);h==t&&(n+=l*(e.number-o)),r(new UT(e.from,e.length,n,l,nD.Text)),n+=l,h=e.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let t=i[i.length-1];t instanceof QT?i[i.length-1]=new QT(t.length+n):i.push(null,new QT(n-1))}if(t>0){let e=i[0];e instanceof QT?i[0]=new QT(t+e.length):i.unshift(new QT(t-1),null)}return YT.of(i)}decomposeLeft(t,e){e.push(new QT(t-1),null)}decomposeRight(t,e){e.push(null,new QT(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let i=[],r=Math.max(e,n.from),o=-1,l=t.heightChanged;for(n.from>e&&i.push(new QT(n.from-e-1).updateHeight(t,e));r<=s&&n.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let l=new JT(e,s);l.outdated=!1,i.push(l),r+=e+1}r<=s&&i.push(null,new QT(s-r).updateHeight(t,r));let h=YT.of(i);return t.heightChanged=l||o<0||Math.abs(h.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,h}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class ZT extends YT{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,l=e==$T.ByHeight?t<r:t<o,h=l?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,r,o);if(this.break||(l?h.to<o:h.from>o))return h;let a=e==$T.ByPosNoHeight?$T.ByPosNoHeight:$T.ByPos;return l?h.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,n,s).join(h)}forEachLine(t,e,i,n,s,r){let o=n+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,n,s,r),e>=l&&this.right.forEachLine(t,e,i,o,l,r);else{let h=this.lineAt(l,$T.ByPos,i,n,s);t<h.from&&this.left.forEachLine(t,h.from-1,i,n,s,r),h.to>=t&&h.from<=e&&r(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,o,l,r)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let r=s.length;for(let t of i)s.push(t);if(t>0&&tB(s,r-1),e<this.length){let t=s.length;this.decomposeRight(e,s),tB(s,t)}return YT.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?YT.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:r}=this,o=e+s.length+this.break,l=null;return n&&n.from<=e+s.length&&n.more?l=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=o+r.length&&n.more?l=r=r.updateHeight(t,o,i,n):r.updateHeight(t,o,i),l?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function tB(t,e){let i,n;null==t[e]&&(i=t[e-1])instanceof QT&&(n=t[e+1])instanceof QT&&t.splice(e-1,3,new QT(i.length+1+n.length))}class eB{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof JT?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new JT(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new XT(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new JT(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new QT(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof JT)return t;let e=new JT(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=nD.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=nD.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof JT||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new JT(0,-1));let i=t;for(let t of this.nodes)t instanceof JT&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,n){let s=new eB(i,t);return Ht.spans(e,i,n,s,0),s.finish(i)}}class iB{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&aD(t,e,this.changes,5)}}class nB{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return sD.replace({widget:new sB(this.size,t)}).range(this.from,this.to)}}class sB extends iD{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class rB{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new jT,this.scaler=uB,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=YT.empty().applyChanges(t.facet(HD),f.empty,this.heightOracle.setDoc(t.doc),[new ID(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=sD.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>n>=t&&n<=e))){let{from:e,to:i}=this.lineBlockAt(n);t.push(new oB(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?uB:new fB(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:pB(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let n=this.state.facet(HD),s=t.changedRanges,r=ID.extendWithRanges(s,function(t,e,i){let n=new iB;return Ht.compare(t,e,i,n,0),n.changes}(t.startState.facet(HD),n,t?t.changes:M.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace,r="rtl"==i.direction?zD.RTL:zD.LTR,o=this.heightOracle.mustRefreshForStyle(s,r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,n=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==n||(h|=8,this.paddingTop=t,this.paddingBottom=n)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:function(t,e){let i=t.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=l;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();n=Math.max(n,e.left),s=Math.min(s,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let e=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(e)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:l}=t.docView.measureTextSize();o=n.refresh(s,r,i,l,p/l,e),o&&(t.docView.minWidth=0,h|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),n.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(n,0,o,new _T(this.viewport.from,e)),n.heightChanged&&(h|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&h||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new oB(n.lineAt(r-1e3*i,$T.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),$T.ByHeight,s,0,0).to);if(e){let{head:t}=e.range;if(t<l.from||t>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(t,$T.ByPos,s,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<l.from?o.top:o.bottom-r,l=new oB(n.lineAt(i-500,$T.ByHeight,s,0,0).from,n.lineAt(i+r+500,$T.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new oB(this.heightMap.lineAt(i,$T.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,$T.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,$T.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,$T.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||n<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new nB(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=zD.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=lB(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=hB(r,(this.visibleTop-i.top-t)/i.height),s=hB(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;n=hB(r,(this.pixelViewport.left-e)/t),s=hB(r,(this.pixelViewport.right+e)/t)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&cB(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&cB(o,l.to-10,l.to+10);for(let{from:n,to:s}of o)s-n>1e3&&e.push(dB(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-n)<1e3&&Math.abs(t.to-s)<1e3))||new nB(n,s,this.gapSize(i,n,s,r)))}return e}gapSize(t,e,i,n){let s=aB(n,i)-aB(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){nB.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=sD.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(HD);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Ht.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||pB(this.heightMap.lineAt(t,$T.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return pB(this.heightMap.lineAt(this.scaler.fromDOM(t),$T.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return pB(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class oB{constructor(t,e){this.from=t,this.to=e}}function lB(t,e,i){let n=[],s=t,r=0;return Ht.spans(i.facet(HD),t,e,{span(){},point(t,e){t>s&&(n.push({from:s,to:t}),r+=t-s),s=e}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function hB({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:s}=e[t],r=s-i;if(n<=r)return i+n;n-=r}}function aB(t,e){let i=0;for(let{from:n,to:s}of t.ranges){if(e<=s){i+=e-n;break}i+=s-n}return i/t.total}function cB(t,e,i){for(let n=0;n<t.length;n++){let s=t[n];if(s.from<i&&s.to>e){let r=[];s.from<e&&r.push({from:s.from,to:e}),s.to>i&&r.push({from:i,to:s.to}),t.splice(n,1,...r),n+=r.length-1}}}function dB(t,e){for(let i of t)if(e(i))return i}const uB={toDOM:t=>t,fromDOM:t=>t,scale:1};class fB{constructor(t,e,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=e.lineAt(i,$T.ByPos,t,0,0).top,o=e.lineAt(s,$T.ByPos,t,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(e.height-n);for(let t of this.viewports)t.domTop=r+(t.top-s)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),s=t.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function pB(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new UT(t.from,t.length,i,n-i,Array.isArray(t.type)?t.type.map((t=>pB(t,e))):t.type)}const gB=H.define({combine:t=>t.join(" ")}),mB=H.define({combine:t=>t.indexOf(!0)>-1}),vB=Bt.newName(),wB=Bt.newName(),yB=Bt.newName(),bB={"&light":"."+wB,"&dark":"."+yB};function xB(t,e,i){return new Bt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const SB=xB("."+vB,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},bB),kB={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},AB=qO.ie&&qO.ie_version<=11;class MB{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new vO,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(qO.ie&&qO.ie_version<=11||qO.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),AB&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(OD)?e.root.activeElement!=this.dom:!hO(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((qO.ie&&qO.ie_version<=11||qO.android&&qO.chrome)&&!e.state.selection.main.empty&&i.focusNode&&cO(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=oO(t),i=qO.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let n=e.startContainer,s=e.startOffset,r=e.endContainer,o=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);cO(l.node,l.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,kB),AB&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),AB&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;SO(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let t=this.readMutation(s);t&&(t.typeOver&&(n=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&hO(this.dom,this.selectionRange);if(e<0&&!s)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,n),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=CB(e,t.previousSibling||t.target.previousSibling,-1),n=CB(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function CB(t,e,i){for(;e;){let n=CO.get(e);if(n&&n.parent==t)return n;let s=e.parentNode;e=s!=t.dom?s:i>0?e.nextSibling:e.previousSibling}return null}function OB(t,e,i,n){let s,r,o=t.state.selection.main;if(e>-1){let n=t.docView.domBoundsAround(e,i,0);if(!n||t.state.readOnly)return;let{from:l,to:h}=n,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new sT(i,n)),s==i&&r==n||e.push(new sT(s,r)));return e}(t),c=new iT(a,t.state);c.readRange(n.startDOM,n.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||qO.android&&c.text.length<h-l)&&(d=o.to,u="end");let p=function(t,e,i,n){let s=Math.min(t.length,e.length),r=0;for(;r<s&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&t.length==e.length)return null;let o=t.length,l=e.length;for(;o>0&&l>0&&t.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(t.state.doc.sliceString(l,h,"￿"),c.text,d-l,u);p&&(qO.chrome&&13==t.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==c.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:f.of(c.text.slice(p.from,p.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,n=2==t.length?t[1].pos:i;return i>-1&&n>-1?L.single(i+e,n+e):null}(a,l)}else if(t.hasFocus||!t.state.facet(OD)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=t.docView,s=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!lO(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),l=n&&n.node==e.anchorNode&&n.offset==e.anchorOffset||!lO(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);s==o.head&&l==o.anchor||(r=L.single(l,s))}if(s||r)if(!s&&n&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,s.from).append(s.insert).append(t.state.doc.slice(s.to,o.to))}),s){let e=t.state;if(qO.ios&&t.inputState.flushIOSKey(t))return;if(qO.android&&(s.from==o.from&&s.to==o.to&&1==s.insert.length&&2==s.insert.lines&&SO(t.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&0==s.insert.length&&SO(t.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&0==s.insert.length&&SO(t.contentDOM,"Delete",46)))return;let i,n=s.insert.toString();if(t.state.facet(xD).some((e=>e(t,s.from,s.to,n))))return;if(t.inputState.composing>=0&&t.inputState.composing++,s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&t.inputState.composing<0){let n=o.from<s.from?e.sliceDoc(o.from,s.from):"",r=o.to>s.to?e.sliceDoc(s.to,o.to):"";i=e.replaceSelection(t.state.toText(n+s.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let n=e.changes(s),l=r&&!e.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let r=t.state.sliceDoc(s.from,s.to),h=lT(t)||t.state.doc.lineAt(o.head),a=o.to-s.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:n,range:l||i.map(n)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let f=e.changes({from:u,to:d,insert:s.insert}),p=i.to-o.to;return{changes:f,range:l?L.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}}))}else i={changes:n,selection:l&&e.selection.replaceRange(l)}}let l="input.type";t.composing&&(l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:l})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class DB{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new rB(t.state||Mt.create()),this.plugins=this.state.facet(ED).map((t=>new VD(t)));for(let t of this.plugins)t.update(this);this.observer=new MB(this,((t,e,i)=>{OB(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new ST(this),this.docView=new rT(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);if(n.facet(Mt.phrases)!=this.state.facet(Mt.phrases))return this.setState(n);e=new FD(this,n,t);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(s&&(s=s.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;s=new AD(t.empty?t:L.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(SD)?s=new AD(t.value):t.is(kD)?s=new AD(t.value,"center"):t.is(MD)&&(s=t.value)}this.viewState.update(e,s),this.bidiCache=RB.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(WD)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(gB)!=e.state.facet(gB)&&(this.viewState.mustMeasureContent=!0),(i||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(bD))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new rB(t),this.plugins=t.facet(ED).map((t=>new VD(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new rT(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(ED),i=t.state.facet(ED);if(e!=i){let n=[];for(let s of i){let i=e.indexOf(s);if(i<0)n.push(new VD(s));else{let e=this.plugins[i];e.mustUpdate=t,n.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((t=>{try{return t.read(this)}catch(t){return CD(this.state,t),EB}})),o=new FD(this,this.state),l=!1,h=!1;o.flags|=n,e?e.flags|=n:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),l=this.docView.update(o));for(let t=0;t<s.length;t++)if(r[t]!=EB)try{let e=s[t];e.write&&e.write(r[t],this)}catch(t){CD(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),l&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(bD))t(e)}get themeClasses(){return vB+" "+(this.state.facet(mB)?yB:wB)+" "+this.state.facet(gB)}updateAttrs(){let t=LB(this,ND,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(OD)?"true":"false",class:"cm-content",style:`${qO.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),LB(this,PD,e),this.observer.ignore((()=>{eD(this.contentDOM,this.contentAttrs,e),eD(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(DB.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(WD),Bt.mount(this.root,this.styleModules.concat(SB).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=BB(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=BB(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=BB(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return xT(this,t,bT(this,t,e,i))}moveByGroup(t,e){return xT(this,t,bT(this,t,e,(e=>function(t,e,i){let n=t.state.charCategorizer(e),s=n(i);return t=>{let e=n(t);return s==xt.Space&&(s=e),s==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=n&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),n=t.posAtCoords({x:i==(t.textDirection==zD.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=n)return L.cursor(n,i?-1:1)}let o=cD.find(t.docView,e.head),l=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return L.cursor(l,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return xT(this,t,function(t,e,i,n){let s=e.head,r=i?1:-1;if(s==(i?t.state.doc.length:0))return L.cursor(s,e.assoc);let o,l=e.goalColumn,h=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(s),c=t.documentTop;if(a)null==l&&(l=a.left-h.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(s-c);null==l&&(l=Math.min(h.right-h.left,t.defaultCharacterWidth*(s-e.from))),o=(r<0?e.top:e.bottom)+c}let d=h.left+l,u=null!=n?n:t.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(u+i)*r,a=wT(t,{x:d,y:n},!1,r);if(n<h.top||n>h.bottom||(r<0?a<s:a>s))return L.cursor(a,e.assoc,void 0,l)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:SD.of(L.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),wT(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n);return gO(i,s[XD.find(s,t-n.from,-1,e)].dir==zD.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>TB)return ZD(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=QD(t.text,this.textDirection);return this.bidiCache.push(new RB(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||qO.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{bO(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return MD.of(new AD("number"==typeof t?L.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return RD.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Bt.newName(),n=[gB.of(i),WD.of(xB(`.${i}`,t))];return e&&e.dark&&n.push(mB.of(!0)),n}static baseTheme(t){return X.lowest(WD.of(xB("."+vB,t,bB)))}}DB.scrollTo=SD,DB.centerOn=kD,DB.styleModule=WD,DB.inputHandler=xD,DB.exceptionSink=yD,DB.updateListener=bD,DB.editable=OD,DB.mouseSelectionStyle=wD,DB.dragMovesSelection=vD,DB.clickAddsSelectionRange=mD,DB.decorations=HD,DB.darkTheme=mB,DB.contentAttributes=PD,DB.editorAttributes=ND,DB.lineWrapping=DB.contentAttributes.of({class:"cm-lineWrapping"}),DB.announce=ft.define();const TB=4096;function BB(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const EB={};class RB{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:zD.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let r=t[s];r.dir!=n||e.touchesRange(r.from,r.to)||i.push(new RB(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function LB(t,e,i){for(let n=t.state.facet(e),s=n.length-1;s>=0;s--){let e=n[s],r="function"==typeof e?e(t):e;r&&ZO(r,i)}return i}const VB=qO.mac?"mac":qO.windows?"win":qO.linux?"linux":"key";function NB(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==i&&e.shiftKey&&(t="Shift-"+t),t}const PB=DB.domEventHandlers({keydown:(t,e)=>zB(IB(e.state),t,e,"editor")}),HB=H.define({enables:PB}),WB=new WeakMap;function IB(t){let e=t.facet(HB),i=WB.get(e);return i||WB.set(e,i=function(t,e=VB){let i=Object.create(null),n=Object.create(null),s=(t,e)=>{let i=n[t];if(null==i)n[t]=e;else if(i!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")},r=(t,n,r,o)=>{let l=i[t]||(i[t]=Object.create(null)),h=n.split(/ (?!$)/).map((t=>function(t,e){const i=t.split(/-(?!$)/);let n,s,r,o,l=i[i.length-1];"Space"==l&&(l=" ");for(let t=0;t<i.length-1;++t){const l=i[t];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))r=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);"mac"==e?o=!0:s=!0}}return n&&(l="Alt-"+l),s&&(l="Ctrl-"+l),o&&(l="Meta-"+l),r&&(l="Shift-"+l),l}(t,e)));for(let e=1;e<h.length;e++){let i=h.slice(0,e).join(" ");s(i,!0),l[i]||(l[i]={preventDefault:!0,commands:[e=>{let n=FB={view:e,prefix:i,scope:t};return setTimeout((()=>{FB==n&&(FB=null)}),4e3),!0}]})}let a=h.join(" ");s(a,!1);let c=l[a]||(l[a]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let i of t){let t=i[e]||i.key;if(t)for(let e of i.scope?i.scope.split(" "):["editor"])r(e,t,i.run,i.preventDefault),i.shift&&r(e,"Shift-"+t,i.shift,i.preventDefault)}return i}(e.reduce(((t,e)=>t.concat(e)),[]))),i}let FB=null;function zB(t,e,i,n){let s=re(e),r=1==s.length&&" "!=s,o="",l=!1;FB&&FB.view==i&&FB.scope==n&&(o=FB.prefix+" ",(l=AT.indexOf(e.keyCode)<0)&&(FB=null));let h,a=t=>{if(t){for(let e of t.commands)if(e(i))return!0;t.preventDefault&&(l=!0)}return!1},c=t[n];if(c){if(a(c[o+NB(s,e,!r)]))return!0;if(r&&(e.shiftKey||e.altKey||e.metaKey)&&(h=Yt[e.keyCode])&&h!=s){if(a(c[o+NB(h,e,!0)]))return!0}else if(r&&e.shiftKey&&a(c[o+NB(s,e,!0)]))return!0}return l}const qB=!qO.ios;const KB={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};qB&&(KB[".cm-line"].caretColor="transparent !important");const GB=H.define({combine(t){let e,i;for(let n of t)e=e||n.topContainer,i=i||n.bottomContainer;return{topContainer:e,bottomContainer:i}}});function jB(t,e){let i=t.plugin(_B),n=i?i.specs.indexOf(e):-1;return n>-1?i.panels[n]:null}const _B=_o.fromClass(class{constructor(t){this.input=t.state.facet(XB),this.specs=this.input.filter((t=>t)),this.panels=this.specs.map((e=>e(t)));let e=t.state.facet(GB);this.top=new UB(t,!0,e.topContainer),this.bottom=new UB(t,!1,e.bottomContainer),this.top.sync(this.panels.filter((t=>t.top))),this.bottom.sync(this.panels.filter((t=>!t.top)));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(t){let e=t.state.facet(GB);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new UB(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new UB(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=t.state.facet(XB);if(i!=this.input){let e=i.filter((t=>t)),n=[],s=[],r=[],o=[];for(let i of e){let e,l=this.specs.indexOf(i);l<0?(e=i(t.view),o.push(e)):(e=this.panels[l],e.update&&e.update(t)),n.push(e),(e.top?s:r).push(e)}this.specs=e,this.panels=n,this.top.sync(s),this.bottom.sync(r);for(let t of o)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}else for(let e of this.panels)e.update&&e.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:Ko.scrollMargins.from((t=>({top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()})))});class UB{constructor(t,e,i){this.view=t,this.top=e,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let t=this.dom.firstChild;for(let e of this.panels)if(e.dom.parentNode==this.dom){for(;t!=e.dom;)t=$B(t);t=t.nextSibling}else this.dom.insertBefore(e.dom,t);for(;t;)t=$B(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function $B(t){let e=t.nextSibling;return t.remove(),e}const YB=qh.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}}),XB=H.define({enables:[_B,YB]});function JB(){var t=arguments[0];"string"==typeof t&&(t=document.createElement(t));var e=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var s=i[n];"string"==typeof s?t.setAttribute(n,s):null!=s&&(t[n]=s)}e++}for(;e<arguments.length;e++)QB(t,arguments[e]);return t}function QB(t,e){if("string"==typeof e)t.appendChild(document.createTextNode(e));else if(null==e);else if(null!=e.nodeType)t.appendChild(e);else{if(!Array.isArray(e))throw new RangeError("Unsupported child node: "+e);for(var i=0;i<e.length;i++)QB(t,e[i])}}const ZB="function"==typeof String.prototype.normalize?t=>t.normalize("NFKD"):t=>t;class tE{constructor(t,e,i=0,n=t.length,s){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(i,n),this.bufferStart=i,this.normalize=s?t=>s(ZB(t)):ZB,this.query=this.normalize(e)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return h(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let t=this.peek();if(t<0)return this.done=!0,this;let e=a(t),i=this.bufferStart+this.bufferPos;this.bufferPos+=c(t);let n=this.normalize(e);for(let t=0,s=i;;t++){let r=n.charCodeAt(t),o=this.match(r,s);if(o)return this.value=o,this;if(t==n.length-1)break;s==i&&t<e.length&&e.charCodeAt(t)==r&&s++}}}match(t,e){let i=null;for(let n=0;n<this.matches.length;n+=2){let s=this.matches[n],r=!1;this.query.charCodeAt(s)==t&&(s==this.query.length-1?i={from:this.matches[n+1],to:e+1}:(this.matches[n]++,r=!0)),r||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==t&&(1==this.query.length?i={from:e,to:e+1}:this.matches.push(1,e)),i}}"undefined"!=typeof Symbol&&(tE.prototype[Symbol.iterator]=function(){return this});const eE={from:-1,to:-1,match:/.*/.exec("")},iE="gm"+(null==/x/.unicode?"":"u");class nE{constructor(t,e,i,n=0,s=t.length){if(this.to=s,this.curLine="",this.done=!1,this.value=eE,/\\[sWDnr]|\n|\r|\[\^/.test(e))return new oE(t,e,i,n,s);this.re=new RegExp(e,iE+((null==i?void 0:i.ignoreCase)?"i":"")),this.iter=t.iter();let r=t.lineAt(n);this.curLineStart=r.from,this.matchPos=n,this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;let e=this.matchPos<=this.to&&this.re.exec(this.curLine);if(e){let i=this.curLineStart+e.index,n=i+e[0].length;if(this.matchPos=n+(i==n?1:0),i==this.curLine.length&&this.nextLine(),i<n||i>this.value.to)return this.value={from:i,to:n,match:e},this;t=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),t=0}}}}const sE=new WeakMap;class rE{constructor(t,e){this.from=t,this.text=e}get to(){return this.from+this.text.length}static get(t,e,i){let n=sE.get(t);if(!n||n.from>=i||n.to<=e){let n=new rE(e,t.sliceString(e,i));return sE.set(t,n),n}if(n.from==e&&n.to==i)return n;let{text:s,from:r}=n;return r>e&&(s=t.sliceString(e,r)+s,r=e),n.to<i&&(s+=t.sliceString(n.to,i)),sE.set(t,new rE(r,s)),new rE(e,s.slice(e-r,i-r))}}class oE{constructor(t,e,i,n,s){this.text=t,this.to=s,this.done=!1,this.value=eE,this.matchPos=n,this.re=new RegExp(e,iE+((null==i?void 0:i.ignoreCase)?"i":"")),this.flat=rE.get(t,n,this.chunkEnd(n+5e3))}chunkEnd(t){return t>=this.to?this.to:this.text.lineAt(t).to}next(){for(;;){let t=this.re.lastIndex=this.matchPos-this.flat.from,e=this.re.exec(this.flat.text);if(e&&!e[0]&&e.index==t&&(this.re.lastIndex=t+1,e=this.re.exec(this.flat.text)),e&&this.flat.to<this.to&&e.index+e[0].length>this.flat.text.length-10&&(e=null),e){let t=this.flat.from+e.index,i=t+e[0].length;return this.value={from:t,to:i,match:e},this.matchPos=i+(t==i?1:0),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=rE.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function lE(t){let e=JB("input",{class:"cm-textfield",name:"line"});function i(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!i)return;let{state:n}=t,s=n.doc.lineAt(n.selection.main.head),[,r,o,l,h]=i,a=l?+l.slice(1):0,c=o?+o:s.number;if(o&&h){let t=c/100;r&&(t=t*("-"==r?-1:1)+s.number/n.doc.lines),c=Math.round(n.doc.lines*t)}else o&&r&&(c=c*("-"==r?-1:1)+s.number);let d=n.doc.line(Math.max(1,Math.min(n.doc.lines,c)));t.dispatch({effects:hE.of(!1),selection:L.cursor(d.from+Math.max(0,Math.min(a,d.length))),scrollIntoView:!0}),t.focus()}return{dom:JB("form",{class:"cm-gotoLine",onkeydown:e=>{27==e.keyCode?(e.preventDefault(),t.dispatch({effects:hE.of(!1)}),t.focus()):13==e.keyCode&&(e.preventDefault(),i())},onsubmit:t=>{t.preventDefault(),i()}},JB("label",t.state.phrase("Go to line"),": ",e)," ",JB("button",{class:"cm-button",type:"submit"},t.state.phrase("go"))),pos:-10}}"undefined"!=typeof Symbol&&(nE.prototype[Symbol.iterator]=oE.prototype[Symbol.iterator]=function(){return this});const hE=ft.define(),aE=K.define({create:()=>!0,update(t,e){for(let i of e.effects)i.is(hE)&&(t=i.value);return t},provide:t=>XB.from(t,(t=>t?lE:null))}),cE=DB.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),dE={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!0},uE=H.define({combine:t=>Ct(t,dE,{highlightWordAroundCursor:(t,e)=>t||e,minSelectionLength:Math.min,maxMatches:Math.min})});function fE(t){let e=[wE,vE];return t&&e.push(uE.of(t)),e}const pE=sD.mark({class:"cm-selectionMatch"}),gE=sD.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function mE(t,e,i,n){return!(0!=i&&t(e.sliceDoc(i-1,i))==xt.Word||n!=e.doc.length&&t(e.sliceDoc(n,n+1))==xt.Word)}const vE=RD.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(uE),{state:i}=t,n=i.selection;if(n.ranges.length>1)return sD.none;let s,r=n.main,o=null;if(r.empty){if(!e.highlightWordAroundCursor)return sD.none;let t=i.wordAt(r.head);if(!t)return sD.none;o=i.charCategorizer(r.head),s=i.sliceDoc(t.from,t.to)}else{let t=r.to-r.from;if(t<e.minSelectionLength||t>200)return sD.none;if(e.wholeWords){if(s=i.sliceDoc(r.from,r.to),o=i.charCategorizer(r.head),!mE(o,i,r.from,r.to)||!function(t,e,i,n){return t(e.sliceDoc(i,i+1))==xt.Word&&t(e.sliceDoc(n-1,n))==xt.Word}(o,i,r.from,r.to))return sD.none}else if(s=i.sliceDoc(r.from,r.to).trim(),!s)return sD.none}let l=[];for(let n of t.visibleRanges){let t=new tE(i.doc,s,n.from,n.to);for(;!t.next().done;){let{from:n,to:s}=t.value;if((!o||mE(o,i,n,s))&&(r.empty&&n<=r.from&&s>=r.to?l.push(gE.range(n,s)):(n>=r.to||s<=r.from)&&l.push(pE.range(n,s)),l.length>e.maxMatches))return sD.none}}return sD.set(l)}},{decorations:t=>t.decorations}),wE=DB.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}});const yE=H.define({combine(t){var e;return{top:t.reduce(((t,e)=>null!=t?t:e.top),void 0)||!1,caseSensitive:t.reduce(((t,e)=>null!=t?t:e.caseSensitive||e.matchCase),void 0)||!1,createPanel:(null===(e=t.find((t=>t.createPanel)))||void 0===e?void 0:e.createPanel)||(t=>new GE(t))}}});class bE{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||function(t){try{return new RegExp(t,iE),!0}catch(t){return!1}}(this.search)),this.unquoted=this.search.replace(/\\([nrt\\])/g,((t,e)=>"n"==e?"\n":"r"==e?"\r":"t"==e?"\t":"\\"))}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp}create(){return this.regexp?new ME(this):new kE(this)}getCursor(t,e=0,i=t.length){return this.regexp?AE(this,t,e,i):SE(this,t,e,i)}}class xE{constructor(t){this.spec=t}}function SE(t,e,i,n){return new tE(e,t.unquoted,i,n,t.caseSensitive?void 0:t=>t.toLowerCase())}class kE extends xE{constructor(t){super(t)}nextMatch(t,e,i){let n=SE(this.spec,t,i,t.length).nextOverlapping();return n.done&&(n=SE(this.spec,t,0,e).nextOverlapping()),n.done?null:n.value}prevMatchInRange(t,e,i){for(let n=i;;){let i=Math.max(e,n-1e4-this.spec.unquoted.length),s=SE(this.spec,t,i,n),r=null;for(;!s.nextOverlapping().done;)r=s.value;if(r)return r;if(i==e)return null;n-=1e4}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.length)}getReplacement(t){return this.spec.replace}matchAll(t,e){let i=SE(this.spec,t,0,t.length),n=[];for(;!i.next().done;){if(n.length>=e)return null;n.push(i.value)}return n}highlight(t,e,i,n){let s=SE(this.spec,t,Math.max(0,e-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,t.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}function AE(t,e,i,n){return new nE(e,t.search,t.caseSensitive?void 0:{ignoreCase:!0},i,n)}class ME extends xE{nextMatch(t,e,i){let n=AE(this.spec,t,i,t.length).next();return n.done&&(n=AE(this.spec,t,0,e).next()),n.done?null:n.value}prevMatchInRange(t,e,i){for(let n=1;;n++){let s=Math.max(e,i-1e4*n),r=AE(this.spec,t,s,i),o=null;for(;!r.next().done;)o=r.value;if(o&&(s==e||o.from>s+10))return o;if(s==e)return null}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.length)}getReplacement(t){return this.spec.replace.replace(/\$([$&\d+])/g,((e,i)=>"$"==i?"$":"&"==i?t.match[0]:"0"!=i&&+i<t.match.length?t.match[i]:e))}matchAll(t,e){let i=AE(this.spec,t,0,t.length),n=[];for(;!i.next().done;){if(n.length>=e)return null;n.push(i.value)}return n}highlight(t,e,i,n){let s=AE(this.spec,t,Math.max(0,e-250),Math.min(i+250,t.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}const CE=ft.define(),OE=ft.define(),DE=K.define({create:t=>new TE(FE(t).create(),null),update(t,e){for(let i of e.effects)i.is(CE)?t=new TE(i.value.create(),t.panel):i.is(OE)&&(t=new TE(t.query,i.value?IE:null));return t},provide:t=>XB.from(t,(t=>t.panel))});class TE{constructor(t,e){this.query=t,this.panel=e}}const BE=sD.mark({class:"cm-searchMatch"}),EE=sD.mark({class:"cm-searchMatch cm-searchMatch-selected"}),RE=RD.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(DE))}update(t){let e=t.state.field(DE);(e!=t.startState.field(DE)||t.docChanged||t.selectionSet)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return sD.none;let{view:i}=this,n=new Wt;for(let e=0,s=i.visibleRanges,r=s.length;e<r;e++){let{from:o,to:l}=s[e];for(;e<r-1&&l>s[e+1].from-500;)l=s[++e].to;t.highlight(i.state.doc,o,l,((t,e)=>{let s=i.state.selection.ranges.some((i=>i.from==t&&i.to==e));n.add(t,e,s?EE:BE)}))}return n.finish()}},{decorations:t=>t.decorations});function LE(t){return e=>{let i=e.state.field(DE,!1);return i&&i.query.spec.valid?t(e,i):zE(e)}}const VE=LE(((t,{query:e})=>{let{from:i,to:n}=t.state.selection.main,s=e.nextMatch(t.state.doc,i,n);return!(!s||s.from==i&&s.to==n)&&(t.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:UE(t,s),userEvent:"select.search"}),!0)})),NE=LE(((t,{query:e})=>{let{state:i}=t,{from:n,to:s}=i.selection.main,r=e.prevMatch(i.doc,n,s);return!!r&&(t.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:UE(t,r),userEvent:"select.search"}),!0)})),PE=LE(((t,{query:e})=>{let i=e.matchAll(t.state.doc,1e3);return!(!i||!i.length)&&(t.dispatch({selection:L.create(i.map((t=>L.range(t.from,t.to)))),userEvent:"select.search.matches"}),!0)})),HE=LE(((t,{query:e})=>{let{state:i}=t,{from:n,to:s}=i.selection.main;if(i.readOnly)return!1;let r=e.nextMatch(i.doc,n,n);if(!r)return!1;let o,l,h=[];if(r.from==n&&r.to==s&&(l=i.toText(e.getReplacement(r)),h.push({from:r.from,to:r.to,insert:l}),r=e.nextMatch(i.doc,r.from,r.to)),r){let t=0==h.length||h[0].from>=r.to?0:r.to-r.from-l.length;o={anchor:r.from-t,head:r.to-t}}return t.dispatch({changes:h,selection:o,scrollIntoView:!!o,effects:r?UE(t,r):void 0,userEvent:"input.replace"}),!0})),WE=LE(((t,{query:e})=>{if(t.state.readOnly)return!1;let i=e.matchAll(t.state.doc,1e9).map((t=>{let{from:i,to:n}=t;return{from:i,to:n,insert:e.getReplacement(t)}}));return!!i.length&&(t.dispatch({changes:i,userEvent:"input.replace.all"}),!0)}));function IE(t){return t.state.facet(yE).createPanel(t)}function FE(t,e){var i;let n=t.selection.main,s=n.empty||n.to>n.from+100?"":t.sliceDoc(n.from,n.to),r=null!==(i=null==e?void 0:e.caseSensitive)&&void 0!==i?i:t.facet(yE).caseSensitive;return e&&!s?e:new bE({search:s.replace(/\n/g,"\\n"),caseSensitive:r})}const zE=t=>{let e=t.state.field(DE,!1);if(e&&e.panel){let i=jB(t,IE);if(!i)return!1;let n=i.dom.querySelector("[name=search]");if(n!=t.root.activeElement){let i=FE(t.state,e.query.spec);i.valid&&t.dispatch({effects:CE.of(i)}),n.focus(),n.select()}}else t.dispatch({effects:[OE.of(!0),e?CE.of(FE(t.state,e.query.spec)):ft.appendConfig.of(YE)]});return!0},qE=t=>{let e=t.state.field(DE,!1);if(!e||!e.panel)return!1;let i=jB(t,IE);return i&&i.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:OE.of(!1)}),!0},KE=[{key:"Mod-f",run:zE,scope:"editor search-panel"},{key:"F3",run:VE,shift:NE,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:VE,shift:NE,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:qE,scope:"editor search-panel"},{key:"Mod-Shift-l",run:({state:t,dispatch:e})=>{let i=t.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:n,to:s}=i.main,r=[],o=0;for(let e=new tE(t.doc,t.sliceDoc(n,s));!e.next().done;){if(r.length>1e3)return!1;e.value.from==n&&(o=r.length),r.push(L.range(e.value.from,e.value.to))}return e(t.update({selection:L.create(r,o),userEvent:"select.search.matches"})),!0}},{key:"Alt-g",run:t=>{let e=jB(t,lE);if(!e){let i=[hE.of(!0)];null==t.state.field(aE,!1)&&i.push(ft.appendConfig.of([aE,cE])),t.dispatch({effects:i}),e=jB(t,lE)}return e&&e.dom.querySelector("input").focus(),!0}},{key:"Mod-d",run:({state:t,dispatch:e})=>{let{ranges:i}=t.selection;if(i.some((t=>t.from===t.to)))return(({state:t,dispatch:e})=>{let{selection:i}=t,n=L.create(i.ranges.map((e=>t.wordAt(e.head)||L.cursor(e.head))),i.mainIndex);return!n.eq(i)&&(e(t.update({selection:n})),!0)})({state:t,dispatch:e});let n=t.sliceDoc(i[0].from,i[0].to);if(t.selection.ranges.some((e=>t.sliceDoc(e.from,e.to)!=n)))return!1;let s=function(t,e){let{main:i,ranges:n}=t.selection,s=t.wordAt(i.head),r=s&&s.from==i.from&&s.to==i.to;for(let i=!1,s=new tE(t.doc,e,n[n.length-1].to);;){if(s.next(),!s.done){if(i&&n.some((t=>t.from==s.value.from)))continue;if(r){let e=t.wordAt(s.value.from);if(!e||e.from!=s.value.from||e.to!=s.value.to)continue}return s.value}if(i)return null;s=new tE(t.doc,e,0,Math.max(0,n[n.length-1].from-1)),i=!0}}(t,n);return!!s&&(e(t.update({selection:t.selection.addRange(L.range(s.from,s.to),!1),effects:DB.scrollIntoView(s.to)})),!0)},preventDefault:!0}];class GE{constructor(t){this.view=t;let e=this.query=t.state.field(DE).query.spec;function i(t,e,i){return JB("button",{class:"cm-button",name:t,onclick:e,type:"button"},i)}this.commit=this.commit.bind(this),this.searchField=JB("input",{value:e.search,placeholder:jE(t,"Find"),"aria-label":jE(t,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=JB("input",{value:e.replace,placeholder:jE(t,"Replace"),"aria-label":jE(t,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=JB("input",{type:"checkbox",name:"case",checked:e.caseSensitive,onchange:this.commit}),this.reField=JB("input",{type:"checkbox",name:"re",checked:e.regexp,onchange:this.commit}),this.dom=JB("div",{onkeydown:t=>this.keydown(t),class:"cm-search"},[this.searchField,i("next",(()=>VE(t)),[jE(t,"next")]),i("prev",(()=>NE(t)),[jE(t,"previous")]),i("select",(()=>PE(t)),[jE(t,"all")]),JB("label",null,[this.caseField,jE(t,"match case")]),JB("label",null,[this.reField,jE(t,"regexp")]),...t.state.readOnly?[]:[JB("br"),this.replaceField,i("replace",(()=>HE(t)),[jE(t,"replace")]),i("replaceAll",(()=>WE(t)),[jE(t,"replace all")]),JB("button",{name:"close",onclick:()=>qE(t),"aria-label":jE(t,"close"),type:"button"},["×"])]])}commit(){let t=new bE({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});t.eq(this.query)||(this.query=t,this.view.dispatch({effects:CE.of(t)}))}keydown(t){var e,i,n;e=this.view,i=t,n="search-panel",zB(IB(e.state),i,e,n)?t.preventDefault():13==t.keyCode&&t.target==this.searchField?(t.preventDefault(),(t.shiftKey?NE:VE)(this.view)):13==t.keyCode&&t.target==this.replaceField&&(t.preventDefault(),HE(this.view))}update(t){for(let e of t.transactions)for(let t of e.effects)t.is(CE)&&!t.value.eq(this.query)&&this.setQuery(t.value)}setQuery(t){this.query=t,this.searchField.value=t.search,this.replaceField.value=t.replace,this.caseField.checked=t.caseSensitive,this.reField.checked=t.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(yE).top}}function jE(t,e){return t.state.phrase(e)}const _E=/[\s\.,:;?!]/;function UE(t,{from:e,to:i}){let n=t.state.doc.lineAt(e).from,s=t.state.doc.lineAt(i).to,r=Math.max(n,e-30),o=Math.min(s,i+30),l=t.state.sliceDoc(r,o);if(r!=n)for(let t=0;t<30;t++)if(!_E.test(l[t+1])&&_E.test(l[t])){l=l.slice(t);break}if(o!=s)for(let t=l.length-1;t>l.length-30;t--)if(!_E.test(l[t-1])&&_E.test(l[t])){l=l.slice(0,t);break}return DB.announce.of(`${t.state.phrase("current match")}. ${l} ${t.state.phrase("on line")} ${t.state.doc.lineAt(e).number}`)}const $E=DB.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),YE=[DE,X.lowest(RE),$E],XE="undefined"!=typeof navigator&&!/Edge\/(\d+)/.exec(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2);class JE{constructor(t,e,i){this.facet=e,this.createTooltipView=i,this.input=t.state.facet(e),this.tooltips=this.input.filter((t=>t)),this.tooltipViews=this.tooltips.map(i)}update(t){let e=t.state.facet(this.facet),i=e.filter((t=>t));if(e===this.input){for(let e of this.tooltipViews)e.update&&e.update(t);return!1}let n=[];for(let e=0;e<i.length;e++){let s=i[e],r=-1;if(s){for(let t=0;t<this.tooltips.length;t++){let e=this.tooltips[t];e&&e.create==s.create&&(r=t)}if(r<0)n[e]=this.createTooltipView(s);else{let i=n[e]=this.tooltipViews[r];i.update&&i.update(t)}}}for(let t of this.tooltipViews)n.indexOf(t)<0&&t.dom.remove();return this.input=e,this.tooltips=i,this.tooltipViews=n,!0}}function QE(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const ZE=H.define({combine:t=>{var e,i,n;return{position:XE?"absolute":(null===(e=t.find((t=>t.position)))||void 0===e?void 0:e.position)||"fixed",parent:(null===(i=t.find((t=>t.parent)))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(n=t.find((t=>t.tooltipSpace)))||void 0===n?void 0:n.tooltipSpace)||QE}}}),tR=_o.fromClass(class{constructor(t){var e;this.view=t,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let i=t.state.facet(ZE);this.position=i.position,this.parent=i.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new JE(t,nR,(t=>this.createTooltip(t))),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),null===(e=t.dom.ownerDocument.defaultView)||void 0===e||e.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t);e&&this.observeIntersection();let i=e||t.geometryChanged,n=t.state.facet(ZE);if(n.position!=this.position){this.position=n.position;for(let t of this.manager.tooltipViews)t.dom.style.position=this.position;i=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let t of this.manager.tooltipViews)this.container.appendChild(t.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(t){let e=t.create(this.view);if(e.dom.classList.add("cm-tooltip"),t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top="-10000px",this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var t,e;null===(t=this.view.dom.ownerDocument.defaultView)||void 0===t||t.removeEventListener("resize",this.measureSoon);for(let{dom:t}of this.manager.tooltipViews)t.remove();null===(e=this.intersectionObserver)||void 0===e||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=this.view.dom.getBoundingClientRect();return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map(((t,e)=>{let i=this.manager.tooltipViews[e];return i.getCoords?i.getCoords(t.pos):this.view.coordsAtPos(t.pos)})),size:this.manager.tooltipViews.map((({dom:t})=>t.getBoundingClientRect())),space:this.view.state.facet(ZE).tooltipSpace(this.view)}}writeMeasure(t){let{editor:e,space:i}=t,n=[];for(let s=0;s<this.manager.tooltips.length;s++){let r=this.manager.tooltips[s],o=this.manager.tooltipViews[s],{dom:l}=o,h=t.pos[s],a=t.size[s];if(!h||h.bottom<=Math.max(e.top,i.top)||h.top>=Math.min(e.bottom,i.bottom)||h.right<Math.max(e.left,i.left)-.1||h.left>Math.min(e.right,i.right)+.1){l.style.top="-10000px";continue}let c=r.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,d=c?7:0,u=a.right-a.left,f=a.bottom-a.top,p=o.offset||iR,g=this.view.textDirection==el.LTR,m=a.width>i.right-i.left?g?i.left:i.right-a.width:g?Math.min(h.left-(c?14:0)+p.x,i.right-u):Math.max(i.left,h.left-u+(c?14:0)-p.x),v=!!r.above;!r.strictSide&&(v?h.top-(a.bottom-a.top)-p.y<i.top:h.bottom+(a.bottom-a.top)+p.y>i.bottom)&&v==i.bottom-h.bottom>h.top-i.top&&(v=!v);let w=v?h.top-f-d-p.y:h.bottom+d+p.y,y=m+u;if(!0!==o.overlap)for(let t of n)t.left<y&&t.right>m&&t.top<w+f&&t.bottom>w&&(w=v?t.top-f-2-d:t.bottom+d+2);"absolute"==this.position?(l.style.top=w-t.parent.top+"px",l.style.left=m-t.parent.left+"px"):(l.style.top=w+"px",l.style.left=m+"px"),c&&(c.style.left=h.left+(g?p.x:-p.x)-(m+14-7)+"px"),!0!==o.overlap&&n.push({left:m,top:w,right:y,bottom:w+f}),l.classList.toggle("cm-tooltip-above",v),l.classList.toggle("cm-tooltip-below",!v),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top="-10000px"}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),eR=qh.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),iR={x:0,y:0},nR=H.define({enables:[tR,eR]}),sR=H.define();class rR{constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new JE(t,sR,(t=>this.createHostedView(t)))}static create(t){return new rR(t)}createHostedView(t){let e=t.create(this.view);return e.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(e.dom),this.mounted&&e.mount&&e.mount(this.view),e}mount(t){for(let e of this.manager.tooltipViews)e.mount&&e.mount(t);this.mounted=!0}positioned(){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned()}update(t){this.manager.update(t)}}const oR=nR.compute([sR],(t=>{let e=t.facet(sR).filter((t=>t));return 0===e.length?null:{pos:Math.min(...e.map((t=>t.pos))),end:Math.max(...e.filter((t=>null!=t.end)).map((t=>t.end))),create:rR.create,above:e[0].above,arrow:e.some((t=>t.arrow))}}));class lR{constructor(t,e,i,n,s){this.view=t,this.source=e,this.field=i,this.setHover=n,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout((()=>this.startHover()),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){var t;clearTimeout(this.restartTimeout);let{lastMove:e}=this,i=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(null==i)return;let n=this.view.coordsAtPos(i);if(null==n||e.y<n.top||e.y>n.bottom||e.x<n.left-this.view.defaultCharacterWidth||e.x>n.right+this.view.defaultCharacterWidth)return;let s=this.view.bidiSpans(this.view.state.doc.lineAt(i)).find((t=>t.from<=i&&t.to>=i)),r=s&&s.dir==el.RTL?-1:1,o=this.source(this.view,i,e.x<n.left?-r:r);if(null===(t=o)||void 0===t?void 0:t.then){let t=this.pending={pos:i};o.then((e=>{this.pending==t&&(this.pending=null,e&&this.view.dispatch({effects:this.setHover.of(e)}))}),(t=>Fo(this.view.state,t,"hover tooltip")))}else o&&this.view.dispatch({effects:this.setHover.of(o)})}mousemove(t){var e;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!function(t){for(let e=t;e;e=e.parentNode)if(1==e.nodeType&&e.classList.contains("cm-tooltip"))return!0;return!1}(this.lastMove.target)||this.pending){let{pos:n}=i||this.pending,s=null!==(e=null==i?void 0:i.end)&&void 0!==e?e:n;(n==s?this.view.posAtCoords(this.lastMove)==n:function(t,e,i,n,s,r){let o=document.createRange(),l=t.domAtPos(e),h=t.domAtPos(i);o.setEnd(h.node,h.offset),o.setStart(l.node,l.offset);let a=o.getClientRects();o.detach();for(let t=0;t<a.length;t++){let e=a[t];if(Math.max(e.top-s,s-e.bottom,e.left-n,n-e.right)<=r)return!0}return!1}(this.view,n,s,t.clientX,t.clientY,6))||(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function hR(t,e={}){let i=ft.define(),n=K.define({create:()=>null,update(t,n){if(t&&e.hideOnChange&&(n.docChanged||n.selection))return null;for(let t of n.effects){if(t.is(i))return t.value;if(t.is(aR))return null}if(t&&n.docChanged){let e=n.changes.mapPos(t.pos,-1,k.TrackDel);if(null==e)return null;let i=Object.assign(Object.create(null),t);return i.pos=e,null!=t.end&&(i.end=n.changes.mapPos(t.end)),i}return t},provide:t=>sR.from(t)});return[n,_o.define((s=>new lR(s,t,n,i,e.hoverTime||300))),oR]}const aR=ft.define();class cR{constructor(t,e,i){this.state=t,this.pos=e,this.explicit=i,this.abortListeners=[]}tokenBefore(t){let e=Lf(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),i=Math.max(e.from,this.pos-250),n=e.text.slice(i-e.from,this.pos-e.from),s=n.search(gR(t,!1));return s<0?null:{from:i+s,to:this.pos,text:n.slice(s)}}get aborted(){return null==this.abortListeners}addEventListener(t,e){"abort"==t&&this.abortListeners&&this.abortListeners.push(e)}}function dR(t){let e=Object.keys(t).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function uR(t){let e=t.map((t=>"string"==typeof t?{label:t}:t)),[i,n]=e.every((t=>/^\w+$/.test(t.label)))?[/\w*$/,/\w+$/]:function(t){let e=Object.create(null),i=Object.create(null);for(let{label:n}of t){e[n[0]]=!0;for(let t=1;t<n.length;t++)i[n[t]]=!0}let n=dR(e)+dR(i)+"*$";return[new RegExp("^"+n),new RegExp(n)]}(e);return t=>{let s=t.matchBefore(n);return s||t.explicit?{from:s?s.from:t.pos,options:e,span:i}:null}}class fR{constructor(t,e,i){this.completion=t,this.source=e,this.match=i}}function pR(t){return t.selection.main.head}function gR(t,e){var i;let{source:n}=t,s=e&&"^"!=n[0],r="$"!=n[n.length-1];return s||r?new RegExp(`${s?"^":""}(?:${n})${r?"$":""}`,null!==(i=t.flags)&&void 0!==i?i:t.ignoreCase?"i":""):t}const mR=ct.define();function vR(t,e){let i=e.completion.apply||e.completion.label,n=e.source;"string"==typeof i?t.dispatch({changes:{from:n.from,to:n.to,insert:i},selection:{anchor:n.from+i.length},userEvent:"input.complete",annotations:mR.of(e.completion)}):i(t,e.completion,n.from,n.to)}const wR=new WeakMap;function yR(t){if(!Array.isArray(t))return t;let e=wR.get(t);return e||wR.set(t,e=uR(t)),e}class bR{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let e=0;e<t.length;){let i=h(t,e),n=c(i);this.chars.push(i);let s=t.slice(e,e+n),r=s.toUpperCase();this.folded.push(h(r==s?s.toLowerCase():r,0)),e+=n}this.astral=t.length!=this.chars.length}match(t){if(0==this.pattern.length)return[0];if(t.length<this.pattern.length)return null;let{chars:e,folded:i,any:n,precise:s,byWord:r}=this;if(1==e.length){let n=h(t,0);return n==e[0]?[0,0,c(n)]:n==i[0]?[-200,0,c(n)]:null}let o=t.indexOf(this.pattern);if(0==o)return[0,0,this.pattern.length];let l=e.length,d=0;if(o<0){for(let s=0,r=Math.min(t.length,200);s<r&&d<l;){let r=h(t,s);r!=e[d]&&r!=i[d]||(n[d++]=s),s+=c(r)}if(d<l)return null}let u=0,f=0,p=!1,g=0,m=-1,v=-1,w=/[a-z]/.test(t),y=!0;for(let n=0,d=Math.min(t.length,200),b=0;n<d&&f<l;){let d=h(t,n);o<0&&(u<l&&d==e[u]&&(s[u++]=n),g<l&&(d==e[g]||d==i[g]?(0==g&&(m=n),v=n+1,g++):g=0));let x,S=d<255?d>=48&&d<=57||d>=97&&d<=122?2:d>=65&&d<=90?1:0:(x=a(d))!=x.toLowerCase()?1:x!=x.toUpperCase()?2:0;(!n||1==S&&w||0==b&&0!=S)&&(e[f]==d||i[f]==d&&(p=!0)?r[f++]=n:r.length&&(y=!1)),b=S,n+=c(d)}return f==l&&0==r[0]&&y?this.result((p?-200:0)-100,r,t):g==l&&0==m?[-200-t.length,0,v]:o>-1?[-700-t.length,o,o+this.pattern.length]:g==l?[-900-t.length,m,v]:f==l?this.result((p?-200:0)-100-700+(y?0:-1100),r,t):2==e.length?null:this.result((n[0]?-700:0)-200-1100,n,t)}result(t,e,i){let n=[t-i.length],s=1;for(let t of e){let e=t+(this.astral?c(h(i,t)):1);s>1&&n[s-1]==t?n[s-1]=e:(n[s++]=t,n[s++]=e)}return n}}const xR=H.define({combine:t=>Ct(t,{activateOnTyping:!0,override:null,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(t,e)=>t&&e,icons:(t,e)=>t&&e,optionClass:(t,e)=>i=>function(t,e){return t?e?t+" "+e:t:e}(t(i),e(i)),addToOptions:(t,e)=>t.concat(e)})});function SR(t,e,i){if(t<=i)return{from:0,to:t};if(e<=t>>1){let t=Math.floor(e/i);return{from:t*i,to:(t+1)*i}}let n=Math.floor((t-e)/i);return{from:t-(n+1)*i,to:t-n*i}}class kR{constructor(t,e){this.view=t,this.stateField=e,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:t=>this.positionInfo(t),key:this};let i=t.state.field(e),{options:n,selected:s}=i.open,r=t.state.facet(xR);this.optionContent=function(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(t){let e=document.createElement("div");return e.classList.add("cm-completionIcon"),t.type&&e.classList.add(...t.type.split(/\s+/g).map((t=>"cm-completionIcon-"+t))),e.setAttribute("aria-hidden","true"),e},position:20}),e.push({render(t,e,i){let n=document.createElement("span");n.className="cm-completionLabel";let{label:s}=t,r=0;for(let t=1;t<i.length;){let e=i[t++],o=i[t++];e>r&&n.appendChild(document.createTextNode(s.slice(r,e)));let l=n.appendChild(document.createElement("span"));l.appendChild(document.createTextNode(s.slice(e,o))),l.className="cm-completionMatchedText",r=o}return r<s.length&&n.appendChild(document.createTextNode(s.slice(r))),n},position:50},{render(t){if(!t.detail)return null;let e=document.createElement("span");return e.className="cm-completionDetail",e.textContent=t.detail,e},position:80}),e.sort(((t,e)=>t.position-e.position)).map((t=>t.render))}(r),this.optionClass=r.optionClass,this.range=SR(n.length,s,r.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",(e=>{for(let i,s=e.target;s&&s!=this.dom;s=s.parentNode)if("LI"==s.nodeName&&(i=/-(\d+)$/.exec(s.id))&&+i[1]<n.length)return vR(t,n[+i[1]]),void e.preventDefault()})),this.list=this.dom.appendChild(this.createListBox(n,i.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))}mount(){this.updateSel()}update(t){t.state.field(this.stateField)!=t.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let t=this.view.state.field(this.stateField),e=t.open;if((e.selected<this.range.from||e.selected>=this.range.to)&&(this.range=SR(e.options.length,e.selected,this.view.state.facet(xR).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e.options,t.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))),this.updateSelectedOption(e.selected)){this.info&&(this.info.remove(),this.info=null);let t=e.options[e.selected];t.completion.info&&(this.info=this.dom.appendChild(function(t,e){let i=document.createElement("div");i.className="cm-tooltip cm-completionInfo";let{info:n}=t.completion;if("string"==typeof n)i.textContent=n;else{let s=n(t.completion);s.then?s.then((t=>i.appendChild(t)),(t=>Fo(e.state,t,"completion info"))):i.appendChild(s)}return i}(t,this.view)),this.view.requestMeasure(this.placeInfo))}}updateSelectedOption(t){let e=null;for(let i=this.list.firstChild,n=this.range.from;i;i=i.nextSibling,n++)n==t?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),e=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return e&&function(t,e){let i=t.getBoundingClientRect(),n=e.getBoundingClientRect();n.top<i.top?t.scrollTop-=i.top-n.top:n.bottom>i.bottom&&(t.scrollTop+=n.bottom-i.bottom)}(this.list,e),e}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let e=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),n=t.getBoundingClientRect();if(n.top>Math.min(innerHeight,e.bottom)-10||n.bottom<Math.max(0,e.top)+10)return null;let s=Math.max(0,Math.min(n.top,innerHeight-i.height))-e.top,r=this.view.textDirection==el.RTL,o=e.left,l=innerWidth-e.right;return r&&o<Math.min(i.width,l)?r=!1:!r&&l<Math.min(i.width,o)&&(r=!0),{top:s,left:r}}positionInfo(t){this.info&&(this.info.style.top=(t?t.top:-1e6)+"px",t&&(this.info.classList.toggle("cm-completionInfo-left",t.left),this.info.classList.toggle("cm-completionInfo-right",!t.left)))}createListBox(t,e,i){const n=document.createElement("ul");n.id=e,n.setAttribute("role","listbox");for(let s=i.from;s<i.to;s++){let{completion:i,match:r}=t[s];const o=n.appendChild(document.createElement("li"));o.id=e+"-"+s,o.setAttribute("role","option");let l=this.optionClass(i);l&&(o.className=l);for(let t of this.optionContent){let e=t(i,this.view.state,r);e&&o.appendChild(e)}}return i.from&&n.classList.add("cm-completionListIncompleteTop"),i.to<t.length&&n.classList.add("cm-completionListIncompleteBottom"),n}}function AR(t){return 100*(t.boost||0)+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}class MR{constructor(t,e,i,n,s){this.options=t,this.attrs=e,this.tooltip=i,this.timestamp=n,this.selected=s}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new MR(this.options,DR(e,t),this.tooltip,this.timestamp,t)}static build(t,e,i,n,s){let r=function(t,e){let i=[],n=0;for(let s of t)if(s.hasResult())if(!1===s.result.filter)for(let t of s.result.options)i.push(new fR(t,s,[1e9-n++]));else{let t,n=new bR(e.sliceDoc(s.from,s.to));for(let e of s.result.options)(t=n.match(e.label))&&(null!=e.boost&&(t[0]+=e.boost),i.push(new fR(e,s,t)))}i.sort(BR);let s=[],r=null;for(let t of i.sort(BR)){if(300==s.length)break;r&&r.label==t.completion.label&&r.detail==t.completion.detail&&r.type==t.completion.type&&r.apply==t.completion.apply?AR(t.completion)>AR(r)&&(s[s.length-1]=t):s.push(t),r=t.completion}return s}(t,e);if(!r.length)return null;let o=0;if(n&&n.selected){let t=n.options[n.selected].completion;for(let e=0;e<r.length&&!o;e++)r[e].completion==t&&(o=e)}return new MR(r,DR(i,o),{pos:t.reduce(((t,e)=>e.hasResult()?Math.min(t,e.from):t),1e8),create:(l=WR,t=>new kR(t,l)),above:s.aboveCursor},n?n.timestamp:Date.now(),o);var l}map(t){return new MR(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class CR{constructor(t,e,i){this.active=t,this.id=e,this.open=i}static start(){return new CR(TR,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(t){let{state:e}=t,i=e.facet(xR),n=(i.override||e.languageDataAt("autocomplete",pR(e)).map(yR)).map((e=>(this.active.find((t=>t.source==e))||new RR(e,this.active.some((t=>0!=t.state))?1:0)).update(t,i)));n.length==this.active.length&&n.every(((t,e)=>t==this.active[e]))&&(n=this.active);let s=t.selection||n.some((e=>e.hasResult()&&t.changes.touchesRange(e.from,e.to)))||!function(t,e){if(t==e)return!0;for(let i=0,n=0;;){for(;i<t.length&&!t[i].hasResult;)i++;for(;n<e.length&&!e[n].hasResult;)n++;let s=i==t.length,r=n==e.length;if(s||r)return s==r;if(t[i++].result!=e[n++].result)return!1}}(n,this.active)?MR.build(n,e,this.id,this.open,i):this.open&&t.docChanged?this.open.map(t.changes):this.open;!s&&n.every((t=>1!=t.state))&&n.some((t=>t.hasResult()))&&(n=n.map((t=>t.hasResult()?new RR(t.source,0):t)));for(let e of t.effects)e.is(HR)&&(s=s&&s.setSelected(e.value,this.id));return n==this.active&&s==this.open?this:new CR(n,this.id,s)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:OR}}const OR={"aria-autocomplete":"list","aria-expanded":"false"};function DR(t,e){return{"aria-autocomplete":"list","aria-expanded":"true","aria-activedescendant":t+"-"+e,"aria-controls":t}}const TR=[];function BR(t,e){let i=e.match[0]-t.match[0];return i||t.completion.label.localeCompare(e.completion.label)}function ER(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}class RR{constructor(t,e,i=-1){this.source=t,this.state=e,this.explicitPos=i}hasResult(){return!1}update(t,e){let i=ER(t),n=this;i?n=n.handleUserEvent(t,i,e):t.docChanged?n=n.handleChange(t):t.selection&&0!=n.state&&(n=new RR(n.source,0));for(let e of t.effects)if(e.is(VR))n=new RR(n.source,1,e.value?pR(t.state):-1);else if(e.is(NR))n=new RR(n.source,0);else if(e.is(PR))for(let t of e.value)t.source==n.source&&(n=t);return n}handleUserEvent(t,e,i){return"delete"!=e&&i.activateOnTyping?new RR(this.source,1):this.map(t.changes)}handleChange(t){return t.changes.touchesRange(pR(t.startState))?new RR(this.source,0):this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new RR(this.source,this.state,t.mapPos(this.explicitPos))}}class LR extends RR{constructor(t,e,i,n,s,r){super(t,2,e),this.result=i,this.from=n,this.to=s,this.span=r}hasResult(){return!0}handleUserEvent(t,e,i){let n=t.changes.mapPos(this.from),s=t.changes.mapPos(this.to,1),r=pR(t.state);if((this.explicitPos<0?r<=n:r<this.from)||r>s||"delete"==e&&pR(t.startState)==this.from)return new RR(this.source,"input"==e&&i.activateOnTyping?1:0);let o=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos);return this.span&&(n==s||this.span.test(t.state.sliceDoc(n,s)))?new LR(this.source,o,this.result,n,s,this.span):new RR(this.source,1,o)}handleChange(t){return t.changes.touchesRange(this.from,this.to)?new RR(this.source,0):this.map(t.changes)}map(t){return t.empty?this:new LR(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1),this.span)}}const VR=ft.define(),NR=ft.define(),PR=ft.define({map:(t,e)=>t.map((t=>t.map(e)))}),HR=ft.define(),WR=K.define({create:()=>CR.start(),update:(t,e)=>t.update(e),provide:t=>[nR.from(t,(t=>t.tooltip)),qh.contentAttributes.from(t,(t=>t.attrs))]});function IR(t,e="option"){return i=>{let n=i.state.field(WR,!1);if(!n||!n.open||Date.now()-n.open.timestamp<75)return!1;let s,r=1;"page"==e&&(s=function(t,e){let i=t.plugin(tR);if(!i)return null;let n=i.manager.tooltips.indexOf(e);return n<0?null:i.manager.tooltipViews[n]}(i,n.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let o=n.open.selected+r*(t?1:-1),{length:l}=n.open.options;return o<0?o="page"==e?0:l-1:o>=l&&(o="page"==e?l-1:0),i.dispatch({effects:HR.of(o)}),!0}}class FR{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}const zR=_o.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of t.state.field(WR).active)1==e.state&&this.startQuery(e)}update(t){let e=t.state.field(WR);if(!t.selectionSet&&!t.docChanged&&t.startState.field(WR)==e)return;let i=t.transactions.some((t=>(t.selection||t.docChanged)&&!ER(t)));for(let e=0;e<this.running.length;e++){let n=this.running[e];if(i||n.updates.length+t.transactions.length>50&&n.time-Date.now()>1e3){for(let t of n.context.abortListeners)try{t()}catch(t){Fo(this.view.state,t)}n.context.abortListeners=null,this.running.splice(e--,1)}else n.updates.push(...t.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some((t=>1==t.state&&!this.running.some((e=>e.active.source==t.source))))?setTimeout((()=>this.startUpdate()),50):-1,0!=this.composing)for(let e of t.transactions)"input"==ER(e)?this.composing=2:2==this.composing&&e.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:t}=this.view,e=t.field(WR);for(let t of e.active)1!=t.state||this.running.some((e=>e.active.source==t.source))||this.startQuery(t)}startQuery(t){let{state:e}=this.view,i=pR(e),n=new cR(e,i,t.explicitPos==i),s=new FR(t,n);this.running.push(s),Promise.resolve(t.source(n)).then((t=>{s.context.aborted||(s.done=t||null,this.scheduleAccept())}),(t=>{this.view.dispatch({effects:NR.of(null)}),Fo(this.view.state,t)}))}scheduleAccept(){this.running.every((t=>void 0!==t.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),50))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],i=this.view.state.facet(xR);for(let n=0;n<this.running.length;n++){let s=this.running[n];if(void 0===s.done)continue;if(this.running.splice(n--,1),s.done){let n=new LR(s.active.source,s.active.explicitPos,s.done,s.done.from,null!==(t=s.done.to)&&void 0!==t?t:pR(s.updates.length?s.updates[0].startState:this.view.state),s.done.span&&!1!==s.done.filter?gR(s.done.span,!0):null);for(let t of s.updates)n=n.update(t,i);if(n.hasResult()){e.push(n);continue}}let r=this.view.state.field(WR).active.find((t=>t.source==s.active.source));if(r&&1==r.state)if(null==s.done){let t=new RR(s.active.source,0);for(let e of s.updates)t=t.update(e,i);1!=t.state&&e.push(t)}else this.startQuery(r)}e.length&&this.view.dispatch({effects:PR.of(e)})}},{eventHandlers:{compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:VR.of(!1)})),20),this.composing=0}}}),qR=qh.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});function KR(t={}){return[WR,xR.of(t),zR,jR,qR]}const GR=[{key:"Ctrl-Space",run:t=>!!t.state.field(WR,!1)&&(t.dispatch({effects:VR.of(!0)}),!0)},{key:"Escape",run:t=>{let e=t.state.field(WR,!1);return!(!e||!e.active.some((t=>0!=t.state)))&&(t.dispatch({effects:NR.of(null)}),!0)}},{key:"ArrowDown",run:IR(!0)},{key:"ArrowUp",run:IR(!1)},{key:"PageDown",run:IR(!0,"page")},{key:"PageUp",run:IR(!1,"page")},{key:"Enter",run:t=>{let e=t.state.field(WR,!1);return!(t.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<75)&&(vR(t,e.open.options[e.open.selected]),!0)}}],jR=X.highest(Jh.computeN([xR],(t=>t.facet(xR).defaultKeymap?[GR]:[])));function _R(t,e){return({state:i,dispatch:n})=>{if(i.readOnly)return!1;let s=t(e,i);return!!s&&(n(i.update(s)),!0)}}const UR=_R(ZR,0),$R=_R(QR,0),YR=_R(((t,e)=>QR(t,e,function(t){let e=[];for(let i of t.selection.ranges){let n=t.doc.lineAt(i.from),s=i.to<=n.to?n:t.doc.lineAt(i.to),r=e.length-1;r>=0&&e[r].to>n.from?e[r].to=s.to:e.push({from:n.from,to:s.to})}return e}(e))),0),XR=[{key:"Mod-/",run:t=>{let e=JR(t.state);return e.line?UR(t):!!e.block&&YR(t)}},{key:"Alt-A",run:$R}];function JR(t,e=t.selection.main.head){let i=t.languageDataAt("commentTokens",e);return i.length?i[0]:{}}function QR(t,e,i=e.selection.ranges){let n=i.map((t=>JR(e,t.from).block));if(!n.every((t=>t)))return null;let s=i.map(((t,i)=>function(t,{open:e,close:i},n,s){let r,o,l=t.sliceDoc(n-50,n),h=t.sliceDoc(s,s+50),a=/\s*$/.exec(l)[0].length,c=/^\s*/.exec(h)[0].length,d=l.length-a;if(l.slice(d-e.length,d)==e&&h.slice(c,c+i.length)==i)return{open:{pos:n-a,margin:a&&1},close:{pos:s+c,margin:c&&1}};s-n<=100?r=o=t.sliceDoc(n,s):(r=t.sliceDoc(n,n+50),o=t.sliceDoc(s-50,s));let u=/^\s*/.exec(r)[0].length,f=/\s*$/.exec(o)[0].length,p=o.length-f-i.length;return r.slice(u,u+e.length)==e&&o.slice(p,p+i.length)==i?{open:{pos:n+u+e.length,margin:/\s/.test(r.charAt(u+e.length))?1:0},close:{pos:s-f-i.length,margin:/\s/.test(o.charAt(p-1))?1:0}}:null}(e,n[i],t.from,t.to)));if(2!=t&&!s.every((t=>t)))return{changes:e.changes(i.map(((t,e)=>s[e]?[]:[{from:t.from,insert:n[e].open+" "},{from:t.to,insert:" "+n[e].close}])))};if(1!=t&&s.some((t=>t))){let t=[];for(let e,i=0;i<s.length;i++)if(e=s[i]){let s=n[i],{open:r,close:o}=e;t.push({from:r.pos-s.open.length,to:r.pos+r.margin},{from:o.pos-o.margin,to:o.pos+s.close.length})}return{changes:t}}return null}function ZR(t,e,i=e.selection.ranges){let n=[],s=-1;for(let{from:t,to:r}of i){let i=n.length,o=1e9;for(let i=t;i<=r;){let l=e.doc.lineAt(i);if(l.from>s&&(t==r||r>l.from)){s=l.from;let t=JR(e,i).line;if(!t)continue;let r=/^\s*/.exec(l.text)[0].length,h=r==l.length,a=l.text.slice(r,r+t.length)==t?r:-1;r<l.text.length&&r<o&&(o=r),n.push({line:l,comment:a,token:t,indent:r,empty:h,single:!1})}i=l.to+1}if(o<1e9)for(let t=i;t<n.length;t++)n[t].indent<n[t].line.text.length&&(n[t].indent=o);n.length==i+1&&(n[i].single=!0)}if(2!=t&&n.some((t=>t.comment<0&&(!t.empty||t.single)))){let t=[];for(let{line:e,token:i,indent:s,empty:r,single:o}of n)!o&&r||t.push({from:e.from+s,insert:i+" "});let i=e.changes(t);return{changes:i,selection:e.selection.map(i,1)}}if(1!=t&&n.some((t=>t.comment>=0))){let t=[];for(let{line:e,comment:i,token:s}of n)if(i>=0){let n=e.from+i,r=n+s.length;" "==e.text[r-e.from]&&r++,t.push({from:n,to:r})}return{changes:t}}return null}function tL(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1),n=t.state.doc.lineAt(i),s=i-n.from,r=s>2e3?-1:s==n.length?function(t,e){let i=t.coordsAtPos(t.viewport.from);return i?Math.round(Math.abs((i.left-e)/t.defaultCharacterWidth)):-1}(t,e.clientX):d(n.text,t.state.tabSize,i-n.from);return{line:n.number,col:r,off:s}}function eL(t,e){let i=tL(t,e),n=t.state.selection;return i?{update(t){if(t.docChanged){let e=t.changes.mapPos(t.startState.doc.line(i.line).from),s=t.state.doc.lineAt(e);i={line:s.number,col:i.col,off:Math.min(i.off,s.length)},n=n.map(t.changes)}},get(e,s,r){let o=tL(t,e);if(!o)return n;let l=function(t,e,i){let n=Math.min(e.line,i.line),s=Math.max(e.line,i.line),r=[];if(e.off>2e3||i.off>2e3||e.col<0||i.col<0){let o=Math.min(e.off,i.off),l=Math.max(e.off,i.off);for(let e=n;e<=s;e++){let i=t.doc.line(e);i.length<=l&&r.push(L.range(i.from+o,i.to+l))}}else{let o=Math.min(e.col,i.col),l=Math.max(e.col,i.col);for(let e=n;e<=s;e++){let i=t.doc.line(e),n=u(i.text,o,t.tabSize,!0);if(n>-1){let e=u(i.text,l,t.tabSize);r.push(L.range(i.from+n,i.from+e))}}}return r}(t.state,i,o);return l.length?r?L.create(l.concat(n.ranges)):L.create(l):n}}:null}function iL(t){let e=(null==t?void 0:t.eventFilter)||(t=>t.altKey&&0==t.button);return qh.mouseSelectionStyle.of(((t,i)=>e(i)?eL(t,i):null))}let nL=0;class sL{constructor(t,e,i){this.set=t,this.base=e,this.modified=i,this.id=nL++}static define(t){if(null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let e=new sL([],null,[]);if(e.set.push(e),t)for(let i of t.set)e.set.push(i);return e}static defineModifier(){let t=new oL;return e=>e.modified.indexOf(t)>-1?e:oL.get(e.base||e,e.modified.concat(t).sort(((t,e)=>t.id-e.id)))}}let rL=0;class oL{constructor(){this.instances=[],this.id=rL++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find((i=>{return i.base==t&&(n=e,s=i.modified,n.length==s.length&&n.every(((t,e)=>t==s[e])));var n,s}));if(i)return i;let n=[],s=new sL(n,t,e);for(let t of e)t.instances.push(s);let r=lL(e);for(let e of t.set)for(let t of r)n.push(oL.get(e,t));return s}}function lL(t){let e=[t];for(let i=0;i<t.length;i++)for(let n of lL(t.slice(0,i).concat(t.slice(i+1))))e.push(n);return e}function hL(t){let e=Object.create(null);for(let i in t){let n=t[i];Array.isArray(n)||(n=[n]);for(let t of i.split(" "))if(t){let i=[],s=2,r=t;for(let e=0;;){if("..."==r&&e>0&&e+3==t.length){s=1;break}let n=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(r);if(!n)throw new RangeError("Invalid path: "+t);if(i.push("*"==n[0]?null:'"'==n[0][0]?JSON.parse(n[0]):n[0]),e+=n[0].length,e==t.length)break;let o=t[e++];if(e==t.length&&"!"==o){s=0;break}if("/"!=o)throw new RangeError("Invalid path: "+t);r=t.slice(e)}let o=i.length-1,l=i[o];if(!l)throw new RangeError("Invalid path: "+t);let h=new fL(n,s,o>0?i.slice(0,o):null);e[l]=h.sort(e[l])}}return aL.add(e)}const aL=new lf,cL=H.define({combine:t=>t.length?pL.combinedMatch(t):null}),dL=H.define({combine:t=>t.length?t[0].match:null});function uL(t){return t.facet(cL)||t.facet(dL)}class fL{constructor(t,e,i,n){this.tags=t,this.mode=e,this.context=i,this.next=n}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}class pL{constructor(t,e){let i;function n(t){let e=Bt.newName();return(i||(i=Object.create(null)))["."+e]=t,e}this.map=Object.create(null),this.all="string"==typeof e.all?e.all:e.all?n(e.all):null;for(let e of t){let t=(e.class||n(Object.assign({},e,{tag:null})))+(this.all?" "+this.all:""),i=e.tag;if(Array.isArray(i))for(let e of i)this.map[e.id]=t;else this.map[i.id]=t}this.module=i?new Bt(i):null,this.scope=e.scope||null,this.match=this.match.bind(this);let s=[mL];this.module&&s.push(qh.styleModule.of(this.module)),this.extension=s.concat(cL.of(this)),this.fallback=s.concat(dL.of(this))}match(t,e){if(this.scope&&e!=this.scope)return null;for(let e of t.set){let i=this.map[e.id];if(void 0!==i)return e!=t&&(this.map[t.id]=i),i}return this.map[t.id]=this.all}static combinedMatch(t){if(1==t.length)return t[0].match;let e=t.some((t=>t.scope))?void 0:Object.create(null);return(i,n)=>{let s=e&&e[i.id];if(void 0!==s)return s;let r=null;for(let e of t){let t=e.match(i,n);t&&(r=r?r+" "+t:t)}return e&&(e[i.id]=r),r}}static define(t,e){return new pL(t,e||{})}static get(t,e,i){let n=uL(t);return n&&n(e,i||af.none)}}class gL{constructor(t){this.markCache=Object.create(null),this.tree=Lf(t.state),this.decorations=this.buildDeco(t,uL(t.state))}update(t){let e=Lf(t.state),i=uL(t.state),n=i!=t.startState.facet(cL);e.length<t.view.viewport.to&&!n&&e.type==this.tree.type?this.decorations=this.decorations.map(t.changes):(e!=this.tree||t.viewportChanged||n)&&(this.tree=e,this.decorations=this.buildDeco(t.view,i))}buildDeco(t,e){if(!e||!this.tree.length)return wo.none;let i=new Wt;for(let{from:n,to:s}of t.visibleRanges)yL(this.tree,n,s,e,((t,e,n)=>{i.add(t,e,this.markCache[n]||(this.markCache[n]=wo.mark({class:n})))}));return i.finish()}}const mL=X.high(_o.fromClass(gL,{decorations:t=>t.decorations})),vL=[""];class wL{constructor(t,e,i){this.at=t,this.style=e,this.span=i,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,e,i,n,s,r){let{type:o,from:l,to:h}=t;if(l>=i||h<=e)return;vL[s]=o.name,o.isTop&&(r=o);let a=n,c=o.prop(aL),d=!1;for(;c;){if(!c.context||bL(c.context,vL,s)){for(let t of c.tags){let e=this.style(t,r);e&&(a&&(a+=" "),a+=e,1==c.mode?n+=(n?" ":"")+e:0==c.mode&&(d=!0))}break}c=c.next}if(this.startSpan(t.from,a),d)return;let u=t.tree&&t.tree.prop(lf.mounted);if(u&&u.overlay){let o=t.node.enter(u.overlay[0].from+l,1),c=t.firstChild();for(let d=0,f=l;;d++){let p=d<u.overlay.length?u.overlay[d]:null,g=p?p.from+l:h,m=Math.max(e,f),v=Math.min(i,g);if(m<v&&c)for(;t.from<v&&(this.highlightRange(t,m,v,n,s+1,r),this.startSpan(Math.min(i,t.to),a),!(t.to>=g)&&t.nextSibling()););if(!p||g>i)break;f=p.to+l,f>e&&(this.highlightRange(o.cursor,Math.max(e,p.from+l),Math.min(i,f),n,s,u.tree.type),this.startSpan(f,a))}c&&t.parent()}else if(t.firstChild()){do{if(!(t.to<=e)){if(t.from>=i)break;this.highlightRange(t,e,i,n,s+1,r),this.startSpan(Math.min(i,t.to),a)}}while(t.nextSibling());t.parent()}}}function yL(t,e,i,n,s){let r=new wL(e,n,s);r.highlightRange(t.cursor(),e,i,"",0,t.type),r.flush(i)}function bL(t,e,i){if(t.length>i-1)return!1;for(let n=i-1,s=t.length-1;s>=0;s--,n--){let i=t[s];if(i&&i!=e[n])return!1}return!0}const xL=sL.define,SL=xL(),kL=xL(),AL=xL(kL),ML=xL(kL),CL=xL(),OL=xL(CL),DL=xL(CL),TL=xL(),BL=xL(TL),EL=xL(),RL=xL(),LL=xL(),VL=xL(LL),NL=xL(),PL={comment:SL,lineComment:xL(SL),blockComment:xL(SL),docComment:xL(SL),name:kL,variableName:xL(kL),typeName:AL,tagName:xL(AL),propertyName:ML,attributeName:xL(ML),className:xL(kL),labelName:xL(kL),namespace:xL(kL),macroName:xL(kL),literal:CL,string:OL,docString:xL(OL),character:xL(OL),attributeValue:xL(OL),number:DL,integer:xL(DL),float:xL(DL),bool:xL(CL),regexp:xL(CL),escape:xL(CL),color:xL(CL),url:xL(CL),keyword:EL,self:xL(EL),null:xL(EL),atom:xL(EL),unit:xL(EL),modifier:xL(EL),operatorKeyword:xL(EL),controlKeyword:xL(EL),definitionKeyword:xL(EL),moduleKeyword:xL(EL),operator:RL,derefOperator:xL(RL),arithmeticOperator:xL(RL),logicOperator:xL(RL),bitwiseOperator:xL(RL),compareOperator:xL(RL),updateOperator:xL(RL),definitionOperator:xL(RL),typeOperator:xL(RL),controlOperator:xL(RL),punctuation:LL,separator:xL(LL),bracket:VL,angleBracket:xL(VL),squareBracket:xL(VL),paren:xL(VL),brace:xL(VL),content:TL,heading:BL,heading1:xL(BL),heading2:xL(BL),heading3:xL(BL),heading4:xL(BL),heading5:xL(BL),heading6:xL(BL),contentSeparator:xL(TL),list:xL(TL),quote:xL(TL),emphasis:xL(TL),strong:xL(TL),link:xL(TL),monospace:xL(TL),strikethrough:xL(TL),inserted:xL(),deleted:xL(),changed:xL(),invalid:xL(),meta:NL,documentMeta:xL(NL),annotation:xL(NL),processingInstruction:xL(NL),definition:sL.defineModifier(),constant:sL.defineModifier(),function:sL.defineModifier(),standard:sL.defineModifier(),local:sL.defineModifier(),special:sL.defineModifier()},HL=pL.define([{tag:PL.link,textDecoration:"underline"},{tag:PL.heading,textDecoration:"underline",fontWeight:"bold"},{tag:PL.emphasis,fontStyle:"italic"},{tag:PL.strong,fontWeight:"bold"},{tag:PL.strikethrough,textDecoration:"line-through"},{tag:PL.keyword,color:"#708"},{tag:[PL.atom,PL.bool,PL.url,PL.contentSeparator,PL.labelName],color:"#219"},{tag:[PL.literal,PL.inserted],color:"#164"},{tag:[PL.string,PL.deleted],color:"#a11"},{tag:[PL.regexp,PL.escape,PL.special(PL.string)],color:"#e40"},{tag:PL.definition(PL.variableName),color:"#00f"},{tag:PL.local(PL.variableName),color:"#30a"},{tag:[PL.typeName,PL.namespace],color:"#085"},{tag:PL.className,color:"#167"},{tag:[PL.special(PL.variableName),PL.macroName],color:"#256"},{tag:PL.definition(PL.propertyName),color:"#00c"},{tag:PL.comment,color:"#940"},{tag:PL.meta,color:"#7a757a"},{tag:PL.invalid,color:"#f00"}]);function WL(t){let e;return e=11==t.nodeType?t.getSelection?t:t.ownerDocument:t,e.getSelection()}function IL(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function FL(t,e){if(!e.anchorNode)return!1;try{return IL(t,e.anchorNode)}catch(t){return!1}}function zL(t){return 3==t.nodeType?ZL(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function qL(t,e,i,n){return!!i&&(GL(t,e,i,n,-1)||GL(t,e,i,n,1))}function KL(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function GL(t,e,i,n,s){for(;;){if(t==i&&e==n)return!0;if(e==(s<0?0:jL(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=KL(t)+(s<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(s<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=s<0?jL(t):0}}}function jL(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const _L={left:0,right:0,top:0,bottom:0};function UL(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function $L(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class YL{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let XL,JL=null;function QL(t){if(t.setActive)return t.setActive();if(JL)return t.focus(JL);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==JL?{get preventScroll(){return JL={preventScroll:!0},!0}}:void 0),!JL){JL=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],s=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function ZL(t,e,i=e){let n=XL||(XL=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function tV(t,e,i){let n={key:e,code:e,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,t.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,t.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function eV(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class iV{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new iV(t.parentNode,KL(t),e)}static after(t,e){return new iV(t.parentNode,KL(t)+1,e)}}const nV=[];class sV{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e=this.dom,i=e.firstChild;for(let n of this.children){if(n.dirty){if(!n.dom&&i){let t=sV.get(i);t&&(t.parent||t.constructor!=n.constructor)||n.reuseDOM(i)}n.sync(t),n.dirty=0}if(t&&!t.written&&t.node==e&&i!=n.dom&&(t.written=!0),n.dom.parentNode==e){for(;i&&i!=n.dom;)i=rV(i);i=n.dom.nextSibling}else e.insertBefore(n.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=rV(i)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=0==jL(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==n&&e.firstChild!=e.lastChild&&(n=t==e.firstChild?-1:1),t=e}i=n<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!sV.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let n=this.children[t];if(n.dom==i)return e;e+=n.length+n.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,r=-1,o=-1;for(let l=0,h=i,a=i;l<this.children.length;l++){let i=this.children[l],c=h+i.length;if(h<t&&c>e)return i.domBoundsAround(t,e,h);if(c>=t&&-1==n&&(n=l,s=h),h>e&&i.dom.parentNode==this.dom){r=l,o=a;break}a=c,h=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=nV){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new oV(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,r){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}function rV(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}sV.prototype.breakAfter=0;class oV{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function lV(t,e,i,n,s,r,o,l,h){let{children:a}=t,c=a.length?a[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(i,s,r.length?d:null,0==i,l,h))){if(n<a.length){let t=a[n];t&&s<t.length?(e==n&&(t=t.split(s),s=0),!u&&d&&t.merge(0,s,d,!0,0,h)?r[r.length-1]=t:(s&&t.merge(0,s,null,!1,0,h),r.push(t))):(null==t?void 0:t.breakAfter)&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),e++));e<n&&r.length;)if(a[n-1].become(r[r.length-1]))n--,r.pop(),h=r.length?0:l;else{if(!a[e].become(r[0]))break;e++,r.shift(),l=r.length?0:h}!r.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,l,h)&&e--,(e<n||r.length)&&t.replaceChildren(e,n,r)}}function hV(t,e,i,n,s,r){let o=t.childCursor(),{i:l,off:h}=o.findPos(i,1),{i:a,off:c}=o.findPos(e,-1),d=e-i;for(let t of n)d+=t.length;t.length+=d,lV(t,a,c,l,h,n,0,s,r)}let aV="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},cV="undefined"!=typeof document?document:{documentElement:{style:{}}};const dV=/Edge\/(\d+)/.exec(aV.userAgent),uV=/MSIE \d/.test(aV.userAgent),fV=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(aV.userAgent),pV=!!(uV||fV||dV),gV=!pV&&/gecko\/(\d+)/i.test(aV.userAgent),mV=!pV&&/Chrome\/(\d+)/.exec(aV.userAgent),vV="webkitFontSmoothing"in cV.documentElement.style,wV=!pV&&/Apple Computer/.test(aV.vendor),yV=wV&&(/Mobile\/\w+/.test(aV.userAgent)||aV.maxTouchPoints>2);var bV={mac:yV||/Mac/.test(aV.platform),windows:/Win/.test(aV.platform),linux:/Linux|X11/.test(aV.platform),ie:pV,ie_version:uV?cV.documentMode||6:fV?+fV[1]:dV?+dV[1]:0,gecko:gV,gecko_version:gV?+(/Firefox\/(\d+)/.exec(aV.userAgent)||[0,0])[1]:0,chrome:!!mV,chrome_version:mV?+mV[1]:0,ios:yV,android:/Android\b/.test(aV.userAgent),webkit:vV,safari:wV,webkit_version:vV?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=cV.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class xV extends sV{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof xV&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new xV(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new iV(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return kV(this.dom,t,e)}}class SV extends sV{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(eV(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,r){return(!i||!(!(i instanceof SV&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&r<=0))&&(hV(this,t,e,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),n<0&&i>=t&&(n=s),i=o,s++}let r=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new SV(this.mark,e,r)}domAtPos(t){return TV(this.dom,this.children,t)}coordsAt(t,e){return EV(this,t,e)}}function kV(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;0==e&&i<0||e==n&&i>=0?bV.chrome||bV.gecko||(e?(s--,o=1):(r++,o=-1)):i<0?s--:r++;let l=ZL(t,s,r).getClientRects();if(!l.length)return _L;let h=l[(o?o<0:i>=0)?0:l.length-1];return bV.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(l,(t=>t.width))||h),o?UL(h,o<0):h||null}class AV extends sV{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||AV)(t,e,i)}split(t){let e=AV.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof AV&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof AV&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return f.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):f.empty}domAtPos(t){return 0==t?iV.before(this.dom):iV.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return _L;for(let e=t>0?i.length-1:0;n=i[e],!(t>0?0==e:e==i.length-1||n.top<n.bottom);e+=t>0?-1:1);return 0==t&&e>0||t==this.length&&e<=0?n:UL(n,0==t)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class MV extends AV{domAtPos(t){let{topView:e,text:i}=this.widget;return e?CV(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new iV(i,Math.min(t,i.nodeValue.length)))):new iV(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?OV(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?CV(t,e,i,n,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>kV(n,t,e))):kV(n,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}}function CV(t,e,i,n,s,r){if(i instanceof SV){for(let o of i.children){let i=IL(o.dom,n),l=i?n.nodeValue.length:o.length;if(t<l||t==l&&o.getSide()<=0)return i?CV(t,e,o,n,s,r):s(o,t,e);t-=l}return s(i,i.length,-1)}return i.dom==n?r(t,e):s(i,t,e)}function OV(t,e,i,n){if(i instanceof SV)for(let s of i.children){let i=0,r=IL(s.dom,n);if(IL(s.dom,t))return i+(r?OV(t,e,s,n):s.localPosFromDOM(t,e));i+=r?n.nodeValue.length:s.length}else if(i.dom==n)return Math.min(e,n.nodeValue.length);return i.localPosFromDOM(t,e)}class DV extends sV{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof DV&&t.side==this.side}split(){return new DV(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return iV.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,n=i?i.children.indexOf(t):-1;for(;i&&n>=0;)if(e<0?n>0:n<i.children.length){let t=i.children[n+e];if(t instanceof xV){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}n+=e}else{if(!(i instanceof SV&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}n=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return f.empty}}function TV(t,e,i){let n=0;for(let s=0;n<e.length;n++){let r=e[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==t)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return iV.after(i)}return new iV(t,0)}function BV(t,e,i){let n,{children:s}=t;i>0&&e instanceof SV&&s.length&&(n=s[s.length-1])instanceof SV&&n.mark.eq(e.mark)?BV(n,e.children[0],i-1):(s.push(e),e.setParent(t)),t.length+=e.length}function EV(t,e,i){for(let n=0,s=0;s<t.children.length;s++){let r,o=t.children[s],l=n+o.length;if((i<=0||l==t.length||o.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(r=t.children[s+1]).length||r.getSide()>0)){let t=0;if(l==n){if(o.getSide()<=0)continue;t=i=-o.getSide()}let s=o.coordsAt(Math.max(0,e-n),i);return t&&s?UL(s,i<0):s}n=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let s=zL(n);return s[s.length-1]||null}function RV(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function LV(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||t[s]!==e[s])return!1;return!0}function VV(t,e,i){if(e)for(let n in e)i&&n in i||t.removeAttribute(n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(n,i[n])}xV.prototype.children=AV.prototype.children=DV.prototype.children=nV;class NV{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var PV=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(PV||(PV={}));class HV extends Lt{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new WV(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?4e8:-5e8:e>0?1e8:-1e8,new FV(t,e,e,i,t.widget||null,!1)}static replace(t){let e,i,n=!!t.block;if(t.isBlockGap)e=-4e8,i=3e8;else{let{start:s,end:r}=zV(t,n);e=(s?n?-3e8:-1:5e8)-1,i=1+(r?n?2e8:1:-6e8)}return new FV(t,e,i,n,t.widget||null,!0)}static line(t){return new IV(t)}static set(t,e=!1){return Ht.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}HV.none=Ht.empty;class WV extends HV{constructor(t){let{start:e,end:i}=zV(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof WV&&this.tagName==t.tagName&&this.class==t.class&&LV(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}WV.prototype.point=!1;class IV extends HV{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof IV&&LV(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}IV.prototype.mapMode=k.TrackBefore,IV.prototype.point=!0;class FV extends HV{constructor(t,e,i,n,s,r){super(e,i,s,t),this.block=n,this.isReplace=r,this.mapMode=n?e<=0?k.TrackBefore:k.TrackAfter:k.TrackDel}get type(){return this.startSide<this.endSide?PV.WidgetRange:this.startSide<=0?PV.WidgetBefore:PV.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof FV&&(e=this.widget,i=t.widget,e==i||!!(e&&i&&e.compare(i)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var e,i}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function zV(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return null==i&&(i=t.inclusive),null==n&&(n=t.inclusive),{start:null!=i?i:e,end:null!=n?n:e}}function qV(t,e,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=t?i[s]=Math.max(i[s],e):i.push(t,e)}FV.prototype.point=!0;class KV extends sV{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,r){if(i){if(!(i instanceof KV))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),hV(this,t,e,i?i.children:[],s,r),!0}split(t){let e=new KV;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){LV(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){BV(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=RV(e,this.attrs||{})),i&&(this.attrs=RV({class:i},this.attrs||{}))}domAtPos(t){return TV(this.dom,this.children,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(eV(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(VV(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&sV.get(i)instanceof SV;)i=i.lastChild;if(!i||"BR"!=i.nodeName&&0==(null===(e=sV.get(i))||void 0===e?void 0:e.isEditable)&&(!bV.ios||!this.children.some((t=>t instanceof xV)))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof xV))return null;let i=zL(e.dom);if(1!=i.length)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return EV(this,t,e)}become(t){return!1}get type(){return PV.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],r=n+s.length;if(r>=e){if(s instanceof KV)return s;if(r>e)break}n=r+s.breakAfter}return null}}class GV extends sV{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,r){return!(i&&(!(i instanceof GV&&this.widget.compare(i.widget))||t>0&&s<=0||e<this.length&&r<=0))&&(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return 0==t?iV.before(this.dom):iV.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new GV(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return nV}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):f.empty}domBoundsAround(){return null}become(t){return t instanceof GV&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class jV{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof GV&&t.type==PV.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new KV),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(_V(new DV(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(_V(new xV(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s){let r=e-t;if(i instanceof FV)if(i.block){let{type:t}=i;t!=PV.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new GV(i.widget||new UV("div"),r,t))}else{let o=AV.create(i.widget||new UV("span"),r,i.startSide),l=this.atCursorPos&&!o.isEditable&&s<=n.length&&(t<e||i.startSide>0),h=!o.isEditable&&(t<e||i.startSide<=0),a=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(n),l&&(a.append(_V(new DV(1),n),s),s=n.length+Math.max(0,s-n.length)),a.append(_V(o,n),s),this.atCursorPos=h,this.pendingBuffer=h?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);r&&(this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}filterPoint(t,e,i,n){if(n<this.disallowBlockEffectsBelow&&i instanceof FV){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(t,e,i,n,s){let r=new jV(t,e,i,s);return r.openEnd=Ht.spans(n,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function _V(t,e){for(let i of e)t=new SV(i,[t],t.length);return t}class UV extends NV{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const $V=[],YV=H.define(),XV=H.define(),JV=H.define(),QV=H.define(),ZV=H.define(),tN=H.define(),eN=ft.define({map:(t,e)=>t.map(e)}),iN=ft.define({map:(t,e)=>t.map(e)});class nN{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new nN(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const sN=ft.define({map:(t,e)=>t.map(e)});function rN(t,e,i){let n=t.facet(QV);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const oN=H.define({combine:t=>!t.length||t[0]});class lN{constructor(t,e){this.field=t,this.get=e}}class hN{from(t){return new lN(this,t)}static define(){return new hN}}hN.decorations=hN.define(),hN.atomicRanges=hN.define(),hN.scrollMargins=hN.define();let aN=0;const cN=H.define();class dN{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=cN.of(this)}static define(t,e){let{eventHandlers:i,provide:n,decorations:s}=e||{},r=[];if(n)for(let t of Array.isArray(n)?n:[n])r.push(t);return i&&r.push(uN.from((t=>({plugin:t,handlers:i})))),s&&r.push(hN.decorations.from(s)),new dN(aN++,t,r)}static fromClass(t,e){return dN.define((e=>new t(e)),e)}}const uN=hN.define();class fN{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:n}of this.spec.fields)i==t&&e.push(n(this.value))}update(t){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(e){if(rN(t.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){rN(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){rN(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const pN=H.define(),gN=H.define(),mN=H.define(),vN=H.define();class wN{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new wN(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let l=n==t.length?null:t[n],h=r-o,a=l?l.fromB:1e9;for(;s<e.length&&e[s]<a;){let t=e[s],n=e[s+1],r=Math.max(o,t),l=Math.min(a,n);if(r<=l&&new wN(r+h,l+h,r,l).addToSet(i),n>a)break;s+=2}if(!l)return i;new wN(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class yN{constructor(t,e,i=$V){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=M.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let n=[];this.changes.iterChangedRanges(((t,e,i,s)=>n.push(new wN(t,e,i,s)))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var bN=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(bN||(bN={}));const xN=bN.LTR,SN=bN.RTL;function kN(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const AN=kN("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),MN=kN("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),CN=Object.create(null),ON=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);CN[e]=i,CN[i]=-e}const DN=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class TN{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?SN:xN}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<e:o.to>e:t[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const BN=[];function EN(t,e){let i=t.length,n=e==xN?1:2,s=e==xN?2:1;if(!t||1==n&&!DN.test(t))return RN(i);for(let e=0,s=n,o=n;e<i;e++){let i=(r=t.charCodeAt(e))<=247?AN[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?MN[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),BN[e]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let t=0,e=n,s=n;t<i;t++){let n=BN[t];if(128==n)t<i-1&&e==BN[t+1]&&24&e?n=BN[t]=e:BN[t]=256;else if(64==n){let n=t+1;for(;n<i&&64==BN[n];)n++;let r=t&&8==e||n<i&&8==BN[n]?1==s?1:8:256;for(let e=t;e<n;e++)BN[e]=r;t=n-1}else 8==n&&1==s&&(BN[t]=1);e=n,7&n&&(s=n)}for(let e,r,o,l=0,h=0,a=0;l<i;l++)if(r=CN[e=t.charCodeAt(l)])if(r<0){for(let t=h-3;t>=0;t-=3)if(ON[t+1]==-r){let e=ON[t+2],i=2&e?n:4&e?1&e?s:n:0;i&&(BN[l]=BN[ON[t]]=i),h=t;break}}else{if(189==ON.length)break;ON[h++]=l,ON[h++]=e,ON[h++]=a}else if(2==(o=BN[l])||1==o){let t=o==n;a=t?0:1;for(let e=h-3;e>=0;e-=3){let i=ON[e+2];if(2&i)break;if(t)ON[e+2]|=2;else{if(4&i)break;ON[e+2]|=4}}}for(let t=0;t<i;t++)if(256==BN[t]){let e=t+1;for(;e<i&&256==BN[e];)e++;let s=1==(t?BN[t-1]:n),r=s==(1==(e<i?BN[e]:n))?s?1:2:n;for(let i=t;i<e;i++)BN[i]=r;t=e-1}let o=[];if(1==n)for(let t=0;t<i;){let e=t,n=1!=BN[t++];for(;t<i&&n==(1!=BN[t]);)t++;if(n)for(let i=t;i>e;){let t=i,n=2!=BN[--i];for(;i>e&&n==(2!=BN[i-1]);)i--;o.push(new TN(i,t,n?2:1))}else o.push(new TN(e,t,0))}else for(let t=0;t<i;){let e=t,n=2==BN[t++];for(;t<i&&n==(2==BN[t]);)t++;o.push(new TN(e,t,n?1:2))}return o}function RN(t){return[new TN(0,t,0)]}let LN="";function VN(t,e,i,s,r){var o;let l=s.head-t.from,h=-1;if(0==l){if(!r||!t.length)return null;e[0].level!=i&&(l=e[0].side(!1,i),h=0)}else if(l==t.length){if(r)return null;let t=e[e.length-1];t.level!=i&&(l=t.side(!0,i),h=e.length-1)}h<0&&(h=TN.find(e,l,null!==(o=s.bidiLevel)&&void 0!==o?o:-1,s.assoc));let a=e[h];l==a.side(r,i)&&(a=e[h+=r?1:-1],l=a.side(!r,i));let c=r==(a.dir==i),d=n(t.text,l,c);if(LN=t.text.slice(Math.min(l,d),Math.max(l,d)),d!=a.side(r,i))return L.cursor(d+t.from,c?-1:1,a.level);let u=h==(r?e.length-1:0)?null:e[h+(r?1:-1)];return u||a.level==i?u&&u.level<a.level?L.cursor(u.side(!r,i)+t.from,r?1:-1,u.level):L.cursor(d+t.from,r?-1:1,a.level):L.cursor(r?t.to:t.from,r?-1:1,i)}class NN{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Mt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+="￿"}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let t=n.nextSibling;if(t==e)break;let s=sV.get(n),r=sV.get(t);(s&&r?s.breakAfter:(s?s.breakAfter:PN(n))||PN(t)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(e))&&(r=s.index,o=s[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=sV.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function PN(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class HN{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class WN extends sV{constructor(t){super(),this.view=t,this.compositionDeco=HV.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new KV],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new wN(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=HV.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=FN(t);if(!i)return HV.none;let{from:n,to:s,node:r,text:o}=i,l=e.mapPos(n,1),h=Math.max(l,e.mapPos(s,-1)),{state:a}=t,c=3==r.nodeType?r.nodeValue:new NN([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),"￿")==c)h=l+c.length;else{if(a.doc.sliceString(Math.max(0,h-c.length),h,"￿")!=c)return HV.none;l=h-c.length}else if(a.doc.sliceString(l,h,"￿")!=c)return HV.none;let d=sV.get(r);d instanceof MV?d=d.widget.topView:d&&(d.parent=null);return HV.set(HV.replace({widget:new zN(r,o,d)}).range(l,h))}(this.view,t.changes)),(bV.ie||bV.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let n=new KN;return Ht.compare(t,e,i,n),n.changes}(this.decorations,this.updateDeco(),t.changes);return e=wN.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let t=bV.chrome||bV.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof GV&&t.widget instanceof IN&&n.push(t.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let n=e>=0?t[e]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:l}=n,{content:h,breakAtStart:a,openStart:c,openEnd:d}=jV.build(this.view.state.doc,o,l,this.decorations,this.pluginDecorationLength),{i:u,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);lV(this,p,g,u,f,h,a,c,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection()||bV.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if(bV.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let t=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(t,s.node.childNodes[s.offset]||null))),s=r=new iV(t,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&qL(s.node,s.offset,l.anchorNode,l.anchorOffset)&&qL(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{bV.android&&bV.chrome&&this.dom.contains(l.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=WL(this.root);if(n.empty){if(bV.gecko){let t=(e=s.node,i=s.offset,1!=e.nodeType?0:(i&&"false"==e.childNodes[i-1].contentEditable?1:0)|(i<e.childNodes.length&&"false"==e.childNodes[i].contentEditable?2:0));if(t&&3!=t){let e=qN(s.node,s.offset,1==t?1:-1);e&&(s=new iV(e,1==t?0:e.nodeValue.length))}}t.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(t.extend)t.collapse(s.node,s.offset),t.extend(r.node,r.offset);else{let e=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),e.setEnd(r.node,r.offset),e.setStart(s.node,s.offset),t.removeAllRanges(),t.addRange(e)}var e,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new iV(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new iV(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=WL(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=KV.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),r=this.coordsAt(t.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(t.head+t.assoc);e.collapse(o.node,o.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(oN)?this.root.activeElement==this.dom:FL(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let t=sV.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof KV)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(t>r||t==r&&s.type!=PV.WidgetBefore&&s.type!=PV.WidgetAfter&&(!n||2==e||this.children[n-1].breakAfter||this.children[n-1].type==PV.WidgetBefore&&e>-2))return s.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,n=this.view.contentDOM.clientWidth,s=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,r=-1;for(let o=0,l=0;l<this.children.length;l++){let h=this.children[l],a=o+h.length;if(a>i)break;if(o>=e){let e=h.dom.getBoundingClientRect();if(t.push(e.height),s){let t=h.dom.lastChild,i=t?zL(t):[];if(i.length){let t=i[i.length-1],s=this.view.textDirection==bN.LTR?t.right-e.left:e.right-t.left;s>r&&(r=s,this.minWidth=n,this.minWidthFrom=o,this.minWidthTo=a)}}}o=a+h.breakAfter}return t}measureTextSize(){for(let t of this.children)if(t instanceof KV){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=zL(i.firstChild)[0];t=i.getBoundingClientRect().height,e=n?n.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new oV(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(HV.replace({widget:new IN(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!s)break;i=s.to+1}return HV.set(t)}updateDeco(){let t=this.view.pluginField(hN.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(mN),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)});let s=0,r=0,o=0,l=0;for(let t of this.view.pluginField(hN.scrollMargins))if(t){let{left:e,right:i,top:n,bottom:h}=t;null!=e&&(s=Math.max(s,e)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=h&&(l=Math.max(l,h))}let h={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+l};!function(t,e,i,n,s,r,o,l){let h=t.ownerDocument,a=h.defaultView;for(let c=t;c;)if(1==c.nodeType){let t,d=c==h.body;if(d)t=$L(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let u=0,f=0;if("nearest"==s)e.top<t.top?(f=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+f&&(f=e.bottom-t.bottom+f+o)):e.bottom>t.bottom&&(f=e.bottom-t.bottom+o,i<0&&e.top-f<t.top&&(f=-(t.top+f-e.top+o)));else{let n=e.bottom-e.top,r=t.bottom-t.top;f=("center"==s&&n<=r?e.top+n/2-r/2:"start"==s||"center"==s&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==n?e.left<t.left?(u=-(t.left-e.left+r),i>0&&e.right>t.right+u&&(u=e.right-t.right+u+r)):e.right>t.right&&(u=e.right-t.right+r,i<0&&e.left<t.left+u&&(u=-(t.left+u-e.left+r))):u=("center"==n?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==n==l?e.left-r:e.right-(t.right-t.left)+r)-t.left,u||f)if(d)a.scrollBy(u,f);else{if(f){let t=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-t}if(u){let t=c.scrollLeft;c.scrollLeft+=u,u=c.scrollLeft-t}e={left:e.left-u,top:e.top-f,right:e.right-u,bottom:e.bottom-f}}if(d)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,h,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==bN.LTR)}}class IN extends NV{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function FN(t){let e=t.observer.selectionRange,i=e.focusNode&&qN(e.focusNode,e.focusOffset,0);if(!i)return null;let n=t.docView.nearest(i);if(!n)return null;if(n instanceof KV){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!sV.get(e);)e=e.previousSibling;let s=e?sV.get(e).posAtEnd:n.posAtStart;return{from:s,to:s,node:t,text:i}}{for(;;){let{parent:t}=n;if(!t)return null;if(t instanceof KV)break;n=t}let t=n.posAtStart;return{from:t,to:t+n.length,node:n.dom,text:i}}}class zN extends NV{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return MV}}function qN(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=jL(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class KN{constructor(){this.changes=[]}compareRange(t,e){qV(t,e,this.changes)}comparePoint(t,e){qV(t,e,this.changes)}}function GN(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function jN(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function _N(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function UN(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function $N(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function YN(t,e,i){let n,s,r,o,l,h,a,c;for(let d=t.firstChild;d;d=d.nextSibling){let t=zL(d);for(let u=0;u<t.length;u++){let f=t[u];s&&_N(s,f)&&(f=UN($N(f,s.bottom),s.top));let p=GN(e,f),g=jN(i,f);if(0==p&&0==g)return 3==d.nodeType?XN(d,e,i):YN(d,e,i);(!n||o>g||o==g&&r>p)&&(n=d,s=f,r=p,o=g),0==p?i>f.bottom&&(!a||a.bottom<f.bottom)?(l=d,a=f):i<f.top&&(!c||c.top>f.top)&&(h=d,c=f):a&&_N(a,f)?a=$N(a,f.bottom):c&&_N(c,f)&&(c=UN(c,f.top))}}if(a&&a.bottom>=i?(n=l,s=a):c&&c.top<=i&&(n=h,s=c),!n)return{node:t,offset:0};let d=Math.max(s.left,Math.min(s.right,e));return 3==n.nodeType?XN(n,d,i):r||"true"!=n.contentEditable?{node:t,offset:Array.prototype.indexOf.call(t.childNodes,n)+(e>=(s.left+s.right)/2?1:0)}:YN(n,d,i)}function XN(t,e,i){let n=t.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<n;l++){let n=ZL(t,l,l+1).getClientRects();for(let h=0;h<n.length;h++){let a=n[h];if(a.top==a.bottom)continue;o||(o=e-a.left);let c=(a.top>i?a.top-i:i-a.bottom)-1;if(a.left-1<=e&&a.right+1>=e&&c<r){let i=e>=(a.left+a.right)/2,n=i;if(bV.chrome||bV.gecko){ZL(t,l).getBoundingClientRect().left==a.right&&(n=!i)}if(c<=0)return{node:t,offset:l+(n?1:0)};s=l+(n?1:0),r=c}}}return{node:t,offset:s>-1?s:o>0?t.nodeValue.length:0}}function JN(t,{x:e,y:i},n,s=-1){var r;let o,l=t.contentDOM.getBoundingClientRect(),h=l.top+t.viewState.paddingTop,{docHeight:a}=t.viewState,c=i-h;if(c<0)return 0;if(c>a)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;o=t.elementAtHeight(c),o.type!=PV.Text;)for(;c=s>0?o.bottom+e:o.top-e,!(c>=0&&c<=a);){if(i)return n?null:0;i=!0,s=-s}i=h+c;let d=o.from;if(d<t.viewport.from)return 0==t.viewport.from?0:n?null:QN(t,l,o,e,i);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:QN(t,l,o,e,i);let u=t.dom.ownerDocument,f=t.root.elementFromPoint?t.root:u,p=f.elementFromPoint(e,i);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(l.left+1,Math.min(l.right-1,e)),p=f.elementFromPoint(e,i),p&&!t.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=t.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(u.caretPositionFromPoint){let t=u.caretPositionFromPoint(e,i);t&&({offsetNode:g,offset:m}=t)}else if(u.caretRangeFromPoint){let t=u.caretRangeFromPoint(e,i);t&&(({startContainer:g,startOffset:m}=t),bV.safari&&function(t,e,i){let n;if(3!=t.nodeType||e!=(n=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return ZL(t,n-1,n).getBoundingClientRect().left>i}(g,m,e)&&(g=void 0))}if(!g||!t.docView.dom.contains(g)){let n=KV.find(t.docView,d);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=YN(n.dom,e,i))}return t.docView.posFromDOM(g,m)}function QN(t,e,i,n,s){let r=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>1.5*t.defaultLineHeight){r+=Math.floor((s-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+u(o,r,t.state.tabSize)}function ZN(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=t.bidiSpans(s);for(let o=e,l=null;;){let e=VN(s,r,t.textDirection,o,i),h=LN;if(!e){if(s.number==(i?t.state.doc.lines:1))return o;h="\n",s=t.state.doc.line(s.number+(i?1:-1)),r=t.bidiSpans(s),e=L.cursor(i?s.from:s.to)}if(l){if(!l(h))return o}else{if(!n)return e;l=n(h)}o=e}}function tP(t,e,i){let n=t.pluginField(hN.atomicRanges);for(;;){let t=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=e.from>i.from?L.cursor(n,1):L.cursor(s,-1),t=!0)}));if(!t)return i}}class eP{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in oP){let i=oP[e];t.contentDOM.addEventListener(e,(n=>{"keydown"==e&&this.keydown(t,n)||rP(t,n)&&!this.ignoreDuringComposition(n)&&(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))})),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),bV.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(uN);for(let i of e)for(let e in i.handlers)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{rP(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(t){rN(e.state,t)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(e){rN(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if(bV.android&&bV.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!bV.ios||!(i=iP.find((t=>t.keyCode==e.keyCode)))||e.ctrlKey||e.altKey||e.metaKey||e.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(t)),250),!0)}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,tV(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(bV.safari&&Date.now()-this.compositionEndedAt<500)&&(this.compositionEndedAt=0,!0))}screenKeyEvent(t,e){let i=9==e.keyCode&&Date.now()<this.lastEscPress+2e3;return 27==e.keyCode?this.lastEscPress=Date.now():nP.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode||"compositionend"==t.type&&!bV.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const iP=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],nP=[16,17,18,20,91,92,224,225];class sP{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Mt.allowMultipleSelections)&&function(t,e){let i=t.state.facet(YV);return i.length?i[0](e):bV.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(XV);return i.length?i[0](e):bV.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=WL(t.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let t=0;t<s.length;t++){let i=s[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=yP(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function rP(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=sV.get(n))&&i.ignoreEvent(e))return!1;return!0}const oP=Object.create(null),lP=bV.ie&&bV.ie_version<15||bV.ios&&bV.webkit_version<604;function hP(t,e){let i,{state:n}=t,s=1,r=n.toText(e),o=r.lines==n.selection.ranges.length;if(null!=xP&&n.selection.ranges.every((t=>t.empty))&&xP==r.toString()){let t=-1;i=n.changeByRange((i=>{let l=n.doc.lineAt(i.from);if(l.from==t)return{range:i};t=l.from;let h=n.toText((o?r.line(s++).text:e)+n.lineBreak);return{changes:{from:l.from,insert:h},range:L.cursor(i.from+h.length)}}))}else i=o?n.changeByRange((t=>{let e=r.line(s++);return{changes:{from:t.from,to:t.to,insert:e.text},range:L.cursor(t.from+e.length)}})):n.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}oP.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select")};let aP=0;function cP(t,e,i,s){if(1==s)return L.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),r=t.doc.lineAt(e),o=e-r.from;if(0==r.length)return L.cursor(e);0==o?i=1:o==r.length&&(i=-1);let l=o,h=o;i<0?l=n(r.text,o,!1):h=n(r.text,o);let a=s(r.text.slice(l,h));for(;l>0;){let t=n(r.text,l,!1);if(s(r.text.slice(t,l))!=a)break;l=t}for(;h<r.length;){let t=n(r.text,h);if(s(r.text.slice(h,t))!=a)break;h=t}return L.range(l+r.from,h+r.from)}(t.state,e,i);{let i=KV.find(t.docView,e),n=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<t.state.doc.length&&r==n.to&&r++,L.range(s,r)}}oP.touchstart=(t,e)=>{aP=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},oP.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},oP.mousedown=(t,e)=>{if(t.observer.flush(),aP>Date.now()-2e3&&1==yP(e))return;let i=null;for(let n of t.state.facet(JV))if(i=n(t,e),i)break;if(i||0!=e.button||(i=function(t,e){let i=pP(t,e),n=yP(e),s=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i&&(i.pos=t.changes.mapPos(i.pos)),s=s.map(t.changes),o=null)},get(e,l,h){let a;if(o&&e.clientX==o.clientX&&e.clientY==o.clientY?a=r:(a=r=pP(t,e),o=e),!a||!i)return s;let c=cP(t,a.pos,a.bias,n);if(i.pos!=a.pos&&!l){let e=cP(t,i.pos,i.bias,n),s=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=s<c.from?L.range(s,r):L.range(r,s)}return l?s.replaceRange(s.main.extend(c.from,c.to)):h?s.addRange(c):L.create([c])}}}(t,e)),i){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore((()=>QL(t.contentDOM))),t.inputState.startMouseSelection(new sP(t,e,i,n))}};let dP=(t,e)=>t>=e.top&&t<=e.bottom,uP=(t,e,i)=>dP(e,i)&&t>=i.left&&t<=i.right;function fP(t,e,i,n){let s=KV.find(t.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&uP(i,n,o))return-1;let l=s.coordsAt(r,1);return l&&uP(i,n,l)?1:o&&dP(n,o)?-1:1}function pP(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:fP(t,i,e.clientX,e.clientY)}}const gP=bV.ie&&bV.ie_version<=11;let mP=null,vP=0,wP=0;function yP(t){if(!gP)return t.detail;let e=mP,i=wP;return mP=t,wP=Date.now(),vP=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(vP+1)%3:1}function bP(t,e,i,n){if(!i)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:i},h=t.state.changes(o?[o,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}oP.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},oP.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&bP(t,e,n.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(n[t]=e.result),r()},e.readAsText(i[t])}}else bP(t,e,e.dataTransfer.getData("Text"),!0)},oP.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=lP?null:e.clipboardData;i?(hP(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),hP(t,i.value)}),50)}(t)};let xP=null;function SP(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}oP.copy=oP.cut=(t,e)=>{let{text:i,ranges:n,linewise:s}=function(t){let e=[],i=[],n=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let s=-1;for(let{from:n}of t.selection.ranges){let r=t.doc.lineAt(n);r.number>s&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),s=r.number}n=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:n}}(t.state);if(!i&&!s)return;xP=s?i:null;let r=lP?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout((()=>{n.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},oP.focus=oP.blur=t=>{setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)},oP.beforeprint=t=>{t.viewState.printing=!0,t.requestMeasure(),setTimeout((()=>{t.viewState.printing=!1,t.requestMeasure()}),2e3)},oP.compositionstart=oP.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),SP(t,!0)))},oP.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout((()=>{t.inputState.composing<0&&SP(t,!1)}),50)},oP.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},oP.beforeinput=(t,e)=>{var i;let n;if(bV.chrome&&bV.android&&(n=iP.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const kP=["pre-wrap","normal","pre-line","break-spaces"];class AP{constructor(){this.doc=f.empty,this.lineWrapping=!1,this.direction=bN.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return kP.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(e=!0,this.heightSamples[Math.floor(10*n)]=!0)}return e}refresh(t,e,i,n,s,r){let o=kP.indexOf(t)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=o||this.direction!=e;if(this.lineWrapping=o,this.direction=e,this.lineHeight=i,this.charWidth=n,this.lineLength=s,l){this.heightSamples={};for(let t=0;t<r.length;t++){let e=r[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return l}}class MP{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class CP{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new CP(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new CP(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((e=>e.moveY(t))):this.type):this}}var OP=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(OP||(OP={}));class DP{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>.001&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return DP.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:h,toB:a}=n[r],c=s.lineAt(o,OP.ByPosNoHeight,e,0,0),d=c.to>=l?c:s.lineAt(l,OP.ByPosNoHeight,e,0,0);for(a+=d.to-l,l=d.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,h=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,OP.ByPosNoHeight,e,0,0));h+=c.from-o,o=c.from;let u=VP.build(i,t,h,a);s=s.replace(o,l,u)}return s.updateHeight(i,0)}static empty(){return new BP(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>2*s){let s=t[e-1];s.break?t.splice(--e,1,s.left,null,s.right):t.splice(--e,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,s-=e.size}}else if(n<s){let i=t[e++];i&&(n+=i.size)}else{let e=t[--i];e&&(s+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new RP(DP.of(t.slice(0,e)),r,DP.of(t.slice(i)))}}DP.prototype.size=1;class TP extends DP{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new CP(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,r){r(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class BP extends TP{constructor(t,e){super(t,e,PV.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return 1==i.length&&(n instanceof BP||n instanceof EP&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof EP?n=new BP(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):DP.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class EP extends DP{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(e,n),l=Math.max(0,Math.min(r-s,Math.floor((t-i)/o))),{from:h,length:a}=e.line(s+l);return new CP(h,a,i+o*l,o,PV.Text)}lineAt(t,e,i,n,s){if(e==OP.ByHeight)return this.blockAt(t,i,n,s);if(e==OP.ByPosNoHeight){let{from:e,to:n}=i.lineAt(t);return new CP(e,n-e,0,0,PV.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:l,length:h,number:a}=i.lineAt(t);return new CP(l,h,n+o*(a-r),o,PV.Text)}forEachLine(t,e,i,n,s,r){let{firstLine:o,lineHeight:l}=this.lines(i,s);for(let h=Math.max(t,s),a=Math.min(s+this.length,e);h<=a;){let e=i.lineAt(h);h==t&&(n+=l*(e.number-o)),r(new CP(e.from,e.length,n,l,PV.Text)),n+=l,h=e.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let t=i[i.length-1];t instanceof EP?i[i.length-1]=new EP(t.length+n):i.push(null,new EP(n-1))}if(t>0){let e=i[0];e instanceof EP?i[0]=new EP(t+e.length):i.unshift(new EP(t-1),null)}return DP.of(i)}decomposeLeft(t,e){e.push(new EP(t-1),null)}decomposeRight(t,e){e.push(null,new EP(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let i=[],r=Math.max(e,n.from),o=-1,l=t.heightChanged;for(n.from>e&&i.push(new EP(n.from-e-1).updateHeight(t,e));r<=s&&n.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let l=new BP(e,s);l.outdated=!1,i.push(l),r+=e+1}r<=s&&i.push(null,new EP(s-r).updateHeight(t,r));let h=DP.of(i);return t.heightChanged=l||o<0||Math.abs(h.height-this.height)>=.001||Math.abs(o-this.lines(t.doc,e).lineHeight)>=.001,h}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class RP extends DP{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,l=e==OP.ByHeight?t<r:t<o,h=l?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,r,o);if(this.break||(l?h.to<o:h.from>o))return h;let a=e==OP.ByPosNoHeight?OP.ByPosNoHeight:OP.ByPos;return l?h.join(this.right.lineAt(o,a,i,r,o)):this.left.lineAt(o,a,i,n,s).join(h)}forEachLine(t,e,i,n,s,r){let o=n+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,n,s,r),e>=l&&this.right.forEachLine(t,e,i,o,l,r);else{let h=this.lineAt(l,OP.ByPos,i,n,s);t<h.from&&this.left.forEachLine(t,h.from-1,i,n,s,r),h.to>=t&&h.from<=e&&r(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,o,l,r)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let r=s.length;for(let t of i)s.push(t);if(t>0&&LP(s,r-1),e<this.length){let t=s.length;this.decomposeRight(e,s),LP(s,t)}return DP.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?DP.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:r}=this,o=e+s.length+this.break,l=null;return n&&n.from<=e+s.length&&n.more?l=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=o+r.length&&n.more?l=r=r.updateHeight(t,o,i,n):r.updateHeight(t,o,i),l?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function LP(t,e){let i,n;null==t[e]&&(i=t[e-1])instanceof EP&&(n=t[e+1])instanceof EP&&t.splice(e-1,3,new EP(i.length+1+n.length))}class VP{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof BP?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new BP(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new TP(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new BP(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new EP(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof BP)return t;let e=new BP(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=PV.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=PV.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof BP||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new BP(0,-1));let i=t;for(let t of this.nodes)t instanceof BP&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,n){let s=new VP(i,t);return Ht.spans(e,i,n,s,0),s.finish(i)}}class NP{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&qV(t,e,this.changes,5)}}class PP{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return HV.replace({widget:new HP(this.size,t)}).range(this.from,this.to)}}class HP extends NV{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class WP{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new AP,this.scaler=jP,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=DP.empty().applyChanges(t.facet(mN),f.empty,this.heightOracle.setDoc(t.doc),[new wN(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=HV.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>n>=t&&n<=e))){let{from:e,to:i}=this.lineBlockAt(n);t.push(new IP(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?jP:new _P(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:UP(t,this.scaler))}))}update(t,e=null){let i=this.state;this.state=t.state;let n=this.state.facet(mN),s=t.changedRanges,r=wN.extendWithRanges(s,function(t,e,i){let n=new NP;return Ht.compare(t,e,i,n,0),n.changes}(t.startState.facet(mN),n,t?t.changes:M.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,i.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||2&t.flags||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace,r="rtl"==i.direction?bN.RTL:bN.LTR,o=this.heightOracle.mustRefreshForStyle(s,r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,h=0,a=0;if(this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let t=parseInt(i.paddingTop)||0,n=parseInt(i.paddingBottom)||0;this.paddingTop==t&&this.paddingBottom==n||(h|=8,this.paddingTop=t,this.paddingBottom=n)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:function(t,e){let i=t.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=t.ownerDocument.body;for(let e=t.parentNode;e&&e!=l;)if(1==e.nodeType){let t=e,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let e=t.getBoundingClientRect();n=Math.max(n,e.left),s=Math.min(s,e.right),r=Math.max(r,e.top),o=Math.min(o,e.bottom)}e="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+e),bottom:Math.max(r,o)-(i.top+e)}}(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if(this.contentDOMWidth==p&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let e=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(e)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:l}=t.docView.measureTextSize();o=n.refresh(s,r,i,l,p/l,e),o&&(t.docView.minWidth=0,h|=8)}d>0&&u>0?a=Math.max(d,u):d<0&&u<0&&(a=Math.min(d,u)),n.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(n,0,o,new MP(this.viewport.from,e)),n.heightChanged&&(h|=2)}let g=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&h||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new IP(n.lineAt(r-1e3*i,OP.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),OP.ByHeight,s,0,0).to);if(e){let{head:t}=e.range;if(t<l.from||t>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(t,OP.ByPos,s,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<l.from?o.top:o.bottom-r,l=new IP(n.lineAt(i-500,OP.ByHeight,s,0,0).from,n.lineAt(i+r+500,OP.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new IP(this.heightMap.lineAt(i,OP.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,OP.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,OP.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,OP.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||n<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new PP(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=bN.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=FP(i.from,i.to,this.state);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let t=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=zP(r,(this.visibleTop-i.top-t)/i.height),s=zP(r,(this.visibleBottom-i.top+t)/i.height)}else{let t=r.total*this.heightOracle.charWidth,e=2e3*this.heightOracle.charWidth;n=zP(r,(this.pixelViewport.left-e)/t),s=zP(r,(this.pixelViewport.right+e)/t)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&KP(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&KP(o,l.to-10,l.to+10);for(let{from:n,to:s}of o)s-n>1e3&&e.push(GP(t,(t=>t.from>=i.from&&t.to<=i.to&&Math.abs(t.from-n)<1e3&&Math.abs(t.to-s)<1e3))||new PP(n,s,this.gapSize(i,n,s,r)))}return e}gapSize(t,e,i,n){let s=qP(n,i)-qP(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){PP.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=HV.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.state.facet(mN);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Ht.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||UP(this.heightMap.lineAt(t,OP.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return UP(this.heightMap.lineAt(this.scaler.fromDOM(t),OP.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return UP(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class IP{constructor(t,e){this.from=t,this.to=e}}function FP(t,e,i){let n=[],s=t,r=0;return Ht.spans(i.facet(mN),t,e,{span(){},point(t,e){t>s&&(n.push({from:s,to:t}),r+=t-s),s=e}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function zP({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:s}=e[t],r=s-i;if(n<=r)return i+n;n-=r}}function qP(t,e){let i=0;for(let{from:n,to:s}of t.ranges){if(e<=s){i+=e-n;break}i+=s-n}return i/t.total}function KP(t,e,i){for(let n=0;n<t.length;n++){let s=t[n];if(s.from<i&&s.to>e){let r=[];s.from<e&&r.push({from:s.from,to:e}),s.to>i&&r.push({from:i,to:s.to}),t.splice(n,1,...r),n+=r.length-1}}}function GP(t,e){for(let i of t)if(e(i))return i}const jP={toDOM:t=>t,fromDOM:t=>t,scale:1};class _P{constructor(t,e,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=e.lineAt(i,OP.ByPos,t,0,0).top,o=e.lineAt(s,OP.ByPos,t,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(e.height-n);for(let t of this.viewports)t.domTop=r+(t.top-s)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),s=t.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function UP(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new CP(t.from,t.length,i,n-i,Array.isArray(t.type)?t.type.map((t=>UP(t,e))):t.type)}const $P=H.define({combine:t=>t.join(" ")}),YP=H.define({combine:t=>t.indexOf(!0)>-1}),XP=Bt.newName(),JP=Bt.newName(),QP=Bt.newName(),ZP={"&light":"."+JP,"&dark":"."+QP};function tH(t,e,i){return new Bt(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const eH=tH("."+XP,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},ZP),iH={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},nH=bV.ie&&bV.ie_version<=11;class sH{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new YL,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(bV.ie&&bV.ie_version<=11||bV.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),nH&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(oN)?e.root.activeElement!=this.dom:!FL(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((bV.ie&&bV.ie_version<=11||bV.android&&bV.chrome)&&!e.state.selection.main.empty&&i.focusNode&&qL(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=WL(t),i=bV.safari&&11==t.nodeType&&function(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}()==this.view.contentDOM&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let n=e.startContainer,s=e.startOffset,r=e.endContainer,o=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);qL(l.node,l.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||e;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,iH),nH&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),nH&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame((()=>{let t=this.delayedAndroidKey;this.delayedAndroidKey=null;let e=this.view.state;tV(this.view.contentDOM,t.key,t.keyCode)?this.processRecords():this.flush(),this.view.state==e&&this.view.update([])})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let t=this.readMutation(s);t&&(t.typeOver&&(n=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&FL(this.dom,this.selectionRange);if(e<0&&!s)return;this.selectionChanged=!1;let r=this.view.state;this.onChange(e,i,n),this.view.state==r&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=rH(e,t.previousSibling||t.target.previousSibling,-1),n=rH(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function rH(t,e,i){for(;e;){let n=sV.get(e);if(n&&n.parent==t)return n;let s=e.parentNode;e=s!=t.dom?s:i>0?e.nextSibling:e.previousSibling}return null}function oH(t,e,i,n){let s,r,o=t.state.selection.main;if(e>-1){let n=t.docView.domBoundsAround(e,i,0);if(!n||t.state.readOnly)return;let{from:l,to:h}=n,a=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=t.observer.selectionRange;i&&(e.push(new HN(i,n)),s==i&&r==n||e.push(new HN(s,r)));return e}(t),c=new NN(a,t.state);c.readRange(n.startDOM,n.endDOM);let d=o.from,u=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||bV.android&&c.text.length<h-l)&&(d=o.to,u="end");let p=function(t,e,i,n){let s=Math.min(t.length,e.length),r=0;for(;r<s&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&t.length==e.length)return null;let o=t.length,l=e.length;for(;o>0&&l>0&&t.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&t.length<e.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(t.state.doc.sliceString(l,h,"￿"),c.text,d-l,u);p&&(bV.chrome&&13==t.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==c.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:f.of(c.text.slice(p.from,p.toB).split("￿"))}),r=function(t,e){if(0==t.length)return null;let i=t[0].pos,n=2==t.length?t[1].pos:i;return i>-1&&n>-1?L.single(i+e,n+e):null}(a,l)}else if(t.hasFocus||!t.state.facet(oN)){let e=t.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=t.docView,s=i&&i.node==e.focusNode&&i.offset==e.focusOffset||!IL(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),l=n&&n.node==e.anchorNode&&n.offset==e.anchorOffset||!IL(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);s==o.head&&l==o.anchor||(r=L.single(l,s))}if(s||r)if(!s&&n&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:t.state.doc.slice(o.from,s.from).append(s.insert).append(t.state.doc.slice(s.to,o.to))}),s){let e=t.state;if(bV.ios&&t.inputState.flushIOSKey(t))return;if(bV.android&&(s.from==o.from&&s.to==o.to&&1==s.insert.length&&2==s.insert.lines&&tV(t.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&0==s.insert.length&&tV(t.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&0==s.insert.length&&tV(t.contentDOM,"Delete",46)))return;let i,n=s.insert.toString();if(t.state.facet(tN).some((e=>e(t,s.from,s.to,n))))return;if(t.inputState.composing>=0&&t.inputState.composing++,s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&t.inputState.composing<0){let n=o.from<s.from?e.sliceDoc(o.from,s.from):"",r=o.to>s.to?e.sliceDoc(s.to,o.to):"";i=e.replaceSelection(t.state.toText(n+s.insert.sliceString(0,void 0,t.state.lineBreak)+r))}else{let n=e.changes(s),l=r&&!e.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let r=t.state.sliceDoc(s.from,s.to),h=FN(t)||t.state.doc.lineAt(o.head),a=o.to-s.to,c=o.to-o.from;i=e.changeByRange((i=>{if(i.from==o.from&&i.to==o.to)return{changes:n,range:l||i.map(n)};let d=i.to-a,u=d-r.length;if(i.to-i.from!=c||t.state.sliceDoc(u,d)!=r||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let f=e.changes({from:u,to:d,insert:s.insert}),p=i.to-o.to;return{changes:f,range:l?L.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}}))}else i={changes:n,selection:l&&e.selection.replaceRange(l)}}let l="input.type";t.composing&&(l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(i,{scrollIntoView:!0,userEvent:l})}else if(r&&!r.main.eq(o)){let e=!1,i="select";t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:e,userEvent:i})}}class lH{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new WP(t.state||Mt.create()),this.plugins=this.state.facet(cN).map((t=>new fN(t)));for(let t of this.plugins)t.update(this);this.observer=new sH(this,((t,e,i)=>{oH(this,t,e,i)}),(t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()})),this.inputState=new eP(this),this.docView=new WN(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pt?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);if(n.facet(Mt.phrases)!=this.state.facet(Mt.phrases))return this.setState(n);e=new yN(this,n,t);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(s&&(s=s.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;s=new nN(t.empty?t:L.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(eN)?s=new nN(t.value):t.is(iN)?s=new nN(t.value,"center"):t.is(sN)&&(s=t.value)}this.viewState.update(e,s),this.bidiCache=dH.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(vN)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet($P)!=e.state.facet($P)&&(this.viewState.mustMeasureContent=!0),(i||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(ZV))t(e)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new WP(t),this.plugins=t.facet(cN).map((t=>new fN(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new WN(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(cN),i=t.state.facet(cN);if(e!=i){let n=[];for(let s of i){let i=e.indexOf(s);if(i<0)n.push(new fN(s));else{let e=this.plugins[i];e.mustUpdate=t,n.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let t=0;;t++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(t>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((t=>{try{return t.read(this)}catch(t){return rN(this.state,t),cH}})),o=new yN(this,this.state),l=!1,h=!1;o.flags|=n,e?e.flags|=n:e=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),l=this.docView.update(o));for(let t=0;t<s.length;t++)if(r[t]!=cH)try{let e=s[t];e.write&&e.write(r[t],this)}catch(t){rN(this.state,t)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),l&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(ZV))t(e)}get themeClasses(){return XP+" "+(this.state.facet(YP)?QP:JP)+" "+this.state.facet($P)}updateAttrs(){let t=uH(this,pN,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(oN)?"true":"false",class:"cm-content",style:`${bV.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),uH(this,gN,e),this.observer.ignore((()=>{VV(this.contentDOM,this.contentAttrs,e),VV(this.dom,this.editorAttrs,t)})),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)if(t.is(lH.announce)){e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(vN),Bt.mount(this.root,this.styleModules.concat(eH).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=aH(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=aH(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=aH(e,this);for(let e of this.viewportLineBlocks)t(e.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return tP(this,t,ZN(this,t,e,i))}moveByGroup(t,e){return tP(this,t,ZN(this,t,e,(e=>function(t,e,i){let n=t.state.charCategorizer(e),s=n(i);return t=>{let e=n(t);return s==xt.Space&&(s=e),s==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,n){let s=t.state.doc.lineAt(e.head),r=n&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),n=t.posAtCoords({x:i==(t.textDirection==bN.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=n)return L.cursor(n,i?-1:1)}let o=KV.find(t.docView,e.head),l=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return L.cursor(l,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return tP(this,t,function(t,e,i,n){let s=e.head,r=i?1:-1;if(s==(i?t.state.doc.length:0))return L.cursor(s,e.assoc);let o,l=e.goalColumn,h=t.contentDOM.getBoundingClientRect(),a=t.coordsAtPos(s),c=t.documentTop;if(a)null==l&&(l=a.left-h.left),o=r<0?a.top:a.bottom;else{let e=t.viewState.lineBlockAt(s-c);null==l&&(l=Math.min(h.right-h.left,t.defaultCharacterWidth*(s-e.from))),o=(r<0?e.top:e.bottom)+c}let d=h.left+l,u=null!=n?n:t.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(u+i)*r,a=JN(t,{x:d,y:n},!1,r);if(n<h.top||n>h.bottom||(r<0?a<s:a>s))return L.cursor(a,e.assoc,void 0,l)}}(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:eN.of(L.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),JN(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n);return UL(i,s[TN.find(s,t-n.from,-1,e)].dir==bN.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>hH)return RN(t.length);let e=this.textDirection;for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=EN(t.text,this.textDirection);return this.bidiCache.push(new dH(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||bV.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{QL(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return sN.of(new nN("number"==typeof t?L.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return dN.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Bt.newName(),n=[$P.of(i),vN.of(tH(`.${i}`,t))];return e&&e.dark&&n.push(YP.of(!0)),n}static baseTheme(t){return X.lowest(vN.of(tH("."+XP,t,ZP)))}}lH.scrollTo=eN,lH.centerOn=iN,lH.styleModule=vN,lH.inputHandler=tN,lH.exceptionSink=QV,lH.updateListener=ZV,lH.editable=oN,lH.mouseSelectionStyle=JV,lH.dragMovesSelection=XV,lH.clickAddsSelectionRange=YV,lH.decorations=mN,lH.darkTheme=YP,lH.contentAttributes=gN,lH.editorAttributes=pN,lH.lineWrapping=lH.contentAttributes.of({class:"cm-lineWrapping"}),lH.announce=ft.define();const hH=4096;function aH(t,e){return(null==t?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}const cH={};class dH{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:bN.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let r=t[s];r.dir!=n||e.touchesRange(r.from,r.to)||i.push(new dH(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function uH(t,e,i){for(let n=t.state.facet(e),s=n.length-1;s>=0;s--){let e=n[s],r="function"==typeof e?e(t):e;r&&RV(r,i)}return i}const fH=!bV.ios;const pH={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};fH&&(pH[".cm-line"].caretColor="transparent !important");class gH{constructor(t,e,i){this.from=t,this.to=e,this.diagnostic=i}}class mH{constructor(t,e,i){this.diagnostics=t,this.panel=e,this.selected=i}static init(t,e,i){let n=HV.set(t.map((t=>t.from==t.to||t.from==t.to-1&&i.doc.lineAt(t.from).to==t.from?HV.widget({widget:new BH(t),diagnostic:t}).range(t.from):HV.mark({attributes:{class:"cm-lintRange cm-lintRange-"+t.severity},diagnostic:t}).range(t.from,t.to))),!0);return new mH(n,e,vH(n))}}function vH(t,e=null,i=0){let n=null;return t.between(i,1e9,((t,i,{spec:s})=>{if(!e||s.diagnostic==e)return n=new gH(t,i,s.diagnostic),!1})),n}function wH(t,e){return t.field(SH,!1)?e:e.concat(ft.appendConfig.of([SH,lH.decorations.compute([SH],(t=>{let{selected:e,panel:i}=t.field(SH);return e&&i&&e.from!=e.to?HV.set([kH.range(e.from,e.to)]):HV.none})),hR(AH),NH]))}const yH=ft.define(),bH=ft.define(),xH=ft.define(),SH=K.define({create:()=>new mH(HV.none,null,null),update(t,e){if(e.docChanged){let i=t.diagnostics.map(e.changes),n=null;if(t.selected){let s=e.changes.mapPos(t.selected.from,1);n=vH(i,t.selected.diagnostic,s)||vH(i,null,s)}t=new mH(i,t.panel,n)}for(let i of e.effects)i.is(yH)?t=mH.init(i.value,t.panel,e.state):i.is(bH)?t=new mH(t.diagnostics,i.value?RH.open:null,t.selected):i.is(xH)&&(t=new mH(t.diagnostics,t.panel,i.value));return t},provide:t=>[XB.from(t,(t=>t.panel)),lH.decorations.from(t,(t=>t.diagnostics))]});const kH=HV.mark({class:"cm-lintRange cm-lintRange-active"});function AH(t,e,i){let{diagnostics:n}=t.state.field(SH),s=[],r=2e8,o=0;return n.between(e-(i<0?1:0),e+(i>0?1:0),((t,n,{spec:l})=>{e>=t&&e<=n&&(t==n||(e>t||i>0)&&(e<n||i<0))&&(s.push(l.diagnostic),r=Math.min(t,r),o=Math.max(n,o))})),s.length?{pos:r,end:o,above:t.state.doc.lineAt(r).to<o,create:()=>({dom:MH(t,s)})}:null}function MH(t,e){return JB("ul",{class:"cm-tooltip-lint"},e.map((e=>TH(t,e,!1))))}const CH=t=>{let e=t.state.field(SH,!1);return!(!e||!e.panel)&&(t.dispatch({effects:bH.of(!1)}),!0)},OH=[{key:"Mod-Shift-m",run:t=>{let e=t.state.field(SH,!1);e&&e.panel||t.dispatch({effects:wH(t.state,[bH.of(!0)])});let i=jB(t,RH.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0}},{key:"F8",run:t=>{let e=t.state.field(SH,!1);if(!e)return!1;let i=t.state.selection.main,n=e.diagnostics.iter(i.to+1);return!(!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==i.from&&n.to==i.to))&&(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)}}];function DH(t){let e=[];if(t)t:for(let{name:i}of t){for(let t=0;t<i.length;t++){let n=i[t];if(/[a-zA-Z]/.test(n)&&!e.some((t=>t.toLowerCase()==n.toLowerCase()))){e.push(n);continue t}}e.push("")}return e}function TH(t,e,i){var n;let s=i?DH(e.actions):[];return JB("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},JB("span",{class:"cm-diagnosticText"},e.message),null===(n=e.actions)||void 0===n?void 0:n.map(((i,n)=>{let r=n=>{n.preventDefault();let s=vH(t.state.field(SH).diagnostics,e);s&&i.apply(t,s.from,s.to)},{name:o}=i,l=s[n]?o.indexOf(s[n]):-1,h=l<0?o:[o.slice(0,l),JB("u",o.slice(l,l+1)),o.slice(l+1)];return JB("button",{type:"button",class:"cm-diagnosticAction",onclick:r,onmousedown:r,"aria-label":` Action: ${o}${l<0?"":` (access key "${s[n]})"`}.`},h)})),e.source&&JB("div",{class:"cm-diagnosticSource"},e.source))}class BH extends NV{constructor(t){super(),this.diagnostic=t}eq(t){return t.diagnostic==this.diagnostic}toDOM(){return JB("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class EH{constructor(t,e){this.diagnostic=e,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=TH(t,e,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class RH{constructor(t){this.view=t,this.items=[];this.list=JB("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:e=>{if(27==e.keyCode)CH(this.view),this.view.focus();else if(38==e.keyCode||33==e.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==e.keyCode||34==e.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==e.keyCode)this.moveSelection(0);else if(35==e.keyCode)this.moveSelection(this.items.length-1);else if(13==e.keyCode)this.view.focus();else{if(!(e.keyCode>=65&&e.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],n=DH(i.actions);for(let s=0;s<n.length;s++)if(n[s].toUpperCase().charCodeAt(0)==e.keyCode){let e=vH(this.view.state.field(SH).diagnostics,i);e&&i.actions[s].apply(t,e.from,e.to)}}}e.preventDefault()},onclick:t=>{for(let e=0;e<this.items.length;e++)this.items[e].dom.contains(t.target)&&this.moveSelection(e)}}),this.dom=JB("div",{class:"cm-panel-lint"},this.list,JB("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>CH(this.view)},"×")),this.update()}get selectedIndex(){let t=this.view.state.field(SH).selected;if(!t)return-1;for(let e=0;e<this.items.length;e++)if(this.items[e].diagnostic==t.diagnostic)return e;return-1}update(){let{diagnostics:t,selected:e}=this.view.state.field(SH),i=0,n=!1,s=null;for(t.between(0,this.view.state.doc.length,((t,r,{spec:o})=>{let l,h=-1;for(let t=i;t<this.items.length;t++)if(this.items[t].diagnostic==o.diagnostic){h=t;break}h<0?(l=new EH(this.view,o.diagnostic),this.items.splice(i,0,l),n=!0):(l=this.items[h],h>i&&(this.items.splice(i,h-i),n=!0)),e&&l.diagnostic==e.diagnostic?l.dom.hasAttribute("aria-selected")||(l.dom.setAttribute("aria-selected","true"),s=l):l.dom.hasAttribute("aria-selected")&&l.dom.removeAttribute("aria-selected"),i++}));i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();0==this.items.length&&(this.items.push(new EH(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:t,panel:e})=>{t.top<e.top?this.list.scrollTop-=e.top-t.top:t.bottom>e.bottom&&(this.list.scrollTop+=t.bottom-e.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let t=this.list.firstChild;function e(){let e=t;t=e.nextSibling,e.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;t!=i.dom;)e();t=i.dom.nextSibling}else this.list.insertBefore(i.dom,t);for(;t;)e()}moveSelection(t){if(this.selectedIndex<0)return;let e=vH(this.view.state.field(SH).diagnostics,this.items[t].diagnostic);e&&this.view.dispatch({selection:{anchor:e.from,head:e.to},scrollIntoView:!0,effects:xH.of(e)})}static open(t){return new RH(t)}}function LH(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function VH(t){return LH(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const NH=lH.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:VH("#d11")},".cm-lintRange-warning":{backgroundImage:VH("orange")},".cm-lintRange-info":{backgroundImage:VH("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});const PH=[ew(),rw(),ur(),aa(),kw(),_s(),sr(),Mt.allowMultipleSelections.of(!0),ep(),HL.fallback,lS(),$C(),KR(),iL(),mr(),fE(),Is.of([...ZC,...dk,...KE,...Ma,...mw,...XR,...GR,...OH])];function HH(t,e,i,n=0,s=0){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);let r=s;for(let s=n;s<e;s++)9==t.charCodeAt(s)?r+=i-r%i:r++;return r}class WH{constructor(t,e,i){this.string=t,this.tabSize=e,this.indentUnit=i,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return 0==this.pos}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){let e,i=this.string.charAt(this.pos);if(e="string"==typeof t?i==t:i&&(t instanceof RegExp?t.test(i):t(i)),e)return++this.pos,i}eatWhile(t){let e=this.pos;for(;this.eat(t););return this.pos>e}eatSpace(){let t=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){let e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=HH(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){return HH(this.string,null,this.tabSize)}match(t,e,i){if("string"==typeof t){let n=t=>i?t.toLowerCase():t;return n(this.string.substr(this.pos,t.length))==n(t)?(!1!==e&&(this.pos+=t.length),!0):null}{let i=this.string.slice(this.pos).match(t);return i&&i.index>0?null:(i&&!1!==e&&(this.pos+=i[0].length),i)}}current(){return this.string.slice(this.start,this.pos)}}const IH=Object.create(null),FH=[af.none],zH=[],qH=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])qH[t]=GH(IH,e);function KH(t,e){zH.indexOf(t)>-1||(zH.push(t),console.warn(e))}function GH(t,e){let i=null;for(let n of e.split(".")){let e=t[n]||PL[n];e?"function"==typeof e?i?i=e(i):KH(n,`Modifier ${n} used at start of tag`):i?KH(n,`Tag ${n} used as modifier`):i=e:KH(n,`Unknown highlighting tag ${n}`)}if(!i)return 0;let n=e.replace(/ /g,"_"),s=af.define({id:FH.length,name:n,props:[hL({[n]:i})]});return FH.push(s),s.id}const jH="function"==typeof String.prototype.normalize?t=>t.normalize("NFKD"):t=>t;class _H{constructor(t,e,i=0,n=t.length,s){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(i,n),this.bufferStart=i,this.normalize=s?t=>s(jH(t)):jH,this.query=this.normalize(e)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return h(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let t=this.peek();if(t<0)return this.done=!0,this;let e=a(t),i=this.bufferStart+this.bufferPos;this.bufferPos+=c(t);let n=this.normalize(e);for(let t=0,s=i;;t++){let r=n.charCodeAt(t),o=this.match(r,s);if(o)return this.value=o,this;if(t==n.length-1)break;s==i&&t<e.length&&e.charCodeAt(t)==r&&s++}}}match(t,e){let i=null;for(let n=0;n<this.matches.length;n+=2){let s=this.matches[n],r=!1;this.query.charCodeAt(s)==t&&(s==this.query.length-1?i={from:this.matches[n+1],to:e+1}:(this.matches[n]++,r=!0)),r||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==t&&(1==this.query.length?i={from:e,to:e+1}:this.matches.push(1,e)),i}}"undefined"!=typeof Symbol&&(_H.prototype[Symbol.iterator]=function(){return this});const UH={from:-1,to:-1,match:/.*/.exec("")},$H="gm"+(null==/x/.unicode?"":"u");class YH{constructor(t,e,i,n=0,s=t.length){if(this.to=s,this.curLine="",this.done=!1,this.value=UH,/\\[sWDnr]|\n|\r|\[\^/.test(e))return new QH(t,e,i,n,s);this.re=new RegExp(e,$H+((null==i?void 0:i.ignoreCase)?"i":"")),this.iter=t.iter();let r=t.lineAt(n);this.curLineStart=r.from,this.matchPos=n,this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;let e=this.matchPos<=this.to&&this.re.exec(this.curLine);if(e){let i=this.curLineStart+e.index,n=i+e[0].length;if(this.matchPos=n+(i==n?1:0),i==this.curLine.length&&this.nextLine(),i<n||i>this.value.to)return this.value={from:i,to:n,match:e},this;t=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),t=0}}}}const XH=new WeakMap;class JH{constructor(t,e){this.from=t,this.text=e}get to(){return this.from+this.text.length}static get(t,e,i){let n=XH.get(t);if(!n||n.from>=i||n.to<=e){let n=new JH(e,t.sliceString(e,i));return XH.set(t,n),n}if(n.from==e&&n.to==i)return n;let{text:s,from:r}=n;return r>e&&(s=t.sliceString(e,r)+s,r=e),n.to<i&&(s+=t.sliceString(n.to,i)),XH.set(t,new JH(r,s)),new JH(e,s.slice(e-r,i-r))}}class QH{constructor(t,e,i,n,s){this.text=t,this.to=s,this.done=!1,this.value=UH,this.matchPos=n,this.re=new RegExp(e,$H+((null==i?void 0:i.ignoreCase)?"i":"")),this.flat=JH.get(t,n,this.chunkEnd(n+5e3))}chunkEnd(t){return t>=this.to?this.to:this.text.lineAt(t).to}next(){for(;;){let t=this.re.lastIndex=this.matchPos-this.flat.from,e=this.re.exec(this.flat.text);if(e&&!e[0]&&e.index==t&&(this.re.lastIndex=t+1,e=this.re.exec(this.flat.text)),e&&this.flat.to<this.to&&e.index+e[0].length>this.flat.text.length-10&&(e=null),e){let t=this.flat.from+e.index,i=t+e[0].length;return this.value={from:t,to:i,match:e},this.matchPos=i+(t==i?1:0),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=JH.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}"undefined"!=typeof Symbol&&(YH.prototype[Symbol.iterator]=QH.prototype[Symbol.iterator]=function(){return this});class ZH{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||function(t){try{return new RegExp(t,$H),!0}catch(t){return!1}}(this.search))}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp}create(){return this.regexp?new iW(this):new eW(this)}}class tW{constructor(t){this.spec=t}}class eW extends tW{constructor(t){super(t),this.unquoted=t.search.replace(/\\([nrt\\])/g,((t,e)=>"n"==e?"\n":"r"==e?"\r":"t"==e?"\t":"\\"))}cursor(t,e=0,i=t.length){return new _H(t,this.unquoted,e,i,this.spec.caseSensitive?void 0:t=>t.toLowerCase())}nextMatch(t,e,i){let n=this.cursor(t,i).nextOverlapping();return n.done&&(n=this.cursor(t,0,e).nextOverlapping()),n.done?null:n.value}prevMatchInRange(t,e,i){for(let n=i;;){let i=Math.max(e,n-1e4-this.unquoted.length),s=this.cursor(t,i,n),r=null;for(;!s.nextOverlapping().done;)r=s.value;if(r)return r;if(i==e)return null;n-=1e4}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.length)}getReplacement(t){return this.spec.replace}matchAll(t,e){let i=this.cursor(t),n=[];for(;!i.next().done;){if(n.length>=e)return null;n.push(i.value)}return n}highlight(t,e,i,n){let s=this.cursor(t,Math.max(0,e-this.unquoted.length),Math.min(i+this.unquoted.length,t.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}class iW extends tW{cursor(t,e=0,i=t.length){return new YH(t,this.spec.search,this.spec.caseSensitive?void 0:{ignoreCase:!0},e,i)}nextMatch(t,e,i){let n=this.cursor(t,i).next();return n.done&&(n=this.cursor(t,0,e).next()),n.done?null:n.value}prevMatchInRange(t,e,i){for(let n=1;;n++){let s=Math.max(e,i-1e4*n),r=this.cursor(t,s,i),o=null;for(;!r.next().done;)o=r.value;if(o&&(s==e||o.from>s+10))return o;if(s==e)return null}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.length)}getReplacement(t){return this.spec.replace.replace(/\$([$&\d+])/g,((e,i)=>"$"==i?"$":"&"==i?t.match[0]:"0"!=i&&+i<t.match.length?t.match[i]:e))}matchAll(t,e){let i=this.cursor(t),n=[];for(;!i.next().done;){if(n.length>=e)return null;n.push(i.value)}return n}highlight(t,e,i,n){let s=this.cursor(t,Math.max(0,e-250),Math.min(i+250,t.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}const nW=ft.define();function sW(t){var e=t.Pos;function i(t,i){var n=t.state.vim;if(!n||n.insertMode)return i.head;var s=n.sel.head;return s?n.visualBlock&&i.head.line!=s.line?void 0:i.from()!=i.anchor||i.empty()||i.head.line!=s.line||i.head.ch==s.ch?i.head:new e(i.head.line,i.head.ch-1):i.head}var n=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],s=n.length,r=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"global",shortName:"g"}];function o(e){e.setOption("disableInput",!0),e.setOption("showCursorWhenSelecting",!1),t.signal(e,"vim-mode-change",{mode:"normal"}),e.on("cursorActivity",ee),W(e),t.on(e.getInputField(),"paste",u(e))}function l(e,i){this==t.keyMap.vim&&(e.options.$customCursor=null,t.rmClass(e.getWrapperElement(),"cm-fat-cursor")),i&&i.attach==h||function(e){e.setOption("disableInput",!1),e.off("cursorActivity",ee),t.off(e.getInputField(),"paste",u(e)),e.state.vim=null,Ft&&clearTimeout(Ft)}(e)}function h(e,n){this==t.keyMap.vim&&(e.curOp&&(e.curOp.selectionChanged=!0),e.options.$customCursor=i,t.addClass(e.getWrapperElement(),"cm-fat-cursor")),n&&n.attach==h||o(e)}function a(e,i){if(i){if(this[e])return this[e];var n=function(t){if("'"==t.charAt(0))return t.charAt(1);var e=t.split(/-(?!$)/),i=e[e.length-1];if(1==e.length&&1==e[0].length)return!1;if(2==e.length&&"Shift"==e[0]&&1==i.length)return!1;for(var n=!1,s=0;s<e.length;s++){var r=e[s];r in c?e[s]=c[r]:n=!0,r in d&&(e[s]=d[r])}if(!n)return!1;M(i)&&(e[e.length-1]=i.toLowerCase());return"<"+e.join("-")+">"}(e);if(!n)return!1;var s=F.findKey(i,n);return"function"==typeof s&&t.signal(i,"vim-keypress",n),s}}t.defineOption("vimMode",!1,(function(e,i,n){i&&"vim"!=e.getOption("keyMap")?e.setOption("keyMap","vim"):!i&&n!=t.Init&&/^vim/.test(e.getOption("keyMap"))&&e.setOption("keyMap","default")}));var c={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A",CapsLock:""},d={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"};function u(t){var e=t.state.vim;return e.onPasteFn||(e.onPasteFn=function(){e.insertMode||(t.setCursor(Z(t.getCursor(),0,1)),X.enterInsertMode(t,{},e))}),e.onPasteFn}var f=/[\d]/,p=[t.isWordChar,function(e){return e&&!t.isWordChar(e)&&!/\s/.test(e)}],g=[function(t){return/\S/.test(t)}];function m(t,e){for(var i=[],n=t;n<t+e;n++)i.push(String.fromCharCode(n));return i}var v,w=m(65,26),y=m(97,26),b=m(48,10),x=[].concat(w,y,b,["<",">"]),S=[].concat(w,y,b,["-",'"',".",":","_","/"]);try{v=new RegExp("^[\\p{Lu}]$","u")}catch(t){v=/^[A-Z]$/}function k(t,e){return e>=t.firstLine()&&e<=t.lastLine()}function A(t){return/^[a-z]$/.test(t)}function M(t){return v.test(t)}function C(t){return/^\s*$/.test(t)}function O(t){return-1!=".?!".indexOf(t)}function D(t,e){for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1}var T={};function B(t,e,i,n,s){if(void 0===e&&!s)throw Error("defaultValue is required unless callback is provided");if(i||(i="string"),T[t]={type:i,defaultValue:e,callback:s},n)for(var r=0;r<n.length;r++)T[n[r]]=T[t];e&&E(t,e)}function E(t,e,i,n){var s=T[t],r=(n=n||{}).scope;if(!s)return new Error("Unknown option: "+t);if("boolean"==s.type){if(e&&!0!==e)return new Error("Invalid argument: "+t+"="+e);!1!==e&&(e=!0)}s.callback?("local"!==r&&s.callback(e,void 0),"global"!==r&&i&&s.callback(e,i)):("local"!==r&&(s.value="boolean"==s.type?!!e:e),"global"!==r&&i&&(i.state.vim.options[t]={value:e}))}function R(t,e,i){var n=T[t],s=(i=i||{}).scope;if(!n)return new Error("Unknown option: "+t);if(n.callback){var r=e&&n.callback(void 0,e);return"global"!==s&&void 0!==r?r:"local"!==s?n.callback():void 0}return((r="global"!==s&&e&&e.state.vim.options[t])||"local"!==s&&n||{}).value}B("filetype",void 0,"string",["ft"],(function(t,e){if(void 0!==e){if(void 0===t)return"null"==(i=e.getOption("mode"))?"":i;var i=""==t?"null":t;e.setOption("mode",i)}}));var L,V,N=function(){var t=100,e=-1,i=0,n=0,s=new Array(t);function r(r,o){(e+=o)>i?e=i:e<n&&(e=n);var l=s[(t+e)%t];if(l&&!l.find()){var h,a=o>0?1:-1,c=r.getCursor();do{if((l=s[(t+(e+=a))%t])&&(h=l.find())&&!nt(c,h))break}while(e<i&&e>n)}return l}return{cachedCursor:void 0,add:function(r,o,l){var h=s[e%t];function a(i){var n=++e%t,o=s[n];o&&o.clear(),s[n]=r.setBookmark(i)}if(h){var c=h.find();c&&!nt(c,o)&&a(o)}else a(o);a(l),i=e,(n=e-t+1)<0&&(n=0)},find:function(t,i){var n=e,s=r(t,i);return e=n,s&&s.find()},move:r}},P=function(t){return t?{changes:t.changes,expectCursorActivityForChange:t.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};function H(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=P()}function W(t){return t.state.vim||(t.state.vim={inputState:new z,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),t.state.vim}function I(){for(var t in L={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:N(),macroModeState:new H,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new G({}),searchHistoryController:new j,exCommandHistoryController:new j},T){var e=T[t];e.value=e.defaultValue}}H.prototype={exitMacroRecordMode:function(){var t=L.macroModeState;t.onRecordingDone&&t.onRecordingDone(),t.onRecordingDone=void 0,t.isRecording=!1},enterMacroRecordMode:function(t,e){var i=L.registerController.getRegister(e);if(i){if(i.clear(),this.latestRegister=e,t.openDialog){var n=Pt("span",{class:"cm-vim-message"},"recording @"+e);this.onRecordingDone=t.openDialog(n,null,{bottom:!0})}this.isRecording=!0}}};var F={enterVimMode:o,buildKeyMap:function(){},getRegisterController:function(){return L.registerController},resetVimGlobalState_:I,getVimGlobalState_:function(){return L},maybeInitVimState_:W,suppressErrorLogging:!1,InsertModeKey:ne,map:function(t,e,i){Xt.map(t,e,i)},unmap:function(t,e){return Xt.unmap(t,e)},noremap:function(t,e,i){function r(t){return t?[t]:["normal","insert","visual"]}for(var o=r(i),l=n.length,h=l-s;h<l&&o.length;h++){var a=n[h];if(!(a.keys!=e||i&&a.context&&a.context!==i||"ex"===a.type.substr(0,2)||"key"===a.type.substr(0,3))){var c={};for(var d in a)c[d]=a[d];c.keys=t,i&&!c.context&&(c.context=i),this._mapCommand(c);var u=r(a.context);o=o.filter((function(t){return-1===u.indexOf(t)}))}}},mapclear:function(t){var e=n.length,i=s,r=n.slice(0,e-i);if(n=n.slice(e-i),t)for(var o=r.length-1;o>=0;o--){var l=r[o];if(t!==l.context)if(l.context)this._mapCommand(l);else{var h=["normal","insert","visual"];for(var a in h)if(h[a]!==t){var c={};for(var d in l)c[d]=l[d];c.context=h[a],this._mapCommand(c)}}}},setOption:E,getOption:R,defineOption:B,defineEx:function(t,e,i){if(e){if(0!==t.indexOf(e))throw new Error('(Vim.defineEx) "'+e+'" is not a prefix of "'+t+'", command not registered')}else e=t;Yt[t]=i,Xt.commandMap_[e]={name:t,shortName:e,type:"api"}},handleKey:function(t,e,i){var n=this.findKey(t,e,i);if("function"==typeof n)return n()},multiSelectHandleKey:function(t,e,i){var n=!1,s=F.maybeInitVimState_(t),r=s.visualBlock||s.wasInVisualBlock,o=t.isInMultiSelectMode();s.wasInVisualBlock&&!o?s.wasInVisualBlock=!1:o&&s.visualBlock&&(s.wasInVisualBlock=!0);if("<Esc>"!=e||s.insertMode||s.visualMode||!o||"<Esc>"!=s.status)if(r||!o||t.inVirtualSelectionMode)n=F.handleKey(t,e,i);else{var l=le(s);t.operation((function(){t.curOp.isVimOp=!0,t.forEachSelection((function(){var s=t.getCursor("head"),r=t.getCursor("anchor"),o=st(s,r)?0:-1,h=st(s,r)?-1:0;s=Z(s,0,o),r=Z(r,0,h),t.state.vim.sel.head=s,t.state.vim.sel.anchor=r,n=F.handleKey(t,e,i),t.virtualSelection&&(t.state.vim=le(l))})),t.curOp.cursorActivity&&!n&&(t.curOp.cursorActivity=!1),t.state.vim=s}),!0)}else q(t);!n||s.visualMode||s.insert||s.visualMode==t.somethingSelected()||ie(t,s);return n},findKey:function(t,e,i){var s,r=W(t);function o(){var n=L.macroModeState;if(n.isRecording){if("q"==e)return n.exitMacroRecordMode(),q(t),!0;"mapping"!=i&&function(t,e){if(t.isPlaying)return;var i=t.latestRegister,n=L.registerController.getRegister(i);n&&n.pushText(e)}(n,e)}}function l(){if("<Esc>"==e)return q(t),r.visualMode?mt(t):r.insertMode&&Jt(t),!0}return!1===(s=r.insertMode?function(){if(l())return!0;for(var i=r.inputState.keyBuffer=r.inputState.keyBuffer+e,s=1==e.length,o=_.matchCommand(i,n,r.inputState,"insert");i.length>1&&"full"!=o.type;){i=r.inputState.keyBuffer=i.slice(1);var h=_.matchCommand(i,n,r.inputState,"insert");"none"!=h.type&&(o=h)}if("none"==o.type)return q(t),!1;if("partial"==o.type)return V&&window.clearTimeout(V),V=window.setTimeout((function(){r.insertMode&&r.inputState.keyBuffer&&q(t)}),R("insertModeEscKeysTimeout")),!s;if(V&&window.clearTimeout(V),s){for(var a=t.listSelections(),c=0;c<a.length;c++){var d=a[c].head;t.replaceRange("",Z(d,0,-(i.length-1)),d,"+input")}L.macroModeState.lastInsertModeChanges.changes.pop()}return q(t),o.command}():function(){if(o()||l())return!0;var i=r.inputState.keyBuffer=r.inputState.keyBuffer+e;if(/^[1-9]\d*$/.test(i))return!0;var s=/^(\d*)(.*)$/.exec(i);if(!s)return q(t),!1;var h=r.visualMode?"visual":"normal",a=s[2]||s[1];r.inputState.operatorShortcut&&r.inputState.operatorShortcut.slice(-1)==a&&(a=r.inputState.operatorShortcut);var c=_.matchCommand(a,n,r.inputState,h);return"none"==c.type?(q(t),!1):"partial"==c.type||("clear"==c.type?(q(t),!0):(r.inputState.keyBuffer="",(s=/^(\d*)(.*)$/.exec(i))[1]&&"0"!=s[1]&&r.inputState.pushRepeatDigit(s[1]),c.command))}())?r.insertMode||1!==e.length?void 0:function(){return!0}:!0===s?function(){return!0}:function(){return t.operation((function(){t.curOp.isVimOp=!0;try{"keyToKey"==s.type?function(i){for(var n;i;)n=/<\w+-.+?>|<\w+>|./.exec(i),e=n[0],i=i.substring(n.index+e.length),F.handleKey(t,e,"mapping")}(s.toKeys):_.processCommand(t,r,s)}catch(e){throw t.state.vim=void 0,W(t),F.suppressErrorLogging||console.log(e),e}return!0}))}},handleEx:function(t,e){Xt.processCommand(t,e)},defineMotion:function(t,e){U[t]=e},defineAction:function(t,e){X[t]=e},defineOperator:function(t,e){Y[t]=e},mapCommand:function(t,e,i,n,s){var r={keys:t,type:e};for(var o in r[e]=i,r[e+"Args"]=n,s)r[o]=s[o];Qt(r)},_mapCommand:Qt,defineRegister:function(t,e){var i=L.registerController.registers;if(!t||1!=t.length)throw Error("Register name must be 1 character");if(i[t])throw Error("Register already defined "+t);i[t]=e,S.push(t)},exitVisualMode:mt,exitInsertMode:Jt};function z(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}function q(e,i){e.state.vim.inputState=new z,t.signal(e,"vim-command-done",i)}function K(t,e,i){this.clear(),this.keyBuffer=[t||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!e,this.blockwise=!!i}function G(t){this.registers=t,this.unnamedRegister=t['"']=new K,t["."]=new K,t[":"]=new K,t["/"]=new K}function j(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}z.prototype.pushRepeatDigit=function(t){this.operator?this.motionRepeat=this.motionRepeat.concat(t):this.prefixRepeat=this.prefixRepeat.concat(t)},z.prototype.getRepeat=function(){var t=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(t=1,this.prefixRepeat.length>0&&(t*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(t*=parseInt(this.motionRepeat.join(""),10))),t},K.prototype={setText:function(t,e,i){this.keyBuffer=[t||""],this.linewise=!!e,this.blockwise=!!i},pushText:function(t,e){e&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(t)},pushInsertModeChanges:function(t){this.insertModeChanges.push(P(t))},pushSearchQuery:function(t){this.searchQueries.push(t)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},G.prototype={pushText:function(t,e,i,n,s){if("_"!==t){n&&"\n"!==i.charAt(i.length-1)&&(i+="\n");var r=this.isValidRegister(t)?this.getRegister(t):null;if(r){M(t)?r.pushText(i,n):r.setText(i,n,s),this.unnamedRegister.setText(r.toString(),n)}else{switch(e){case"yank":this.registers[0]=new K(i,n,s);break;case"delete":case"change":-1==i.indexOf("\n")?this.registers["-"]=new K(i,n):(this.shiftNumericRegisters_(),this.registers[1]=new K(i,n))}this.unnamedRegister.setText(i,n,s)}}},getRegister:function(t){return this.isValidRegister(t)?(t=t.toLowerCase(),this.registers[t]||(this.registers[t]=new K),this.registers[t]):this.unnamedRegister},isValidRegister:function(t){return t&&D(t,S)},shiftNumericRegisters_:function(){for(var t=9;t>=2;t--)this.registers[t]=this.getRegister(""+(t-1))}},j.prototype={nextMatch:function(t,e){var i=this.historyBuffer,n=e?-1:1;null===this.initialPrefix&&(this.initialPrefix=t);for(var s=this.iterator+n;e?s>=0:s<i.length;s+=n)for(var r=i[s],o=0;o<=r.length;o++)if(this.initialPrefix==r.substring(0,o))return this.iterator=s,r;return s>=i.length?(this.iterator=i.length,this.initialPrefix):s<0?t:void 0},pushInput:function(t){var e=this.historyBuffer.indexOf(t);e>-1&&this.historyBuffer.splice(e,1),t.length&&this.historyBuffer.push(t)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var _={matchCommand:function(t,e,i,n){var s,r=function(t,e,i,n){for(var s,r=[],o=[],l=0;l<e.length;l++){var h=e[l];"insert"==i&&"insert"!=h.context||h.context&&h.context!=i||n.operator&&"action"==h.type||!(s=tt(t,h.keys))||("partial"==s&&r.push(h),"full"==s&&o.push(h))}return{partial:r.length&&r,full:o.length&&o}}(t,e,n,i);if(!r.full&&!r.partial)return{type:"none"};if(!r.full&&r.partial)return{type:"partial"};for(var o=0;o<r.full.length;o++){var l=r.full[o];s||(s=l)}if("<character>"==s.keys.slice(-11)){var h=function(t){var e=/^.*(<[^>]+>)$/.exec(t),i=e?e[1]:t.slice(-1);if(i.length>1)switch(i){case"<CR>":i="\n";break;case"<Space>":i=" ";break;default:i=""}return i}(t);if(!h||h.length>1)return{type:"clear"};i.selectedCharacter=h}return{type:"full",command:s}},processCommand:function(t,e,i){switch(e.inputState.repeatOverride=i.repeatOverride,i.type){case"motion":this.processMotion(t,e,i);break;case"operator":this.processOperator(t,e,i);break;case"operatorMotion":this.processOperatorMotion(t,e,i);break;case"action":this.processAction(t,e,i);break;case"search":this.processSearch(t,e,i);break;case"ex":case"keyToEx":this.processEx(t,e,i)}},processMotion:function(t,e,i){e.inputState.motion=i.motion,e.inputState.motionArgs=Q(i.motionArgs),this.evalInput(t,e)},processOperator:function(t,e,i){var n=e.inputState;if(n.operator){if(n.operator==i.operator)return n.motion="expandToLine",n.motionArgs={linewise:!0},void this.evalInput(t,e);q(t)}n.operator=i.operator,n.operatorArgs=Q(i.operatorArgs),i.keys.length>1&&(n.operatorShortcut=i.keys),i.exitVisualBlock&&(e.visualBlock=!1,pt(t)),e.visualMode&&this.evalInput(t,e)},processOperatorMotion:function(t,e,i){var n=e.visualMode,s=Q(i.operatorMotionArgs);s&&n&&s.visualLine&&(e.visualLine=!0),this.processOperator(t,e,i),n||this.processMotion(t,e,i)},processAction:function(t,e,i){var n=e.inputState,s=n.getRepeat(),r=!!s,o=Q(i.actionArgs)||{};n.selectedCharacter&&(o.selectedCharacter=n.selectedCharacter),i.operator&&this.processOperator(t,e,i),i.motion&&this.processMotion(t,e,i),(i.motion||i.operator)&&this.evalInput(t,e),o.repeat=s||1,o.repeatIsExplicit=r,o.registerName=n.registerName,q(t),e.lastMotion=null,i.isEdit&&this.recordLastEdit(e,n,i),X[i.action](t,o,e)},processSearch:function(e,i,n){if(e.getSearchCursor){var s=n.searchArgs.forward,r=n.searchArgs.wholeWordOnly;Bt(e).setReversed(!s);var o=s?"/":"?",l=Bt(e).getQuery(),h=e.getScrollInfo();switch(n.searchArgs.querySrc){case"prompt":var a=L.macroModeState;if(a.isPlaying)f(u=a.replaySearchQueries.shift(),!0,!1);else Wt(e,{onClose:function(t){e.scrollTo(h.left,h.top),f(t,!0,!0);var i=L.macroModeState;i.isRecording&&function(t,e){if(!t.isPlaying){var i=t.latestRegister,n=L.registerController.getRegister(i);n&&n.pushSearchQuery&&n.pushSearchQuery(e)}}(i,t)},prefix:o,desc:"(JavaScript regexp)",onKeyUp:function(i,n,r){var o,l,a,c=t.keyName(i);"Up"==c||"Down"==c?(o="Up"==c,l=i.target?i.target.selectionEnd:0,r(n=L.searchHistoryController.nextMatch(n,o)||""),l&&i.target&&(i.target.selectionEnd=i.target.selectionStart=Math.min(l,i.target.value.length))):"Left"!=c&&"Right"!=c&&"Ctrl"!=c&&"Alt"!=c&&"Shift"!=c&&L.searchHistoryController.reset();try{a=It(e,n,!0,!0)}catch(t){}a?e.scrollIntoView(qt(e,!s,a),30):(Kt(e),e.scrollTo(h.left,h.top))},onKeyDown:function(i,n,s){var r=t.keyName(i);"Esc"==r||"Ctrl-C"==r||"Ctrl-["==r||"Backspace"==r&&""==n?(L.searchHistoryController.pushInput(n),L.searchHistoryController.reset(),It(e,l),Kt(e),e.scrollTo(h.left,h.top),t.e_stop(i),q(e),s(),e.focus()):"Up"==r||"Down"==r?t.e_stop(i):"Ctrl-U"==r&&(t.e_stop(i),s(""))}});break;case"wordUnderCursor":var c=wt(e,!1,!0,!1,!0),d=!0;if(c||(c=wt(e,!1,!0,!1,!1),d=!1),!c)return;var u=e.getLine(c.start.line).substring(c.start.ch,c.end.ch);d&&r?u="\\b"+u+"\\b":u=u.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1"),L.jumpList.cachedCursor=e.getCursor(),e.setCursor(c.start),f(u,!0,!1)}}function f(t,s,r){L.searchHistoryController.pushInput(t),L.searchHistoryController.reset();try{It(e,t,s,r)}catch(i){return Ht(e,"Invalid regex: "+t),void q(e)}_.processMotion(e,i,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:n.searchArgs.toJumplist}})}},processEx:function(e,i,n){function s(t){L.exCommandHistoryController.pushInput(t),L.exCommandHistoryController.reset(),Xt.processCommand(e,t),q(e)}function r(i,n,s){var r,o,l=t.keyName(i);("Esc"==l||"Ctrl-C"==l||"Ctrl-["==l||"Backspace"==l&&""==n)&&(L.exCommandHistoryController.pushInput(n),L.exCommandHistoryController.reset(),t.e_stop(i),q(e),s(),e.focus()),"Up"==l||"Down"==l?(t.e_stop(i),r="Up"==l,o=i.target?i.target.selectionEnd:0,s(n=L.exCommandHistoryController.nextMatch(n,r)||""),o&&i.target&&(i.target.selectionEnd=i.target.selectionStart=Math.min(o,i.target.value.length))):"Ctrl-U"==l?(t.e_stop(i),s("")):"Left"!=l&&"Right"!=l&&"Ctrl"!=l&&"Alt"!=l&&"Shift"!=l&&L.exCommandHistoryController.reset()}"keyToEx"==n.type?Xt.processCommand(e,n.exArgs.input):i.visualMode?Wt(e,{onClose:s,prefix:":",value:"'<,'>",onKeyDown:r,selectValueOnOpen:!1}):Wt(e,{onClose:s,prefix:":",onKeyDown:r})},evalInput:function(t,i){var n,s,r,o=i.inputState,l=o.motion,h=o.motionArgs||{},a=o.operator,c=o.operatorArgs||{},d=o.registerName,u=i.sel,f=it(i.visualMode?J(t,u.head):t.getCursor("head")),p=it(i.visualMode?J(t,u.anchor):t.getCursor("anchor")),g=it(f),m=it(p);if(a&&this.recordLastEdit(i,o),(r=void 0!==o.repeatOverride?o.repeatOverride:o.getRepeat())>0&&h.explicitRepeat?h.repeatIsExplicit=!0:(h.noRepeat||!h.explicitRepeat&&0===r)&&(r=1,h.repeatIsExplicit=!1),o.selectedCharacter&&(h.selectedCharacter=c.selectedCharacter=o.selectedCharacter),h.repeat=r,q(t),l){var v=U[l](t,f,h,i,o);if(i.lastMotion=U[l],!v)return;if(h.toJumplist){var w=L.jumpList,y=w.cachedCursor;y?(yt(t,y,v),delete w.cachedCursor):yt(t,f,v)}v instanceof Array?(s=v[0],n=v[1]):n=v,n||(n=it(f)),i.visualMode?(i.visualBlock&&n.ch===1/0||(n=J(t,n)),s&&(s=J(t,s)),s=s||m,u.anchor=s,u.head=n,pt(t),Ct(t,i,"<",st(s,n)?s:n),Ct(t,i,">",st(s,n)?n:s)):a||(n=J(t,n),t.setCursor(n.line,n.ch))}if(a){if(c.lastSel){s=m;var b=c.lastSel,x=Math.abs(b.head.line-b.anchor.line),S=Math.abs(b.head.ch-b.anchor.ch);n=b.visualLine?new e(m.line+x,m.ch):b.visualBlock?new e(m.line+x,m.ch+S):b.head.line==b.anchor.line?new e(m.line,m.ch+S):new e(m.line+x,m.ch),i.visualMode=!0,i.visualLine=b.visualLine,i.visualBlock=b.visualBlock,u=i.sel={anchor:s,head:n},pt(t)}else i.visualMode&&(c.lastSel={anchor:it(u.anchor),head:it(u.head),visualBlock:i.visualBlock,visualLine:i.visualLine});var k,A,M,O,D;if(i.visualMode){if(k=rt(u.head,u.anchor),A=ot(u.head,u.anchor),M=i.visualLine||c.linewise,D=gt(t,{anchor:k,head:A},O=i.visualBlock?"block":M?"line":"char"),M){var T=D.ranges;if("block"==O)for(var B=0;B<T.length;B++)T[B].head.ch=ht(t,T[B].head.line);else"line"==O&&(T[0].head=new e(T[0].head.line+1,0))}}else{if(k=it(s||m),st(A=it(n||g),k)){var E=k;k=A,A=E}(M=h.linewise||c.linewise)?function(t,e,i){e.ch=0,i.ch=0,i.line++}(0,k,A):h.forward&&function(t,e,i){var n=t.getRange(e,i);if(/\n\s*$/.test(n)){var s=n.split("\n");s.pop();for(var r=s.pop();s.length>0&&r&&C(r);r=s.pop())i.line--,i.ch=0;r?(i.line--,i.ch=ht(t,i.line)):i.ch=0}}(t,k,A),D=gt(t,{anchor:k,head:A},O="char",!h.inclusive||M)}t.setSelections(D.ranges,D.primary),i.lastMotion=null,c.repeat=r,c.registerName=d,c.linewise=M;var R=Y[a](t,c,D.ranges,m,n);i.visualMode&&mt(t,null!=R),R&&t.setCursor(R)}},recordLastEdit:function(t,e,i){var n=L.macroModeState;n.isPlaying||(t.lastEditInputState=e,t.lastEditActionCommand=i,n.lastInsertModeChanges.changes=[],n.lastInsertModeChanges.expectCursorActivityForChange=!1,n.lastInsertModeChanges.visualBlock=t.visualBlock?t.sel.head.line-t.sel.anchor.line:0)}},U={moveToTopLine:function(t,i,n){var s=jt(t).top+n.repeat-1;return new e(s,vt(t.getLine(s)))},moveToMiddleLine:function(t){var i=jt(t),n=Math.floor(.5*(i.top+i.bottom));return new e(n,vt(t.getLine(n)))},moveToBottomLine:function(t,i,n){var s=jt(t).bottom-n.repeat+1;return new e(s,vt(t.getLine(s)))},expandToLine:function(t,i,n){return new e(i.line+n.repeat-1,1/0)},findNext:function(t,e,i){var n=Bt(t),s=n.getQuery();if(s){var r=!i.forward;return r=n.isReversed()?!r:r,zt(t,s),qt(t,r,s,i.repeat)}},findAndSelectNextInclusive:function(i,n,s,r,o){var l=Bt(i),h=l.getQuery();if(h){var a=!s.forward,c=function(t,i,n,s,r){void 0===s&&(s=1);return t.operation((function(){var o=t.getCursor(),l=t.getSearchCursor(n,o),h=l.find(!i);!r.visualMode&&h&&nt(l.from(),o)&&l.find(!i);for(var a=0;a<s;a++)if(!(h=l.find(i))&&!(l=t.getSearchCursor(n,i?new e(t.lastLine()):new e(t.firstLine(),0))).find(i))return;return[l.from(),l.to()]}))}(i,a=l.isReversed()?!a:a,h,s.repeat,r);if(c){if(o.operator)return c;var d=c[0],u=new e(c[1].line,c[1].ch-1);if(r.visualMode){(r.visualLine||r.visualBlock)&&(r.visualLine=!1,r.visualBlock=!1,t.signal(i,"vim-mode-change",{mode:"visual",subMode:""}));var f=r.sel.anchor;if(f)return l.isReversed()?s.forward?[f,d]:[f,u]:s.forward?[f,u]:[f,d]}else r.visualMode=!0,r.visualLine=!1,r.visualBlock=!1,t.signal(i,"vim-mode-change",{mode:"visual",subMode:""});return a?[u,d]:[d,u]}}},goToMark:function(t,e,i,n){var s=_t(t,n,i.selectedCharacter);return s?i.linewise?{line:s.line,ch:vt(t.getLine(s.line))}:s:null},moveToOtherHighlightedEnd:function(t,i,n,s){if(s.visualBlock&&n.sameLine){var r=s.sel;return[J(t,new e(r.anchor.line,r.head.ch)),J(t,new e(r.head.line,r.anchor.ch))]}return[s.sel.head,s.sel.anchor]},jumpToMark:function(t,i,n,s){for(var r=i,o=0;o<n.repeat;o++){var l=r;for(var h in s.marks)if(A(h)){var a=s.marks[h].find();if(!((n.forward?st(a,l):st(l,a))||n.linewise&&a.line==l.line)){var c=nt(l,r),d=n.forward?lt(l,a,r):lt(r,a,l);(c||d)&&(r=a)}}}return n.linewise&&(r=new e(r.line,vt(t.getLine(r.line)))),r},moveByCharacters:function(t,i,n){var s=i,r=n.repeat,o=n.forward?s.ch+r:s.ch-r;return new e(s.line,o)},moveByLines:function(t,i,n,s){var r=i,o=r.ch;switch(s.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:o=s.lastHPos;break;default:s.lastHPos=o}var l=n.repeat+(n.repeatOffset||0),h=n.forward?r.line+l:r.line-l,a=t.firstLine(),c=t.lastLine(),d=t.findPosV(r,n.forward?l:-l,"line",s.lastHSPos);return(n.forward?d.line>h:d.line<h)&&(h=d.line,o=d.ch),h<a&&r.line==a?this.moveToStartOfLine(t,i,n,s):h>c&&r.line==c?At(t,i,n,s,!0):(n.toFirstChar&&(o=vt(t.getLine(h)),s.lastHPos=o),s.lastHSPos=t.charCoords(new e(h,o),"div").left,new e(h,o))},moveByDisplayLines:function(t,i,n,s){var r=i;switch(s.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:s.lastHSPos=t.charCoords(r,"div").left}var o=n.repeat;if((h=t.findPosV(r,n.forward?o:-o,"line",s.lastHSPos)).hitSide)if(n.forward)var l={top:t.charCoords(h,"div").top+8,left:s.lastHSPos},h=t.coordsChar(l,"div");else{var a=t.charCoords(new e(t.firstLine(),0),"div");a.left=s.lastHSPos,h=t.coordsChar(a,"div")}return s.lastHPos=h.ch,h},moveByPage:function(t,e,i){var n=e,s=i.repeat;return t.findPosV(n,i.forward?s:-s,"page")},moveByParagraph:function(t,e,i){var n=i.forward?1:-1;return Dt(t,e,i.repeat,n)},moveBySentence:function(t,i,n){var s=n.forward?1:-1;return function(t,i,n,s){function r(t,e){if(e.pos+e.dir<0||e.pos+e.dir>=e.line.length){if(e.ln+=e.dir,!k(t,e.ln))return e.line=null,e.ln=null,void(e.pos=null);e.line=t.getLine(e.ln),e.pos=e.dir>0?0:e.line.length-1}else e.pos+=e.dir}function o(t,e,i,n){var s=""===(a=t.getLine(e)),o={line:a,ln:e,pos:i,dir:n},l={ln:o.ln,pos:o.pos},h=""===o.line;for(r(t,o);null!==o.line;){if(l.ln=o.ln,l.pos=o.pos,""===o.line&&!h)return{ln:o.ln,pos:o.pos};if(s&&""!==o.line&&!C(o.line[o.pos]))return{ln:o.ln,pos:o.pos};!O(o.line[o.pos])||s||o.pos!==o.line.length-1&&!C(o.line[o.pos+1])||(s=!0),r(t,o)}var a=t.getLine(l.ln);l.pos=0;for(var c=a.length-1;c>=0;--c)if(!C(a[c])){l.pos=c;break}return l}function l(t,e,i,n){var s={line:h=t.getLine(e),ln:e,pos:i,dir:n},o={ln:s.ln,pos:null},l=""===s.line;for(r(t,s);null!==s.line;){if(""===s.line&&!l)return null!==o.pos?o:{ln:s.ln,pos:s.pos};if(O(s.line[s.pos])&&null!==o.pos&&(s.ln!==o.ln||s.pos+1!==o.pos))return o;""===s.line||C(s.line[s.pos])||(l=!1,o={ln:s.ln,pos:s.pos}),r(t,s)}var h=t.getLine(o.ln);o.pos=0;for(var a=0;a<h.length;++a)if(!C(h[a])){o.pos=a;break}return o}var h={ln:i.line,pos:i.ch};for(;n>0;)h=s<0?l(t,h.ln,h.pos,s):o(t,h.ln,h.pos,s),n--;return new e(h.ln,h.pos)}(t,i,n.repeat,s)},moveByScroll:function(t,e,i,n){var s,r=t.getScrollInfo(),o=i.repeat;o||(o=r.clientHeight/(2*t.defaultTextHeight()));var l=t.charCoords(e,"local");if(i.repeat=o,!(s=U.moveByDisplayLines(t,e,i,n)))return null;var h=t.charCoords(s,"local");return t.scrollTo(null,r.top+h.top-l.top),s},moveByWords:function(t,i,n){return function(t,i,n,s,r,o){var l=it(i),h=[];(s&&!r||!s&&r)&&n++;for(var a=!(s&&r),c=0;c<n;c++){var d=kt(t,i,s,o,a);if(!d){var u=ht(t,t.lastLine());h.push(s?{line:t.lastLine(),from:u,to:u}:{line:0,from:0,to:0});break}h.push(d),i=new e(d.line,s?d.to-1:d.from)}var f=h.length!=n,p=h[0],g=h.pop();return s&&!r?(f||p.from==l.ch&&p.line==l.line||(g=h.pop()),new e(g.line,g.from)):s&&r?new e(g.line,g.to-1):!s&&r?(f||p.to==l.ch&&p.line==l.line||(g=h.pop()),new e(g.line,g.to)):new e(g.line,g.from)}(t,i,n.repeat,!!n.forward,!!n.wordEnd,!!n.bigWord)},moveTillCharacter:function(t,e,i){var n=Mt(t,i.repeat,i.forward,i.selectedCharacter),s=i.forward?-1:1;return bt(s,i),n?(n.ch+=s,n):null},moveToCharacter:function(t,e,i){var n=i.repeat;return bt(0,i),Mt(t,n,i.forward,i.selectedCharacter)||e},moveToSymbol:function(t,i,n){return function(t,i,n,s){var r=it(t.getCursor()),o=n?1:-1,l=n?t.lineCount():-1,h=r.ch,a=r.line,c=t.getLine(a),d={lineText:c,nextCh:c.charAt(h),lastCh:null,index:h,symb:s,reverseSymb:(n?{")":"(","}":"{"}:{"(":")","{":"}"})[s],forward:n,depth:0,curMoveThrough:!1},u=xt[s];if(!u)return r;var f=St[u].init,p=St[u].isComplete;f&&f(d);for(;a!==l&&i;){if(d.index+=o,d.nextCh=d.lineText.charAt(d.index),!d.nextCh){if(a+=o,d.lineText=t.getLine(a)||"",o>0)d.index=0;else{var g=d.lineText.length;d.index=g>0?g-1:0}d.nextCh=d.lineText.charAt(d.index)}p(d)&&(r.line=a,r.ch=d.index,i--)}return d.nextCh||d.curMoveThrough?new e(a,d.index):r}(t,n.repeat,n.forward,n.selectedCharacter)||i},moveToColumn:function(t,i,n,s){var r=n.repeat;return s.lastHPos=r-1,s.lastHSPos=t.charCoords(i,"div").left,function(t,i){var n=t.getCursor().line;return J(t,new e(n,i-1))}(t,r)},moveToEol:function(t,e,i,n){return At(t,e,i,n,!1)},moveToFirstNonWhiteSpaceCharacter:function(t,i){var n=i;return new e(n.line,vt(t.getLine(n.line)))},moveToMatchedSymbol:function(t,i){for(var n,s=i,r=s.line,o=s.ch,l=t.getLine(r);o<l.length;o++)if((n=l.charAt(o))&&-1!="()[]{}".indexOf(n)){var h=t.getTokenTypeAt(new e(r,o+1));if("string"!==h&&"comment"!==h)break}if(o<l.length){var a="<"===o||">"===o?/[(){}[\]<>]/:/[(){}[\]]/;return t.findMatchingBracket(new e(r,o),{bracketRegex:a}).to}return s},moveToStartOfLine:function(t,i){return new e(i.line,0)},moveToLineOrEdgeOfDocument:function(t,i,n){var s=n.forward?t.lastLine():t.firstLine();return n.repeatIsExplicit&&(s=n.repeat-t.getOption("firstLineNumber")),new e(s,vt(t.getLine(s)))},textObjectManipulation:function(i,n,s,r){var o=s.selectedCharacter;"b"==o?o="(":"B"==o&&(o="{");var l,h=!s.textObjectInner;if({"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"}[o])l=function(t,i,n,s){var r,o,l=i,h={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[n],a={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[n],c=t.getLine(l.line).charAt(l.ch)===a?1:0;if(r=t.scanForBracket(new e(l.line,l.ch+c),-1,void 0,{bracketRegex:h}),o=t.scanForBracket(new e(l.line,l.ch+c),1,void 0,{bracketRegex:h}),!r||!o)return{start:l,end:l};if(r=r.pos,o=o.pos,r.line==o.line&&r.ch>o.ch||r.line>o.line){var d=r;r=o,o=d}s?o.ch+=1:r.ch+=1;return{start:r,end:o}}(i,n,o,h);else if({"'":!0,'"':!0,"`":!0}[o])l=function(t,i,n,s){var r,o,l,h,a=it(i),c=t.getLine(a.line).split(""),d=c.indexOf(n);a.ch<d?a.ch=d:d<a.ch&&c[a.ch]==n&&(o=a.ch,--a.ch);if(c[a.ch]!=n||o)for(l=a.ch;l>-1&&!r;l--)c[l]==n&&(r=l+1);else r=a.ch+1;if(r&&!o)for(l=r,h=c.length;l<h&&!o;l++)c[l]==n&&(o=l);if(!r||!o)return{start:a,end:a};s&&(--r,++o);return{start:new e(a.line,r),end:new e(a.line,o)}}(i,n,o,h);else if("W"===o)l=wt(i,h,!0,!0);else if("w"===o)l=wt(i,h,!0,!1);else if("p"===o)if(l=Dt(i,n,s.repeat,0,h),s.linewise=!0,r.visualMode)r.visualLine||(r.visualLine=!0);else{var a=r.inputState.operatorArgs;a&&(a.linewise=!0),l.end.line--}else{if("t"!==o)return null;l=function(e,i,n){var s=i;if(!t.findMatchingTag||!t.findEnclosingTag)return{start:s,end:s};var r=t.findMatchingTag(e,i)||t.findEnclosingTag(e,i);return r&&r.open&&r.close?n?{start:r.open.from,end:r.close.to}:{start:r.open.to,end:r.close.from}:{start:s,end:s}}(i,n,h)}return i.state.vim.visualMode?function(t,i,n){var s,r=t.state.vim.sel,o=r.head,l=r.anchor;st(n,i)&&(s=n,n=i,i=s);st(o,l)?(o=rt(i,o),l=ot(l,n)):(l=rt(i,l),-1==(o=Z(o=ot(o,n),0,-1)).ch&&o.line!=t.firstLine()&&(o=new e(o.line-1,ht(t,o.line-1))));return[l,o]}(i,l.start,l.end):[l.start,l.end]},repeatLastCharacterSearch:function(t,e,i){var n=L.lastCharacterSearch,s=i.repeat,r=i.forward===n.forward,o=(n.increment?1:0)*(r?-1:1);t.moveH(-o,"char"),i.inclusive=!!r;var l=Mt(t,s,r,n.selectedCharacter);return l?(l.ch+=o,l):(t.moveH(o,"char"),e)}};function $(t,e){for(var i=[],n=0;n<e;n++)i.push(t);return i}var Y={change:function(i,n,s){var r,o,l=i.state.vim,h=s[0].anchor,a=s[0].head;if(l.visualMode)if(n.fullLine)a.ch=Number.MAX_VALUE,a.line--,i.setSelection(h,a),o=i.getSelection(),i.replaceSelection(""),r=h;else{o=i.getSelection();var c=$("",s.length);i.replaceSelections(c),r=rt(s[0].head,s[0].anchor)}else{o=i.getRange(h,a);var d=l.lastEditInputState||{};if("moveByWords"==d.motion&&!C(o)){var u=/\s+$/.exec(o);u&&d.motionArgs&&d.motionArgs.forward&&(a=Z(a,0,-u[0].length),o=o.slice(0,-u[0].length))}var f=new e(h.line-1,Number.MAX_VALUE),p=i.firstLine()==i.lastLine();a.line>i.lastLine()&&n.linewise&&!p?i.replaceRange("",f,a):i.replaceRange("",h,a),n.linewise&&(p||(i.setCursor(f),t.commands.newlineAndIndent(i)),h.ch=Number.MAX_VALUE),r=h}L.registerController.pushText(n.registerName,"change",o,n.linewise,s.length>1),X.enterInsertMode(i,{head:r},i.state.vim)},delete:function(t,i,n){var s,r,o=t.state.vim;if(o.visualBlock){r=t.getSelection();var l=$("",n.length);t.replaceSelections(l),s=rt(n[0].head,n[0].anchor)}else{var h=n[0].anchor,a=n[0].head;i.linewise&&a.line!=t.firstLine()&&h.line==t.lastLine()&&h.line==a.line-1&&(h.line==t.firstLine()?h.ch=0:h=new e(h.line-1,ht(t,h.line-1))),r=t.getRange(h,a),t.replaceRange("",h,a),s=h,i.linewise&&(s=U.moveToFirstNonWhiteSpaceCharacter(t,h))}return L.registerController.pushText(i.registerName,"delete",r,i.linewise,o.visualBlock),J(t,s)},indent:function(t,e,i){var n=t.state.vim;if(t.indentMore)for(var s=n.visualMode?e.repeat:1,r=0;r<s;r++)e.indentRight?t.indentMore():t.indentLess();else{var o=i[0].anchor.line,l=n.visualBlock?i[i.length-1].anchor.line:i[0].head.line;s=n.visualMode?e.repeat:1;e.linewise&&l--;for(var h=o;h<=l;h++)for(r=0;r<s;r++)t.indentLine(h,e.indentRight)}return U.moveToFirstNonWhiteSpaceCharacter(t,i[0].anchor)},indentAuto:function(t,e,i){return t.execCommand("indentAuto"),U.moveToFirstNonWhiteSpaceCharacter(t,i[0].anchor)},changeCase:function(t,e,i,n,s){for(var r=t.getSelections(),o=[],l=e.toLower,h=0;h<r.length;h++){var a=r[h],c="";if(!0===l)c=a.toLowerCase();else if(!1===l)c=a.toUpperCase();else for(var d=0;d<a.length;d++){var u=a.charAt(d);c+=M(u)?u.toLowerCase():u.toUpperCase()}o.push(c)}return t.replaceSelections(o),e.shouldMoveCursor?s:!t.state.vim.visualMode&&e.linewise&&i[0].anchor.line+1==i[0].head.line?U.moveToFirstNonWhiteSpaceCharacter(t,n):e.linewise?n:rt(i[0].anchor,i[0].head)},yank:function(t,e,i,n){var s=t.state.vim,r=t.getSelection(),o=s.visualMode?rt(s.sel.anchor,s.sel.head,i[0].head,i[0].anchor):n;return L.registerController.pushText(e.registerName,"yank",r,e.linewise,s.visualBlock),o}};var X={jumpListWalk:function(t,e,i){if(!i.visualMode){var n=e.repeat,s=e.forward,r=L.jumpList.move(t,s?n:-n),o=r?r.find():void 0;o=o||t.getCursor(),t.setCursor(o)}},scroll:function(t,e,i){if(!i.visualMode){var n=e.repeat||1,s=t.defaultTextHeight(),r=t.getScrollInfo().top,o=s*n,l=e.forward?r+o:r-o,h=it(t.getCursor()),a=t.charCoords(h,"local");if(e.forward)l>a.top?(h.line+=(l-a.top)/s,h.line=Math.ceil(h.line),t.setCursor(h),a=t.charCoords(h,"local"),t.scrollTo(null,a.top)):t.scrollTo(null,l);else{var c=l+t.getScrollInfo().clientHeight;c<a.bottom?(h.line-=(a.bottom-c)/s,h.line=Math.floor(h.line),t.setCursor(h),a=t.charCoords(h,"local"),t.scrollTo(null,a.bottom-t.getScrollInfo().clientHeight)):t.scrollTo(null,l)}}},scrollToCursor:function(t,i){var n=t.getCursor().line,s=t.charCoords(new e(n,0),"local"),r=t.getScrollInfo().clientHeight,o=s.top,l=s.bottom-o;switch(i.position){case"center":o=o-r/2+l;break;case"bottom":o=o-r+l}t.scrollTo(null,o)},replayMacro:function(t,e,i){var n=e.selectedCharacter,s=e.repeat,r=L.macroModeState;for("@"==n?n=r.latestRegister:r.latestRegister=n;s--;)Zt(t,i,r,n)},enterMacroRecordMode:function(t,e){var i=L.macroModeState,n=e.selectedCharacter;L.registerController.isValidRegister(n)&&i.enterMacroRecordMode(t,n)},toggleOverwrite:function(e){e.state.overwrite?(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),t.signal(e,"vim-mode-change",{mode:"insert"})):(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),t.signal(e,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(i,n,s){if(!i.getOption("readOnly")){s.insertMode=!0,s.insertModeRepeat=n&&n.repeat||1;var r=n?n.insertAt:null,o=s.sel,l=n.head||i.getCursor("head"),h=i.listSelections().length;if("eol"==r)l=new e(l.line,ht(i,l.line));else if("bol"==r)l=new e(l.line,0);else if("charAfter"==r)l=Z(l,0,1);else if("firstNonBlank"==r)l=U.moveToFirstNonWhiteSpaceCharacter(i,l);else if("startOfSelectedArea"==r){if(!s.visualMode)return;s.visualBlock?(l=new e(Math.min(o.head.line,o.anchor.line),Math.min(o.head.ch,o.anchor.ch)),h=Math.abs(o.head.line-o.anchor.line)+1):l=o.head.line<o.anchor.line?o.head:new e(o.anchor.line,0)}else if("endOfSelectedArea"==r){if(!s.visualMode)return;s.visualBlock?(l=new e(Math.min(o.head.line,o.anchor.line),Math.max(o.head.ch,o.anchor.ch)+1),h=Math.abs(o.head.line-o.anchor.line)+1):l=o.head.line>=o.anchor.line?Z(o.head,0,1):new e(o.anchor.line,0)}else if("inplace"==r){if(s.visualMode)return}else"lastEdit"==r&&(l=Ut(i)||l);i.setOption("disableInput",!1),n&&n.replace?(i.toggleOverwrite(!0),i.setOption("keyMap","vim-replace"),t.signal(i,"vim-mode-change",{mode:"replace"})):(i.toggleOverwrite(!1),i.setOption("keyMap","vim-insert"),t.signal(i,"vim-mode-change",{mode:"insert"})),L.macroModeState.isPlaying||(i.on("change",te),t.on(i.getInputField(),"keydown",se)),s.visualMode&&mt(i),ut(i,l,h)}},toggleVisualMode:function(i,n,s){var r,o=n.repeat,l=i.getCursor();s.visualMode?s.visualLine^n.linewise||s.visualBlock^n.blockwise?(s.visualLine=!!n.linewise,s.visualBlock=!!n.blockwise,t.signal(i,"vim-mode-change",{mode:"visual",subMode:s.visualLine?"linewise":s.visualBlock?"blockwise":""}),pt(i)):mt(i):(s.visualMode=!0,s.visualLine=!!n.linewise,s.visualBlock=!!n.blockwise,r=J(i,new e(l.line,l.ch+o-1)),s.sel={anchor:l,head:r},t.signal(i,"vim-mode-change",{mode:"visual",subMode:s.visualLine?"linewise":s.visualBlock?"blockwise":""}),pt(i),Ct(i,s,"<",rt(l,r)),Ct(i,s,">",ot(l,r)))},reselectLastSelection:function(e,i,n){var s=n.lastSelection;if(n.visualMode&&ft(e,n),s){var r=s.anchorMark.find(),o=s.headMark.find();if(!r||!o)return;n.sel={anchor:r,head:o},n.visualMode=!0,n.visualLine=s.visualLine,n.visualBlock=s.visualBlock,pt(e),Ct(e,n,"<",rt(r,o)),Ct(e,n,">",ot(r,o)),t.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""})}},joinLines:function(t,i,n){var s,r;if(n.visualMode){if(s=t.getCursor("anchor"),st(r=t.getCursor("head"),s)){var o=r;r=s,s=o}r.ch=ht(t,r.line)-1}else{var l=Math.max(i.repeat,2);s=t.getCursor(),r=J(t,new e(s.line+l-1,1/0))}for(var h=0,a=s.line;a<r.line;a++){h=ht(t,s.line);o=new e(s.line+1,ht(t,s.line+1));var c=t.getRange(s,o);c=i.keepSpaces?c.replace(/\n\r?/g,""):c.replace(/\n\s*/g," "),t.replaceRange(c,s,o)}var d=new e(s.line,h);n.visualMode&&mt(t,!1),t.setCursor(d)},newLineAndEnterInsertMode:function(i,n,s){s.insertMode=!0;var r=it(i.getCursor());r.line!==i.firstLine()||n.after?(r.line=n.after?r.line:r.line-1,r.ch=ht(i,r.line),i.setCursor(r),(t.commands.newlineAndIndentContinueComment||t.commands.newlineAndIndent)(i)):(i.replaceRange("\n",new e(i.firstLine(),0)),i.setCursor(i.firstLine(),0));this.enterInsertMode(i,{repeat:n.repeat},s)},paste:function(t,i,n){var s=it(t.getCursor()),r=L.registerController.getRegister(i.registerName);if(f=r.toString()){if(i.matchIndent){var o=t.getOption("tabSize"),l=function(t){var e=t.split("\t").length-1,i=t.split(" ").length-1;return e*o+1*i},h=t.getLine(t.getCursor().line),a=l(h.match(/^\s*/)[0]),c=f.replace(/\n$/,""),d=f!==c,u=l(f.match(/^\s*/)[0]),f=c.replace(/^\s*/gm,(function(e){var i=a+(l(e)-u);if(i<0)return"";if(t.getOption("indentWithTabs")){var n=Math.floor(i/o);return Array(n+1).join("\t")}return Array(i+1).join(" ")}));f+=d?"\n":""}if(i.repeat>1)f=Array(i.repeat+1).join(f);var p,g,m=r.linewise,v=r.blockwise;if(v){f=f.split("\n"),m&&f.pop();for(var w=0;w<f.length;w++)f[w]=""==f[w]?" ":f[w];s.ch+=i.after?1:0,s.ch=Math.min(ht(t,s.line),s.ch)}else m?n.visualMode?f=n.visualLine?f.slice(0,-1):"\n"+f.slice(0,f.length-1)+"\n":i.after?(f="\n"+f.slice(0,f.length-1),s.ch=ht(t,s.line)):s.ch=0:s.ch+=i.after?1:0;if(n.visualMode){var y;n.lastPastedText=f;var b=function(t,i){var n=i.lastSelection,s=function(){var e=t.listSelections(),i=e[0],n=e[e.length-1];return[st(i.anchor,i.head)?i.anchor:i.head,st(n.anchor,n.head)?n.head:n.anchor]},r=function(){var i=t.getCursor(),s=t.getCursor(),r=n.visualBlock;if(r){var o=r.width,l=r.height;s=new e(i.line+l,i.ch+o);for(var h=[],a=i.line;a<s.line;a++){var c={anchor:new e(a,i.ch),head:new e(a,s.ch)};h.push(c)}t.setSelections(h)}else{var d=n.anchorMark.find(),u=n.headMark.find(),f=u.line-d.line,p=u.ch-d.ch;s={line:s.line+f,ch:f?s.ch:p+s.ch},n.visualLine&&(i=new e(i.line,0),s=new e(s.line,ht(t,s.line))),t.setSelection(i,s)}return[i,s]};return i.visualMode?s():r()}(t,n),x=b[0],S=b[1],k=t.getSelection(),A=t.listSelections(),M=new Array(A.length).join("1").split("1");n.lastSelection&&(y=n.lastSelection.headMark.find()),L.registerController.unnamedRegister.setText(k),v?(t.replaceSelections(M),S=new e(x.line+f.length-1,x.ch),t.setCursor(x),dt(t,S),t.replaceSelections(f),p=x):n.visualBlock?(t.replaceSelections(M),t.setCursor(x),t.replaceRange(f,x,x),p=x):(t.replaceRange(f,x,S),p=t.posFromIndex(t.indexFromPos(x)+f.length-1)),y&&(n.lastSelection.headMark=t.setBookmark(y)),m&&(p.ch=0)}else if(v){t.setCursor(s);for(w=0;w<f.length;w++){var C=s.line+w;C>t.lastLine()&&t.replaceRange("\n",new e(C,0)),ht(t,C)<s.ch&&ct(t,C,s.ch)}t.setCursor(s),dt(t,new e(s.line+f.length-1,s.ch)),t.replaceSelections(f),p=s}else t.replaceRange(f,s),m&&i.after?p=new e(s.line+1,vt(t.getLine(s.line+1))):m&&!i.after?p=new e(s.line,vt(t.getLine(s.line))):!m&&i.after?(g=t.indexFromPos(s),p=t.posFromIndex(g+f.length-1)):(g=t.indexFromPos(s),p=t.posFromIndex(g+f.length));n.visualMode&&mt(t,!1),t.setCursor(p)}},undo:function(e,i){e.operation((function(){et(e,t.commands.undo,i.repeat)(),e.setCursor(e.getCursor("anchor"))}))},redo:function(e,i){et(e,t.commands.redo,i.repeat)()},setRegister:function(t,e,i){i.inputState.registerName=e.selectedCharacter},setMark:function(t,e,i){Ct(t,i,e.selectedCharacter,t.getCursor())},replace:function(i,n,s){var r,o,l=n.selectedCharacter,h=i.getCursor(),a=i.listSelections();if(s.visualMode)h=i.getCursor("start"),o=i.getCursor("end");else{var c=i.getLine(h.line);(r=h.ch+n.repeat)>c.length&&(r=c.length),o=new e(h.line,r)}if("\n"==l)s.visualMode||i.replaceRange("",h,o),(t.commands.newlineAndIndentContinueComment||t.commands.newlineAndIndent)(i);else{var d=i.getRange(h,o);if(d=d.replace(/[^\n]/g,l),s.visualBlock){var u=new Array(i.getOption("tabSize")+1).join(" ");d=(d=i.getSelection()).replace(/\t/g,u).replace(/[^\n]/g,l).split("\n"),i.replaceSelections(d)}else i.replaceRange(d,h,o);s.visualMode?(h=st(a[0].anchor,a[0].head)?a[0].anchor:a[0].head,i.setCursor(h),mt(i,!1)):i.setCursor(Z(o,0,-1))}},incrementNumberToken:function(t,i){for(var n,s,r,o,l=t.getCursor(),h=t.getLine(l.line),a=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi;null!==(n=a.exec(h))&&(r=(s=n.index)+n[0].length,!(l.ch<r)););if((i.backtrack||!(r<=l.ch))&&n){var c=n[2]||n[4],d=n[3]||n[5],u=i.increase?1:-1,f={"0b":2,0:8,"":10,"0x":16}[c.toLowerCase()];o=(parseInt(n[1]+d,f)+u*i.repeat).toString(f);var p=c?new Array(d.length-o.length+1+n[1].length).join("0"):"";o="-"===o.charAt(0)?"-"+c+p+o.substr(1):c+p+o;var g=new e(l.line,s),m=new e(l.line,r);t.replaceRange(o,g,m),t.setCursor(new e(l.line,s+o.length-1))}},repeatLastEdit:function(t,e,i){if(i.lastEditInputState){var n=e.repeat;n&&e.repeatIsExplicit?i.lastEditInputState.repeatOverride=n:n=i.lastEditInputState.repeatOverride||n,re(t,i,n,!1)}},indent:function(t,e){t.indentLine(t.getCursor().line,e.indentRight)},exitInsertMode:Jt};function J(t,i){var n=t.state.vim,s=n.insertMode||n.visualMode,r=Math.min(Math.max(t.firstLine(),i.line),t.lastLine()),o=ht(t,r)-1+!!s,l=Math.min(Math.max(0,i.ch),o);return new e(r,l)}function Q(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function Z(t,i,n){return"object"==typeof i&&(n=i.ch,i=i.line),new e(t.line+i,t.ch+n)}function tt(t,e){if("<character>"==e.slice(-11)){var i=e.length-11,n=t.slice(0,i),s=e.slice(0,i);return n==s&&t.length>i?"full":0==s.indexOf(n)&&"partial"}return t==e?"full":0==e.indexOf(t)&&"partial"}function et(t,e,i){return function(){for(var n=0;n<i;n++)e(t)}}function it(t){return new e(t.line,t.ch)}function nt(t,e){return t.ch==e.ch&&t.line==e.line}function st(t,e){return t.line<e.line||t.line==e.line&&t.ch<e.ch}function rt(t,e){return arguments.length>2&&(e=rt.apply(void 0,Array.prototype.slice.call(arguments,1))),st(t,e)?t:e}function ot(t,e){return arguments.length>2&&(e=ot.apply(void 0,Array.prototype.slice.call(arguments,1))),st(t,e)?e:t}function lt(t,e,i){var n=st(t,e),s=st(e,i);return n&&s}function ht(t,e){return t.getLine(e).length}function at(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function ct(t,i,n){var s=ht(t,i),r=new Array(n-s+1).join(" ");t.setCursor(new e(i,s)),t.replaceRange(r,t.getCursor())}function dt(t,i){var n=[],s=t.listSelections(),r=it(t.clipPos(i)),o=!nt(i,r),l=function(t,e,i){for(var n=0;n<t.length;n++){var s="head"!=i&&nt(t[n].anchor,e),r="anchor"!=i&&nt(t[n].head,e);if(s||r)return n}return-1}(s,t.getCursor("head")),h=nt(s[l].head,s[l].anchor),a=s.length-1,c=a-l>l?a:0,d=s[c].anchor,u=Math.min(d.line,r.line),f=Math.max(d.line,r.line),p=d.ch,g=r.ch,m=s[c].head.ch-p,v=g-p;m>0&&v<=0?(p++,o||g--):m<0&&v>=0?(p--,h||g++):m<0&&-1==v&&(p--,g++);for(var w=u;w<=f;w++){var y={anchor:new e(w,p),head:new e(w,g)};n.push(y)}return t.setSelections(n),i.ch=g,d.ch=p,d}function ut(t,e,i){for(var n=[],s=0;s<i;s++){var r=Z(e,s,0);n.push({anchor:r,head:r})}t.setSelections(n,0)}function ft(t,e){var i=e.sel.anchor,n=e.sel.head;e.lastPastedText&&(n=t.posFromIndex(t.indexFromPos(i)+e.lastPastedText.length),e.lastPastedText=null),e.lastSelection={anchorMark:t.setBookmark(i),headMark:t.setBookmark(n),anchor:it(i),head:it(n),visualMode:e.visualMode,visualLine:e.visualLine,visualBlock:e.visualBlock}}function pt(t,e,i){var n=t.state.vim,s=gt(t,e=e||n.sel,i=i||n.visualLine?"line":n.visualBlock?"block":"char");t.setSelections(s.ranges,s.primary)}function gt(t,i,n,s){var r=it(i.head),o=it(i.anchor);if("char"==n){var l=s||st(i.head,i.anchor)?0:1,h=st(i.head,i.anchor)?1:0;return r=Z(i.head,0,l),{ranges:[{anchor:o=Z(i.anchor,0,h),head:r}],primary:0}}if("line"==n){if(st(i.head,i.anchor))r.ch=0,o.ch=ht(t,o.line);else{o.ch=0;var a=t.lastLine();r.line>a&&(r.line=a),r.ch=ht(t,r.line)}return{ranges:[{anchor:o,head:r}],primary:0}}if("block"==n){var c=Math.min(o.line,r.line),d=o.ch,u=Math.max(o.line,r.line),f=r.ch;d<f?f+=1:d+=1;for(var p=u-c+1,g=r.line==c?0:p-1,m=[],v=0;v<p;v++)m.push({anchor:new e(c+v,d),head:new e(c+v,f)});return{ranges:m,primary:g}}}function mt(e,i){var n=e.state.vim;!1!==i&&e.setCursor(J(e,n.sel.head)),ft(e,n),n.visualMode=!1,n.visualLine=!1,n.visualBlock=!1,n.insertMode||t.signal(e,"vim-mode-change",{mode:"normal"})}function vt(t){if(!t)return 0;var e=t.search(/\S/);return-1==e?t.length:e}function wt(t,i,n,s,r){for(var o=function(t){var e=t.getCursor("head");return 1==t.getSelection().length&&(e=rt(e,t.getCursor("anchor"))),e}(t),l=t.getLine(o.line),h=o.ch,a=r?p[0]:g[0];!a(l.charAt(h));)if(++h>=l.length)return null;s?a=g[0]:(a=p[0])(l.charAt(h))||(a=p[1]);for(var c=h,d=h;a(l.charAt(c))&&c<l.length;)c++;for(;a(l.charAt(d))&&d>=0;)d--;if(d++,i){for(var u=c;/\s/.test(l.charAt(c))&&c<l.length;)c++;if(u==c){for(var f=d;/\s/.test(l.charAt(d-1))&&d>0;)d--;d||(d=f)}}return{start:new e(o.line,d),end:new e(o.line,c)}}function yt(t,e,i){nt(e,i)||L.jumpList.add(t,e,i)}function bt(t,e){L.lastCharacterSearch.increment=t,L.lastCharacterSearch.forward=e.forward,L.lastCharacterSearch.selectedCharacter=e.selectedCharacter}var xt={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},St={bracket:{isComplete:function(t){if(t.nextCh===t.symb){if(t.depth++,t.depth>=1)return!0}else t.nextCh===t.reverseSymb&&t.depth--;return!1}},section:{init:function(t){t.curMoveThrough=!0,t.symb=(t.forward?"]":"[")===t.symb?"{":"}"},isComplete:function(t){return 0===t.index&&t.nextCh===t.symb}},comment:{isComplete:function(t){var e="*"===t.lastCh&&"/"===t.nextCh;return t.lastCh=t.nextCh,e}},method:{init:function(t){t.symb="m"===t.symb?"{":"}",t.reverseSymb="{"===t.symb?"}":"{"},isComplete:function(t){return t.nextCh===t.symb}},preprocess:{init:function(t){t.index=0},isComplete:function(t){if("#"===t.nextCh){var e=t.lineText.match(/^#(\w+)/)[1];if("endif"===e){if(t.forward&&0===t.depth)return!0;t.depth++}else if("if"===e){if(!t.forward&&0===t.depth)return!0;t.depth--}if("else"===e&&0===t.depth)return!0}return!1}}};function kt(t,e,i,n,s){var r=e.line,o=e.ch,l=t.getLine(r),h=i?1:-1,a=n?g:p;if(s&&""==l){if(r+=h,l=t.getLine(r),!k(t,r))return null;o=i?0:l.length}for(;;){if(s&&""==l)return{from:0,to:0,line:r};for(var c=h>0?l.length:-1,d=c,u=c;o!=c;){for(var f=!1,m=0;m<a.length&&!f;++m)if(a[m](l.charAt(o))){for(d=o;o!=c&&a[m](l.charAt(o));)o+=h;if(f=d!=(u=o),d==e.ch&&r==e.line&&u==d+h)continue;return{from:Math.min(d,u+1),to:Math.max(d,u),line:r}}f||(o+=h)}if(!k(t,r+=h))return null;l=t.getLine(r),o=h>0?0:l.length}}function At(t,i,n,s,r){var o=new e(i.line+n.repeat-1,1/0),l=t.clipPos(o);return l.ch--,r||(s.lastHPos=1/0,s.lastHSPos=t.charCoords(l,"div").left),o}function Mt(t,i,n,s){for(var r,o=t.getCursor(),l=o.ch,h=0;h<i;h++){if(-1==(r=Ot(l,t.getLine(o.line),s,n,!0)))return null;l=r}return new e(t.getCursor().line,r)}function Ct(t,e,i,n){D(i,x)&&(e.marks[i]&&e.marks[i].clear(),e.marks[i]=t.setBookmark(n))}function Ot(t,e,i,n,s){var r;return n?-1==(r=e.indexOf(i,t+1))||s||(r-=1):-1==(r=e.lastIndexOf(i,t-1))||s||(r+=1),r}function Dt(t,i,n,s,r){var o,l=i.line,h=t.firstLine(),a=t.lastLine(),c=l;function d(e){return!t.getLine(e)}function u(t,e,i){return i?d(t)!=d(t+e):!d(t)&&d(t+e)}if(s){for(;h<=c&&c<=a&&n>0;)u(c,s)&&n--,c+=s;return new e(c,0)}var f=t.state.vim;if(f.visualLine&&u(l,1,!0)){var p=f.sel.anchor;u(p.line,-1,!0)&&(r&&p.line==l||(l+=1))}var g=d(l);for(c=l;c<=a&&n;c++)u(c,1,!0)&&(r&&d(c)==g||n--);for(o=new e(c,0),c>a&&!g?g=!0:r=!1,c=l;c>h&&(r&&d(c)!=g&&c!=l||!u(c,-1,!0));c--);return{start:new e(c,0),end:o}}function Tt(){}function Bt(t){var e=t.state.vim;return e.searchState_||(e.searchState_=new Tt)}function Et(t,e){var i=Rt(t,e)||[];if(!i.length)return[];var n=[];if(0===i[0]){for(var s=0;s<i.length;s++)"number"==typeof i[s]&&n.push(t.substring(i[s]+1,i[s+1]));return n}}function Rt(t,e){e||(e="/");for(var i=!1,n=[],s=0;s<t.length;s++){var r=t.charAt(s);i||r!=e||n.push(s),i=!i&&"\\"==r}return n}B("pcre",!0,"boolean"),Tt.prototype={getQuery:function(){return L.query},setQuery:function(t){L.query=t},getOverlay:function(){return this.searchOverlay},setOverlay:function(t){this.searchOverlay=t},isReversed:function(){return L.isReversed},setReversed:function(t){L.isReversed=t},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(t){this.annotate=t}};var Lt={"\\n":"\n","\\r":"\r","\\t":"\t"};var Vt={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t","\\&":"&"};function Nt(t,e,i){if(L.registerController.getRegister("/").setText(t),t instanceof RegExp)return t;var n,s,r=Rt(t,"/");r.length?(n=t.substring(0,r[0]),s=-1!=t.substring(r[0]).indexOf("i")):n=t;return n?(R("pcre")||(n=function(t){for(var e=!1,i=[],n=-1;n<t.length;n++){var s=t.charAt(n)||"",r=t.charAt(n+1)||"",o=r&&-1!="|(){".indexOf(r);e?("\\"===s&&o||i.push(s),e=!1):"\\"===s?(e=!0,r&&-1!="}".indexOf(r)&&(o=!0),o&&"\\"!==r||i.push(s)):(i.push(s),o&&"\\"!==r&&i.push("\\"))}return i.join("")}(n)),i&&(e=/^[^A-Z]*$/.test(n)),new RegExp(n,e||s?"im":"m")):null}function Pt(t){"string"==typeof t&&(t=document.createElement(t));for(var e,i=1;i<arguments.length;i++)if(e=arguments[i])if("object"!=typeof e&&(e=document.createTextNode(e)),e.nodeType)t.appendChild(e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&("$"===n[0]?t.style[n.slice(1)]=e[n]:t.setAttribute(n,e[n]));return t}function Ht(t,e){var i=Pt("div",{$color:"red",$whiteSpace:"pre",class:"cm-vim-message"},e);t.openNotification?t.openNotification(i,{bottom:!0,duration:5e3}):alert(i.innerText)}function Wt(t,e){var i,n,s=(i=e.prefix,n=e.desc,Pt(document.createDocumentFragment(),Pt("span",{$fontFamily:"monospace",$whiteSpace:"pre"},i,Pt("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})),n&&Pt("span",{$color:"#888"},n)));if(t.openDialog)t.openDialog(s,e.onClose,{onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:e.value,onClose:function(){t.state.vim&&q(t)}});else{var r="";"string"!=typeof e.prefix&&e.prefix&&(r+=e.prefix.textContent),e.desc&&(r+=" "+e.desc),e.onClose(prompt(r,""))}}function It(t,e,i,n){if(e){var s=Bt(t),r=Nt(e,!!i,!!n);if(r)return zt(t,r),function(t,e){if(t instanceof RegExp&&e instanceof RegExp){for(var i=["global","multiline","ignoreCase","source"],n=0;n<i.length;n++){var s=i[n];if(t[s]!==e[s])return!1}return!0}return!1}(r,s.getQuery())||s.setQuery(r),r}}var Ft=0;function zt(t,e){clearTimeout(Ft),Ft=setTimeout((function(){if(t.state.vim){var i=Bt(t),n=i.getOverlay();n&&e==n.query||(n&&t.removeOverlay(n),n=function(t){if("^"==t.source.charAt(0))var e=!0;return{token:function(i){if(!e||i.sol()){var n=i.match(t,!1);if(n)return 0==n[0].length?(i.next(),"searching"):i.sol()||(i.backUp(1),t.exec(i.next()+n[0]))?(i.match(t),"searching"):(i.next(),null);for(;!i.eol()&&(i.next(),!i.match(t,!1)););}else i.skipToEnd()},query:t}}(e),t.addOverlay(n),t.showMatchesOnScrollbar&&(i.getScrollbarAnnotate()&&i.getScrollbarAnnotate().clear(),i.setScrollbarAnnotate(t.showMatchesOnScrollbar(e))),i.setOverlay(n))}}),50)}function qt(t,i,n,s){return void 0===s&&(s=1),t.operation((function(){for(var r=t.getCursor(),o=t.getSearchCursor(n,r),l=0;l<s;l++){var h=o.find(i);if(0==l&&h&&nt(o.from(),r)){var a=i?o.from():o.to();(h=o.find(i))&&!h[0]&&nt(o.from(),a)&&t.getLine(a.line).length==a.ch&&(h=o.find(i))}if(!h&&!(o=t.getSearchCursor(n,i?new e(t.lastLine()):new e(t.firstLine(),0))).find(i))return}return o.from()}))}function Kt(t){var e=Bt(t);t.removeOverlay(Bt(t).getOverlay()),e.setOverlay(null),e.getScrollbarAnnotate()&&(e.getScrollbarAnnotate().clear(),e.setScrollbarAnnotate(null))}function Gt(t,e,i){return"number"!=typeof t&&(t=t.line),e instanceof Array?D(t,e):"number"==typeof i?t>=e&&t<=i:t==e}function jt(t){var e=t.getScrollInfo(),i=t.coordsChar({left:0,top:6+e.top},"local"),n=e.clientHeight-10+e.top,s=t.coordsChar({left:0,top:n},"local");return{top:i.line,bottom:s.line}}function _t(t,i,n){if("'"==n||"`"==n)return L.jumpList.find(t,-1)||new e(0,0);if("."==n)return Ut(t);var s=i.marks[n];return s&&s.find()}function Ut(t){for(var e=t.doc.history.done,i=e.length;i--;)if(e[i].changes)return it(e[i].changes[0].to)}var $t=function(){this.buildCommandMap_()};$t.prototype={processCommand:function(t,e,i){var n=this;t.operation((function(){t.curOp.isVimOp=!0,n._processCommand(t,e,i)}))},_processCommand:function(e,i,n){var s=e.state.vim,r=L.registerController.getRegister(":"),o=r.toString();s.visualMode&&mt(e);var l=new t.StringStream(i);r.setText(i);var h,a,c=n||{};c.input=i;try{this.parseInput_(e,l,c)}catch(t){throw Ht(e,t.toString()),t}if(c.commandName){if(h=this.matchCommand_(c.commandName)){if(a=h.name,h.excludeFromCommandHistory&&r.setText(o),this.parseCommandArgs_(l,c,h),"exToKey"==h.type){for(var d=0;d<h.toKeys.length;d++)F.handleKey(e,h.toKeys[d],"mapping");return}if("exToEx"==h.type)return void this.processCommand(e,h.toInput)}}else void 0!==c.line&&(a="move");if(a)try{Yt[a](e,c),h&&h.possiblyAsync||!c.callback||c.callback()}catch(t){throw Ht(e,t.toString()),t}else Ht(e,'Not an editor command ":'+i+'"')},parseInput_:function(t,e,i){e.eatWhile(":"),e.eat("%")?(i.line=t.firstLine(),i.lineEnd=t.lastLine()):(i.line=this.parseLineSpec_(t,e),void 0!==i.line&&e.eat(",")&&(i.lineEnd=this.parseLineSpec_(t,e)));var n=e.match(/^(\w+|!!|@@|[!#&*<=>@~])/);return i.commandName=n?n[1]:e.match(/.*/)[0],i},parseLineSpec_:function(t,e){var i=e.match(/^(\d+)/);if(i)return parseInt(i[1],10)-1;switch(e.next()){case".":return this.parseLineSpecOffset_(e,t.getCursor().line);case"$":return this.parseLineSpecOffset_(e,t.lastLine());case"'":var n=e.next(),s=_t(t,t.state.vim,n);if(!s)throw new Error("Mark not set");return this.parseLineSpecOffset_(e,s.line);case"-":case"+":return e.backUp(1),this.parseLineSpecOffset_(e,t.getCursor().line);default:return void e.backUp(1)}},parseLineSpecOffset_:function(t,e){var i=t.match(/^([+-])?(\d+)/);if(i){var n=parseInt(i[2],10);"-"==i[1]?e-=n:e+=n}return e},parseCommandArgs_:function(t,e,i){if(!t.eol()){e.argString=t.match(/.*/)[0];var n=i.argDelimiter||/\s+/,s=at(e.argString).split(n);s.length&&s[0]&&(e.args=s)}},matchCommand_:function(t){for(var e=t.length;e>0;e--){var i=t.substring(0,e);if(this.commandMap_[i]){var n=this.commandMap_[i];if(0===n.name.indexOf(t))return n}}return null},buildCommandMap_:function(){this.commandMap_={};for(var t=0;t<r.length;t++){var e=r[t],i=e.shortName||e.name;this.commandMap_[i]=e}},map:function(t,e,i){if(":"!=t&&":"==t.charAt(0)){if(i)throw Error("Mode not supported for ex mappings");var s=t.substring(1);":"!=e&&":"==e.charAt(0)?this.commandMap_[s]={name:s,type:"exToEx",toInput:e.substring(1),user:!0}:this.commandMap_[s]={name:s,type:"exToKey",toKeys:e,user:!0}}else if(":"!=e&&":"==e.charAt(0)){var r={keys:t,type:"keyToEx",exArgs:{input:e.substring(1)}};i&&(r.context=i),n.unshift(r)}else{r={keys:t,type:"keyToKey",toKeys:e};i&&(r.context=i),n.unshift(r)}},unmap:function(t,e){if(":"!=t&&":"==t.charAt(0)){if(e)throw Error("Mode not supported for ex mappings");var i=t.substring(1);if(this.commandMap_[i]&&this.commandMap_[i].user)return delete this.commandMap_[i],!0}else for(var s=t,r=0;r<n.length;r++)if(s==n[r].keys&&n[r].context===e)return n.splice(r,1),!0}};var Yt={colorscheme:function(t,e){!e.args||e.args.length<1?Ht(t,t.getOption("theme")):t.setOption("theme",e.args[0])},map:function(t,e,i){var n=e.args;!n||n.length<2?t&&Ht(t,"Invalid mapping: "+e.input):Xt.map(n[0],n[1],i)},imap:function(t,e){this.map(t,e,"insert")},nmap:function(t,e){this.map(t,e,"normal")},vmap:function(t,e){this.map(t,e,"visual")},unmap:function(t,e,i){var n=e.args;(!n||n.length<1||!Xt.unmap(n[0],i))&&t&&Ht(t,"No such mapping: "+e.input)},move:function(t,e){_.processCommand(t,t.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:e.line+1})},set:function(t,e){var i=e.args,n=e.setCfg||{};if(!i||i.length<1)t&&Ht(t,"Invalid mapping: "+e.input);else{var s=i[0].split("="),r=s[0],o=s[1],l=!1;if("?"==r.charAt(r.length-1)){if(o)throw Error("Trailing characters: "+e.argString);r=r.substring(0,r.length-1),l=!0}void 0===o&&"no"==r.substring(0,2)&&(r=r.substring(2),o=!1);var h=T[r]&&"boolean"==T[r].type;if(h&&null==o&&(o=!0),!h&&void 0===o||l){var a=R(r,t,n);a instanceof Error?Ht(t,a.message):Ht(t,!0===a||!1===a?" "+(a?"":"no")+r:"  "+r+"="+a)}else{var c=E(r,o,t,n);c instanceof Error&&Ht(t,c.message)}}},setlocal:function(t,e){e.setCfg={scope:"local"},this.set(t,e)},setglobal:function(t,e){e.setCfg={scope:"global"},this.set(t,e)},registers:function(t,e){var i=e.args,n=L.registerController.registers,s="----------Registers----------\n\n";if(i){i=i.join("");for(var r=0;r<i.length;r++){if(o=i.charAt(r),L.registerController.isValidRegister(o))s+='"'+o+"    "+(n[o]||new K).toString()+"\n"}}else for(var o in n){var l=n[o].toString();l.length&&(s+='"'+o+"    "+l+"\n")}Ht(t,s)},sort:function(i,n){var s,r,o,l,h;var a=function(){if(n.argString){var e=new t.StringStream(n.argString);if(e.eat("!")&&(s=!0),e.eol())return;if(!e.eatSpace())return"Invalid arguments";var i=e.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!i&&!e.eol())return"Invalid arguments";if(i[1]){r=-1!=i[1].indexOf("i"),o=-1!=i[1].indexOf("u");var a=-1!=i[1].indexOf("d")||-1!=i[1].indexOf("n")&&1,c=-1!=i[1].indexOf("x")&&1,d=-1!=i[1].indexOf("o")&&1;if(a+c+d>1)return"Invalid arguments";l=(a?"decimal":c&&"hex")||d&&"octal"}i[2]&&(h=new RegExp(i[2].substr(1,i[2].length-2),r?"i":""))}}();if(a)Ht(i,a+": "+n.argString);else{var c=n.line||i.firstLine(),d=n.lineEnd||n.line||i.lastLine();if(c!=d){var u=new e(c,0),f=new e(d,ht(i,d)),p=i.getRange(u,f).split("\n"),g=h||("decimal"==l?/(-?)([\d]+)/:"hex"==l?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==l?/([0-7]+)/:null),m="decimal"==l?10:"hex"==l?16:"octal"==l?8:null,v=[],w=[];if(l||h)for(var y=0;y<p.length;y++){var b=h?p[y].match(h):null;b&&""!=b[0]?v.push(b):!h&&g.exec(p[y])?v.push(p[y]):w.push(p[y])}else w=p;if(v.sort(h?function(t,e){var i;return s&&(i=t,t=e,e=i),r&&(t[0]=t[0].toLowerCase(),e[0]=e[0].toLowerCase()),t[0]<e[0]?-1:1}:k),h)for(y=0;y<v.length;y++)v[y]=v[y].input;else l||w.sort(k);if(p=s?v.concat(w):w.concat(v),o){var x,S=p;p=[];for(y=0;y<S.length;y++)S[y]!=x&&p.push(S[y]),x=S[y]}i.replaceRange(p.join("\n"),u,f)}}function k(t,e){var i;s&&(i=t,t=e,e=i);r&&(t=t.toLowerCase(),e=e.toLowerCase());var n=l&&g.exec(t),o=l&&g.exec(e);return n?(n=parseInt((n[1]+n[2]).toLowerCase(),m))-(o=parseInt((o[1]+o[2]).toLowerCase(),m)):t<e?-1:1}},vglobal:function(t,e){this.global(t,e)},global:function(t,e){var i=e.argString;if(i){var n,s="v"===e.commandName[0],r=void 0!==e.line?e.line:t.firstLine(),o=e.lineEnd||e.line||t.lastLine(),l=function(t){return Et(t,"/")}(i),h=i;if(l.length&&(h=l[0],n=l.slice(1,l.length).join("/")),h)try{It(t,h,!0,!0)}catch(e){return void Ht(t,"Invalid regex: "+h)}for(var a=Bt(t).getQuery(),c=[],d=r;d<=o;d++){var u=t.getLineHandle(d);a.test(u.text)!==s&&c.push(n?u:u.text)}if(n){var f=0,p=function(){if(f<c.length){var e=c[f++],i=t.getLineNumber(e);if(null==i)return void p();var s=i+1+n;Xt.processCommand(t,s,{callback:p})}};p()}else Ht(t,c.join("\n"))}else Ht(t,"Regular Expression missing from global")},substitute:function(i,n){if(!i.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var s,r,o,l,h=n.argString,a=h?Et(h,h[0]):[],c="",d=!1,u=!1;if(a.length)s=a[0],R("pcre")&&""!==s&&(s=new RegExp(s).source),void 0!==(c=a[1])&&(c=R("pcre")?function(e){for(var i=new t.StringStream(e),n=[];!i.eol();){for(;i.peek()&&"\\"!=i.peek();)n.push(i.next());var s=!1;for(var r in Vt)if(i.match(r,!0)){s=!0,n.push(Vt[r]);break}s||n.push(i.next())}return n.join("")}(c.replace(/([^\\])&/g,"$1$$&")):function(t){for(var e,i=!1,n=[],s=-1;s<t.length;s++){var r=t.charAt(s)||"",o=t.charAt(s+1)||"";Lt[r+o]?(n.push(Lt[r+o]),s++):i?(n.push(r),i=!1):"\\"===r?(i=!0,e=o,f.test(e)||"$"===o?n.push("$"):"/"!==o&&"\\"!==o&&n.push("\\")):("$"===r&&n.push("$"),n.push(r),"/"===o&&n.push("\\"))}return n.join("")}(c),L.lastSubstituteReplacePart=c),r=a[2]?a[2].split(" "):[];else if(h&&h.length)return void Ht(i,"Substitutions should be of the form :s/pattern/replace/");if(r&&(o=r[0],l=parseInt(r[1]),o&&(-1!=o.indexOf("c")&&(d=!0),-1!=o.indexOf("g")&&(u=!0),s=R("pcre")?s+"/"+o:s.replace(/\//g,"\\/")+"/"+o)),s)try{It(i,s,!0,!0)}catch(t){return void Ht(i,"Invalid regex: "+s)}if(void 0!==(c=c||L.lastSubstituteReplacePart)){var p=Bt(i).getQuery(),g=void 0!==n.line?n.line:i.getCursor().line,m=n.lineEnd||g;g==i.firstLine()&&m==i.lastLine()&&(m=1/0),l&&(m=(g=m)+l-1);var v=J(i,new e(g,0)),w=i.getSearchCursor(p,v);!function(e,i,n,s,r,o,l,h,a){e.state.vim.exMode=!0;var c,d,u,f=!1;function p(){e.operation((function(){for(;!f;)g(),v();w()}))}function g(){var t=e.getRange(o.from(),o.to()).replace(l,h),i=o.to().line;o.replace(t),d=o.to().line,r+=d-i,u=d<i}function m(){var t=c&&it(o.to()),e=o.findNext();return e&&!e[0]&&t&&nt(o.from(),t)&&(e=o.findNext()),e}function v(){for(;m()&&Gt(o.from(),s,r);)if(n||o.from().line!=d||u)return e.scrollIntoView(o.from(),30),e.setSelection(o.from(),o.to()),c=o.from(),void(f=!1);f=!0}function w(t){if(t&&t(),e.focus(),c){e.setCursor(c);var i=e.state.vim;i.exMode=!1,i.lastHPos=i.lastHSPos=c.ch}a&&a()}function y(i,n,s){switch(t.e_stop(i),t.keyName(i)){case"Y":g(),v();break;case"N":v();break;case"A":var r=a;a=void 0,e.operation(p),a=r;break;case"L":g();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":w(s)}return f&&w(s),!0}if(v(),f)return void Ht(e,"No matches for "+l.source);if(!i)return p(),void(a&&a());Wt(e,{prefix:Pt("span","replace with ",Pt("strong",h)," (y/n/a/q/l)"),onKeyDown:y})}(i,d,u,g,m,w,p,c,n.callback)}else Ht(i,"No previous substitute regular expression")},redo:t.commands.redo,undo:t.commands.undo,write:function(e){t.commands.save?t.commands.save(e):e.save&&e.save()},nohlsearch:function(t){Kt(t)},yank:function(t){var e=it(t.getCursor()).line,i=t.getLine(e);L.registerController.pushText("0","yank",i,!0,!0)},delmarks:function(e,i){if(i.argString&&at(i.argString))for(var n=e.state.vim,s=new t.StringStream(at(i.argString));!s.eol();){s.eatSpace();var r=s.pos;if(!s.match(/[a-zA-Z]/,!1))return void Ht(e,"Invalid argument: "+i.argString.substring(r));var o=s.next();if(s.match("-",!0)){if(!s.match(/[a-zA-Z]/,!1))return void Ht(e,"Invalid argument: "+i.argString.substring(r));var l=o,h=s.next();if(!(A(l)&&A(h)||M(l)&&M(h)))return void Ht(e,"Invalid argument: "+l+"-");var a=l.charCodeAt(0),c=h.charCodeAt(0);if(a>=c)return void Ht(e,"Invalid argument: "+i.argString.substring(r));for(var d=0;d<=c-a;d++){var u=String.fromCharCode(a+d);delete n.marks[u]}}else delete n.marks[o]}else Ht(e,"Argument required")}},Xt=new $t;function Jt(e){var i=e.state.vim,n=L.macroModeState,s=L.registerController.getRegister("."),r=n.isPlaying,o=n.lastInsertModeChanges;r||(e.off("change",te),t.off(e.getInputField(),"keydown",se)),!r&&i.insertModeRepeat>1&&(re(e,i,i.insertModeRepeat-1,!0),i.lastEditInputState.repeatOverride=i.insertModeRepeat),delete i.insertModeRepeat,i.insertMode=!1,e.setCursor(e.getCursor().line,e.getCursor().ch-1),e.setOption("keyMap","vim"),e.setOption("disableInput",!0),e.toggleOverwrite(!1),s.setText(o.changes.join("")),t.signal(e,"vim-mode-change",{mode:"normal"}),n.isRecording&&function(t){if(t.isPlaying)return;var e=t.latestRegister,i=L.registerController.getRegister(e);i&&i.pushInsertModeChanges&&i.pushInsertModeChanges(t.lastInsertModeChanges)}(n)}function Qt(t){n.unshift(t)}function Zt(t,e,i,n){var s=L.registerController.getRegister(n);if(":"==n)return s.keyBuffer[0]&&Xt.processCommand(t,s.keyBuffer[0]),void(i.isPlaying=!1);var r=s.keyBuffer,o=0;i.isPlaying=!0,i.replaySearchQueries=s.searchQueries.slice(0);for(var l=0;l<r.length;l++)for(var h,a,c=r[l];c;)if(a=(h=/<\w+-.+?>|<\w+>|./.exec(c))[0],c=c.substring(h.index+a.length),F.handleKey(t,a,"macro"),e.insertMode){var d=s.insertModeChanges[o++].changes;L.macroModeState.lastInsertModeChanges.changes=d,oe(t,d,1),Jt(t)}i.isPlaying=!1}function te(t,e){var i=L.macroModeState,n=i.lastInsertModeChanges;if(!i.isPlaying)for(;e;){if(n.expectCursorActivityForChange=!0,n.ignoreCount>1)n.ignoreCount--;else if("+input"==e.origin||"paste"==e.origin||void 0===e.origin){var s=t.listSelections().length;s>1&&(n.ignoreCount=s);var r=e.text.join("\n");n.maybeReset&&(n.changes=[],n.maybeReset=!1),r&&(t.state.overwrite&&!/\n/.test(r)?n.changes.push([r]):n.changes.push(r))}e=e.next}}function ee(t){var e=t.state.vim;if(e.insertMode){var i=L.macroModeState;if(i.isPlaying)return;var n=i.lastInsertModeChanges;n.expectCursorActivityForChange?n.expectCursorActivityForChange=!1:n.maybeReset=!0}else t.curOp.isVimOp||ie(t,e)}function ie(e,i){var n=e.getCursor("anchor"),s=e.getCursor("head");if(i.visualMode&&!e.somethingSelected()?mt(e,!1):i.visualMode||i.insertMode||!e.somethingSelected()||(i.visualMode=!0,i.visualLine=!1,t.signal(e,"vim-mode-change",{mode:"visual"})),i.visualMode){var r=st(s,n)?0:-1,o=st(s,n)?-1:0;s=Z(s,0,r),n=Z(n,0,o),i.sel={anchor:n,head:s},Ct(e,i,"<",rt(s,n)),Ct(e,i,">",ot(s,n))}else i.insertMode||(i.lastHPos=e.getCursor().ch)}function ne(t){this.keyName=t}function se(e){var i=L.macroModeState.lastInsertModeChanges,n=t.keyName(e);n&&(-1==n.indexOf("Delete")&&-1==n.indexOf("Backspace")||t.lookupKey(n,"vim-insert",(function(){return i.maybeReset&&(i.changes=[],i.maybeReset=!1),i.changes.push(new ne(n)),!0})))}function re(t,e,i,n){var s=L.macroModeState;s.isPlaying=!0;var r=!!e.lastEditActionCommand,o=e.inputState;function l(){r?_.processAction(t,e,e.lastEditActionCommand):_.evalInput(t,e)}function h(i){if(s.lastInsertModeChanges.changes.length>0){i=e.lastEditActionCommand?i:1;var n=s.lastInsertModeChanges;oe(t,n.changes,i)}}if(e.inputState=e.lastEditInputState,r&&e.lastEditActionCommand.interlaceInsertRepeat)for(var a=0;a<i;a++)l(),h(1);else n||l(),h(i);e.inputState=o,e.insertMode&&!n&&Jt(t),s.isPlaying=!1}function oe(e,i,n){function s(i){return"string"==typeof i?t.commands[i](e):i(e),!0}var r=e.getCursor("head"),o=L.macroModeState.lastInsertModeChanges.visualBlock;o&&(ut(e,r,o+1),n=e.listSelections().length,e.setCursor(r));for(var l=0;l<n;l++){o&&e.setCursor(Z(r,l,0));for(var h=0;h<i.length;h++){var a=i[h];if(a instanceof ne)t.lookupKey(a.keyName,"vim-insert",s);else if("string"==typeof a)e.replaceSelection(a);else{var c=e.getCursor(),d=Z(c,0,a[0].length);e.replaceRange(a[0],c,d),e.setCursor(d)}}}o&&e.setCursor(Z(r,0,1))}function le(t){var e=new t.constructor;return Object.keys(t).forEach((function(i){var n=t[i];Array.isArray(n)?n=n.slice():n&&"object"==typeof n&&n.constructor!=Object&&(n=le(n)),e[i]=n})),t.sel&&(e.sel={head:t.sel.head&&it(t.sel.head),anchor:t.sel.anchor&&it(t.sel.anchor)}),e}return t.keyMap.vim={attach:h,detach:l,call:a},B("insertModeEscKeysTimeout",200,"number"),t.keyMap["vim-insert"]={fallthrough:["default"],attach:h,detach:l,call:a},t.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:h,detach:l,call:a},I(),F}function rW(t,e){var i=e.ch,n=e.line+1;n<1&&(n=1,i=0),n>t.lines&&(n=t.lines,i=Number.MAX_VALUE);var s=t.line(n);return Math.min(s.from+Math.max(0,i),s.to)}function oW(t,e){let i=t.lineAt(e);return{line:i.number-1,ch:e-i.from}}class lW{constructor(t,e){this.line=t,this.ch=e}}function hW(t,e,i){if(t.addEventListener)t.addEventListener(e,i,!1);else{var n=t._handlers||(t._handlers={});n[e]=(n[e]||[]).concat(i)}}function aW(t,e,i){if(t.removeEventListener)t.removeEventListener(e,i,!1);else{var n=t._handlers,s=n&&n[e];if(s){var r=s.indexOf(i);r>-1&&(n[e]=s.slice(0,r).concat(s.slice(r+1)))}}}function cW(t,e,...i){var n,s=null===(n=t._handlers)||void 0===n?void 0:n[e];if(s)for(var r=0;r<s.length;++r)s[r](...i)}function dW(t,...e){if(t)for(var i=0;i<t.length;++i)t[i](...e)}var uW={Return:"CR",Backspace:"BS",Delete:"Del",Escape:"Esc",Insert:"Ins",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"CR"," ":"Space"},fW={Shift:1,Alt:1,Command:1,Control:1,CapsLock:1};let pW;try{pW=new RegExp("[\\w\\p{Alphabetic}\\p{Number}_]","u")}catch(t){pW=/[\w]/}function gW(t,e){if(e.annotations)try{e.annotations.some((function(t){"input"==t.value&&(t.value="input.type.compose")}))}catch(t){console.error(t)}else e.userEvent="input.type.compose";return t.dispatch(e)}class mW{constructor(t){this.state={},this.marks=Object.create(null),this.$mid=0,this.options={},this._handlers={},this.doc={history:{done:[{changes:[{cm:this,get to(){return this.cm.posFromIndex(this.cm.$lastChangeEndOffset)}}]}]}},this.$lastChangeEndOffset=0,this.virtualSelection=null,this.cm6=t,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this)}openDialog(t,e,i){return function(t,e,i,n){n||(n={});wW(t,void 0);var s=vW(t,e,n.bottom),r=!1;function o(e){if("string"==typeof e)l.value=e;else{if(r)return;r=!0,bW(t,s),t.state.dialog||t.focus(),n.onClose&&n.onClose(s)}}yW(t,s);var l=s.getElementsByTagName("input")[0];l&&(n.value&&(l.value=n.value,!1!==n.selectValueOnOpen&&l.select()),n.onInput&&mW.on(l,"input",(function(t){n.onInput(t,l.value,o)})),n.onKeyUp&&mW.on(l,"keyup",(function(t){n.onKeyUp(t,l.value,o)})),mW.on(l,"keydown",(function(t){n&&n.onKeyDown&&n.onKeyDown(t,l.value,o)||(13==t.keyCode&&i(l.value),(27==t.keyCode||!1!==n.closeOnEnter&&13==t.keyCode)&&(l.blur(),mW.e_stop(t),o()))})),!1!==n.closeOnBlur&&mW.on(l,"blur",(function(){setTimeout((function(){document.activeElement!==l&&o()}))})),l.focus());return o}(this,t,e,i)}openNotification(t,e){return function(t,e,i){wW(t,l);var n,s=vW(t,e,i&&i.bottom),r=!1,o=i&&void 0!==i.duration?i.duration:5e3;function l(){r||(r=!0,clearTimeout(n),s.remove(),bW(t,s))}s.onclick=function(t){t.preventDefault(),l()},yW(t,s),o&&(n=setTimeout(l,o));return l}(this,t,e)}on(t,e){hW(this,t,e)}off(t,e){aW(this,t,e)}signal(t,e,i){cW(this,t,e,i)}indexFromPos(t){return rW(this.cm6.state.doc,t)}posFromIndex(t){return oW(this.cm6.state.doc,t)}foldCode(t){let e=this.cm6,i=e.state.selection.ranges,n=rW(this.cm6.state.doc,t),s=L.create([L.range(n,n)],0).ranges;e.state.selection.ranges=s,pw(e),e.state.selection.ranges=i}firstLine(){return 0}lastLine(){return this.cm6.state.doc.lines-1}lineCount(){return this.cm6.state.doc.lines}setCursor(t,e){"object"==typeof t&&(e=t.ch,t=t.line);var i=rW(this.cm6.state.doc,{line:t,ch:e});this.cm6.dispatch({selection:{anchor:i}},{scrollIntoView:!this.curOp}),this.curOp&&!this.curOp.isVimOp&&this.onBeforeEndOperation()}getCursor(t){var e=this.cm6.state.selection.main,i="head"!=t&&t?"anchor"==t?e.anchor:"start"==t?e.from:"end"==t?e.to:null:e.head;if(null==i)throw new Error("Invalid cursor type");return this.posFromIndex(i)}listSelections(){var t=this.cm6.state.doc;return this.cm6.state.selection.ranges.map((e=>({anchor:oW(t,e.anchor),head:oW(t,e.head)})))}setSelections(t,e){var i=this.cm6.state.doc,n=t.map((t=>L.range(rW(i,t.anchor),rW(i,t.head))));this.cm6.dispatch({selection:L.create(n,e)})}setSelection(t,e,i){var n=this.cm6.state.doc,s=[L.range(rW(n,t),rW(n,e))];this.cm6.dispatch({selection:L.create(s,0)}),i&&"*mouse"==i.origin&&this.onBeforeEndOperation()}getLine(t){var e=this.cm6.state.doc;return t<0||t>=e.lines?"":this.cm6.state.doc.line(t+1).text}getLineHandle(t){return{text:this.getLine(t),row:t}}getLineNumber(t){return t.row}getRange(t,e){var i=this.cm6.state.doc;return this.cm6.state.sliceDoc(rW(i,t),rW(i,e))}replaceRange(t,e,i){i||(i=e);var n=this.cm6.state.doc,s=rW(n,e),r=rW(n,i);gW(this.cm6,{changes:{from:s,to:r,insert:t}})}replaceSelection(t){gW(this.cm6,this.cm6.state.replaceSelection(t))}replaceSelections(t){var e=this.cm6.state.selection.ranges.map(((e,i)=>({from:e.from,to:e.to,insert:t[i]||""})));gW(this.cm6,{changes:e})}getSelection(){return this.getSelections().join("\n")}getSelections(){var t=this.cm6;return t.state.selection.ranges.map((e=>t.state.sliceDoc(e.from,e.to)))}somethingSelected(){return this.cm6.state.selection.ranges.some((t=>!t.empty))}getInputField(){return this.cm6.contentDOM}clipPos(t){var e=this.cm6.state.doc,i=t.ch,n=t.line+1;n<1&&(n=1,i=0),n>e.lines&&(n=e.lines,i=Number.MAX_VALUE);var s=e.line(n);return i=Math.min(Math.max(0,i),s.to-s.from),new lW(n-1,i)}getValue(){return this.cm6.state.doc.toString()}setValue(t){var e=this.cm6;return e.dispatch({changes:{from:0,to:e.state.doc.length,insert:t},selection:L.range(0,0)})}focus(){return this.cm6.focus()}blur(){return this.cm6.contentDOM.blur()}defaultTextHeight(){return this.cm6.defaultLineHeight}findMatchingBracket(t){var e=this.cm6.state,i=rW(e.doc,t),n=aS(e,i+1,-1);return n&&n.end||(n=aS(e,i,1))&&n.end?{to:oW(e.doc,n.end.from)}:{to:void 0}}scanForBracket(t,e,i,n){return function(t,e,i,n,s){for(var r=s&&s.maxScanLineLength||1e4,o=s&&s.maxScanLines||1e3,l=[],h=function(t){return t&&t.bracketRegex||/[(){}[\]]/}(s),a=i>0?Math.min(e.line+o,t.lastLine()+1):Math.max(t.firstLine()-1,e.line-o),c=e.line;c!=a;c+=i){var d=t.getLine(c);if(d){var u=i>0?0:d.length-1,f=i>0?d.length:-1;if(!(d.length>r))for(c==e.line&&(u=e.ch-(i<0?1:0));u!=f;u+=i){var p=d.charAt(u);if(h.test(p)){var g=xW[p];if(g&&">"==g.charAt(1)==i>0)l.push(p);else{if(!l.length)return{pos:new lW(c,u),ch:p};l.pop()}}}}}return c-i!=(i>0?t.lastLine():t.firstLine())&&null}(this,t,e,0,n)}indentLine(t,e){e?this.indentMore():this.indentLess()}indentMore(){ak(this.cm6)}indentLess(){ck(this.cm6)}execCommand(t){"indentAuto"==t?mW.commands.indentAuto(this):console.log(t+" is not implemented")}setBookmark(t,e){var i=(null==e?void 0:e.insertLeft)?1:-1,n=this.indexFromPos(t);return new kW(this,n,i)}addOverlay({query:t}){let e=new ZH({regexp:!0,search:t.source,caseSensitive:!/i/.test(t.flags)});if(e.valid){e.forVim=!0,this.cm6Query=e;let t=nW.of(e);return this.cm6.dispatch({effects:t}),e}}removeOverlay(t){if(!this.cm6Query)return;this.cm6Query.forVim=!1;let e=nW.of(this.cm6Query);this.cm6.dispatch({effects:e})}getSearchCursor(t,e){var i=this,n=null,s=null;null==e.ch&&(e.ch=Number.MAX_VALUE);var r=rW(i.cm6.state.doc,e),o=t.source.replace(/(\\.|{(?:\d+(?:,\d*)?|,\d+)})|[{}]/g,(function(t,e){return e||"\\"+t}));function l(e,i=0,n=e.length){return new YH(e,o,{ignoreCase:t.ignoreCase},i,n)}return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){var e=i.cm6.state.doc;if(t){let t=n?n.from==n.to?n.to-1:n.from:r;n=function(t,e){var n=i.cm6.state.doc;for(let i=1;;i++){let s=Math.max(t,e-1e4*i),r=l(n,s,e),o=null;for(;!r.next().done;)o=r.value;if(o&&(s==t||o.from>s+10))return o;if(s==t)return null}}(0,t)}else{let t=n?n.from==n.to?n.to+1:n.to:r;n=function(t){var e=i.cm6.state.doc;if(t>e.length)return null;let n=l(e,t).next();return n.done?null:n.value}(t)}return s=n&&{from:oW(e,n.from),to:oW(e,n.to),match:n.match},n&&n.match},from:function(){return null==s?void 0:s.from},to:function(){return null==s?void 0:s.to},replace:function(t){n&&(gW(i.cm6,{changes:{from:n.from,to:n.to,insert:t}}),n.to=n.from+t.length,s&&(s.to=oW(i.cm6.state.doc,n.to)))}}}findPosV(t,e,i,n){let{cm6:s}=this;const r=s.state.doc;let o="page"==i?s.dom.clientHeight:0;const l=rW(r,t);let h=L.range(l,l,n),a=Math.round(Math.abs(e));for(let t=0;t<a;t++)"page"==i?h=s.moveVertically(h,e>0,o):"line"==i&&(h=s.moveVertically(h,e>0));return oW(r,h.head)}charCoords(t,e){var i=this.cm6.contentDOM.getBoundingClientRect(),n=rW(this.cm6.state.doc,t),s=this.cm6.coordsAtPos(n),r=this.cm6.scrollDOM.scrollTop-i.top;return{left:((null==s?void 0:s.left)||0)-i.left,top:((null==s?void 0:s.top)||0)+r,bottom:((null==s?void 0:s.bottom)||0)+r}}coordsChar(t,e){var i=this.cm6.contentDOM.getBoundingClientRect(),n=this.cm6.posAtCoords({x:t.left+i.left,y:t.top+i.top})||0;return oW(this.cm6.state.doc,n)}getScrollInfo(){var t=this.cm6.scrollDOM;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight,width:t.scrollWidth,clientHeight:t.clientHeight,clientWidth:t.clientWidth}}scrollTo(t,e){null!=t&&(this.cm6.scrollDOM.scrollLeft=t),null!=e&&(this.cm6.scrollDOM.scrollTop=e)}scrollIntoView(t,e){if(t){var i=this.indexFromPos(t);this.cm6.dispatch({effects:qh.scrollIntoView(i)})}else this.cm6.dispatch({scrollIntoView:!0,userEvent:"scroll"})}getWrapperElement(){return this.cm6.dom}getMode(){return{name:this.getOption("mode")}}setSize(t,e){this.cm6.dom.style.width=t+4+"px",this.cm6.dom.style.height=e+"px",this.refresh()}refresh(){this.cm6.measure()}destroy(){this.removeOverlay()}onChange(t){for(let e in this.marks){this.marks[e].update(t.changes)}this.virtualSelection&&(this.virtualSelection.ranges=this.virtualSelection.ranges.map((e=>e.map(t.changes))));var e=this.curOp=this.curOp||{};t.changes.iterChanges(((t,i,n,s,r)=>{this.$lastChangeEndOffset=s;var o={text:r.toJSON()};e.lastChange?e.lastChange.next=e.lastChange=o:e.lastChange=e.change=o}),!0),e.changeHandlers||(e.changeHandlers=this._handlers.change&&this._handlers.change.slice())}onSelectionChange(){var t=this.curOp=this.curOp||{};t.cursorActivityHandlers||(t.cursorActivityHandlers=this._handlers.cursorActivity&&this._handlers.cursorActivity.slice()),this.curOp.cursorActivity=!0}operation(t){this.curOp||(this.curOp={$d:0}),this.curOp.$d++;try{var e=t()}finally{this.curOp&&(this.curOp.$d--,this.curOp.$d||this.onBeforeEndOperation())}return e}onBeforeEndOperation(){var t=this.curOp,e=!1;t&&(t.change&&dW(t.changeHandlers,this,t.change),t&&t.cursorActivity&&(dW(t.cursorActivityHandlers,this,null),t.isVimOp&&(e=!0)),this.curOp=null),e&&this.scrollIntoView()}moveH(t,e){if("char"==e){var i=this.getCursor();this.setCursor(i.line,i.ch+t)}}setOption(t,e){if("keyMap"===t)this.state.keyMap=e}getOption(t){switch(t){case"firstLineNumber":return 1;case"tabSize":return this.cm6.state.tabSize||4;case"readonly":return this.cm6.state.readOnly;case"indentWithTabs":return"\t"==this.cm6.state.facet(Kf);case"indentUnit":return this.cm6.state.facet(Kf).length||2;case"keyMap":return this.state.keyMap||"vim"}}toggleOverwrite(t){this.state.overwrite=t}getTokenTypeAt(t){var e,i=this.indexFromPos(t),n=function(t,e,i=50){var n;let s=null===(n=t.field(Ef.state,!1))||void 0===n?void 0:n.context;return s&&(s.isDone(e)||s.work(i,e))?s.tree:null}(this.cm6.state,i),s=null==n?void 0:n.resolve(i),r=(null===(e=null==s?void 0:s.type)||void 0===e?void 0:e.name)||"";return/comment/i.test(r)?"comment":/string/i.test(r)?"string":""}overWriteSelection(t){var e=this.cm6.state.doc,i=this.cm6.state.selection,n=i.ranges.map((t=>{if(t.empty){var i=t.to<e.length?e.sliceString(t.from,t.to+1):"";if(i&&!/\n/.test(i))return L.range(t.from,t.to+1)}return t}));this.cm6.dispatch({selection:L.create(n,i.mainIndex)}),this.replaceSelection(t)}isInMultiSelectMode(){return this.cm6.state.selection.ranges.length>1}virtualSelectionMode(){return!!this.virtualSelection}forEachSelection(t){var e=this.cm6.state.selection;this.virtualSelection=L.create(e.ranges,e.mainIndex);for(var i=0;i<this.virtualSelection.ranges.length;i++){var n=this.virtualSelection.ranges[i];n&&(this.cm6.dispatch({selection:L.create([n])}),t(),this.virtualSelection.ranges[i]=this.cm6.state.selection.ranges[0])}this.cm6.dispatch({selection:this.virtualSelection}),this.virtualSelection=null}}function vW(t,e,i){var n=document.createElement("div");return n.appendChild(e),n}function wW(t,e){t.state.currentNotificationClose&&t.state.currentNotificationClose(),t.state.currentNotificationClose=e}function yW(t,e){var i=t.state.dialog;t.state.dialog=e,e&&i!==e&&(i&&i.contains(document.activeElement)&&t.focus(),i&&i.parentElement?i.parentElement.replaceChild(e,i):i&&i.remove(),mW.signal(t,"dialog"))}function bW(t,e){t.state.dialog==e&&(t.state.dialog=null,mW.signal(t,"dialog"))}mW.Pos=lW,mW.StringStream=WH,mW.commands={cursorCharLeft:function(t){mS(t.cm6)},redo:function(t){ua(t.cm6)},undo:function(t){da(t.cm6)},newlineAndIndent:function(t){rk({state:t.cm6.state,dispatch:e=>gW(t.cm6,e)})},indentAuto:function(t){hk(t.cm6)}},mW.defineOption=function(t,e,i){},mW.isWordChar=function(t){return pW.test(t)},mW.keys={Backspace:function(t){JS(t.cm6)},Delete:function(t){QS(t.cm6)}},mW.keyMap={},mW.addClass=function(){},mW.rmClass=function(){},mW.e_preventDefault=function(t){t.preventDefault()},mW.e_stop=function(t){var e,i;null===(e=null==t?void 0:t.stopPropagation)||void 0===e||e.call(t),null===(i=null==t?void 0:t.preventDefault)||void 0===i||i.call(t)},mW.keyName=function(t){var e=t.key;if(!fW[e]){"Escape"==e&&(e="Esc")," "==e&&(e="Space"),e.length>1&&(e=e.replace(/Numpad|Arrow/,"")),1==e.length&&(e=e.toUpperCase());var i="";return t.ctrlKey&&(i+="Ctrl-"),t.altKey&&(i+="Alt-"),(i||e.length>1)&&t.shiftKey&&(i+="Shift-"),i+=e}},mW.vimKey=function(t){var e=t.key;if(!fW[e]){e.length>1&&"n"==e[0]&&(e=e.replace("Numpad","")),e=uW[e]||e;var i="";return t.ctrlKey&&(i+="C-"),t.altKey&&(i+="A-"),t.metaKey&&(i+="M-"),(i||e.length>1)&&t.shiftKey&&(i+="S-"),(i+=e).length>1&&(i="<"+i+">"),i}},mW.lookupKey=function(t,e,i){var n=mW.keys[t];n&&i(n)},mW.on=hW,mW.off=aW,mW.signal=cW,mW.findMatchingTag=function(t,e){var i=t.cm6.state,n=t.indexFromPos(e),s=aS(i,n+1,-1,{brackets:"\n\n"});if(s){if(!s.end||!s.start)return;return{open:SW(i.doc,s.end),close:SW(i.doc,s.start)}}if(s=aS(i,n,1,{brackets:"\n\n"})){if(!s.end||!s.start)return;return{open:SW(i.doc,s.start),close:SW(i.doc,s.end)}}},mW.findEnclosingTag=function(t,e){var i=t.cm6.state,n=t.indexFromPos(e),s=i.sliceDoc(0,n),r=n;for(;r>0;){var o=aS(i,r,1,{brackets:"\n\n"});if(o&&o.start&&o.end)return{open:SW(i.doc,o.start),close:SW(i.doc,o.end)};r=s.lastIndexOf(">",r-1)}};var xW={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function SW(t,e){return{from:oW(t,e.from),to:oW(t,e.to)}}class kW{constructor(t,e,i){this.cm=t,this.id=t.$mid++,this.offset=e,this.assoc=i,t.marks[this.id]=this}clear(){delete this.cm.marks[this.id]}find(){return null==this.offset?null:this.cm.posFromIndex(this.offset)}update(t){null!=this.offset&&(this.offset=t.mapPos(this.offset,this.assoc,k.TrackDel))}}class AW{constructor(t,e,i,n,s,r,o,l,h,a){this.left=t,this.top=e,this.height=i,this.fontFamily=n,this.fontSize=s,this.fontWeight=r,this.color=o,this.className=l,this.letter=h,this.partial=a}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",t.style.height=this.height+"px",t.style.lineHeight=this.height+"px",t.style.fontFamily=this.fontFamily,t.style.fontSize=this.fontSize,t.style.fontWeight=this.fontWeight,t.style.color=this.partial?"transparent":this.color,t.className=this.className,t.textContent=this.letter}eq(t){return this.left==t.left&&this.top==t.top&&this.height==t.height&&this.fontFamily==t.fontFamily&&this.fontSize==t.fontSize&&this.fontWeight==t.fontWeight&&this.color==t.color&&this.className==t.className&&this.letter==t.letter}}class MW{constructor(t,e){this.view=t,this.rangePieces=[],this.cursors=[],this.cm=e,this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.cursorLayer=t.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer cm-vimCursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),t.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration="1200ms"}update(t){(t.selectionSet||t.geometryChanged||t.viewportChanged)&&(this.view.requestMeasure(this.measureReq),this.cursorLayer.style.animationName="cm-blink"==this.cursorLayer.style.animationName?"cm-blink2":"cm-blink")}scheduleRedraw(){this.view.requestMeasure(this.measureReq)}readPos(){let{state:t}=this.view,e=[];for(let i of t.selection.ranges){let n=i==t.selection.main,s=DW(this.cm,this.view,i,n);s&&e.push(s)}return{cursors:e}}drawSel({cursors:t}){if(t.length!=this.cursors.length||t.some(((t,e)=>!t.eq(this.cursors[e])))){let e=this.cursorLayer.children;if(e.length!==t.length){this.cursorLayer.textContent="";for(const e of t)this.cursorLayer.appendChild(e.draw())}else t.forEach(((t,i)=>t.adjust(e[i])));this.cursors=t}}destroy(){this.cursorLayer.remove()}}const CW={".cm-vimMode .cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-fat-cursor":{position:"absolute",background:"#ff9696",border:"none",whiteSpace:"pre"},"&:not(.cm-focused) .cm-fat-cursor":{background:"none",outline:"solid 1px #ff9696"}},OW=X.override(qh.theme(CW));function DW(t,e,i,n){let s=i.head,r=!1,o=1,l=t.state.vim;if(l&&(!l.insertMode||t.state.overwrite)){if(r=!0,l.visualBlock&&!n)return null;i.anchor<i.head&&s--,t.state.overwrite?o=.2:l.status&&(o=.5)}if(r){let t=e.coordsAtPos(s,i.assoc||1);if(!t)return null;let r=function(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==el.LTR?e.left:e.right-t.scrollDOM.clientWidth)-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}}(e),l=e.domAtPos(s),h=l?l.node:e.contentDOM;for(;l&&l.node instanceof HTMLElement;)h=l.node,l={node:l.node.childNodes[l.offset],offset:0};h instanceof HTMLElement||(h=h.parentNode);let a=getComputedStyle(h),c=s<e.state.doc.length&&e.state.sliceDoc(s,s+1);c&&"\n"!=c&&"\r"!=c||(c=" ");let d=t.bottom-t.top;return new AW(t.left-r.left,t.top-r.top+d*(1-o),d*o,a.fontFamily,a.fontSize,a.fontWeight,a.color,n?"cm-fat-cursor cm-cursor-primary":"cm-fat-cursor cm-cursor-secondary",c,1!=o)}return null}const TW=sW(mW),BW=qh.baseTheme({".cm-vimMode .cm-cursorLayer:not(.cm-vimCursorLayer)":{display:"none"},".cm-vim-panel":{padding:"0px 10px",fontFamily:"monospace",minHeight:"1.3em"},".cm-vim-panel input":{border:"none",outline:"none",backgroundColor:"inherit"},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"}}),EW=_o.fromClass(class{constructor(t){this.status="",this.query=null,this.decorations=wo.none,this.view=t;const e=this.cm=new mW(t);TW.enterVimMode(this.cm),this.view.cm=this.cm,this.cm.state.vimPlugin=this,this.blockCursor=new MW(t,e),this.updateClass(),this.cm.on("vim-command-done",(()=>{e.state.vim&&(e.state.vim.status=""),this.blockCursor.scheduleRedraw(),this.updateStatus()})),this.cm.on("vim-mode-change",(t=>{e.state.vim.mode=t.mode,t.subMode&&(e.state.vim.mode+=" block"),e.state.vim.status="",this.blockCursor.scheduleRedraw(),this.updateClass(),this.updateStatus()})),this.cm.on("dialog",(()=>{this.cm.state.statusbar?this.updateStatus():t.dispatch({effects:LW.of(!!this.cm.state.dialog)})})),this.dom=document.createElement("span"),this.dom.style.cssText="position: absolute; right: 10px; top: 1px"}update(t){var e;if(t.docChanged&&(this.cm.onChange(t),this.query&&this.highlight(this.query)),t.selectionSet&&this.cm.onSelectionChange(),t.viewportChanged,this.cm.curOp&&!this.cm.curOp.isVimOp&&this.cm.onBeforeEndOperation(),t.transactions)for(let i of t.transactions)for(let t of i.effects)if(t.is(nW)){if(null===(e=t.value)||void 0===e?void 0:e.forVim){let e=t.value.create();this.highlight(e)}else this.highlight(null)}this.blockCursor.update(t)}updateClass(){const t=this.cm.state;!t.vim||t.vim.insertMode&&!t.overwrite?this.view.scrollDOM.classList.remove("cm-vimMode"):this.view.scrollDOM.classList.add("cm-vimMode")}updateStatus(){let t=this.cm.state.statusbar;if(!t)return;let e=this.cm.state.dialog,i=this.cm.state.vim;e?e.parentElement!=t&&(t.textContent="",t.appendChild(e)):t.textContent=`--${(i.mode||"normal").toUpperCase()}--`,this.dom.textContent=i.status,t.appendChild(this.dom)}destroy(){this.cm.state.vim=null,this.updateClass(),this.blockCursor.destroy(),delete this.view.cm}highlight(t){if(this.query=t,!t)return this.decorations=wo.none;let{view:e}=this,i=new Wt;for(let n=0,s=e.visibleRanges,r=s.length;n<r;n++){let{from:o,to:l}=s[n];for(;n<r-1&&l>s[n+1].from-500;)l=s[++n].to;t.highlight(e.state.doc,o,l,((t,e)=>{i.add(t,e,RW)}))}return this.decorations=i.finish()}},{eventHandlers:{keydown:function(t,e){const i=mW.vimKey(t),n=this.cm;if(!i)return;let s=n.state.vim;"<Esc>"!=i||s.insertMode||s.visualMode||!this.query||n.removeOverlay(null),n.state.vim.status=(n.state.vim.status||"")+i;let r=TW.multiSelectHandleKey(n,i,"user");return!r&&n.state.vim.insertMode&&n.state.overwrite&&(t.key&&1==t.key.length&&!/\n/.test(t.key)?(r=!0,n.overWriteSelection(t.key)):"Backspace"==t.key&&(r=!0,mW.commands.cursorCharLeft(n))),r&&(t.preventDefault(),t.stopPropagation(),this.blockCursor.scheduleRedraw()),this.updateStatus(),!!r}},decorations:t=>t.decorations}),RW=wo.mark({class:"cm-searchMatch"}),LW=ft.define(),VW=K.define({create:()=>!1,update(t,e){for(let i of e.effects)i.is(LW)&&(t=i.value);return t},provide:t=>XB.from(t,(t=>t?NW:null))});function NW(t){let e=document.createElement("div");e.className="cm-vim-panel";let i=t.cm;return i.state.dialog&&e.appendChild(i.state.dialog),{top:!1,dom:e}}function PW(t){let e=document.createElement("div");e.className="cm-vim-panel";let i=t.cm;return i.state.statusbar=e,i.state.vimPlugin.updateStatus(),{dom:e}}H.define();const HW=_o.fromClass(class{update(t){const e=[];for(const{from:i,to:n}of t.view.visibleRanges){const s=t.view.state.doc.lineAt(i),r=t.view.state.doc.lineAt(n);for(let i=s.number;i<=r.number;i++){const n=t.view.state.doc.line(i),s=(n.text.indexOf("- "),/\[\[([^\]]*)\]\]/g);let r;for(;null!==(r=s.exec(n.text));){let t=r.index,i=r[0].length;e.push(wo.mark({inclusive:!1,class:"cm-wikilink"}).range(n.from+t,n.from+t+i))}}}this.decorations=wo.set(e)}constructor(){this.decorations=wo.none}},{decorations:t=>t.decorations,eventHandlers:{mousedown:(t,e)=>{let i=t.target;e.state.doc.lineAt(e.posAtDOM(i));i.classList.contains("cm-wikilink")&&console.log("pressed wikilink")},mousemove:(t,e)=>{t.target},dragstart:(t,e)=>{t.target},drag:(t,e)=>{t.target},dragenter:(t,e)=>{t.target}}});function WW(t,e){for(let i=e;i>=1;i--){const e=FW(t.line(i).text);if(e>0)return e}return 0}function IW(t,e){for(let i=e;i>=1;i--){const e=FW(t.line(i).text);if(e>0)return{rootBlockLine:i,blockLevel:e}}return{rootBlockLine:0,blockLevel:0}}function FW(t){const e=t.indexOf("- ");return e>=0?e+2:0}const zW=Mt.transactionFilter.of((t=>{const e=t.newDoc,i=[];return t.changes.iterChanges(((t,n,s,r,o)=>{const l=e.lineAt(t),h=e.lineAt(r);for(let t=l.number;t<=h.number;t++){const n=e.line(t);if(FW(n.text)<=0){const s=WW(e,t)-(n.text.length-n.text.trimLeft().length)-2;s>-2&&i.push({from:n.from,insert:" ".repeat(s)+"- "})}}})),[t,{changes:i,sequential:!0}]})),qW=ft.define(),KW=H.define(),GW=Mt.transactionFilter.of((t=>{let e=t.startState.facet(KW);if(e.length){const i=t.effects.filter((t=>t.is(qW))).map((t=>t.value));e.forEach((t=>{t(i)}))}return t}));class jW extends mo{constructor(t){super(),this.level=t}eq(t){return t.level==this.level}toDOM(){const t=document.createElement("span");t.classList.add("cm-dot");const e=document.createElement("span");return e.style.paddingRight="0.7ch",e.appendChild(t),e}ignoreEvent(){return!1}}const _W=_o.fromClass(class{update(t){const e=[];for(const{from:i,to:n}of t.view.visibleRanges){const s=t.view.state.doc.lineAt(i),r=t.view.state.doc.lineAt(n);for(let i=s.number;i<=r.number;i++){const n=t.view.state.doc.line(i),s=n.text.indexOf("- ");s>=0&&e.push(wo.replace({widget:new jW(s),inclusiveStart:!0}).range(n.from+s,n.from+s+2))}}this.decorations=wo.set(e)}constructor(){this.decorations=wo.none}},{decorations:t=>t.decorations,eventHandlers:{mousedown:(t,e)=>{let i=t.target;const n=e.state.doc.lineAt(e.posAtDOM(i));i.classList.contains("cm-dot")&&(console.log("mouse down on",n),t.preventDefault())},mousemove:(t,e)=>{t.target},dragstart:(t,e)=>{t.target},drag:(t,e)=>{t.target},dragenter:(t,e)=>{t.target}}}),UW=H.define({combine:t=>t.length?t[0]:2}),$W=Mt.transactionFilter.of((t=>{const{doc:e}=t.startState,i=[],n=[],s=t.startState.facet(UW);return t.changes.iterChanges(((r,o,l,h,a)=>{const c=e.lineAt(r),d=WW(e,c.number);if(r===c.from&&r===o&&1===a.lines&&!a.line(1).text.trim().length)return console.log("level increased"),n.push(qW.of({fromLevel:Math.floor(d/s),toLevel:Math.floor((d+a.line(1).length)/s),lineNumber:c.number})),t;const u=o-c.from;if(l===h&&1===a.lines&&u<d)return console.log(`level decreased from ${d} to ${u}`),n.push(qW.of({fromLevel:Math.floor(d/s),toLevel:Math.floor(u/s),lineNumber:c.number})),t;if(r>c.from&&r-c.from<d){console.log("deleting line");const t=1===c.number?0:1;i.push({from:c.from-t,to:c.from+d,insert:""})}})),[t,{changes:i,effects:n,sequential:!1}]})),YW=Jh.of([{key:"Tab",preventDefault:!0,run:t=>XW(t,"increase"),shift:t=>XW(t,"decrease")}]);function XW(t,e){const i=[],n=t.state.selection.ranges.map((e=>t.state.doc.lineAt(e.from)));for(const s of n)if("increase"===e)console.log("increase"),i.push({from:s.from,insert:"  "});else{if("decrease"!==e)throw new Error("Unhandled mode: "+e);{const{rootBlockLine:e,blockLevel:n}=IW(t.state.doc,s.number);e&&n-2>0&&(console.log(`decrease rootBlockLine=${e}, blockLevel=${n}`),i.push({from:s.from,to:s.from+2}))}}return!!i.length&&(t.dispatch({changes:i}),!0)}const JW=qh.baseTheme({".cm-dot":{height:"1.3ch",width:"1.3ch",backgroundColor:"#bbb",borderRadius:"50%",display:"inline-block",cursor:"grab"},".cm-dot:hover":{backgroundColor:"#000"},".cm-wikilink":{color:"#AA5555",cursor:"pointer"}}),QW=Mt.transactionFilter.of((t=>{const e=t.newDoc;let i;for(const{head:n,anchor:s}of t.newSelection.ranges){const t=e.lineAt(n),r=WW(e,t.number),o=t.from+r,l=e.lineAt(s),h=WW(e,l.number),a=l.from+h;let c=n,d=s;n<=o&&(c=o),s<=a&&(d=a),c===n&&d===s||(i={anchor:d,head:c})}return[t,{selection:i,sequential:!0}]}));!function(){const t=document.getElementById("version");t&&(t.textContent="0.7.6")}();const ZW=Mt.create({doc:["- Indent block with Tab","- and use Shift-Tab to decrease the block indentation","- itemA [[test]]","  - itemB","    - itemC","- itemD"].join("\n"),extensions:[function(t={}){return[BW,EW,OW,t.status?XB.of(PW):VW]}(),[HW,_W,JW,GW,QW,zW,$W,YW],PH,KW.of((t=>{!function(t){const e=document.getElementById("notifications");if(!e)return void console.error("Could not find notifications container.");const i=document.createElement("div");i.textContent=t,e.prepend(i)}(JSON.stringify(t))}))]});new Bs({parent:document.getElementById("editor")??void 0,state:ZW});
//# sourceMappingURL=index.b70792b4.js.map
